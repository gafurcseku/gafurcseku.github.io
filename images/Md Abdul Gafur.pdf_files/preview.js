define(["require","exports","tslib","react","external/classnames","modules/clean/search/logger","modules/clean/search/store_helpers"],function(e,i,t,r,s,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=(function(e){function i(i){var t=e.call(this,i)||this;return t.setSelfDivRef=function(e){t.topDiv=e},t.setImageRef=function(e){t.image=e},t.imageLoadHandler=function(){t.image&&(t.props.visible?t.logCompleted():t.hasStartedLogging&&t.logFailed("user-cancel"),t.isImageTooSmall()||t.setState({imageUrl:t.image.src}))},t.imageErrorHandler=function(){t.setState({imageUrl:void 0}),t.logFailed("server-error")},t.state={imageUrl:void 0},t.previewRequestId=o.generateRandomId(),t}return t.__extends(i,e),i.prototype.previewUrl=function(){return this.props.result.hover_preview_url||void 0},i.prototype.isImageTooSmall=function(){return!this.image||this.image.naturalWidth<=64&&this.image.naturalHeight<=64},i.prototype.basicLogDetails=function(){var e=this.props;return{searchSessionId:e.searchSessionId,result:e.result,user:e.user,previewRequestId:this.previewRequestId}},i.prototype.logStarted=function(){this.hasStartedLogging||(a.logHoverPreviewStarted(this.basicLogDetails()),this.hasStartedLogging=!0)},i.prototype.logCompleted=function(){this.hasFinishedLogging||this.image&&this.topDiv&&(a.logHoverPreviewCompleted(t.__assign({},this.basicLogDetails(),{latency:(new Date).getTime()-this.imageDownloadStart,displayed:!this.isImageTooSmall()&&"none"!==window.getComputedStyle(this.topDiv).display})),this.hasFinishedLogging=!0)},i.prototype.logFailed=function(e){this.hasFinishedLogging||(a.logHoverPreviewFailed(t.__assign({},this.basicLogDetails(),{failureType:e})),this.hasFinishedLogging=!0)},i.prototype.componentDidMount=function(){this.image&&(this.props.visible&&this.logStarted(),this.imageDownloadStart=(new Date).getTime(),this.image.addEventListener("load",this.imageLoadHandler),this.image.addEventListener("error",this.imageErrorHandler))},i.prototype.componentWillReceiveProps=function(e){e.visible&&!this.props.visible&&(this.logStarted(),this.state.imageUrl&&this.logCompleted()),!e.visible&&this.props.visible&&this.logFailed("user-cancel")},i.prototype.render=function(){var e=this.props,i=e.visible,t=e.position;if(!this.previewUrl())return null;var a=void 0!==t&&t<170;return r.createElement("div",{ref:this.setSelfDivRef,className:s({"search-bar__preview":!0,"search-bar__preview--visible":i&&!!this.state.imageUrl,"search-bar__preview--align-bottom":a})},r.createElement("div",null,r.createElement("img",{src:this.previewUrl(),ref:this.setImageRef,alt:"","aria-hidden":"true"})))},i})(r.Component);i.SearchBarDropdownPreview=n});
//# sourceMappingURL=preview.min.js-vflx-kPpU.map