define(["require","exports","tslib","react","classnames","spectrum/tertiary_link","spectrum_comments/comment","spectrum_comments/thread/thread_editor"],function(e,t,n,o,r,s,i,a){"use strict";function c(e){var t=e.count,n=t>1?t+" comments":t+" comment";return o.createElement("div",{className:"sc-thread-comment-number"},n)}function d(e,t){return{onDeleted:function(){return t.onCommentDeleted(e.id)},onEdited:function(n){return t.onCommentEdited(e.id,n)},onMentionsQueryUpdated:t.onMentionsQueryUpdated,onClickTimeCode:t.onClickTimeCode}}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){},m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isEditorEmpty:!0,shouldFocus:!1},t._isMounted=!1,t.onEditorCancel=t.props.onCancel,t.clickInactive=function(){t.setState({shouldFocus:!0}),t.props.onActivated()},t.onEditorContentChange=function(e){var n=e.isEmpty;e.isFocused&&t.props.actions.onEditorFocused(),t.setState({isEditorEmpty:n})},t.onEditorPost=t.props.actions.onReply,t.onMentionsQueryUpdated=t.props.actions.onMentionsQueryUpdated,t.setRef=function(e){t.ref=e},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.scrollToElem,n=void 0===t?function(){return Promise.resolve()}:t,o=this.ref;this._isMounted=!0,o&&this.props.active&&(n(o).then(function(){e._isMounted&&e.setState({shouldFocus:!0})}),this.props.onActivated())},t.prototype.componentWillUnmount=function(){this._isMounted=!1},Object.defineProperty(t.prototype,"active",{get:function(){return this.props.active||!this.state.isEditorEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){var e=this.props,t=e.className,n=void 0===t?"":t,o=e.thread,s=e.isMobile;return r(n,{"sc-thread":!0,"sc-thread-active":this.active,"sc-thread-inactive":!this.active,"sc-thread-read":o.read,"sc-thread-unread":!o.read,"sc-thread-resolved":o.resolved,"sc-thread-unresolved":!o.resolved,"sc-thread-mobile":s})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredReplies",{get:function(){var e=this.props.thread.comments;e[0];return e.slice(1).filter(function(e){return!e.deleted})},enumerable:!0,configurable:!0}),t.prototype.truncateComment=function(e){var t=e.content.text;if(t.length>100){var o=e.content.metadata;return n.__assign({},e,{content:{metadata:o.reduce(function(e,t){if("sticker"===t.type)return e.concat([t]);var o=t.location;return o.start<100?e.concat([n.__assign({},t,{location:n.__assign({},o,{end:Math.min(o.end,100)})})]):e},[]),text:t.substr(0,100)+"…"}})}return e},t.prototype.renderComment=function(e,t,n,r){void 0===n&&(n=i.Comment);var s=this.props,a=s.actions,c=s.editedComment,l=s.mentionsMatches,m=(s.onStartEdit,s.onEndEdit,s.isMobile),u=!!c&&e.id===c.id;return t||(e=this.truncateComment(e)),o.createElement(n,{actions:d(e,a),active:t,annotation:r,comment:e,key:e.id,isEditing:u,onStartEdit:this.props.onStartEdit,onEndEdit:this.props.onEndEdit,mentionsMatches:l,isMobile:m})},t.prototype.renderReadToggle=function(){var e=this.props,t=e.actions,n=e.thread,r=n.read?t.onMarkAsUnread:t.onMarkAsRead,i=n.read?"Mark as unread":"Mark as read";return o.createElement(s.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-left",onClick:r},i)},t.prototype.renderToplineControls=function(){var e=this.props,t=e.user,n=e.isMobile,r=e.actions,i=e.thread;if(!t||n)return null;var a=this.active;return i.resolved?o.createElement("div",{className:"sc-thread-controls"},o.createElement("div",{className:"sc-thread-controls-resolved-note sc-thread-controls-left"},"Marked resolved"),a&&o.createElement(s.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-right",onClick:r.onUnresolve},"Restore")):a?o.createElement("div",{className:"sc-thread-controls"},this.renderReadToggle(),o.createElement(s.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-right",onClick:r.onResolve},"Resolve")):null},t.prototype.renderActive=function(){var e=this,t=this.props,n=(t.actions,t.commentComponent),r=t.mentionsMatches,s=t.thread,c=t.user,d=t.isMobile,l=this.filteredReplies,m=null;return c&&(m=o.createElement(a.ThreadEditor,{author:c,shouldFocus:this.state.shouldFocus,mentionsMatches:r,onCancel:this.onEditorCancel,onContentChange:this.onEditorContentChange,onMentionsQueryUpdated:this.onMentionsQueryUpdated,onPost:this.onEditorPost})),o.createElement("li",{className:this.className,ref:this.setRef},this.renderToplineControls(),o.createElement("ul",{className:"sc-thread-comments"},this.renderComment(s.comments[0],this.active,n,s.annotation),l.map(function(t){return e.renderComment(t,!0,i.Comment)})),!d&&m)},t.prototype.renderInactive=function(){var e=this.props,t=e.active,n=e.commentComponent,r=void 0===n?i.Comment:n,s=e.mentionsMatches,a=(e.onActivated,e.thread),d=e.isMobile,m=e.user,u=this.filteredReplies;return o.createElement("li",{className:this.className,tabIndex:0,onClick:this.clickInactive,ref:this.setRef},this.renderToplineControls(),o.createElement("ul",{className:"sc-thread-comments"},this.renderComment(a.comments[0],t,r,a.annotation),u.length>1&&o.createElement(c,{count:u.length-1}),u.length>0&&o.createElement(i.Comment,{active:!1,comment:this.truncateComment(u[u.length-1]),actions:{onClickTimeCode:l,onDeleted:l,onEdited:l,onMentionsQueryUpdated:l},mentionsMatches:s,onEndEdit:l,onStartEdit:l,isEditing:!1,isMobile:d})),m&&o.createElement("div",{className:"sc-thread-reply-hint"},"Reply…"))},t.prototype.render=function(){return this.props.thread.comments.every(function(e){return!!e.deleted})?null:this.active?this.renderActive():this.renderInactive()},t})(o.PureComponent);t.Thread=m});
//# sourceMappingURL=thread.min.js-vflPtahrj.map