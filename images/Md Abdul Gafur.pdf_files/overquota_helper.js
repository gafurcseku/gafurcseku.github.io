define(["require","exports","modules/core/i18n","modules/clean/ajax_as_promised","modules/clean/display_format","modules/clean/growth/experiments/overquota_sharing_helper","modules/clean/react/overquota_modal_controller","modules/clean/viewer"],function(e,r,o,t,a,n,u,s){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OverquotaHelper={getVariantSubgrowthProOQNewFolder:function(){return new Promise(function(e,r){var o=s.Viewer.get_viewer().get_users()[0];return o||r("Error: no user found."),t.SilentBackgroundRequest({url:"/subgrowth_pro_oq_new_folder_variant",data:{_subject_uid:o.id}}).then(function(e){return JSON.parse(e)}).then(function(r){e(r.variant)}).catch(function(e){r(e)})})},showSubgrowthProOQNewFolderModal:function(e){var t=e.oqa;u.showOverquota({oqa:t,tagline:o._("You’ll need more space to add new folders.")}),r.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("V1")},logExposureSubgrowthProOQNewFolderModal:function(e){t.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_oq_new_folder",variant:e}})},getVariantSubgrowthProWebTraySharedFolder:function(){return new Promise(function(e,r){var o=s.Viewer.get_viewer().get_users()[0];return o||r("Error: no user found."),t.SilentBackgroundRequest({url:"/subgrowth_pro_web_tray_shared_folder_variant",dataType:"json",data:{_subject_uid:o.id}}).then(function(r){e(r)}).catch(function(e){r(e)})})},getVariantSubgrowthProShmCtaCopy:function(){return new Promise(function(e,r){var o=s.Viewer.get_viewer().get_users()[0];return o||r("Error: no user found."),t.SilentBackgroundRequest({url:"/subgrowth_pro_shm_cta_copy",dataType:"json",data:{_subject_uid:o.id}}).then(function(r){e(r)}).catch(function(e){r(e)})})},logExposureSubgrowthProOQWebTraySharedFolder:function(e){t.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_oq_web_tray_shared_folder",variant:e}})},showSubgrowthProOQWebTraySharedFolderModal:function(e){var a=e.oqa;r.OverquotaHelper.getVariantSubgrowthProShmCtaCopy().then(function(e){var r=e.variant,s=o._("Upgrade to add folder"),d="Upgrade to add folder";if("OFF"!==r){var i=n.getModalConfigSubgrowthProShmCtaCopy(r);s=i.buttonText,d=i.buttonTextUntranslated,t.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_shm_cta_copy",variant:r}})}u.showOverquota({oqa:a,headline:o._("Not enough space"),tagline:o._("To add this folder, you’ll need more space in your Dropbox."),ctaText:s,ctaTextUntranslated:d})})},logExposureSubgrowthProNQWebTraySharedFolder:function(e){t.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_nq_web_tray_shared_folder",variant:e}})},showSubgrowthProNQWebTraySharedFolderModal:function(e){var s=e.oqa,d=e.spaceNeeded,i=e.spaceLeft,_=o._("Get more space"),l="Get more space",c=o._("You’ll need more space to add new folders.");d&&i&&(c=o._("You need %(needed)s of space to add this folder, but you only have %(left)s left in your Dropbox account").format({needed:a.format_bytes(d),left:a.format_bytes(i)})),r.OverquotaHelper.getVariantSubgrowthProShmCtaCopy().then(function(e){var r=e.variant;if("OFF"!==r){var a=n.getModalConfigSubgrowthProShmCtaCopy(r);_=a.buttonText,l=a.buttonTextUntranslated,t.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_shm_cta_copy",variant:r}})}u.showOverquota({oqa:s,headline:o._("Not enough space"),tagline:c,ctaText:_,ctaTextUntranslated:l})})},maybeShowSubgrowthProOQRecurringModal:function(e){var r=s.Viewer.get_viewer().get_users()[0];r&&t.SilentBackgroundRequest({url:"/get_subgrowth_pro_oq_modal_recurring_variant",data:{_subject_uid:r.id}}).then(function(a){try{var n=JSON.parse(a).variant;n&&("V1"===n&&(u.showOverquota({oqa:e,tagline:o._("You’ll need more space to add new files or folders.")}),t.SilentBackgroundRequest({url:"/set_subgrowth_pro_oq_modal_timestamp",data:{_subject_uid:r.id}})),t.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_oq_modal_recurring",variant:n}}))}catch(e){}})},maybeShowSubgrowthProOQFileRequestModal:function(e,r){return new Promise(function(a,n){var d=s.Viewer.get_viewer().get_users()[0];d?e?t.SilentBackgroundRequest({url:"/get_subgrowth_pro_oq_file_request_variant",data:{_subject_uid:d.id}}).then(function(e){var n=JSON.parse(e).variant,s="V1"===n;s&&u.showOverquota({oqa:r,tagline:o._("Get more space so you can send file requests.")}),t.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_oq_file_request",variant:n}}),a(s)}):a(!1):n("Error: no user found.")})}}});
//# sourceMappingURL=overquota_helper.min.js-vflVNyMBF.map