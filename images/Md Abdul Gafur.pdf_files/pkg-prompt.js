define("modules/clean/admin/megaphone/prompt/api/utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){var t=function(e){return e.replace(/_(.)/g,function(e,t){return t.toUpperCase()})},o=function(e,t){if(null===t)return null;if(Array.isArray(t)){var n=[];return t.forEach(function(t){n.push(o(e,t))}),n}if("object"==typeof t){var r={};return Object.keys(t).forEach(function(n){r[e(n)]=o(e,t[n])}),r}return t},n=function(e,t){return o(e,t)};e.toCamelCase=function(e){return n(t,e)},e.jsonToCamelCase=function(t){var o=JSON.parse(t);return e.toCamelCase(o)},e.stringToCamelCase=function(e){return t(e)}})(t.APIUtils||(t.APIUtils={})),t.isVersion=function(e){return void 0!==e.id},t.isCreateVersionArg=function(e){return void 0===e.id},t.versionResultToUpdateVersionArg=function(e){return{id:e.id,content:e.content,description:e.description,name:e.name,stormcrow_variant:e.stormcrow_variant}},t.isAdActive=function(e){return!!e.ad&&!!e.ad.lifecycle_state&&"active"===e.ad.lifecycle_state[".tag"]},t.isCampaignArchived=function(e){return"archived"===e.lifecycle_state[".tag"]},t.isCampaignApproved=function(e){return"approved"===e.lifecycle_state[".tag"]},t.isVersionApproved=function(e){return"approved"===e.lifecycle_state[".tag"]},t.isVersionArchived=function(e){return"archived"===e.lifecycle_state[".tag"]},t.isVersionPending=function(e){return"pending_approval"===e.lifecycle_state[".tag"]}}),define("modules/clean/deprecated/uirequest",["require","exports","external/lodash","jquery","modules/clean/ajax","modules/clean/css","modules/clean/dbmodal","modules/clean/legacy_pyxl_controllers/ajax_form","modules/core/html","modules/core/i18n","modules/core/notify","modules/pagelet_config"],function(e,t,o,n,r,a,i,s,l,c,d,p){"use strict";return(function(){function e(e,t,n){if(null==n&&(n={}),this.success=this.success.bind(this),this.perform_actions=this.perform_actions.bind(this),this.error=this.error.bind(this),this.handle_errors=this.handle_errors.bind(this),this.complete=this.complete.bind(this),this.$node=e,this.url=t,this.options=n,this.shouldDelayComplete=!1,this.$node.hasClass("ajax-loading"))return!1;this.$node.addClass("ajax-loading"),r.FormWebRequest({url:this.url,type:null!=this.options.type?this.options.type:void 0,data:this.options.data||{},success:this.success,error:this.error,complete:this.complete,subject_user:this.options.subject_user,headers:o.assignIn({"X-RequireJS-Context":p.REQUIREJS_CONFIG.context,"X-UIRequest-Version":3},this.options.headers)})}return e.prototype.success=function(e,t,o){var n=this,r=s.extract_errors(o.responseText);return r?(this.handle_errors(r),void("function"==typeof this.options.error&&this.options.error(o,t))):(e=JSON.parse(o.responseText),e.redirect?void(window.location.href=e.redirect):e.reload?void window.location.reload():(this.shouldDelayComplete=e.js||e.css,this.shouldDelayComplete?a.require_css_multi(e.css,function(){return n.perform_actions(e.actions||[]),"function"==typeof n.options.success&&n.options.success(e,t,o),n.$node.removeClass("ajax-loading"),"function"==typeof n.options.complete?n.options.complete(o,t):void 0}):(this.perform_actions(e.actions||[]),void("function"==typeof this.options.success&&this.options.success(e,t,o)))))},e.prototype.perform_actions=function(e){var t=this;return(function(){for(var o=[],r=0,a=Array.from(e);r<a.length;r++){var s=a[r],c=Array.from(s),p=c[0],u=c[1],m=c[2],h=t.$node;if(m&&"modal"!==p){if("^"===m.charAt(0)){var f=m.split(" ");h=h.closest(f[0].substr(1)),m=f.slice(1).join(" ")}m&&(h=h.find(m).filter(":first"))}switch(p){case"modal":;n("#db-modal-response-modal-placeholder").remove();var _=n(u);_.attr("id","db-modal-response-modal-placeholder"),n("body").append(_);var g=new i.DBModal({element_id:"response-modal-placeholder"});o.push(g.show());break;case"html":o.push(h.html(u));break;case"replaceWith":o.push(h.replaceWith(u));break;case"after":u?o.push(h.after(u)):o.push(void 0);break;case"before":u?o.push(h.before(u)):o.push(void 0);break;case"toggleClass":o.push(h.toggleClass(u));break;case"addClass":o.push(h.addClass(u));break;case"removeClass":o.push(h.removeClass(u));break;case"notify":o.push(d.Notify.success(u));break;case"notifyError":o.push(d.Notify.error(new l.HTML(u),t.options.errorDuration||void 0));break;default:o.push(void 0)}}return o})()},e.prototype.error=function(e,t,o){var n=s.extract_errors(e.responseText);return"abort"!==t&&this.handle_errors(n),"function"==typeof this.options.error?this.options.error(e,t,o):void 0},e.prototype.handle_errors=function(e){if(e===!1)return d.Notify.error(c._("There was a problem completing this request."));if("string"==typeof e){var t=void 0;return t=this.options.html_in_error_msg?new l.HTML(e):e,d.Notify.error(t)}return s.fill_errors(this.$node,e)},e.prototype.complete=function(e,t){if(!this.shouldDelayComplete)return this.$node.removeClass("ajax-loading"),"function"==typeof this.options.complete?this.options.complete(e,t):void 0},e})()}),define("modules/clean/prompt/ha_loader",["require","exports","modules/clean/admin/megaphone/prompt/api/utils","external/react","external/react-dom","modules/clean/ajax","modules/clean/upsell/prompt_event_emitter","modules/clean/upsell/exception","modules/clean/react/prompt/ha"],function(e,t,o,n,r,a,i,s,l){"use strict";function c(e){if(!e.userID)return Promise.reject(null);var t=document.querySelector("#prompt-silo .ha-silo");return new Promise(function(c,d){try{a.SilentBackgroundRequest({url:"/prompt/ha",subject_user:e.userID,data:{ref_controller:e.controller,ref_action:e.action}}).then(function(a){var s=o.APIUtils.jsonToCamelCase(a);s.campaign&&(s.subjectUser=e.userID,s.campaign.delegateRendering?i.promptBufferedEventEmitter.emit(i.Events.ON_HA_LOADED,s):r.render(n.createElement(l.HA,s),t)),c()})}catch(t){s.reportException({err:t,tags:[s.TAGS.PROMPT_HA_LOADER],exc_extra:{param_user_id:e.userID,param_controller:e.controller,param_action:e.action}}),d()}})}Object.defineProperty(t,"__esModule",{value:!0}),t.initialize_module=c}),define("modules/clean/prompt/react_loader",["require","exports","modules/clean/admin/megaphone/prompt/api/utils","external/react","external/react-dom","modules/clean/upsell/exception","modules/clean/react/prompt/header_link","modules/clean/react/prompt/header_bubble","modules/clean/react/prompt/home_modal"],function(e,t,o,n,r,a,i,s,l){"use strict";function c(e){if(e.userID)for(var t=0,c=e.campaigns;t<c.length;t++){var u=c[t];try{var m=o.APIUtils.toCamelCase(u);if(m&&m.campaign)switch(m.subjectUser=e.userID,m.campaign.campaignLocationId){case"HEADER_LINK":var h=d(e);h&&r.render(n.createElement(i.HeaderLink,m),h);break;case"HEADER_BUBBLE":var f=d(e);f&&r.render(n.createElement(s.HeaderBubble,m),f);break;case"HOME_MODAL":var _=p(e);_&&r.render(n.createElement(l.HomeModal,m),_)}}catch(t){a.reportException({err:t,tags:[a.TAGS.PROMPT_REACT_LOADER],exc_extra:{param_user_id:e.userID,param_controller:e.controller,param_action:e.action,param_campaign_response:u}})}}}function d(e){return u(e,"#prompt-silo .account-header-react-silo")}function p(e){return u(e,"#prompt-silo .main-silo")}function u(e,t){var o=document.querySelector(t);return o||a.reportException({err:new Error("Could not locate mount point "+t),tags:[a.TAGS.PROMPT_REACT_LOADER],exc_extra:{param_user_id:e.userID,param_controller:e.controller,param_action:e.action}}),o}Object.defineProperty(t,"__esModule",{value:!0}),t.initialize_react=c}),define("modules/clean/react/prompt/header_bubble",["require","exports","tslib","external/react","external/classnames","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/prompt/header_link","modules/clean/react/prompt/image","modules/clean/react/prompt/button"],function(e,t,o,n,r,a,i,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.state_manager.onShow()},t.prototype.render=function(){var e=this.props.campaign.content,t=n.createElement("div",null,n.createElement("p",{className:"message",dangerouslySetInnerHTML:c.sanitizeOptionalHTML(e.text),ref:this.state_manager.enhanceHTMLButtons}),n.createElement(c.PromptButtons,{campaign:this.props.campaign,confirmIsPost:this.state_manager.shouldConfirmUsingPost(),confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss})),o=r({"header-bubble-container":!0,show:!0,"header-bubble-container--with-image":!!e.imageUrl}),a=e.imageUrl?[n.createElement("div",{className:"left"},n.createElement(c.ConfirmButton,{className:"image-button",confirmInNewTab:e.confirmInNewTab,confirmUrl:this.state_manager.buildConfirmEndpointURI(),confirmIsPost:this.state_manager.shouldConfirmUsingPost(),onConfirm:this.state_manager.onConfirm},n.createElement(l.Image,{src:e.imageUrl,srcHiRes:e.imageUrlHiRes,alt:e.confirmText}))),n.createElement("div",{className:"right"},t)]:[t],i=["top-level-nav-item"];return this.state.isConfirmed||this.state.isDismissed||i.push("active"),n.createElement("li",{className:i.join(" ")},n.createElement(s.HeaderLinkRendererWithoutCSS,{content:e,confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.state_manager.onConfirm}),n.createElement("div",{className:"sub-nav chat-bubble header-bubble upsell-bubble",id:"upsell-bubble"},n.createElement("div",{className:o},a,n.createElement("div",{className:"chat-bubble-arrow-border"}),n.createElement("div",{className:"chat-bubble-arrow"}))))},t.displayName="HeaderBubbleWithoutCSS",t})(i.PromptLocationWithDefaultState);t.HeaderBubbleWithoutCSS=d,t.HeaderBubble=a(d,["/static/css/upsell/prompt_pagelet-vflzdH6PS.css"])}),define("modules/clean/react/prompt/header_link",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/sprite_div"],function(e,t,o,n,r,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.content,t=["confirm-button","header-nav-link","enabled"];e.linkPretext&&t.push("header-nav-link--bold");var o;o=e.linkIcon?n.createElement("a",{className:t.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},n.createElement(i,{group:"web",name:e.linkIcon,text:e.linkText})):n.createElement("a",{className:t.join(" "),href:this.props.confirmUrl,onClick:this.props.onConfirm},e.linkText);var r=o;return e.linkPretext&&(r=n.createElement("div",{className:"header-nav-link--space"},n.createElement("span",{className:"header-link__pretext"},e.linkPretext),o)),n.createElement("div",{className:"header-link"},r)},t.displayName="HeaderLinkRendererWithoutCSS",t})(n.Component);t.HeaderLinkRendererWithoutCSS=s;var l=r(s,["/static/css/upsell/prompt_pagelet-vflzdH6PS.css"]),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.state_manager.onShow()},t.prototype.render=function(){return n.createElement("li",{className:"top-level-nav-item"},n.createElement(l,{content:this.props.campaign.content,confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.state_manager.onConfirm}))},t})(a.PromptLocationWithDefaultState);t.HeaderLink=c}),define("modules/clean/react/prompt/home_modal",["require","exports","tslib","external/react","external/classnames","modules/core/i18n","modules/clean/react/css","modules/clean/react/prompt/prompt_location","modules/clean/react/prompt/image","modules/clean/react/modal","modules/clean/react/prompt/button","modules/clean/user_education/user_education_client","modules/clean/user_education/user_education_loader","modules/clean/upsell/prompt_event_logger"],function(e,t,o,n,r,a,i,s,l,c,d,p,u,m){"use strict";function h(e){p.UEClient.sendEvent("OnboardingPromptModal","Shown",{name:e})}function f(e){p.UEClient.sendEvent("OnboardingPromptModal","ConfirmButtonClicked",{name:e})}Object.defineProperty(t,"__esModule",{value:!0});var _=function(e){var t=n.createElement(c.Modal,{id:e.id,className:e.className,title:e.title,acceptButtonText:e.acceptButtonText,clickOutToClose:!1,showX:e.showX,shouldLoadCss:!1},e.children),o=t.type.prototype;return o.componentDidMount&&(o._componentDidMount=o.componentDidMount,delete o.componentDidMount),t},g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onShow=function(){t.state_manager.onShow(),t.props.campaign.onboardingModuleName&&h(t.props.campaign.onboardingModuleName)},t.onConfirm=function(e){t.state_manager.onConfirm(e),t.props.campaign.content.confirmInNewTab?setTimeout(function(){t.close()},0):t.state_manager.shouldConfirmUsingPost()||(t.close(),t.props.campaign.onboardingModuleName&&(f(t.props.campaign.onboardingModuleName),t.state_manager.eventLogger.recordEvent("onboarding_confirmed")))},t.onDismiss=function(e){t.state_manager.onDismiss(e),t.close()},t.onRemindMeLater=function(e){t.state_manager.onDismiss(e,{remindMeLater:!0}),t.close()},t.enhanceHTMLButtons=function(e){t.state_manager.enhanceHTMLButtons(e,{dismissButtonSelector:".dismiss-button, .db-modal-x, .db-modal-overlay",onConfirmOverride:t.onConfirm,onDismissOverride:t.onDismiss})},t}return o.__extends(t,e),t.prototype.componentWillMount=function(){this.props.campaign.onboardingModuleName?u.UELoader.notifyModuleToLoad(this.props.campaign.onboardingModuleName):u.UELoader.notifyModuleToLoad(null)},t.prototype.close=function(){c.Modal.close()},t.prototype.render=function(){var e=r((o={"dfb-modal":"dfb"===this.props.campaign.campaignTypeId,"pro-modal":"dfb"!==this.props.campaign.campaignTypeId},o["db-modal-custom-"+this.props.campaign.campaignName]=!!this.props.campaign.campaignName,o[this.props.campaign.content.modalStyle||""]=!!this.props.campaign.content.modalStyle,o["show-upsell-modal"]=!0,o)),t=this.props.isPreview?_:c.Modal;return n.createElement(t,{id:this.props.campaign.modalId,className:e,title:this.props.campaign.content.title,clickOutToClose:!0,acceptButtonText:null,onDismiss:this.onDismiss,onShow:this.onShow,showX:!0,isPreview:this.props.isPreview||!1},this.renderImage(),this.renderSubtext(),this.renderButtons(),this.renderBottomText());var o},t.prototype.renderButtons=function(){return n.createElement(d.PromptButtons,{campaign:this.props.campaign,confirmIsPost:this.state_manager.shouldConfirmUsingPost(),confirmUrl:this.state_manager.buildConfirmEndpointURI(),onConfirm:this.onConfirm,onDismiss:this.onDismiss,onRemindMeLater:this.onRemindMeLater})},t.prototype.renderImage=function(){return this.props.campaign.content.imageUrl?n.createElement(l.Image,{src:this.props.campaign.content.imageUrl,srcHiRes:this.props.campaign.content.imageUrlHiRes,alt:this.props.campaign.content.confirmText||a._("Main modal image.")}):void 0},t.prototype.renderBottomText=function(){return this.props.campaign.content.bottomText?n.createElement("div",{className:"bottom-text",dangerouslySetInnerHTML:d.sanitizeOptionalHTML(this.props.campaign.content.bottomText),ref:this.enhanceHTMLButtons}):void 0},t.prototype.renderSubtext=function(){return n.createElement("div",{className:"subtext",dangerouslySetInnerHTML:d.sanitizeOptionalHTML(this.props.campaign.content.subtext),ref:this.enhanceHTMLButtons})},t.displayName="HomeModalWithoutCSS",t})(s.PromptLocationWithDefaultState);t.HomeModalWithCSS=i(g,["/static/css/modal-vflI292PU.css","/static/css/upsell/prompt_pagelet-vflzdH6PS.css","/static/css/upsell/upsell_modal-vfl3Zh5TP.css"]);var b=(function(e){function r(o){var a=e.call(this,o)||this;if(r.shouldDisplayHomeModal(o)){var i=n.createElement(t.HomeModalWithCSS,o);a.state={modalInstance:c.Modal.showInstance(i)}}else r.kickstartOnboarding(o);return a}return o.__extends(r,e),r.prototype.render=function(){return null},r.shouldDisplayHomeModal=function(e){return!(!e||!e.campaign)&&!(e.campaign.isHomeOnboardingEnabled&&e.campaign.onboardingModuleName&&["home_v1","home_v0"].indexOf(e.campaign.onboardingModuleName)===-1)},r.kickstartOnboarding=function(e){if(!e||!e.campaign)return void u.UELoader.notifyModuleToLoad(null);e.campaign.onboardingModuleName?(u.UELoader.notifyModuleToLoad(e.campaign.onboardingModuleName),h(e.campaign.onboardingModuleName),f(e.campaign.onboardingModuleName)):u.UELoader.notifyModuleToLoad(null);var t=new m.PromptEventLogger(e);t.recordClientImpression(),t.recordConfirm(),t.recordEvent("onboarding_confirmed_no_prompt")},r})(n.Component);t.HomeModal=b}),define("modules/clean/upsell/prompt_loader",["require","exports","jquery","modules/clean/deprecated/uirequest","modules/clean/prompt/react_loader","modules/clean/prompt/ha_loader","modules/clean/upsell/exception","modules/clean/user_education/user_education_loader","modules/clean/upsell/prompt_event_emitter"],function(e,t,o,n,r,a,i,s,l){"use strict";function c(){return window.performance&&window.performance.mark&&window.performance.measure&&window.location.search.indexOf("show_debug_spans")>-1}function d(e){new g(e).didCampaignForUserEducationLoad()||s.UELoader.notifyModuleToLoad(null)}function p(e){return{userID:e.user_id,controller:e.controller,action:e.action}}function u(){return!!o("#top-notification-bar-container").length}function m(){o(".db-modal-overlay").is(":visible")||o("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal")}function h(e,t,o){return new Promise(function(a,i){try{new n(e,"/prompt/main_campaign",{data:{ref_controller:t.controller,ref_action:t.action,in_app:t.in_app,sprite_group:t.sprite_group,skip_main_campaign:o},dataType:"json",subject_user:t.user_id,success:function(e){var o=e.data.account_header_campaign_props,n=e.data.main_campaign_props;n?r.initialize_react({userID:t.user_id,controller:t.controller,action:t.action,campaigns:[n]}):(m(),d(e)),o&&r.initialize_react({userID:t.user_id,controller:t.controller,action:t.action,campaigns:[o]}),a(new g(e))}})}catch(e){f(t,o,e),i()}})}function f(e,t,o){i.reportException({err:o,tags:[i.TAGS.PROMPT_MAIN_AND_ACCOUNT_HEADER_LOADER],exc_extra:{param_user_id:e.user_id,param_controller:e.controller,param_action:e.action,param_in_app:e.in_app,param_sprite_group:e.sprite_group,param_options_skip_main_campaign:t}})}function _(e){var t=c();t&&window.performance.mark("PromptLoader init start");var n=u(),r=o("#prompt-silo .main-silo");try{var s=h(r,e,e.mutually_exclusive_loading&&n);return e.mutually_exclusive_loading?s.then(function(t){return(n?t.didAccountHeaderCampaignLoad():t.didMainCampaignLoad())?t:Promise.all([s,a.initialize_module(p(e))]).then(function(e){return e[0]})}):s=Promise.all([s,a.initialize_module(p(e))]).then(function(e){return e[0]}),s.then(function(e){return t&&(window.performance.mark("PromptLoader init end"),window.performance.measure("PromptLoader init","PromptLoader init start","PromptLoader init end")),l.promptBufferedEventEmitter.emit(l.Events.ON_PROMPT_INITIALIZED,e),e})}catch(t){return i.reportException({err:t,tags:[i.TAGS.PROMPT_LOADER],exc_extra:{param_config:e}}),Promise.reject(null)}}Object.defineProperty(t,"__esModule",{value:!0});var g=(function(){function e(e){this.response_data=e}return e.prototype.didCampaignLoad=function(e,t){for(var o=this.response_data.actions||[],n=0,r=o;n<r.length;n++){var a=r[n],i=a[1];if(a[2]===e&&i)return!t||i.indexOf(t)>=0}return!1},e.prototype.didHeaderBubbleLoad=function(){return this.didCampaignLoad("^body #prompt-silo .account-header-silo","header-bubble-container")||this.didCampaignLoad("^body #prompt-silo .account-header-react-silo","header-bubble-container")},e.prototype.didHeaderLinkLoad=function(){return!this.didHeaderBubbleLoad()&&(this.didCampaignLoad("^body #prompt-silo .account-header-silo","header-link")||this.didCampaignLoad("^body #prompt-silo .account-header-react-silo","header-link"))},e.prototype.didMainCampaignLoad=function(){return this.didHeaderBubbleLoad()||this.didCampaignLoad("^body #prompt-silo .main-silo")},e.prototype.didAccountHeaderCampaignLoad=function(){return this.didHeaderBubbleLoad()||this.didHeaderLinkLoad()},e.prototype.didCampaignForUserEducationLoad=function(){return this.didCampaignLoad("^body #prompt-silo .main-silo",'"onboardingModuleName":')&&!this.didCampaignLoad("^body #prompt-silo .main-silo",'"onboardingModuleName": null')},e.prototype.didAnyContentLoad=function(){for(var e=this.response_data.actions||[],t=0,o=e;t<o.length;t++){if(o[t][1])return!0}return!1},e})();t.ResponseParser=g,t.initialize_module=_}),define("modules/clean/user_education/user_education_loader",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(){this.loadMessage=null,this.callback=null}return e.prototype.notifyModuleToLoad=function(e){this.callback?(this.callback(e),this.callback=null):this.loadMessage={moduleName:e}},e.prototype.setLoadingCallback=function(e){this.loadMessage?e(this.loadMessage.moduleName):this.callback=e},e.prototype.reset=function(){this.loadMessage=null,this.callback=null},e})();t.UELoader=new o});
//# sourceMappingURL=pkg-prompt.min.js-vflr4gS7u.map