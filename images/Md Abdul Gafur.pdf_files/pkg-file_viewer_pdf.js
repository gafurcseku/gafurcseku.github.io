define("modules/clean/frame_messenger/frame_messenger_client",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,o){"use strict";function i(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedOriginForPosting=null,t._validActions=[],t._parentMessageQueue=[],t._onParentReady=null,t}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this._trustedOriginForPosting=null,this._validActions=t,this._trustedMessageHandler=e,this._onParentReady=n},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.requestParentOrigin()},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={});var n=this.packagePostMessage(e,t);null===this._trustedOriginForPosting?this._parentMessageQueue.push(n):this.getWindow().parent.postMessage(n,this._trustedOriginForPosting)},t.prototype.dispatchMessage=function(e,t){"parent-ready"===t.action?this.updateParentOrigin(e.origin):i(t.action,this._validActions)&&null!==this._trustedMessageHandler&&this._trustedMessageHandler(t)},t.prototype.resetOriginsForPosting=function(){this._trustedOriginForPosting=null},t.prototype.updateParentOrigin=function(e){var t=this._trustedOriginForPosting;if(!this.isOriginAllowed(e))return!1;if(this._trustedOriginForPosting=e,this._parentMessageQueue.length>0){for(var n=0;n<this._parentMessageQueue.length;n++){var o=this._parentMessageQueue[n],i=JSON.parse(o);this.postMessageToParent(i.action,i.parameters)}this._parentMessageQueue=[]}return null!=this._trustedOriginForPosting&&null==t&&null!==this._onParentReady&&this._onParentReady(),!0},t.prototype.requestParentOrigin=function(){var e=this;this.getWindow().parent.postMessage('{"action": "child-requesting-parent-origin"}',"*");var n=function(){null===e._trustedOriginForPosting&&e.requestParentOrigin()};this.getWindow().setTimeout(n,t._REQUEST_PARENT_ORIGIN_POLL_DELAY)},t._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,t})(o.FrameMessengerBase);t.FrameMessengerClient=r}),define("modules/clean/react/file_viewer/frame_interface",["require","exports","tslib","modules/clean/react/file_viewer/interface","modules/clean/react/previews/frame_messenger_host"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["annotation-end-drag","annotation-enter","annotation-hidden","annotation-leave","annotation-placed","annotation-start-drag","annotation-ui-click","annotation-ui-enter","annotation-ui-leave","annotation-ui-over","mouse-up","on-keydown","page-rendered","scale-change","scroll"],a=(function(e){function t(n){var o=e.call(this,n)||this;return o.handleMessageFromFrame=function(e){o.eventEmitter.emit(e.action,e.parameters)},t.frameMessengerFactory?o.frameMessenger=t.frameMessengerFactory():o.frameMessenger=new i.PreviewFrameMessengerHost,o.frameMessenger.configureChildMessaging('iframe[name="preview-content"]',o.handleMessageFromFrame,r),o.frameMessenger.startListening(),o}return n.__extends(t,e),t.prototype.dispatchEvent=function(e,t){this.frameMessenger.postMessageToChildren(e,t)},t.prototype.destroy=function(){this.frameMessenger.stopListening()},t.setFrameMessengerFactory=function(e){t.frameMessengerFactory=e},t})(o.FileViewerInterface);t.FileViewerFrameInterface=a}),define("modules/clean/react/file_viewer/interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){this.eventEmitter=e}return e.prototype.destroy=function(){},e})();t.FileViewerInterface=n}),define("modules/clean/react/file_viewer/sidebar_helpers",["require","exports","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/actions","modules/clean/react/size_class/constants"],function(e,t,n,o,i){"use strict";function r(e,t,o){return t===i.SizeClass.Large&&!o&&(e===n.DocType.ppt||e===n.DocType.pdf)}Object.defineProperty(t,"__esModule",{value:!0}),t.mapDispatchToProps={onSidebarOpen:o.openSidebar,onSidebarClose:o.closeSidebar},t.isSidebarEnabled=r}),define("modules/clean/react/previews/pdf_viewer/annotation_creation_layer",["require","exports","tslib","external/keymaster","external/lodash","external/react","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/transform","modules/clean/annotations/annotation_controller"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={draftAnnotationVersion:0,postedAnnotationKey:""},t.resetDraftAnnotation=function(e){void 0===e&&(e=""),t.setState({draftAnnotationVersion:t.state.draftAnnotationVersion+1,postedAnnotationKey:e})},t.onResize=i.debounce(t.resetDraftAnnotation,1e3,{leading:!0,trailing:!1}),t.onUpdateAnnotations=function(e){var n=e.annotations.filter(function(e){return"POSTING"===e.commentActivity.status});if(n.length>0){var o=n[0].commentActivity.activity_key;o!==t.state.postedAnnotationKey&&t.resetDraftAnnotation(o)}},t.onAnnotationHiddenCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-hidden")},t.onAnnotationPlacedCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-placed",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationStartDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-start-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEndDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-end-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScrollCallback=function(e){e&&t.props.frameMessenger.postMessageToParent("scroll",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScaleChangeCallback=function(e){t.props.frameMessenger.postMessageToParent("scale-change",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-enter",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-leave",{annotation:t.finalizeAnnotation(e)})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){a.eventEmitter.on("resize",this.onResize),a.eventEmitter.on("update-annotations",this.onUpdateAnnotations),o("esc","fileviewer",this.resetDraftAnnotation)},t.prototype.componentWillUnmount=function(){a.eventEmitter.off("resize",this.onResize),a.eventEmitter.off("update-annotations",this.onUpdateAnnotations),o.unbind("esc","fileviewer",this.resetDraftAnnotation)},t.prototype.finalizeAnnotation=function(e){return e.pdf_coordinates=s.transformViewportCoordinates(this.props.pageNumber,this.props.parentOffset.left,this.props.parentOffset.top,this.props.width,this.props.height,this.props.scaleFactor,e.viewportCoordinates),e.pdf_page={rotate:0,view:{}},e},t.prototype.render=function(){return r.createElement("div",{className:"db-annotation-creation-layer"},r.createElement(l,{parentContainerOffset:this.props.parentOffset,controllerEventHandlers:this.props.delegate,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationHighlightEnabled:this.props.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:this.props.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.props.isAnnotationCreationEnabled,draftAnnotationVersion:this.state.draftAnnotationVersion}))},t.defaultProps={scaleFactor:1},t})(r.Component);t.AnnotationCreationLayer=c}),define("modules/clean/react/previews/pdf_viewer/annotation_view_layer",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_region_ui","modules/clean/react/previews/pdf_viewer/transform","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/css"],function(e,t,n,o,i,r,a,s,l,c,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderedAnnotations={},t.onAnnotationClickCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-click",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-enter",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-leave",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onHighlightAnnotation=function(e){if(t.renderedAnnotations[e.activity_key]){var n=!1,i=t.renderedAnnotations[e.activity_key],r=o(".page-container"),a=o(i.firstChild);n=!1,t.isElementVisible(a,r)||(n=!0,r.animate({scrollTop:r.scrollTop()+a.offset().top-300+"px"},300)),i.classList.remove("start-highlight-animation"),i.classList.remove("start-highlight-animation--delay"),requestAnimationFrame(function(){i.classList.add("start-highlight-animation"),n&&i.classList.add("start-highlight-animation--delay")})}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){p.eventEmitter.on("highlight-annotation",this.onHighlightAnnotation)},t.prototype.componentWillUnmount=function(){p.eventEmitter.off("highlight-annotation",this.onHighlightAnnotation)},t.prototype.isElementVisible=function(e,t){var n=e.offset().top;return 0<n&&n<t.height()},t.prototype.render=function(){var e=this,t=null;return this.props.annotations&&(t=this.props.annotations.map(function(t,o){var p=a.Annotation.createAnnotationFromDict(t.annotation);p.viewportCoordinates=c.transformPdfCoordinates(0,e.props.height,t.annotation.pdf_coordinates);var d={key:t.commentActivity.activity_key,annotation:p,scaleFactor:e.props.scaleFactor,commentActivity:t.commentActivity,options:t.options,onAnnotationClickCallback:e.onAnnotationClickCallback,onAnnotationEnterCallback:e.onAnnotationEnterCallback,onAnnotationLeaveCallback:e.onAnnotationLeaveCallback,ref:function(n){return e.renderedAnnotations[t.commentActivity.activity_key]=r.findDOMNode(n)}};return p.type===a.AnnotationTypes.HIGHLIGHT?i.createElement(s,n.__assign({},d)):p.type===a.AnnotationTypes.REGION?i.createElement(l,n.__assign({},d)):null})),i.createElement("div",{className:"db-annotation-layer db-annotation-view-layer"},t)},t.defaultProps={scaleFactor:1},t})(i.PureComponent),g=["/static/css/comments_annotations-vflT6HX_-.css"],m=d(u,g);t.AnnotationViewLayer=m}),define("modules/clean/react/previews/pdf_viewer/app",["require","exports","tslib","external/react","external/keymaster","modules/clean/previews/util","modules/clean/react/previews/pdf_viewer/connection_pool","modules/clean/react/previews/constants","modules/clean/react/modal","modules/clean/react/previews/pdf_viewer/password_modal","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/file_viewer/constants","modules/clean/react/previews/pdf_viewer/doc_viewer","modules/core/i18n","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/font"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,g,m,f,h){"use strict";function v(e){return void 0!==e.image}Object.defineProperty(t,"__esModule",{value:!0});var _=["pdf"],w=(function(e){function t(t){var o=e.call(this,t)||this;return o.isFirstPasswordAttempt=!0,o.inProgressPages={},o.downloadSucceedLogged=!1,o.renderSucceededLogged=!1,o.submitPassword=function(e){o.refreshBlob(e)},o.dismissPassword=function(){o.props.onError&&o.props.onError(s.ErrorType.PasswordProtectedError)},o.onScrollToAnnotation=function(e){var t=function(n,o){o===e.page-1&&(m.eventEmitter.off("page-set-to",t),m.eventEmitter.emit("highlight-annotation",e.commentActivity))};m.eventEmitter.on("page-set-to",t),m.eventEmitter.emit("set-current-page",e.page-1)},o.onScrollToPage=function(e){return n.__awaiter(o,void 0,void 0,function(){var t,o,i;return n.__generator(this,function(n){switch(n.label){case 0:this.props.frameMessenger.postMessageToParent("page-change",{current_page:e+1,pages_count:this.state.metadata?this.state.metadata.page_count:0,doc_type:r.isPptExtension(this.props.fileExtension)?d.DocType.ppt:d.DocType.pdf}),t=50*Math.floor(e/50),t+50-e<15&&(t+=50),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetchDataForPage(t)];case 2:return o=n.sent(),o&&this.setState({text:this.addPdfgenText(o.text,this.state.text),links:o.text&&(o.text.links||void 0)}),[3,4];case 3:return i=n.sent(),m.eventEmitter.emit("error",g._("Failed to load PDF")),[3,4];case 4:return[2]}})})},o.onFileFeedbackUIReady=function(){o.props.frameMessenger.postMessageToParent("page-rendered")},o.onUpdateAnnotations=function(e){var t=e.annotations.reduce(function(e,t,n,o){var i=t.annotation.pdf_coordinates[0].page,r=i-1;return e[r]=e[r]||[],e[r].push(t),e},[]);o.setState({annotations:t})},o.onRemoveAllAnnotations=function(){o.setState({annotations:[]})},o.onEnableAnnotationCreation=function(){o.setState({isAnnotationCreationEnabled:!0})},o.onDisableAnnotationCreation=function(){o.setState({isAnnotationCreationEnabled:!1})},o.onEnableRegionCreation=function(){o.setState({isAnnotationRegionEnabled:!0})},o.onDisableRegionCreation=function(){o.setState({isAnnotationRegionEnabled:!1})},o.onMetadataLoad=function(e){o.props.onMetadataLoad&&o.props.onMetadataLoad(e)},o.onPageRenderComplete=function(e,t,n){o.props.filePreviewSession&&(o.props.filePreviewSession.logSSREvent("any_page_rendered"),e<5&&(o.props.filePreviewSession.ssrTiming["page_"+e+"_render"]=t.duration())),!o.renderSucceededLogged&&o.props.timelineCallbacks.onFirstRenderSucceeded&&(o.renderSucceededLogged=!0,o.props.timelineCallbacks.onFirstRenderSucceeded(),o.props.frameMessenger.postMessageToParent("page-rendered"))},o.onPageImageLoad=function(e,t,n){o.props.timelineCallbacks.onFirstImageLoad&&o.props.timelineCallbacks.onFirstImageLoad(),o.props.filePreviewSession&&(o.props.filePreviewSession.logSSREvent("any_page_image_loaded"),e<5&&(o.props.filePreviewSession.ssrTiming["page_"+e+"_image_load"]=t.duration())),!o.downloadSucceedLogged&&o.props.timelineCallbacks.onDownloadSucceeded&&(o.downloadSucceedLogged=!0,o.props.timelineCallbacks.onDownloadSucceeded())},o.onPrintKeyPressed=function(){return m.eventEmitter.emit("print",{context:d.UserActionContext.Keyboard}),!1},o.state={urls:t.urls,isAnnotationHighlightEnabled:!0},t.previewThumbnailUrl?o.placeholderImageUrl=t.previewThumbnailUrl:o.placeholderImageUrl=o.state.urls.imageUrl(0,0),o}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;this.connectionPool=new a.ConnectionPool({maxConnections:3}),this.props.timelineCallbacks.onDownloadAttempted&&this.props.timelineCallbacks.onDownloadAttempted(),this.requestMetadata(),this.refreshIntervalId=window.setInterval(function(){e.refreshBlob()},108e5)},t.prototype.addPdfgenText=function(e,t){if(void 0===t&&(t={}),!e||!e.pages)return t;var n=e.fonts?e.fonts.map(h.renderFont):[];for(var o in e.pages)e.pages.hasOwnProperty(o)&&(t[o]=(e.pages[o]||[]).map(function(e){return{d:e.d,t:e.t,r:e.r,h:e.h,font:n[e.f]?n[e.f]:void 0}}));return t},t.prototype.requestMetadata=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,i,r;return n.__generator(this,function(n){switch(n.label){case 0:e=f.makeTimer().time(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetchDataForPage(0)];case 2:return t=n.sent(),[3,4];case 3:return i=n.sent(),401===i.jqXHR.status&&"1"===i.jqXHR.getResponseHeader("x-dropbox-pdf-password-needed")?_.includes(this.props.fileExtension)?(r=o.createElement(c.PasswordModal,{onSubmit:this.submitPassword,onDismiss:this.dismissPassword,isFirstAttempt:this.isFirstPasswordAttempt}),l.Modal.showInstance(r),this.isFirstPasswordAttempt=!1,this.props.timelineCallbacks.onPasswordPrompt&&this.props.timelineCallbacks.onPasswordPrompt()):this.props.onError&&this.props.onError(s.ErrorType.PasswordProtectedError):this.props.onError&&this.props.onError(s.ErrorType.LoadError),[2];case 4:return t&&t.metadata&&t.metadata.page_count>0?(this.props.filePreviewSession&&(this.props.filePreviewSession.logSSREvent("metadata_succeeded"),this.props.filePreviewSession.ssrTiming.metadata=e.timeEnd().duration()),this.onMetadataLoad(t.metadata),this.setState({metadata:t.metadata,text:this.addPdfgenText(t.text),links:t.text&&(t.text.links||void 0)},this.props.onMetadataApplied),this.props.onLoad&&this.props.onLoad()):this.props.onError&&this.props.onError(s.ErrorType.LoadError),[2]}})})},t.prototype.componentDidMount=function(){m.eventEmitter.on("scrolled-to-page",this.onScrollToPage),m.eventEmitter.on("file-feedback-ui-ready",this.onFileFeedbackUIReady),m.eventEmitter.on("scroll-to-annotation",this.onScrollToAnnotation),m.eventEmitter.on("update-annotations",this.onUpdateAnnotations),m.eventEmitter.on("remove-all-annotations",this.onRemoveAllAnnotations),m.eventEmitter.on("enable-annotation-creation",this.onEnableAnnotationCreation),m.eventEmitter.on("disable-annotation-creation",this.onDisableAnnotationCreation),m.eventEmitter.on("enable-region-creation",this.onEnableRegionCreation),m.eventEmitter.on("disable-region-creation",this.onDisableRegionCreation),i("p, command+p, control+p","fileviewer",this.onPrintKeyPressed)},t.prototype.componentWillUnmount=function(){m.eventEmitter.off("scrolled-to-page",this.onScrollToPage),m.eventEmitter.off("file-feedback-ui-ready",this.onFileFeedbackUIReady),m.eventEmitter.off("scroll-to-annotation",this.onScrollToAnnotation),m.eventEmitter.off("update-annotations",this.onUpdateAnnotations),m.eventEmitter.off("remove-all-annotations",this.onRemoveAllAnnotations),m.eventEmitter.off("enable-annotation-creation",this.onEnableAnnotationCreation),m.eventEmitter.off("disable-annotation-creation",this.onDisableAnnotationCreation),m.eventEmitter.off("enable-region-creation",this.onEnableRegionCreation),m.eventEmitter.off("disable-region-creation",this.onDisableRegionCreation),i.unbind("p, command+p, control+p","fileviewer",this.onPrintKeyPressed),this.connectionPool.shutdown(),window.clearInterval(this.refreshIntervalId)},t.prototype.fetchDataForPage=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i,r,a,s=this;return n.__generator(this,function(n){switch(n.label){case 0:if(e%50!==0)throw new Error("invalid page lower bound");if(this.state.metadata&&this.state.metadata.page_count<=e)return[2,void 0];if(t=e+50,this.state.text&&this.state.text[e])return[3,4];o=this.state.urls.textUrl(0===e,e,t),n.label=1;case 1:return n.trys.push([1,3,,4]),i={dataType:"json",type:"GET",url:o,xhrFields:{withCredentials:!0},skipInjectCsrf:p.skipCsrfTokenInjection(o)},[4,this.connectionPool.request(i,function(t){s.inProgressPages[e]?t():s.inProgressPages[e]=!0})];case 2:return r=n.sent(),delete this.inProgressPages[e],[2,r];case 3:if(a=n.sent(),delete this.inProgressPages[e],401===a.jqXHR.status)throw a;return[3,4];case 4:return[2,void 0]}})})},t.prototype.refreshBlob=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i,r,a=this;return n.__generator(this,function(n){switch(n.label){case 0:return(t=this.state.urls.refreshUrl())?(o={},i=function(){},void 0!==e&&(o={password:e},i=function(){return a.requestMetadata()}),[4,this.connectionPool.request({url:t,dataType:"json",type:"POST",data:o,skipInjectCsrf:p.skipCsrfTokenInjection(t)})]):[3,2];case 1:r=n.sent(),this.setState({urls:this.updateUrls(r)},i),n.label=2;case 2:return[2]}})})},t.prototype.updateUrls=function(e){return v(e)?new p.SsrUrlSet({imageUrl:e.image,textUrl:e.text,refreshUrl:e.refresh}):this.state.urls.newSetWithBlob(e.old_blob,e.new_blob)},t.prototype.render=function(){var e={annotations:this.state.annotations||[],isAnnotationCreationEnabled:!!this.state.isAnnotationCreationEnabled,isAnnotationRegionEnabled:!!this.state.isAnnotationRegionEnabled,isAnnotationHighlightEnabled:!!this.state.isAnnotationHighlightEnabled,frameMessenger:this.props.frameMessenger};return o.createElement(u.DocViewer,{annotationProps:e,fileExtension:this.props.fileExtension,isFullscreen:this.props.isFullscreen,isSidebarOpen:this.props.isSidebarOpen,isToolbarVisible:this.props.isToolbarVisible,links:this.state.links,metadata:this.state.metadata,onExitFullscreen:this.props.onExitFullscreen,onPageImageLoad:this.onPageImageLoad,onPageRenderComplete:this.onPageRenderComplete,onPlaceholderImageLoad:this.props.timelineCallbacks.onPlaceholderImageLoad,placeholderImageUrl:this.placeholderImageUrl,printProps:this.props.printProps,sizeClass:this.props.sizeClass,text:this.state.text,urls:this.state.urls})},t})(o.PureComponent);t.App=w}),define("modules/clean/react/previews/pdf_viewer/connection_pool",["require","exports","tslib","modules/clean/ajax"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){this.inflightConnections=0,this.waitingConnections=[],this.maxConnections=e.maxConnections}return e.prototype.request=function(e,t){var n=this;return new Promise(function(o,i){n.waitingConnections.push({request:e,onBeforeExecute:t,resolve:o,reject:i}),n.maybeSendRequest()})},e.prototype.shutdown=function(){this.waitingConnections=[]},e.prototype.maybeSendRequest=function(){var e=this;if(0!==this.waitingConnections.length)for(var t=function(){var t=i.waitingConnections.pop();if(!t)return{value:void 0};if(t.onBeforeExecute){var r=!1,a=function(){return r=!0};if(t.onBeforeExecute(a),r)return"continue"}i.inflightConnections++,o.SilentBackgroundRequest(n.__assign({},t.request,{success:function(e){return t.resolve(e)},error:function(e,n,o){return t.reject({error:o,jqXHR:e})},complete:function(){e.inflightConnections--,e.maybeSendRequest()}}))},i=this;this.inflightConnections<this.maxConnections;){var r=t();if("object"==typeof r)return r.value}},e})();t.ConnectionPool=i}),define("modules/clean/react/previews/pdf_viewer/continuous_page",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/core/browser","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/page"],function(e,t,n,o,i,r,a,s,l,c,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var n=e.call(this,t)||this;n.pageContainerRef=function(e){return n.pageContainerDOM=e},n.debouncedUpdateTextLayerPageIndex=n.props.updateTextLayerPageIndex?r.debounce(n.props.updateTextLayerPageIndex,200):null,n.onScrollTopChange=function(e){if(void 0===e&&(e=function(e){}),n.props.metadata){c.eventEmitter.emit("scroll"),n.props.annotationProps&&n.props.annotationProps.frameMessenger.postMessageToParent("scroll");for(var t=n.pageContainerDOM.scrollTop+n.pageContainerDOM.clientHeight/2,o=0,i=n.state.clientScaleFactor,r=0,a=n.props.metadata.dimensions;r<a.length;r++){var s=a[r],l=(s[0],s[1]),p=s[2],d=(l*i+16)*p;if(!(t>d)){o+=Math.floor((t+1)/(l*i+16));break}t-=d,o+=p}o!==n.props.currentPageIndex?n.props.onPageNumberUpdated(o,function(){return e(o)}):e(o)}},n.throttledOnScrollTopChange=r.throttle(n.onScrollTopChange,100),n.debouncedOnScrollTopChange=r.debounce(n.onScrollTopChange,200),n.maxScrollSpeed=100,n.onInternalLinkClick=function(e,t){t.preventDefault(),n.props.jumpToPage(e)},n.onScroll=function(){var e=n.checkScrollSpeed();if(Math.abs(e)>n.maxScrollSpeed)return void n.debouncedOnScrollTopChange();n.throttledOnScrollTopChange(),n.debouncedUpdateTextLayerPageIndex&&n.debouncedUpdateTextLayerPageIndex()},n.lastPos=null,n.checkScrollSpeed=function(){var e=0,t=n.pageContainerDOM.scrollTop;return null!==n.lastPos&&(e=t-n.lastPos),n.lastPos=t,e},n.scrollDown=function(){n.setScrollTop(n.pageContainerDOM.scrollTop+60)},n.scrollUp=function(){n.setScrollTop(n.pageContainerDOM.scrollTop-60)},n.zoomIn=function(){var e=Math.min(1.1*n.state.clientScaleFactor,10);n.setState({clientScaleFactor:e,fittingMode:l.FittingMode.NONE})},n.zoomOut=function(){var e=Math.max(n.state.clientScaleFactor/1.1,.1);n.setState({clientScaleFactor:e,fittingMode:l.FittingMode.NONE})};var o=l.FittingMode.FIT_TO_WIDTH,i=t.height&&t.width?l.computeClientScaleFactor(o,t.metadata.dimensions,t.height,t.width-32):1;return n.state={clientScaleFactor:i,fittingMode:o},n.isMobileOrTablet=a.is_mobile_or_tablet(),n.backwardBatchSize=n.isMobileOrTablet?1:3,n.forwardBatchSize=n.isMobileOrTablet?2:4,n}return n.__extends(t,e),t.prototype.setScrollTop=function(e,t){void 0===t&&(t=function(e){}),this.pageContainerDOM.scrollTop=e,this.onScrollTopChange(t),this.props.updateTextLayerPageIndex()},t.prototype.getStartPage=function(e){return Math.max(0,e-this.backwardBatchSize)},t.prototype.getEndPage=function(e){return Math.min(this.props.metadata.page_count,e+this.forwardBatchSize)},t.prototype.displayPage=function(e,t){if(void 0===t&&(t=function(e){}),!(e<0||e>=this.props.metadata.page_count)){for(var n=0,o=this.state.clientScaleFactor,i=0,r=this.props.metadata.dimensions;i<r.length;i++){var a=r[i],s=(a[0],a[1]),l=a[2];if(!(e>=l)){n+=(16+s*o)*e;break}n+=(16+s*o)*l,e-=l}this.setScrollTop(n,t)}},t.prototype.componentDidMount=function(){c.eventEmitter.on("zoom-in",this.zoomIn),c.eventEmitter.on("zoom-out",this.zoomOut)},t.prototype.componentWillReceiveProps=function(e){this.props.height===e.height&&this.props.width===e.width||!this.props.annotationProps||s.resetAnnotationState(this.props.annotationProps.frameMessenger,this.pageContainerDOM)},t.prototype.componentDidUpdate=function(e,t){var n=this;if(e.height!==this.props.height||e.width!==this.props.width||t.fittingMode!==this.state.fittingMode&&this.state.fittingMode!==l.FittingMode.NONE){var o=l.computeClientScaleFactor(this.state.fittingMode,this.props.metadata.dimensions,this.props.height,this.props.width-32);this.setState({clientScaleFactor:o})}if(this.pageContainerDOM&&this.state.clientScaleFactor&&t.clientScaleFactor&&this.state.clientScaleFactor!==t.clientScaleFactor){var i=this.pageContainerDOM.scrollTop,r=this.pageContainerDOM.scrollLeft,a=16*(this.props.currentPageIndex+1),s=t.clientScaleFactor,p=this.state.clientScaleFactor/s;i>a&&(this.pageContainerDOM.scrollTop=(i-a)*p+a),r>16&&(this.pageContainerDOM.scrollLeft=(r-16)*p+16),this.maxScrollSpeed+=s/this.state.clientScaleFactor}if(e.currentPageIndex!==this.props.currentPageIndex&&this.props.shouldMoveToPage===!0&&this.displayPage(this.props.currentPageIndex,function(e){c.eventEmitter.emit("page-set-to",e,n.props.currentPageIndex),c.eventEmitter.emit("page-set")}),e.isFullscreen!==this.props.isFullscreen){var d=e.isFullscreen?l.FittingMode.FIT_TO_WIDTH:l.FittingMode.FIT_PAGE;this.setState({fittingMode:d})}},t.prototype.componentWillUnmount=function(){c.eventEmitter.off("zoom-in",this.zoomIn),c.eventEmitter.off("zoom-out",this.zoomOut)},t.prototype.render=function(){var e=this,t=this.props,n=t.urls,l=t.annotationProps,c=t.onImageError,d=t.onPageRenderComplete,u=t.onPageImageLoad,g=[],m={},f={},h=this.getStartPage(this.props.currentPageIndex),v=this.getEndPage(this.props.currentPageIndex);g=r.range(h,v).map(function(t){return i.createElement(p.Page,{key:t,fields:e.props.getFieldsForPage?e.props.getFieldsForPage(t+1):[],pageData:e.props.pages[t],urls:n,clientScaleFactor:e.state.clientScaleFactor,loadImageOnly:e.isMobileOrTablet,annotationProps:s.annotationsAtPage(l,t),onRenderComplete:d,onImageLoad:u,onImageError:c,signatureImage:e.props.signatureImage,createSignature:e.props.createSignature,signField:e.props.signField,isSendForSignatureMode:e.props.isSendForSignatureMode,isSigningMode:e.props.isSigningMode,isFieldCreationMode:e.props.isFieldCreationMode,fieldCreationType:e.props.fieldCreationType,isCreatingFieldForRecipient:e.props.isCreatingFieldForRecipient,exitFieldCreationMode:e.props.exitFieldCreationMode,createField:e.props.createField,updateField:e.props.updateField,enterFieldText:e.props.enterFieldText,selectFieldDate:e.props.selectFieldDate,onInternalLinkClicked:e.onInternalLinkClick})});var _=this.props.pages.map(function(e){return e.dimension}),w=h>0?s.getTotalSize(_.slice(0,h),this.state.clientScaleFactor,16)[1]+16:0;return m={height:s.getTotalSize(_,this.state.clientScaleFactor,16)[1],margin:"auto",overflow:"auto"},f={top:w},i.createElement("div",{className:o("viewer-container__sizer","page-container","pdf-viewer__pages",{"ios-enable-inertial-scroll":a.iOS}),onScroll:this.onScroll,ref:this.pageContainerRef},i.createElement("div",{style:m},i.createElement("div",{className:"page-container-inner",style:f},g)))},t})(i.PureComponent);t.ContinuousPage=d}),define("modules/clean/react/previews/pdf_viewer/doc_viewer",["require","exports","tslib","external/classnames","external/lodash","external/react","modules/core/browser","modules/clean/react/previews/pdf_viewer/continuous_page","spectrum/dimensions","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/keyboard_bindings","modules/clean/previews/util","modules/clean/react/file_viewer/sidebar_helpers","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/async/loadable","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/pdf_viewer/placeholder_image","modules/clean/react/previews/pdf_viewer/sidebar","modules/clean/react/previews/pdf_viewer/sidebar","modules/clean/react/previews/pdf_viewer/single_page","spectrum/snackbar","modules/clean/web_timing_logger","modules/clean/react/keyboard_binding/keyboard_binding","modules/core/i18n","modules/clean/react/file_viewer/constants","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","esignature_prototype/data/actions","esignature_prototype/data/selectors","external/react-redux"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,g,m,f,h,v,_,w,b,P,y,E,S,F,C,M,x,T,I){"use strict";var D=this;Object.defineProperty(t,"__esModule",{value:!0});var k=f.Loadable({loader:function(){return n.__awaiter(D,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return[4,y.waitForTTI()];case 1:return n.sent(),[4,new Promise(function(t,n){e(["modules/clean/react/previews/pdf_viewer/print_modal"],t,n)})];case 2:return t=n.sent().PrintModal,[2,t]}})})}}),A=(function(e){function t(t){var n=e.call(this,t)||this;return n.iframeRef=function(e){e&&e.contentWindow&&(e.contentWindow.addEventListener("load",n.onResize),e.contentWindow.addEventListener("resize",n.onResize))},n.containerRef=function(e){return n.containerDOM=e},n.continuousPageRef=function(e){return n.continuousPage=e},n.singlePageRef=function(e){return n.singlePage=e},n.docType=u.isPptExtension(n.props.fileExtension)?F.DocType.ppt:F.DocType.pdf,n.onResize=function(){n.props.metadata&&n.props.annotationProps&&C.resetAnnotationState(n.props.annotationProps.frameMessenger,n.containerDOM)},n.enterFullscreen=function(){n.props.isFullscreen||c.enterFullScreen(!0,F.UserActionContext.Keyboard)},n.setPage=function(e,t){void 0===t&&(t=function(){}),n.props.metadata&&(e<0||e>=n.props.metadata.page_count||(n.setState({currentPageIndex:e},t),p.eventEmitter.emit("scrolled-to-page",e)))},n.jumpToPage=function(e,t){void 0===t&&(t=function(){}),n.setState({shouldMoveToPage:!0}),n.setPage(e,t)},n.shouldNotMoveToPage=function(){n.setState({shouldMoveToPage:!1})},n.setTextLayerPageIndex=function(){n.setState({textLayerPageIndex:n.state.currentPageIndex})},
n.onPageRenderComplete=function(e,t){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,e===n.state.currentPageIndex),n.setState({pageRendered:!0})},n.onPageImageLoad=function(e,t){n.props.onPageImageLoad&&n.props.onPageImageLoad(e,t,e===n.state.currentPageIndex)},n.onFirstPageError=function(){n.setState({firstPageFailed:!0})},n.onError=function(e){n.setState({error:e})},n.onImageError=function(){n.setState({error:S._("Some pages failed to load")})},n.onReload=function(){a.reload(!0)},n.onDismissError=function(){n.setState({error:void 0})},n.pageDown=function(){n.jumpToPage(n.state.currentPageIndex+1)},n.pageUp=function(){n.jumpToPage(n.state.currentPageIndex-1)},n.scrollDown=function(){n.continuousPage||n.pageDown(),n.continuousPage.scrollDown()},n.scrollUp=function(){n.continuousPage||n.pageUp(),n.continuousPage.scrollUp()},n.zoomIn=function(){n.continuousPage&&n.continuousPage.zoomIn()},n.zoomOut=function(){n.continuousPage&&n.continuousPage.zoomOut()},n.onPageUp=E.withPreventDefault(n.pageUp),n.onPageDown=E.withPreventDefault(n.pageDown),n.onScrollUp=E.withPreventDefault(n.scrollUp),n.onScrollDown=E.withPreventDefault(n.scrollDown),n.onEnterFullscreen=E.withPreventDefault(n.enterFullscreen),n.onZoomIn=E.withPreventDefault(n.zoomIn),n.onZoomOut=E.withPreventDefault(n.zoomOut),n.docFullScreenKeyboardBindings=n.docType===F.DocType.pdf?d.getContinuousPageKeyboardBindings(!0,n.onScrollUp,n.onScrollDown,n.onPageUp,n.onPageDown,n.onEnterFullscreen,n.onZoomIn,n.onZoomOut):d.getSinglePageKeyboardBindings(!0,n.onPageUp,n.onPageDown,n.onEnterFullscreen),n.docSidebarFocusedKeyboardBindings=n.docType===F.DocType.pdf?d.getContinuousPageKeyboardBindings(!1,n.pageUp,n.onPageDown,n.onPageUp,n.onPageDown,n.onEnterFullscreen,n.onZoomIn,n.onZoomOut):d.getSinglePageKeyboardBindings(!1,n.onPageUp,n.onPageDown,n.onEnterFullscreen),n.docKeyboardBindings=n.docType===F.DocType.pdf?d.getContinuousPageKeyboardBindings(!1,n.onScrollUp,n.onScrollDown,n.onPageUp,n.onPageDown,n.onEnterFullscreen,n.onZoomIn,n.onZoomOut):d.getSinglePageKeyboardBindings(!1,n.onPageUp,n.onPageDown,n.onEnterFullscreen),n.getDocKeyboardBindings=function(e,t){return e?n.docFullScreenKeyboardBindings:t?n.docSidebarFocusedKeyboardBindings:n.docKeyboardBindings},n.handleSidebarClick=function(e){n.jumpToPage(e),n.focusSidebar()},n.focusSidebar=function(){n.setState({isSidebarFocused:!0})},n.unfocusSidebar=function(){n.setState({isSidebarFocused:!1})},n.state={fittingMode:n.props.isFullscreen?M.fullscreenFittingMode():u.isPptExtension(t.fileExtension)?M.FittingMode.FIT_PAGE:M.FittingMode.FIT_TO_WIDTH,currentPageIndex:0,shouldMoveToPage:!1,textLayerPageIndex:0,isSidebarFocused:!1},n}return n.__extends(t,e),t.prototype.isSidebarOpen=function(e,t){void 0===t&&(t=this.props);var n=t.isSidebarOpen,o=t.sizeClass,i=t.isFullscreen;return g.isSidebarEnabled(e,o,!!i)&&(n||{})[e]},t.prototype.componentDidMount=function(){p.eventEmitter.on("page-down",this.pageDown),p.eventEmitter.on("page-up",this.pageUp),p.eventEmitter.on("set-current-page",this.jumpToPage),p.eventEmitter.on("page-set",this.shouldNotMoveToPage),p.eventEmitter.on("error",this.onError)},t.prototype.componentWillUnmount=function(){p.eventEmitter.off("page-down",this.pageDown),p.eventEmitter.off("page-up",this.pageUp),p.eventEmitter.off("set-current-page",this.jumpToPage),p.eventEmitter.off("page-set",this.shouldNotMoveToPage),p.eventEmitter.off("error",this.onError)},t.prototype.componentWillReceiveProps=function(e){var t=this.state.fittingMode;this.props.isFullscreen!==e.isFullscreen&&(t=e.isFullscreen?M.fullscreenFittingMode():u.isPptExtension(e.fileExtension)?M.FittingMode.FIT_PAGE:M.FittingMode.FIT_TO_WIDTH,this.setState({fittingMode:t})),this.props.fileExtension!==e.fileExtension&&(this.docType=u.isPptExtension(e.fileExtension)?F.DocType.ppt:F.DocType.pdf)},t.prototype.renderErrorSnackbar=function(){if(!this.state.error)return null;var e={"pdf-snackbar":!0,"pdf-snackbar__toolbar-visible":this.props.isToolbarVisible};return r.createElement(P.Snackbar,{className:o(e),title:this.state.error,variant:"fail",disablePositioningAndBackdrop:!0},r.createElement(P.SnackbarAction,{onClick:this.onReload},"Reload"),r.createElement(P.SnackbarAction,{onClick:this.onDismissError},"Close"))},t.prototype.renderViewer=function(e,t){var o=this,a=this.props.links||{},l=this.props,c=l.annotationProps,p=l.isFullscreen,d=l.metadata,u=l.text,g=l.urls;if(d&&u){var m={height:e,width:t,currentPageIndex:this.state.currentPageIndex,urls:g,annotationProps:c,metadata:d,onImageError:this.onImageError,isFullscreen:p,onPageImageLoad:this.onPageImageLoad,onPageRenderComplete:this.onPageRenderComplete,onPageNumberUpdated:this.setPage},f=C.expandDimensions(d.dimensions),h=i.range(0,d.page_count).map(function(e){return{pageIndex:e,dimension:f[e],textboxes:u[e],links:a[e]||[],thumbnailUrl:o.props.urls.imageUrl(e,Math.ceil(200*_.SIDEBAR_THUMBNAIL_WIDTH/f[e][0]))}});return this.docType===F.DocType.ppt&&b.deviceSupported()?r.createElement(b.SinglePage,n.__assign({},m,{pages:h,ref:this.singlePageRef})):r.createElement(s.ContinuousPage,n.__assign({},m,{pages:h,shouldMoveToPage:this.state.shouldMoveToPage,textLayerPage:this.state.textLayerPageIndex,updateTextLayerPageIndex:this.setTextLayerPageIndex,getFieldsForPage:this.props.getFieldsForPage,signatureImage:this.props.signatureImage,createSignature:this.props.createSignature,signField:this.props.signField,isSendForSignatureMode:this.props.isSendForSignatureMode,isSigningMode:this.props.isSigningMode,isFieldCreationMode:this.props.isFieldCreationMode,isCreatingFieldForRecipient:this.props.isCreatingFieldForRecipient,exitFieldCreationMode:this.props.exitFieldCreationMode,createField:this.props.createField,updateField:this.props.updateField,enterFieldText:this.props.enterFieldText,selectFieldDate:this.props.selectFieldDate,jumpToPage:this.jumpToPage,ref:this.continuousPageRef}))}return null},t.prototype.renderSidebar=function(){var e=this,t=this.isSidebarOpen(this.docType),n=this.props.links||{},o=this.props,a=o.metadata,s=o.text;if(a&&s){var l=C.expandDimensions(a.dimensions),c=i.range(0,a.page_count).map(function(t){return{pageIndex:t,dimension:l[t],textboxes:s[t],links:n[t]||[],thumbnailUrl:e.props.urls.imageUrl(t,Math.ceil(200*_.SIDEBAR_THUMBNAIL_WIDTH/l[t][0]))}});return r.createElement(w.Sidebar,{className:t?"pdf-viewer__sidebar open":"pdf-viewer__sidebar",currentPageIndex:this.state.currentPageIndex,pages:c,isFocused:this.state.isSidebarFocused,onClick:this.handleSidebarClick,onFocus:this.focusSidebar,onBlur:this.unfocusSidebar})}return null},t.prototype.renderCloseFullscreenButton=function(){return this.props.isFullscreen?r.createElement("div",{className:"close-x"},r.createElement("button",{onClick:this.props.onExitFullscreen,className:"close-x-button","aria-label":S._("Close")},"âœ•")):null},t.prototype.renderPlaceholder=function(){var e=this.props.placeholderImageUrl;return this.state.pageRendered||!e||this.state.firstPageFailed?null:r.createElement(v.PlaceholderImage,{url:e,onError:this.onFirstPageError,onLoad:this.props.onPlaceholderImageLoad})},t.prototype.render=function(){var e=this,t=this.renderSidebar(),n=this.renderCloseFullscreenButton(),i={"viewer-container":!0,"sidebar-visible":this.isSidebarOpen(this.docType)},a=this.renderPlaceholder(),s=this.state.pageRendered?null:r.createElement(h.LoadingIndicator,{className:"loading-indicator"}),c=this.props.metadata&&this.props.printProps?r.createElement(k,{urls:this.props.urls,metadata:this.props.metadata,printProps:this.props.printProps}):null,p=r.createElement("iframe",{"aria-hidden":"true",ref:this.iframeRef,style:{position:"absolute",left:0,bottom:0,top:0,width:"100%",zIndex:-1e3,opacity:0}});return r.createElement("div",{className:o(i)},s,a,p,n,r.createElement("div",{className:o("pdf-viewer",{fullscreen:this.props.isFullscreen}),style:{visibility:this.state.pageRendered?"visible":"hidden"},ref:this.containerRef},r.createElement(m.KeyboardBindingConnector,{keyboardBindings:this.getDocKeyboardBindings(!!this.props.isFullscreen,this.state.isSidebarFocused)}),t,r.createElement(l.Dimensions,{className:"flex-preview-container",style:{overflow:"auto"}},function(t){var n=t.width,o=t.height;return e.renderViewer(o,n)})),this.renderErrorSnackbar(),c)},t})(r.PureComponent);t._DocViewer=A;var L=function(e){return{getFieldsForPage:function(t){return T.getFieldsForPage(e,t)},signatureImage:T.getSignatureImage(e),isSendForSignatureMode:T.getIsSendForSignatureMode(e),isSigningMode:T.getIsSigningMode(e),isFieldCreationMode:T.getIsFieldCreationMode(e),fieldCreationType:T.getFieldCreationType(e),isCreatingFieldForRecipient:T.getIsCreatingFieldForRecipient(e)}},R={createSignature:x.createSignature,signField:x.signField,enterFieldText:x.enterFieldText,selectFieldDate:x.selectFieldDate,exitFieldCreationMode:x.exitFieldCreationMode,createField:x.createField,updateField:x.updateField},O=I.connect(L,R)(A);t.DocViewer=O}),define("modules/clean/react/previews/pdf_viewer/event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventEmitter=new n}),define("modules/clean/react/previews/pdf_viewer/font",["require","exports"],function(e,t){"use strict";function n(e){var t=e.n.lastIndexOf(",");return{fontFamily:'"'+(t>-1?e.n.substr(0,t):e.n)+'", '+(1&e.f?"monospace":"serif"),isBold:(e.f&1<<18)>0,isItalic:(64&e.f)>0}}Object.defineProperty(t,"__esModule",{value:!0});t.renderFont=n}),define("modules/clean/react/previews/pdf_viewer/frame_messenger_shims",["require","exports","tslib","external/eventemitter3","modules/clean/frame_messenger/frame_messenger_client","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,o,i,r){"use strict";function a(){return{parentEmitter:new o,childEmitter:new o}}Object.defineProperty(t,"__esModule",{value:!0});t.makeChannel=a;var s=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){this.handler=t,this.validActions=n},t.prototype.startListening=function(){this.channel.childEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.childEmitter.off("message",this.eventListener)},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={}),this.channel.parentEmitter.emit("message",{action:e,parameters:t})},t})(r.FrameMessengerHost);t.FrameMessengerHostShim=s;var l=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this.validActions=t,this.handler=e},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={}),this.channel.childEmitter.emit("message",{action:e,parameters:t})},t.prototype.startListening=function(){this.channel.parentEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.parentEmitter.off("message",this.eventListener)},t})(i.FrameMessengerClient);t.FrameMessengerClientShim=l}),define("modules/clean/react/previews/pdf_viewer/keyboard_bindings",["require","exports","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode"],function(e,t,n,o){"use strict";function i(e,i,r,a){var s=n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.F},callback:a});return t.getPageUpPageDownKeyboardBindings(i,r).concat(t.getUpDownKeyboardBindings(i,r),t.getLeftRightKeyboardBindings(i,r),[s])}function r(e,i,r,a,s,l,c,p){var d=e?t.getUpDownKeyboardBindings(a,s):t.getUpDownKeyboardBindings(i,r),u=n.hydrateKeyboardBinding({keyboardEventCriteria:{altKey:!0,which:o.KeyCode.UP},callback:a}),g=n.hydrateKeyboardBinding({keyboardEventCriteria:{altKey:!0,which:o.KeyCode.DOWN},callback:s}),m=e?t.getLeftRightKeyboardBindings(a,s).slice():[],f=n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.F},callback:l});return d.concat([u,g],t.getPageUpPageDownKeyboardBindings(a,s),m,[f],n.getEqualsKeyBindings(c),n.getMinusKeyBindings(p))}Object.defineProperty(t,"__esModule",{value:!0}),t.getLeftRightKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.LEFT},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.RIGHT},callback:t})]},t.getUpDownKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.UP},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.DOWN},callback:t})]},t.getPageUpPageDownKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.PAGE_UP},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.PAGE_DOWN},callback:t})]},t.getSinglePageKeyboardBindings=i,t.getContinuousPageKeyboardBindings=r}),define("modules/clean/react/previews/pdf_viewer/links_layer",["require","exports","tslib","external/react","external/lodash","modules/core/i18n","modules/clean/referrer_cleansing_redirect","modules/clean/react/previews/pdf_viewer/utils"],function(e,t,n,o,i,r,a,s){"use strict";function l(e){return!!e.ur}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.links.map(function(t,n){var c=t.a,p=t.r,d=p[0],u=p[1],g=p[2],m=p[3];m<0&&(u+=m,m=-m),g<0&&(d+=g,g=-g);var f={position:"absolute",bottom:u,left:d,width:g,height:m};return l(c)?c.ur.startsWith("mailto:")?o.createElement("a",{key:n,style:f,href:c.ur,"aria-label":r._("External Link")}):o.createElement("a",{key:n,style:f,href:a.get_redirect_uri(s.normalizeUrl(c.ur)).toString(),target:"_blank",rel:"noreferrer noopener","aria-label":r._("External Link")}):o.createElement("div",{key:n,className:"internal-link",style:f,"aria-label":r._("Internal Link"),onClick:i.partial(e.props.onInternalLinkClicked,c.pn)})});return o.createElement("div",{className:"links-layer-inner"},t)},t})(o.PureComponent),p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"links-layer",style:{position:"absolute",bottom:0,left:0,width:0,height:0,transform:"scale("+this.props.clientScaleFactor+")",transformOrigin:"top left"}},o.createElement(c,{links:this.props.links,onInternalLinkClicked:this.props.onInternalLinkClicked}))},t})(o.PureComponent);t.LinksLayer=p}),define("modules/clean/react/previews/pdf_viewer/page",["require","exports","tslib","esignature_prototype/components/esignature_field_creation_layer","esignature_prototype/components/esignature_field_view_layer","esignature_prototype/utils","external/react","external/react-dom","modules/clean/react/async/loadable","modules/clean/react/previews/pdf_viewer/annotation_creation_layer","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/links_layer","modules/clean/react/previews/pdf_viewer/annotation_view_layer","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/zoom","modules/clean/web_timing_logger"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,g,m,f){"use strict";var h=this;Object.defineProperty(t,"__esModule",{value:!0});var v=l.Loadable({loader:function(){return n.__awaiter(h,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return[4,f.waitForTTI()];case 1:return n.sent(),[4,new Promise(function(t,n){e(["modules/clean/react/previews/pdf_viewer/text_layer"],t,n)})];case 2:return t=n.sent().TextLayer,[2,t]}})})}}),_=(function(){function e(){this.imageLoad=new g.TimingStat,this.pageRender=new g.TimingStat}return e})(),w=(function(e){function t(t){var n=e.call(this,t)||this;return n.timingStats=new _,n.imageLoaded=!1,n.textRendered=!1,n.hasError=!1,n.imageElRef=function(e){return n.imageEl=e},n.onMouseDown=function(e){e.persist(),n.updateOffset(),n.annotationCreationDelegate.onMouseDownCallback(e)},n.onMouseMove=function(e){e.persist(),n.annotationCreationDelegate.onMouseMoveCallback(e)},n.onMouseUp=function(e){e.persist(),n.annotationCreationDelegate.onMouseUpCallback(e)},n.updateOffset=function(){var e=s.findDOMNode(n),t=e.getBoundingClientRect(),o=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||o.scrollTop,a=window.pageXOffset||i.scrollLeft||o.scrollLeft,l=i.clientTop||o.clientTop||0,c=i.clientLeft||o.clientLeft||0,p=t.top+r-l,d=t.left+a-c,u=t.right-t.left,g=t.bottom-t.top;n.setState({offset:{top:p,left:d,bottom:p+g,right:d+u}})},n.onScroll=function(){n.updateOffset(),n.annotationCreationDelegate.onScrollCallback()},n.onImageLoaded=function(){n.imageLoaded||(n.imageLoaded=!0,n.timingStats.imageLoad.timeEnd(),n.props.onImageLoad&&n.props.onImageLoad(n.props.pageData.pageIndex,n.timingStats.imageLoad),n.onTimingEventCompleted())},n.onTextRendered=function(){n.textRendered||(n.textRendered=!0,n.onTimingEventCompleted())},n.shouldMarkTimingEventCompleted=function(){return n.imageLoaded&&(n.props.loadImageOnly||n.textRendered)},n.onTimingEventCompleted=function(){n.shouldMarkTimingEventCompleted()&&(n.timingStats.pageRender.timeEnd(),n.props.onRenderComplete&&n.props.onRenderComplete(n.props.pageData.pageIndex,n.timingStats.pageRender)),n.updateOffset()},n.onError=function(){n.hasError=!0,n.props.onImageError&&n.props.onImageError(n.props.pageData.pageIndex)},n.onInternalLinkClick=function(e,t){n.props.onInternalLinkClicked&&n.props.onInternalLinkClicked(e,t)},n.state={},n.annotationCreationDelegate={onMouseDownCallback:function(e){},onMouseMoveCallback:function(e){},onMouseUpCallback:function(e){},onScrollCallback:function(){}},n}return n.__extends(t,e),t.prototype.startTiming=function(){this.timingStats=new _,this.timingStats.imageLoad.time(),this.timingStats.pageRender.time()},t.prototype.componentWillMount=function(){this.startTiming()},t.prototype.componentDidMount=function(){p.eventEmitter.on("scroll",this.onScroll),this.updateOffset(),this.imageEl&&this.imageEl.complete&&!this.hasError&&this.onImageLoaded()},t.prototype.componentWillUnmount=function(){p.eventEmitter.off("scroll",this.onScroll)},t.prototype.componentWillUpdate=function(e,t){this.props.pageData.pageIndex!==e.pageData.pageIndex&&(this.imageLoaded=!1,this.textRendered=!1,this.hasError=!1,this.startTiming())},t.prototype.render=function(){var e=null,t=null,n=null,s=null,l=this.props.pageData.pageIndex+1,p="pageContainer"+l,g="pageImage"+l,f=m.calculatedFetchedScaleFactor(this.props.clientScaleFactor,{originalWidth:this.props.pageData.dimension[0],originalHeight:this.props.pageData.dimension[1]}),h=a.createElement("div",{className:"page-image-wrapper"},a.createElement("img",{ref:this.imageElRef,alt:"",key:g,width:"100%",role:"tabpanel","aria-hidden":"true",src:this.props.urls.imageUrl(this.props.pageData.pageIndex,100*f),onLoad:this.onImageLoaded,onError:this.onError}));if(this.props.loadImageOnly||(e=a.createElement(v,{width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],textboxes:this.props.pageData.textboxes||[],clientScaleFactor:this.props.clientScaleFactor,onRender:this.onTextRendered}),t=a.createElement(d.LinksLayer,{width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],links:this.props.pageData.links||[],clientScaleFactor:this.props.clientScaleFactor,onInternalLinkClicked:this.onInternalLinkClick})),this.props.annotationProps){var _=this.props.annotationProps;n=a.createElement(u.AnnotationViewLayer,{annotations:_.annotations||[],page:l,width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],scaleFactor:this.props.clientScaleFactor,frameMessenger:_.frameMessenger});var w=_.isAnnotationCreationEnabled;this.props.annotationProps.isAnnotationCreationEnabled&&(s=a.createElement(c.AnnotationCreationLayer,{pageNumber:l,width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],scaleFactor:this.props.clientScaleFactor,parentOffset:this.state.offset,delegate:this.annotationCreationDelegate,frameMessenger:_.frameMessenger,isAnnotationCreationEnabled:w,isAnnotationHighlightEnabled:_.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:_.isAnnotationRegionEnabled}))}var b=a.createElement("div",{className:"c-loader"}),P={width:this.props.pageData.dimension[0]*this.props.clientScaleFactor,height:this.props.pageData.dimension[1]*this.props.clientScaleFactor};return a.createElement("div",{id:p,className:"page","data-page-number":l,style:P,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp},b,s,n,h,e,t,r.esignaturesEnabled()&&this.props.isSigningMode?a.createElement(i.EsignatureFieldViewLayer,{fields:this.props.fields,width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],scaleFactor:this.props.clientScaleFactor,signatureImage:this.props.signatureImage,createSignature:this.props.createSignature,signField:this.props.signField,enterFieldText:this.props.enterFieldText,selectFieldDate:this.props.selectFieldDate}):null,r.esignaturesEnabled()&&this.props.isSendForSignatureMode?a.createElement(o.EsignatureFieldCreationLayer,{fields:this.props.fields,width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],scaleFactor:this.props.clientScaleFactor,offset:this.state.offset,pageNumber:l,isFieldCreationMode:this.props.isFieldCreationMode,fieldCreationType:this.props.fieldCreationType,isCreatingFieldForRecipient:this.props.isCreatingFieldForRecipient,exitFieldCreationMode:this.props.exitFieldCreationMode,createField:this.props.createField,updateField:this.props.updateField}):null)},t})(a.PureComponent);t.Page=w}),define("modules/clean/react/previews/pdf_viewer/password_modal",["require","exports","tslib","external/classnames","external/react","modules/clean/react/input","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var n=e.call(this,t)||this;return n.onChange=function(e){n.setState({password:e.target.value})},n.onClickSubmit=function(){n.props.onSubmit(n.state.password)},n.onFormSubmit=function(e){e.preventDefault(),n.onClickSubmit(),n.modalInstance&&n.modalInstance.close()},n.modalRef=function(e){return n.modalInstance=e},n.state={password:""},n}return n.__extends(t,e),t.prototype.getMessage=function(){return this.props.isFirstAttempt?s._("Enter the password to open this file."):s._("The password you entered is incorrect, please try again.")},t.prototype.render=function(){var e=o({"db-modal-message":!0,"wrong-password":!this.props.isFirstAttempt});return i.createElement(a.Modal,{className:"password-modal",title:s._("This file is password protected"),acceptButtonText:s._("Submit"),dismissButtonText:s._("Cancel"),onAccept:this.onClickSubmit,onDismiss:this.props.onDismiss,style:"default-maestro",ref:this.modalRef},i.createElement("form",{method:"post",onSubmit:this.onFormSubmit},i.createElement("div",{className:e},this.getMessage(),i.createElement(r.password,{value:this.state.password,placeholder:s._("Password"),onChange:this.onChange}),i.createElement("input",{type:"submit",style:{display:"none"}}))))},t})(i.PureComponent);t.PasswordModal=l}),define("modules/clean/react/previews/pdf_viewer/sidebar",["require","exports","tslib","external/react","external/react-dom","external/classnames","spectrum/culled_list","modules/core/i18n","modules/clean/react/previews/pdf_viewer/utils"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e){return e.map(function(e){return p(e.dimension)+2*t.SIDEBAR_THUMBNAIL_BORDER+t.SIDEBAR_PAGE_NUMBER_FONT_HEIGHT+t.SIDEBAR_PAGE_NUMBER_MARGIN_BOTTOM})}function p(e){return l.scaleDimension(e,{maxWidth:t.SIDEBAR_THUMBNAIL_WIDTH})[1]}function d(e,t,n){var o=e.scrollTop,i=e.clientHeight,r=o+i,a=t.slice(0,n).reduce(function(e,t){return e+t},0);(a<o||a+t[n]>r)&&(e.scrollTop=a)}function u(e){var n=e.page,i=e.isSelected,a=e.topOffset,c=e.onClick,p=l.scaleDimension(n.dimension,{maxWidth:t.SIDEBAR_THUMBNAIL_WIDTH}),d=p[0],u=p[1],m=n.pageIndex,f=n.thumbnailUrl;return o.createElement("li",{className:r("sidebar__list-item","list-item",{"sidebar__list-item--selected":i}),style:{transform:"translateY("+a+"px)"}},o.createElement("a",{href:"#",onClick:c(m),tabIndex:-1},o.createElement(g,{style:{width:d+"px",height:u+"px"},className:"list-item__thumbnail",src:f,alt:s._("Page %(page_num)s").format({page_num:m+1}),role:"tab",loader:o.createElement("div",{className:"c-loader"})}),o.createElement("span",{className:"list-item__number"},m+1)))}Object.defineProperty(t,"__esModule",{value:!0}),t.SIDEBAR_WIDTH=184,t.SIDEBAR_THUMBNAIL_BORDER=4,t.SIDEBAR_PAGE_NUMBER_FONT_HEIGHT=16,t.SIDEBAR_PAGE_NUMBER_MARGIN_BOTTOM=16,t.SIDEBAR_THUMBNAIL_WIDTH=120;var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isLoaded:!1},t.onLoad=function(e){var n=t.props.onLoad;n&&n(e),t.setState({isLoaded:!0})},t.onError=function(e){var n=t.props.onError;n&&n(e),t.setState({isLoaded:!1})},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.loader,i=e.className,a=e.style,s=n.__rest(e,["loader","className","style"]);return o.createElement("div",{className:i,style:a},o.createElement("img",n.__assign({},s,{onLoad:this.onLoad,onError:this.onError,className:r({hidden:!this.state.isLoaded})})),this.state.isLoaded?null:t)},t})(o.PureComponent),m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onClickItem=function(e){return function(t){n.props.onClick&&n.props.onClick(e)}},n.handleResize=function(){n.setState({height:n.container.getBoundingClientRect().height})},n.state={height:0,itemHeights:c(t.pages)},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){window.addEventListener("resize",this.handleResize),this.handleResize(),d(this.list,this.state.itemHeights,this.props.currentPageIndex),this.container.focus()},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.handleResize)},t.prototype.componentWillReceiveProps=function(e){e.pages!==this.props.pages&&this.setState({itemHeights:c(e.pages)})},t.prototype.componentDidUpdate=function(e){var t=this.props.currentPageIndex;t!==e.currentPageIndex&&d(this.list,this.state.itemHeights,t)},t.prototype.render=function(){var e=this,t=this.props,n=t.className,s=t.pages,l=t.currentPageIndex,c=t.isFocused,p=t.onFocus,d=t.onBlur,g=this.state,m=g.height,f=g.itemHeights;return o.createElement("div",{className:r("sidebar",n,{"doc-preview-sidebar-focused":c}),ref:function(t){return e.container=t},role:"tablist",tabIndex:0,onFocus:p,onBlur:d},o.createElement(a.CulledList,{className:"sidebar__list",items:s,listItemHeight:f,ref:function(t){return e.list=i.findDOMNode(t)},renderRow:function(t,n,i){return o.createElement(u,{key:t.thumbnailUrl,page:t,isSelected:l===t.pageIndex,topOffset:i,onClick:e.onClickItem})},shouldUseWindowAsScrollContainer:!1,viewportHeight:m,itemBuffer:5}))},t.defaultProps={currentPageIndex:0,pages:[]},t})(o.PureComponent);t.Sidebar=m}),define("modules/clean/react/previews/pdf_viewer/single_page",["require","exports","tslib","external/react","external/lodash","modules/core/browser","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","modules/clean/react/previews/pdf_viewer/page"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(){return!r.is_mobile_or_tablet()}Object.defineProperty(t,"__esModule",{value:!0});t.deviceSupported=c;var p=(function(e){function t(t){var n=e.call(this,t)||this;return n.pageContainerRef=function(e){return n.pageContainerDOM=e},n.pageDown=function(){n.props.onPageNumberUpdated(n.props.currentPageIndex+1,function(){})},n.pageUp=function(){n.props.onPageNumberUpdated(n.props.currentPageIndex-1,function(){})},n.debouncedPageDown=i.debounce(n.pageDown,40,{leading:!0,trailing:!1}),n.debouncedPageUp=i.debounce(n.pageUp,40,{leading:!0,trailing:!1}),n.handleWheel=function(e){e.deltaY>0?n.debouncedPageDown():e.deltaY<0&&n.debouncedPageUp()},n.state={clientScaleFactor:1,fittingMode:s.FittingMode.FIT_PAGE},n}return n.__extends(t,e),t.prototype.componentDidUpdate=function(e,t){if(e.height!==this.props.height||e.width!==this.props.width){var n=s.computeClientScaleFactor(this.state.fittingMode,this.props.metadata.dimensions,this.props.height,this.props.width-32);this.setState({clientScaleFactor:n})}},t.prototype.render=function(){var e=this.props,t=e.currentPageIndex,n=e.urls,i=e.pages,r=e.onPageRenderComplete,s=e.onPageImageLoad;return o.createElement("div",{className:"viewer-container__sizer",ref:this.pageContainerRef,onWheel:this.handleWheel},o.createElement(l.Page,{fields:[],key:t,pageData:i[t],urls:n,clientScaleFactor:this.state.clientScaleFactor,onRenderComplete:r,onImageLoad:s,loadImageOnly:!1,annotationProps:a.annotationsAtPage(this.props.annotationProps,t),onImageError:this.props.onImageError}))},t})(o.PureComponent);t.SinglePage=p}),define("modules/clean/react/previews/pdf_viewer/timing",["require","exports"],function(e,t){"use strict";function n(){return i?window.performance.now():Date.now()}function o(){return new r}Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.OVERALL=0]="OVERALL",e[e.REQUEST=1]="REQUEST",e[e.RENDER=2]="RENDER"})(t.TimingEventType||(t.TimingEventType={}));var i=!(!window.performance||!window.performance.now),r=(function(){function e(){}return e.prototype.time=function(){return this.start=n(),this},e.prototype.timeEnd=function(){return void 0===this.end&&(this.end=n()),this},e.prototype.duration=function(){return this.end-this.start},e})();t.TimingStat=r,t.makeTimer=o}),define("modules/clean/react/previews/pdf_viewer/transform",["require","exports"],function(e,t){"use strict";function n(e,t,n){return n.map(function(e){return e.coordinates.map(function(e){return{x:e.x,y:t-e.y}})})}function o(e,t,n,o,i,r,a){return a.map(function(a){return{coordinates:a.map(function(e){return{x:(e.x-t)/r,y:i-(e.y-n)/r}}),page:e,page_size:{width:o,height:i}}})}Object.defineProperty(t,"__esModule",{value:!0}),t.transformPdfCoordinates=n,t.transformViewportCoordinates=o}),define("modules/clean/react/previews/pdf_viewer/urls",["require","exports","modules/core/uri","modules/constants/file_viewer"],function(e,t,n,o){"use strict";function i(e,t){return n.URI.parse(e).updateQuery(t).toString()}function r(e){return n.URI.parse(e).getAuthority().toLocaleLowerCase().indexOf("dropbox.com")<0}Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){var t=e.imageUrl,n=e.textUrl,o=e.refreshUrl;this.useCanned=!1,this.imageUrlTmpl=t,this.textUrlTmpl=n,this.refreshUrlString=o}return e.prototype.setUseCannedFile=function(){this.useCanned=!0},e.prototype.imageUrl=function(e,t){void 0===t&&(t=0);var n={page:e.toString()};o.SVG_PDF_PREVIEW&&t>0?n.format="svg":n.scale_percent=t.toString();var r=i(this.imageUrlTmpl,n);return this.useCanned&&(r=i(r,{canned_file_name:"spdf/audi.pdf."+e+".png"})),r},e.prototype.textUrl=function(e,t,n){var o=this.textUrlTmpl;return e&&(o=i(o,{metadata:"1"})),void 0!==t&&(o=i(o,{text:"1",page_start:""+t,page_end:""+n})),this.useCanned&&(o=i(o,{canned_file_name:"spdf/audi.pdf.json"})),o},e.prototype.refreshUrl=function(){return this.refreshUrlString},e.prototype.newSetWithBlob=function(t,n){return new e({imageUrl:this.imageUrlTmpl.replace(t,n),textUrl:this.textUrlTmpl.replace(t,n),refreshUrl:this.refreshUrlString?this.refreshUrlString.replace(t,n):void 0})},e})();t.SsrUrlSet=a,t.updateQueryParam=i,t.skipCsrfTokenInjection=r}),define("modules/clean/react/previews/pdf_viewer/utils",["require","exports","tslib","modules/clean/react/previews/constants","modules/clean/react/previews/pdf_viewer/event_emitter"],function(e,t,n,o,i){"use strict";function r(e){
if(f===e)return h;var t=[];return e.forEach(function(e){for(var n=e[0],o=e[1],i=e[2],r=0;r<i;r++)t.push([n,o])}),f=e,h=t,t}function a(e,t,n){return e.map(function(e){return[e[0]*t,e[1]*t]}).reduce(function(e,t){var o=e[0],i=e[1],r=t[0],a=t[1];return[Math.max(o,r),i+n+a]},[0,0])}function s(e,t){for(var n=r(e),o=[],i=0;i<n.length;i++){var a=n[i],s=a[0],l=a[1];o.push(t(i,s,l))}return o}function l(e){(new Image).src=e}function c(e,t){if(e.postMessageToParent("annotation-hidden"),i.eventEmitter.emit("resize"),t){var n=document,o=window.getSelection?window.getSelection():n.selection;if(o){var r=o.anchorNode,a=o.focusNode;t.contains(r)&&t.contains(a)&&(window.getSelection?window.getSelection().removeAllRanges():n.selection&&n.selection.empty())}}}function p(e,t){if(e)return n.__assign({},e,{annotations:e.annotations[t]||[]})}function d(e){return"http"===e.substr(0,4)?e:"http://"+e}function u(e){return!!e&&new RegExp("^"+o.HYPERLINK_REGEX_STRING+"$","i").test(e)}function g(e){return new RegExp("^"+o.EMAIL_REGEX_STRING+"$","i").test(e)}function m(e,t){void 0===t&&(t={});var n=e[0],o=e[1],i=t.maxWidth,r=t.maxHeight;if(void 0!==i&&void 0!==r){var a=Math.min(i/n,r/o);return[a*n,a*o]}return void 0!==i?[i,i/n*o]:void 0!==r?[r/o*n,r]:e}Object.defineProperty(t,"__esModule",{value:!0});var f,h;t.expandDimensions=r,t.getTotalSize=a,t.mapPages=s,t.prefetchImage=l,t.resetAnnotationState=c,t.annotationsAtPage=p,t.normalizeUrl=d,t.isHyperlink=u,t.isEmailAddress=g,t.scaleDimension=m}),define("modules/clean/react/previews/pdf_viewer/zoom",["require","exports","modules/clean/previews/util","modules/core/browser"],function(e,t,n,o){"use strict";function i(){return c.FIT_PAGE}function r(e){return n.isPptExtension(e)&&!o.is_mobile_or_tablet()?u.SINGLE_PAGE:u.CONTINUOUS}function a(e,t,n,o){var i=1;if(e===c.FIT_PAGE){for(var r=0,a=0,s=0,l=t;s<l.length;s++){var p=l[s],u=p[0],g=p[1];a=Math.max(u,a),r=Math.max(g,r)}i=Math.min(n/r,o/a)}else e===c.FIT_TO_WIDTH&&(i=o/t[0][0]);return Math.min(i,d)}function s(e,t){return 2048/Math.max(e,t)}function l(e,t){if(t){var n=t.originalHeight;if(s(t.originalWidth,n)>e)return 0}for(var o=0,i=p;o<i.length;o++){var r=i[o];if(r>=e)return r}return d}Object.defineProperty(t,"__esModule",{value:!0});var c,p=[1,2,4],d=Math.max.apply(Math,p);(function(e){e[e.NONE=0]="NONE",e[e.FIT_TO_WIDTH=1]="FIT_TO_WIDTH",e[e.FIT_PAGE=2]="FIT_PAGE"})(c=t.FittingMode||(t.FittingMode={}));var u;(function(e){e[e.CONTINUOUS=0]="CONTINUOUS",e[e.SINGLE_PAGE=1]="SINGLE_PAGE"})(u=t.ScrollMode||(t.ScrollMode={})),t.fullscreenFittingMode=i,t.defaultScrollMode=r,t.computeClientScaleFactor=a,t.calculatedFetchedScaleFactor=l}),define("modules/clean/react/previews/preview_pdf",["require","exports","tslib","external/lodash","external/react","modules/clean/web_timing_logger","modules/clean/previews/util","modules/clean/react/previews/pdf_viewer/app","modules/clean/react/previews/pdf_viewer/frame_messenger_shims","modules/clean/react/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/frame_interface","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/file_viewer/full_screen_helpers"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,g,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.onError=function(e){e===c.ErrorType.LoadError&&n.onDownloadFailed(),n.props.onError&&n.props.onError(e)},n.onDownloadAttempted=function(){n.logFilePreviewEvent(p.EventType.FilePreviewDownloadAttempted)},n.onDownloadSucceeded=function(){n.logFilePreviewEvent(p.EventType.FilePreviewDownloadSucceeded)},n.onMetadataLoad=function(e){n.setState({metadata:e})},n.onDownloadFailed=function(){n.logFilePreviewEvent(p.EventType.FilePreviewDownloadFailed)},n.onFirstRenderSucceeded=function(){n.markPrimaryEvent(),n.logFilePreviewEvent(p.EventType.FilePreviewRenderSucceeded),n.props.setRenderStatusSuccess()},n.onPlaceholderImageLoad=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.logSSREvent("placeholder_loaded")},n.onFirstImageLoad=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.logSSREvent("first_image_loaded")},n.onPasswordPrompt=function(){n.markPrimaryEvent()},n.sendIdleMouse=o.debounce(function(){n.frameMessengerClient.postMessageToParent("idle-mouse")},1500),n.onMouseMove=o.throttle(function(){n.frameMessengerClient.postMessageToParent("active-mouse"),n.sendIdleMouse()},16),n.onToolbarShow=function(){n.setState({isToolbarVisible:!0})},n.onToolbarHide=function(){n.setState({isToolbarVisible:!1})},n.onLoad=function(){n.frameMessengerClient.postMessageToParent("viewer-ready"),n.props.onLoad&&n.props.onLoad()},n.state={isToolbarVisible:!1},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;this.props.filePreviewSession&&(this.props.filePreviewSession.isSSR=!0),this.logFilePreviewEvent(p.EventType.FilePreviewSupportConfirmed),this.frameMessengerChannel=l.makeChannel(),this.frameMessengerHost=new l.FrameMessengerHostShim(this.frameMessengerChannel),this.frameMessengerClient=new l.FrameMessengerClientShim(this.frameMessengerChannel),this.frameMessengerClient.configureParentMessaging(function(e){return m.eventEmitter.emit(e.action,e.parameters)},["open-file","page-up","page-down","file-feedback-ui-ready","update-annotations","enable-annotation-creation","disable-annotation-creation","enable-region-creation","disable-region-creation","zoom-in","zoom-out","print","remove-all-annotations","scroll-to-annotation"]),this.frameMessengerClient.startListening(),d.FileViewerFrameInterface.setFrameMessengerFactory(function(){return new l.FrameMessengerHostShim(e.frameMessengerChannel)}),this.props.invalidateFrameMessenger&&this.props.invalidateFrameMessenger()},t.prototype.componentWillUnmount=function(){d.FileViewerFrameInterface.setFrameMessengerFactory(void 0)},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markPrimaryEvent=function(){r.mark_time_to_view(),r.mark_time_to_interactive(),this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent()},t.prototype.canPrint=function(){var e=this.props,t=e.fileHref,n=e.sharePermission;return!(null!=t&&n&&n.canPrintRoles&&0===n.canPrintRoles.length)},t.prototype.getPrintProps=function(){return{canPrint:this.canPrint(),isSharedLink:this.props.isSharedLink||!1,fileBlockServerUrl:this.props.src,fileHref:this.props.fileHref}},t.prototype.renderPreviewContent=function(){var e=new g.SsrUrlSet({imageUrl:this.props.imageUrl,textUrl:this.props.textUrl,refreshUrl:this.props.refreshUrl});return this.props.forceTestPdf&&e.setUseCannedFile(),i.createElement(s.App,{fileExtension:this.props.fileExtension,filePreviewSession:this.props.filePreviewSession,frameMessenger:this.frameMessengerClient,isFullscreen:this.props.isFullscreen,isSidebarOpen:this.props.isSidebarOpen,isToolbarVisible:this.state.isToolbarVisible,key:e.refreshUrl(),onError:this.onError,onExitFullscreen:f.exitFullScreen,onLoad:this.onLoad,onMetadataLoad:this.onMetadataLoad,previewThumbnailUrl:this.props.previewThumbnailUrl,printProps:this.getPrintProps(),sizeClass:this.props.sizeClass,timelineCallbacks:{onDownloadAttempted:this.onDownloadAttempted,onDownloadSucceeded:this.onDownloadSucceeded,onFirstRenderSucceeded:this.onFirstRenderSucceeded,onPlaceholderImageLoad:this.onPlaceholderImageLoad,onFirstImageLoad:this.onFirstImageLoad,onPasswordPrompt:this.onPasswordPrompt},urls:e})},t.prototype.render=function(){var e=this.props,t=e.fileExtension,n=e.isArchiveFile,o=e.isFullscreen,r=e.isSidebarOpen,s=e.onCloseViewer,l=e.sharePermission,c=e.shouldDisableAnnotations,d=e.sizeClass,g=this.state.metadata,m=a.isPptExtension(t)?p.DocType.ppt:p.DocType.pdf;return i.createElement("div",{className:"preview-content preview-pdf preview-pdf-ssr",onMouseMove:this.onMouseMove,onTouchStart:this.onMouseMove,onTouchMove:this.onMouseMove},this.renderPreviewContent(),g?i.createElement(u.PreviewToolbarContainer,{forceDisableRegionAnnotation:c,isSidebarOpen:!!r[m],isFullscreen:o,previewToolbarProps:{afterFileViewerExit:s,docType:m,isArchiveFile:n,fileExtension:t,isFullscreen:o,sharePermission:l,pagesCount:g.page_count,shouldDisplayRegionCreationButton:!1,frameMessenger:this.frameMessengerHost,onToolbarShow:this.onToolbarShow,onToolbarHide:this.onToolbarHide,sizeClass:d}}):null)},t})(i.PureComponent);t.PreviewPDF=h});
//# sourceMappingURL=pkg-file_viewer_pdf.min.js-vfldghrDQ.map