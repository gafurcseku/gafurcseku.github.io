define("modules/clean/react/async_fileops_modals",["require","exports","modules/clean/react/folder_dialog/constants"],function(e,t,o){"use strict";function a(t){e(["modules/clean/react/fileops_modals"],t)}function r(e){a(function(t){return(0,t.showCopy)(e)})}function s(e){a(function(t){return(0,t.showMove)(e)})}function n(e){a(function(t){return(0,t.showUpload)(e)})}function i(e){a(function(t){return(0,t.showAdminUpload)(e)})}function l(t){e(["modules/clean/react/folder_dialog/move_dialog"],t)}function d(e,t){l(e===o.Operation.MOVE?function(e){return(0,e.showMove)(t)}:function(e){return(0,e.showCopy)(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showCopy=r,t.showMove=s,t.showUpload=n,t.showAdminUpload=i,t.requireMoverDialog=l,t.showMoverDialog=d}),define("modules/clean/react/browse/client_download_modal",["require","exports","tslib","modules/core/cookies","modules/clean/ajax","modules/clean/react/modal","modules/clean/static_urls","external/react","modules/core/i18n","modules/clean/react/css","modules/core/browser","modules/clean/analytics"],function(e,t,o,a,r,s,n,i,l,d,p,u){"use strict";function c(e){"y"!==a.Cookies.read("uj-pop")&&r.WebRequest({url:"/should_show_uj_popup",data:{is_download:e},success:function(t){JSON.parse(t).showModal&&(m.showInstance({isDownload:e}),a.Cookies.create("uj-pop","y",30))},error:function(){}})}Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var o=e.call(this,t)||this;return o.onAccept=function(){u.TeamsWebActionsLogger.log("uj_popup_modal_clicked",{},function(){p.redirect("/downloading")})},o.onDismiss=function(){u.TeamsWebActionsLogger.log("uj_popup_modal_dismissed")},o}return o.__extends(t,e),t.showInstance=function(e){s.Modal.showInstance(i.createElement(t.ClientDownloadModal,o.__assign({},e)))},t.prototype.getHeader=function(){return this.props.isDownload?l._("Download files just by opening them"):l._("No more uploads — how easy!")},t.prototype.getBody=function(){return this.props.isDownload?l._("With the Dropbox desktop app, you can access         everything in your account right from your desktop.         Save to the cloud instantly, and download         files when you need them just by opening them."):l._("With the Dropbox desktop app and selective sync,         you can open, edit, and save files right on your desktop.         Your changes sync automatically to all your devices,         so you save time and hard drive space.")},t.prototype.getCTA=function(){return l._("Download for free")},t.prototype.render=function(){return i.createElement(s.Modal,{className:"uj-popup-modal",acceptButtonText:null,onDismiss:this.onDismiss,style:"clean",width:640},i.createElement("div",{className:"uj-popup-modal__content"},i.createElement("img",{alt:"",src:n.static_url("/static/images/install/uj_popup_install-vflA_v5Lg.png")}),i.createElement("div",{className:"uj-popup-modal__header"},this.getHeader()),i.createElement("div",{className:"uj-popup-modal__body"},this.getBody()),i.createElement("button",{className:"mc-button mc-button-primary",onClick:this.onAccept},this.getCTA())))},t.ClientDownloadModal=d(t,["/static/css/browse/popup_modal-vfl5uk2Vp.css"]),t})(i.Component);t.ClientDownloadModalView=m,t.maybeShowClientDownloadModal=c}),define("modules/clean/react/browse/shared_with",["require","exports","tslib","external/lodash","external/react","external/prop-types","external/create-react-class","modules/clean/ajax","modules/clean/avatar/size","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/files_view/types","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/share_modal_util","modules/clean/react/browse/shared_with_view","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/constants/sharing","modules/core/browser","modules/clean/react/browse/nav_actions"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h,f,E,g,y,S,v,T,A,b,U,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var R=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.initializeWith=function(e){var t=e.path,o=e.files;return this._browseInitializeEverything(t,o)},t.prototype._init=function(){this._sharedFolderDataByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={},this._hasSharedDataLoadedByContainingPath={}},t.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},t.prototype.clearSharedLinkDataCache=function(){this._filesWeHaveSharedLinkDataFor={}},t.prototype.getDataForFile=function(e){var t={};if(e&&!e.target_ns&&this._canBeSharedFile(e)){var o=this._sharedFileDataByFileId[e.file_id||e.fq_path]||{},r=this._sharedFolderDataByTargetNs[h.getBrowseStore().context().currentNSID]||{};null!=o.joinedMembers&&o.joinedMembers.length||null!=o.groups&&o.groups.length||null!=o.invitations&&o.invitations.length||(t.audienceDescription=r.audienceDescription),t.groups=a.uniqBy(a.union(o.groups||[],r.groups||[]),function(e){return e.gid}),t.invitations=a.uniqBy(a.union(o.invitations||[],r.invitations||[]),function(e){return e.email_or_fbname}),t.joinedMembers=a.uniqBy(a.union(o.joinedMembers||[],r.joinedMembers||[]),function(e){return e.email}),t.numUndisplayableUsersAndInvites=(o.numUndisplayableUsersAndInvites||0)+(r.numUndisplayableUsersAndInvites||0);var s=(null!=t.joinedMembers?t.joinedMembers.length:0)+(null!=t.invitations?t.invitations.length:0)+(t.numUndisplayableUsersAndInvites||0);null!=t.groups&&(s+=t.groups.map(function(e){return e.num_users||1}).reduce(function(e,t){return e+t},0)),t.memberCount=s}else t=e&&e.target_ns?this._sharedFolderDataByTargetNs[e.target_ns]:this._sharedFolderDataByTargetNs[h.getBrowseStore().context().currentNSID];t=t||{};var n=this._getSharedLinkInfoByFile(e);return n?t.sharedLinkInfo=n:null!=t&&delete t.sharedLinkInfo,t.hasSharedDataLoaded=this._getHasSharedDataLoaded(),t},t.prototype._getSharedLinkInfoByFile=function(e){var t,o=h.getBrowseStore().path(),a=this._sharedLinkDataMapsByFolderFQPath[o];return a&&e&&(t=a[this._sharedLinkKey(e)]),t},t.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case c.BrowseActionType.LOAD_PATH:case c.BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE:return this._pathLoaded(t.data.path,t.data.files);case c.BrowseActionType.INITIALIZE_EVERYTHING:return this._browseInitializeEverything(t.data.path,t.data.files);case c.BrowseActionType.CHANGE_FILES:return this._filesChanged(t.data.path,t.data.fileDeltas);case c.SharedWithActionType.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(t.data.fileIds);case c.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(t.data.parentPath);case c.SharedWithActionType.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(t.data.parentPath,t.data.fileFqPaths);case c.SharedWithActionType.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(t.data.sharedFolderData,t.data.containingPath);case c.SharedWithActionType.SET_SHARED_LINK_DATA:return this._setSharedLinkData(t.data.parentPath,t.data.sharedLinkData);case c.SharedWithActionType.SET_SHARED_FILE_DATA:return this._setSharedFileData(t.data.sharedFileData);case c.SharedWithActionType.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(t.data.targetNs);case c.SharedWithActionType.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(t.data.parentPath,t.data.files)}},t.prototype._fillInMissingSharedLinkData=function(e){for(var t=e.parentPath,o=e.files,a=[],r=0,s=o;r<s.length;r++){var n=s[r];this.hasLinkDataForFile(n)||(this._filesWeHaveSharedLinkDataFor[n.fq_path]=!0,a.push(n))}return O.loadLinkDataForFiles({parentPath:t,fileFqPaths:a.map(function(e){return e.fq_path})}),O.loadLinkMetadata(a)},t.prototype._getHasSharedDataLoaded=function(){var e=h.getBrowseStore().path();return e in this._hasSharedDataLoadedByContainingPath&&this._hasSharedDataLoadedByContainingPath[e]},t.prototype._setHasSharedDataLoaded=function(e){var t=h.getBrowseStore().path();return this._hasSharedDataLoadedByContainingPath[t]=e},t.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},t.prototype._loadSharedFileData=function(e){void 0===e&&(e=!1),e&&(this._sharedFileDataByFileId={});for(var t=[],o=0,a=h.getBrowseStore().files().toArray();o<a.length;o++){var r=a[o];!this._canBeSharedFile(r)||r.file_id in this._sharedFileDataByFileId||t.push(r.file_id)}return O.loadSharedFileDataForFiles({fileIds:t})},t.prototype._pathLoaded=function(e,t){return this._setHasSharedDataLoaded(!1),O.loadSFDataForPath({parentPath:e,abortCurrentRequest:!0}),this._loadSharedFileData(!0),this._filesAdded(e,t)},t.prototype._filesAdded=function(e,t){return this._fillInMissingSharedLinkData({parentPath:e,files:t}),this._loadSharedFileData()},t.prototype._filesChanged=function(e,t){if(e===h.getBrowseStore().path()&&null!=t&&t.length){p.Dispatcher.waitFor([h.getBrowseStore().dispatchToken]),O.loadSFDataForPath({parentPath:e}),this.clearSharedLinkDataCache();var o=h.getBrowseStore().files().toArray();return this._fillInMissingSharedLinkData({parentPath:e,files:o}),this._loadSharedFileData(!0)}},t.prototype._signalSharedFileDataOutOfDate=function(e){return O.loadSharedFileDataForFiles({fileIds:e})},t.prototype._signalSharedFolderDataOutOfDate=function(e){return null==e&&(e=h.getBrowseStore().path()),O.loadSFDataForPath({parentPath:e})},t.prototype._signalSharedLinkDataOutOfDate=function(e,t){return null==e&&(e=h.getBrowseStore().path()),O.loadLinkDataForFiles({parentPath:e,fileFqPaths:t})},t.prototype._setNSSharedWithData=function(e,t){this._sharedFolderDataByTargetNs=e,this._hasSharedDataLoadedByContainingPath[t]=!0,this.emit_change()},t.prototype._setSharedLinkData=function(e,t){for(var o=this._sharedLinkDataMapsByFolderFQPath[e]||{},a=0,r=t;a<r.length;a++){var s=r[a],n=s.file,i=s.sharedLinkToken;o[this._sharedLinkKey(n)]=i}return this._sharedLinkDataMapsByFolderFQPath[e]=o,this.emit_change()},t.prototype._setSharedFileData=function(e){this._sharedFileDataByFileId=o.__assign({},this._sharedFileDataByFileId,e),this.emit_change()},t.prototype._clearSharedFolderDataForNs=function(e){return delete this._sharedFolderDataByTargetNs[e],this.emit_change()},t.prototype._browseInitializeEverything=function(e,t){return O.loadSFDataForPath({parentPath:e}),this._filesAdded(e,t)},t.prototype._removeSharedLinkData=function(e,t){for(var o=this._sharedLinkDataMapsByFolderFQPath[e]||{},a=0,r=t;a<r.length;a++){var s=r[a];delete o[this._sharedLinkKey(s)]}return this._sharedLinkDataMapsByFolderFQPath[e]=o,this.emit_change()},t})(d.Store),D=new R;t.SharedWithStore=D,document.addEventListener(E.SharingApi.REQUEST_SUCCEEDED_EVENT,function(e,t){return t.request_url.indexOf("/share_ajax/leave")>-1?p.Dispatcher.dispatch({type:c.SharedWithActionType.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):p.Dispatcher.dispatch({type:c.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:h.getBrowseStore().path()}})});var O=(function(){function e(){}return e.loadLinkMetadata=function(e){var t=h.getBrowseStore().user();if(b.TRUELINK.TRUELINK_BROWSE_LINK_ICON[t.id]&&b.TRUELINK.TRUELINK_UI[t.id]){var o=e.filter(function(e){return e.is_dir}).map(function(e){return"ns:"+e.ns_id+e.ns_path}),a=function(){if(0!==o.length){var e=o.slice(0,5);return o=o.slice(5),f.SharingActions.loadFolderLinkMetadataBatch(t,e,!1).then(a)}},r=e.filter(function(e){return!e.is_dir}).map(function(e){return e.file_id||e.fq_path}),s=function(){if(0!==r.length){var e=r.slice(0,5);r=r.slice(5),f.SharingActions.loadFileMetadataBatch(t,e).then(s)}};a(),s()}},e.loadSFDataForPath=function(t){var o=t.parentPath,a=t.abortCurrentRequest,r=void 0!==a&&a,s=h.getBrowseStore().user();r&&null!=e._currentSFDataRequest&&e._currentSFDataRequest.abort(),e._currentSFDataRequest=i.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:s,data:{max_results:5,fq_path_prefix:o,include_inherited:!0,sort_by_name:!0},success:function(e){for(var t={},a=0,r=e;a<r.length;a++){var s=r[a];t[s.ns_id]={numUndisplayableUsersAndInvites:s.num_avatars_not_shown,groups:s.groups,invitations:s.invitations,joinedMembers:s.joined_members,audienceDescription:s.audience_description,memberCount:s.num_users_and_invites}}return p.Dispatcher.dispatch({type:c.SharedWithActionType.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:t,containingPath:o}})},complete:function(){e._currentSFDataRequest=null}})},e.loadSharedFileDataForFiles=function(e){var t=e.fileIds,o=h.getBrowseStore().user();if(o.is_email_verified){var a=new g.FileShareApiClient({userId:o.id}),r=function(e){if(!e||0!==e.length){var t=e.slice(0,100),o=e.slice(100);return a.listMembersBatch({contentIds:t,limit:5}).then(function(e){var t={};if(e.forEach(function(e,o){return t[o]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(A.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(A.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(A.apiUserMemberToAvatarInfo).toArray()}}),p.Dispatcher.dispatch({type:c.SharedWithActionType.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),o)return r(o)})}};return r(t)}},e.loadLinkDataForFiles=function(e){var t=e.parentPath,o=e.fileFqPaths,r=h.getBrowseStore().user();if(!b.TRUELINK.TRUELINK_UI[r.id]){var s=function(e){if(0!==e.length){var o=e.slice(0,100),n=e.slice(100);i.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(o)},subject_user:r,success:function(e){for(var r,i=h.getBrowseStore().filesMap(),l=[],d=0,u=e.shmodels;d<u.length;d++){var m=u[d];m.disabled||(r=i.get(m.path),r&&l.push({file:r,sharedLinkToken:m}))}l.length&&p.Dispatcher.dispatch({type:c.SharedWithActionType.SET_SHARED_LINK_DATA,data:{parentPath:t,sharedLinkData:l}});for(var _,f=a.zipObject(a.map(e.shmodels,"path"),a.map(e.shmodels,function(){return!0})),E=[],g=0,y=o;g<y.length;g++){var S=y[g];S in f||(_=i.get(S),_&&E.push(_))}if(E.length&&p.Dispatcher.dispatch({type:c.SharedWithActionType.REMOVE_SHARED_LINK_DATA,data:{parentPath:t,files:E}}),n)return s(n)}})}};s(o)}},e._currentSFDataRequest=null,e})();t.SharedWithActions=O;var L=n({displayName:"SharedWithController",mixins:[u(D,T.sharingInfoStore,h.getBrowseStore())],propTypes:{browseContext:s.instanceOf(_.BrowseContext).isRequired,file:s.instanceOf(_.File),isInAudienceBox:s.bool,inSelectMode:s.bool,actionHandlers:s.object},_get_state_from_stores:function(e){var t=h.getBrowseStore().user().id,o=D.getDataForFile(e.file),a=T.sharingInfoStore.getSharingInfo(t,e.file&&e.file.fq_path),r=h.getBrowseStore().loadingState()===m.LoadingState.LOADING_FIRST_PAGE;return{audienceDescription:null!=o&&o.audienceDescription,numUndisplayableUsersAndInvites:null!=o?o.numUndisplayableUsersAndInvites:0,groups:null!=o?o.groups:[],hasSharedDataLoaded:null!=o&&o.hasSharedDataLoaded&&!r,invitations:null!=o?o.invitations:[],joinedMembers:null!=o?o.joinedMembers:[],memberCount:null!=o?o.memberCount:0,sharedLinkInfo:null!=o?o.sharedLinkInfo:null,linkMetadata:null!=a&&a.linkMetadata()||null}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},handleMembershipClick:function(){var e=h.getBrowseStore().user();if(!this.props.file&&h.getBrowseStore().context().isCurrentlyInRoot)return void U.open_tab("/team#members");if((!this.props.file||!_.File.isTeamMemberFolder(this.props.file))&&(!this.props.file||_.File.canViewFileMembers(this.props.file,h.getBrowseStore().context()))){var t=this.props.file||h.getBrowseStore().context();return S.showShareModal(e,t,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"},I.browseNavActions.setPath,I.browseNavActions.setUrl)}},handleSharedLinkClick:function(){var e=h.getBrowseStore().user();return S.showShareModal(e,this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"},I.browseNavActions.setPath,I.browseNavActions.setUrl)},render:function(){var e=h.getBrowseStore().context(),t=h.getBrowseStore().user();if(e.isCurrentlyInRoot&&null==this.props.file&&!t.is_cdm_member)return null;var o=this.props.file?_.File.canViewFileMembers(this.props.file,e):e.canViewContainingNSMembers,a=t.is_cdm_member&&"/"===e.currentFQPath&&e.currentNSID===e.rootNSID;return r.createElement(v.SharedWithView,{user:t,file:this.props.file,onOverflowCountClick:this.handleMembershipClick,onAvatarClick:this.handleMembershipClick,groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,memberCount:this.state.memberCount,parentFolderName:e.getNameOfTargetFolder(),animation:!1,avatarDimension:l.AVATAR_DIMENSION_BY_SIZE.MEDIUM,maxVisibleAvatars:5,sharedLinkInfo:this.state.sharedLinkInfo,onSharedLinkClick:this.handleSharedLinkClick,publicFolderSharing:this.props.file&&y.shouldUsePublicFolderSharing(this.props.browseContext||{},this.props.file.fq_path),isCdmRoot:a,inSelectMode:this.props.inSelectMode,isInAudienceBox:this.props.isInAudienceBox,audienceDescription:this.state.audienceDescription,hasSharedDataLoaded:this.state.hasSharedDataLoaded,canViewMembers:o&&!e.isInsideDeletedFolder,inContentManagerCdmRoot:!1,linkMetadata:this.state.linkMetadata})}});t.SharedWithController=L}),define("modules/clean/react/browse/shared_with_view",["require","exports","external/classnames","external/create-react-class","external/react","external/react-dom-factories","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/user_education/react/user_education_effect","modules/constants/sharing","modules/core/i18n"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=r.createElement,g=n.AVATAR_DIMENSION_BY_SIZE.SMALL,y=f._("No access"),S=f._("Limited access"),v=a({displayName:"SharedWithView",mixins:[c.MemberAvatarsMixin],getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:g,maxVisibleAvatars:5,file:void 0,canViewMembers:!0,inContentManagerCdmRoot:!1,inSelectMode:!1,memberCount:0,isCdmRoot:!1,joinedMembers:[]}},render:function(){if(this.props.inContentManagerCdmRoot){if(0===this.props.groups.length)return s.div({});var e=this.props.groups[0].num_users;return s.div({className:"audience-description",onClick:function(e){return e.preventDefault(),e.stopPropagation()}},f.ungettext("%(num)s member","%(num)s members",e).format({num:e}))}return this.props.isInAudienceBox?this.props.canViewMembers?this.props.file&&this.props.file.isDeleted?null:s.div({className:this.getClassName()},this.props.hasSharedDataLoaded?E(_.UserEducationEffect,{containerName:this.constructor.displayName,name:"AudienceBoxAvatars"},this.renderAudienceBoxAvatars()):E(i.LoadingIndicator,{style:i.LoadingIndicator.LoadingIndicatorStyle.DOTS})):null:s.div({className:this.getClassName()},this._hasSharedLink()?this.renderSharedLinkInColumn():void 0,this.renderAudienceDescription())},getClassName:function(){return o({"shared-with-members":!0,clearfix:!0,"audience-box u-pad-top-xs u-pad-bottom-s u-mar-bottom-xs":this.props.isInAudienceBox})},renderSharedLinkInColumn:function(){var e=this.props.onSharedLinkClick,t=this.props.inSelectMode;return E(l,{key:"shared_link",text:this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo,this.props.linkMetadata),direction:this.props.titleButtonDirection,className:"audience-description__link-avatar"},s.img({src:m.static_url("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||f._("Shared link"),width:12,height:12,onClick:function(o){if(!t)return e(),o.preventDefault(),o.stopPropagation()}}))},renderAudienceDescription:function(){var e,t;if(!this.props.hasSharedDataLoaded)return null;if(this.props.file&&this.props.file.isDeleted)e=f._("Deleted");else if(this.props.canViewMembers)this.props.audienceDescription&&(e=this.props.audienceDescription);else{var o=this.props.file._mount_access_perms,a=o&&o.includes("can_view");e=a?S:y}var r=(this.props.groups||[]).concat(this.props.joinedMembers||[]).concat(this.props.invitations||[]),n=r.length+(this.props.numUndisplayableUsersAndInvites||0),i=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers||[])[0];if(n>=0&&(1!==n||!i)){e||(e=f.ungettext("%(num)s member","%(num)s members",this.props.memberCount).format({num:this.props.memberCount}));var p=r.slice(0,this.props.maxVisibleAvatars),c=p.map(function(e){return d.Emstring.em_snippet(e.display_name||e.email||e.name||e.email_or_fbname,u.SNIPPET_SIZES.DISPLAY_NAME)});if(n>this.props.maxVisibleAvatars){c.pop();var m=n-(this.props.maxVisibleAvatars-1),_=f.ungettext("and %(num)s more...","and %(num)s more...",m,{comment:"Number of additional members in the file. Expected to be >= 2."}).format({num:m});c.push(_)}t=c.join("\n")}this.props.publicFolderSharing&&this.props.file&&!this.props.file.is_dir?e||(e=f._("Anyone")):e||(e=f._("Only you"));var h=this.props.onAvatarClick,g=this.props.inSelectMode,v=null!=this.props.file?this.props.file.isDeleted:void 0,T=s.div({className:"audience-description",onClick:function(e){if(!g&&!v)return h(),e.preventDefault(),e.stopPropagation()}},e);return t?E(l,{key:"membership_column_bubble",respectLineBreaks:!0,text:t,direction:this.props.titleButtonDirection},T):T},renderAudienceBoxAvatars:function(){var e=[],t=this.props.joinedMembers?this.props.joinedMembers:[],o=this.props.groups?this.props.groups.slice():[],a=this.props.invitations?this.props.invitations.slice():[];this._addSharedLinkIfExists(e);var r=[],n=this.findOwnerAndMeInJoinedMembers(t),i=n[1];if(i&&(r.push(i.user_id),e.push(c.renderJoinedMember({arePairedUsersInSF:this.state.paired_users_in_sf,member:i,avatarArgs:{avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onAvatarClick,titleButtonDirection:this.props.titleButtonDirection}}))),this.addGroupsMembersInvitations(e,o,t,a,r),1===e.length&&i){if(this.props.user.is_team_admin&&this.props.isCdmRoot){for(var l=1;l<=this.props.maxVisibleAvatars-1;l++)e.push(c.renderPlaceholderAvatar({index:l,description:f._("Invite"),avatarArgs:{onAvatarClick:this.props.onAvatarClick,avatarDimension:this.props.avatarDimension,titleButtonDirection:this.props.titleButtonDirection}}));return this.renderAvatarList(e)}return s.div({className:"audience-box--text-only"},f._("Only you have access"))}return this.renderAvatarList(e)},_addSharedLinkIfExists:function(e){return this._hasSharedLink()?h.TRUELINK.TRUELINK_UI[this.props.user.id]?e.push(this.renderSharedLink(null,this.props.linkMetadata)):e.push(this.renderSharedLink(this.props.sharedLinkInfo)):null},_hasSharedLink:function(){return h.TRUELINK.TRUELINK_UI[this.props.user.id]?this.props.linkMetadata&&this.props.linkMetadata.current_audience!==p.LinkAudience.members:Boolean(this.props.sharedLinkInfo)}});t.SharedWithView=v}),define("modules/clean/react/file_modal_controller",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/react/file_modals","modules/clean/react/modal","modules/clean/sharing/browse_exports"],function(e,t,o,a,r,s,n,i){"use strict";function l(e,t,o,r){var i=a.createElement(s.RestoreFilesModal,{files:t,userId:e.id,context:o,onRestore:r});n.Modal.showInstance(i)}function d(e,t,o){var r=a.createElement(s.PermanentlyDeleteModal,{files:t,userId:e.id,onDelete:o});n.Modal.showInstance(r)}function p(e,t,o,r,i){var l=o.isInsideSharedFolder||o.isNonUserRelativeContext&&o.isCurrentlyInRoot,d=o.isNonUserRelativeContext,p=a.createElement(s.DeleteFileModal,{files:t,user:e,isNonUserRelativeContext:d,parentSharedFolderName:l?r:null,onDelete:i});n.Modal.showInstance(p)}function u(e,t,o){var r=a.createElement(s.ContentManagerBridgeModal,{files:e,type:t,isLimitedTeam:o});n.Modal.showInstance(r)}function c(e,t,o){var l=a.createElement(s.NoAccessFolderModal,{folderName:r.filename(t.fq_path),folderPath:t.fq_path,userIsSameTeam:!(!e.team_dbtid||!o.teamFolderOwnerTeamApiId||e.team_dbtid!==o.teamFolderOwnerTeamApiId),userIsSuperAdmin:i.GoldenGate.hasContentManagerAndSuperAdmin(e.id)});n.Modal.showInstance(l)}function m(e){var t=a.createElement(s.ConfirmOwnershipTransferModal,{onAccept:e});n.Modal.showInstance(t)}function _(e){n.Modal.showInstance(a.createElement(s.FileSystemWarningsModal,o.__assign({},e)))}Object.defineProperty(t,"__esModule",{value:!0}),t.showRestore=l,t.showPermanentlyDelete=d,t.showDelete=p,t.showContentManagerBridge=u,t.showNoAccess=c,t.showConfirmOwnershipTransferModal=m,t.showFileSystemWarningsModal=_}),define("modules/clean/react/file_modals",["require","exports","tslib","external/react","spectrum/button","spectrum/modal","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/icon/file_folder_icon","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/web_user_action_events","modules/core/browser","modules/core/i18n","modules/clean/viewer"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h,f,E,g,y,S){"use strict";function v(){var e=document.querySelector(".mc-util-modal-actions-buttons .mc-button-primary");e&&e.focus()}function T(t){var o=function(){return I(t)},a=t.userId,r=t.context,s=t.files;e(["modules/clean/react/trash/trash_modal_util"],function(e){(0,e.openTrashModalFromBrowseFiles)({userId:a,context:r,files:s,onRestore:o})})}function A(t){var o=t.userId,a=t.context,r=t.files,s=function(){return U(t)};e(["modules/clean/react/trash/trash_modal_util"],function(e){(0,e.openPurgeModalFromBrowseFiles)({userId:o,context:a,files:r,onPurge:s})})}Object.defineProperty(t,"__esModule",{value:!0});var b=(function(e){function t(t){var o=e.call(this,t)||this;return o.handleAccept=function(){p.logFileOperationModalClick({uid:o.props.userId,event_name:E.WebUserActionLogEvent.PERMANENT_DELETE_ACCEPT_CLICK}),o.props.onDelete()},o.handleCancel=function(){o.setState({isModalOpen:!1})},o.onModalReady=function(){v()},o.state={isModalOpen:!0},o}return o.__extends(t,e),t.prototype.isSingleSharedFolder=function(e){return 1===e.length&&e[0].type===d.FileTypes.SHARED_FOLDER},t.prototype.getTitle=function(e){var t=e.length;return this.isSingleSharedFolder(e)?y._("Remove access to folder?"):y.ungettext("Permanently delete %(num)s file?","Delete %(num)s items permanently?",t).format({num:t})},t.prototype.renderContent=function(e){var t=e.length;if(1===t){var o=l.filename(e[0].fq_path);return this.isSingleSharedFolder(e)?_.reactFormat(y._("Are you sure you want to remove your access to <strong>%(filename)s</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."),{strong:a.createElement("strong",null),filename:o}):_.reactFormat(y._("Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?"),{strong:a.createElement("strong",null),filename:o})}return a.createElement("span",null,y.ungettext("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},t.prototype.render=function(){var e=this.getTitle(this.props.files);return a.createElement(s.UtilityModal,{ariaLabel:e,title:e,primaryAction:this.isSingleSharedFolder(this.props.files)?y._("Remove my access"):y._("Delete permanently"),secondaryAction:y._("Cancel"),onPrimaryAction:this.handleAccept,open:this.state.isModalOpen,shouldRequestCloseOnActions:!0,overlayClickClose:!0,onRequestClose:this.handleCancel,displayCloseButton:!0,onReady:this.onModalReady},this.renderContent(this.props.files))},t})(a.Component);t.PermanentlyDeleteModal=b;var U=function(e){var t=e.files,o=e.context,a=e.userId,r=e.onPurge;t||(t=[{fq_path:o.currentFQPath,ns_path:o.currentNSPath,ns_id:o.currentNSID}]),r(a,t)},I=function(e){var t=e.files,o=e.context,a=e.userId,r=e.onRestore;t||(t=[{fq_path:o.currentFQPath,ns_path:o.currentNSPath,ns_id:o.currentNSID}]),r(a,t)},R=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleRestoreClick=function(e){e.preventDefault(),p.logFileOperationModalClick({uid:t.props.userId,event_name:E.WebUserActionLogEvent.RESTORE_ACCEPT_CLICK}),I({files:t.props.files,context:t.props.context,userId:t.props.userId,onRestore:t.props.onRestore}),t.refs.modal.close()},t.handleCancelClick=function(e){e.preventDefault(),t.refs.modal.close()},t}return o.__extends(t,e),t.prototype.getTitle=function(e,t){var o=e-1;return 0===o?y._("Restore %(name)s?").format({name:t}):y.ungettext("Restore %(name)s and %(num)s other item?","Restore %(name)s and %(num)s other items?",o).format({num:o,name:t})},t.prototype.renderSingleFileContent=function(e,t){var o=l.filename(e.fq_path);return[_.reactFormat(y._("The most recent version of <strong>%(filename)s</strong> will be restored."),{strong:a.createElement("strong",null),filename:o}),a.createElement("div",{className:"file-modal__single-file-row"},a.createElement(u.FileOrFolderIcon,{file:e,className:"brws-file-name-cell-icon file-modal__single-file-row-icon"}),t?a.createElement("a",{href:t,className:"file-modal__single-file-row-link"},o):o)]},t.prototype.renderSingleFolderContent=function(e){var t=l.filename(e.fq_path);return[_.reactFormat(y._("Restoring this folder will bring back any files and folders in it. If you’d like specific people to have access, add them once you’ve restored the folder.")),a.createElement("div",{className:"file-modal__single-file-row"},a.createElement(u.FileOrFolderIcon,{file:e,className:"brws-file-name-cell-icon file-modal__single-file-row-icon"}),t)]},t.prototype.renderMultiFileContent=function(e){return a.createElement("span",null,this.props.context.isNonUserRelativeContext?_.reactFormat(y._("Restoring these items will bring back any files and folders inside them. If you’d like specific people to have access, add them once you’ve restored the items.")):y.ungettext("Are you sure you want to restore %(num)s item?","Are you sure you want to restore %(num)s items?",e.length).format({num:e.length}))},t.prototype.renderButtons=function(e){return a.createElement("div",{className:"file-modal__buttons"},e?a.createElement("div",{className:"file-modal__buttons__alt",ref:"revisionButton"},a.createElement("a",{href:e},y._("View other versions"))):void 0,a.createElement("div",{className:"file-modal__buttons__main"},a.createElement("button",{className:"button-primary db-modal-button",onClick:this.handleRestoreClick,ref:"primaryButton"},y._("Restore")),a.createElement("button",{className:"button-tertiary db-modal-button",onClick:this.handleCancelClick,ref:"tertiaryButton"},y._("Cancel"))))},t.prototype.render=function(){var e,t=this.props.files.length,o=null;return 1!==t||this.props.context.isNonUserRelativeContext||(o=n.getFileHistoryUrl({fqPath:this.props.files[0].fq_path,userId:this.props.userId})),e=1===t?this.props.files[0].is_dir?this.renderSingleFolderContent(this.props.files[0]):this.renderSingleFileContent(this.props.files[0],o):this.renderMultiFileContent(this.props.files),a.createElement(m.Modal,{ref:"modal",title:this.getTitle(t,l.filename(this.props.files[0].fq_path)),buttonComponent:this.renderButtons(o)},e)},t})(a.Component)
;t.RestoreFilesModal=c(R,["/static/css/react/file_modal-vflYXf2D3.css"]),t.showUnifiedTrashModal=T,t.showPurgeModal=A;var D=(function(e){function t(t){var o=e.call(this,t)||this;return o.getViewerTeamNameStr=function(){var e=S.Viewer.get_viewer().team_name;return e?"‘"+e+"’ ":""},o.handleAccept=function(){p.logFileOperationModalClick({uid:o.props.user.id,event_name:E.WebUserActionLogEvent.DELETE_ACCEPT_CLICK}),o.props.onDelete()},o.handleCancel=function(){o.setState({isModalOpen:!1})},o.onModalReady=function(){v()},o.isRemovingSharedFolder=function(){return 1===o.props.files.length&&o.props.files[0].target_ns},o.getTitle=function(){var e=o.props.files;return e.length<1?"":1===e.length?e[0].is_dir?y._("Delete folder?"):y._("Delete file?"):y.ungettext("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},o.isTsdPlusOne=function(){var e=o.props,t=e.user,a=e.files;return!(!t||!a||0===a.length)&&(t.is_cdm_member&&a[0].ns_id===t.root_ns_id&&2===a[0].ns_path.split("/").length)},o.getContents=function(){var e=o.props,t=e.user,r=e.files;if(!t||!r||0===r.length)return"";var s=t.is_cdm_member,n=l.filename(r[0].fq_path),i=r[0].target_ns,d=o.props,p=d.parentSharedFolderName,u=d.isNonUserRelativeContext,c=o.isTsdPlusOne(),m={filename:n,shared_folder_name:p,b:a.createElement("b",{className:"file-modal-file-name"}),item_count:r.length,team_name:o.getViewerTeamNameStr()},h="";return h=null!=o.props.parentSharedFolderName?1===r.length?c?y._("Are you sure you want to delete <b>%(filename)s</b> from your %(team_name)sworkspace?"):y._("Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"):c?y._("Are you sure you want to delete %(item_count)s items from your %(team_name)sworkspace?"):y._("Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?"):1===r.length&&i&&!u?s?y._("Are you sure you want to remove the shared folder <b>%(filename)s</b> from your team member folder? This shared folder will stay shared with other members and you can re-add it later."):y._("Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."):1===r.length?s?y._("Are you sure you want to delete <b>%(filename)s</b> from your team member folder?"):y._("Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"):s?y._("Are you sure you want to delete %(item_count)s items from your team member folder?"):y._("Are you sure you want to delete %(item_count)s items from your Dropbox?"),_.reactFormat(h,m)},o.state={isModalOpen:!0},o}return o.__extends(t,e),t.prototype.render=function(){var e=this.getTitle();return a.createElement(s.UtilityModal,{ref:"modal",title:e,ariaLabel:e,primaryAction:this.isRemovingSharedFolder()&&!this.props.isNonUserRelativeContext?y._("Remove"):y._("Delete"),secondaryAction:y._("Cancel"),onPrimaryAction:this.handleAccept,shouldRequestCloseOnActions:!0,displayCloseButton:!0,overlayClickClose:!0,onRequestClose:this.handleCancel,open:this.state.isModalOpen,onReady:this.onModalReady},this.getContents())},t.defaultProps={parentSharedFolderName:null,isNonUserRelativeContext:!1},t})(a.Component);t.DeleteFileModalWithoutCss=D;var O=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAccept=function(){var e=t.props.files[0].fq_path;h.asyncGoToContentManagerForPath({isLimitedTeam:t.props.isLimitedTeam,containingFolder:l.parent_dir(e),filenameToSelect:l.filename(e),isCDM:!1})},t}return o.__extends(t,e),t.prototype.getModalMessage=function(){return"archive"===this.props.type?y._("You can archive team folders in the Admin Console."):"rename"===this.props.type?y._("You can rename team folders in the Admin Console."):void 0},t.prototype.render=function(){return a.createElement(m.Modal,{ref:"modal",style:"clean",onAccept:this.handleAccept,acceptButtonText:y._("Go to Admin Console"),altAction:a.createElement("a",{onClick:function(){return m.Modal.close()}},y._("Cancel")),width:350,showX:!1,className:"content-manager-bridge-modal"},this.getModalMessage())},t})(a.Component);t.ContentManagerBridgeModal=O;var L=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptClick=function(){t.props.userIsSuperAdmin&&t.props.userIsSameTeam&&h.asyncGoToContentManagerForPath({isLimitedTeam:!1,containingFolder:t.props.folderPath,isCDM:!0})},t}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.userIsSuperAdmin&&this.props.userIsSameTeam,t="";return t=e?y._("You aren’t a member of this folder. However, as an admin, you can access it via the content tab in the Admin Console."):this.props.userIsSameTeam?y._("You don’t have permission to open the folder “%(folder_name)s”. Contact your <admin_link>team admins</admin_link> to gain access."):y._("You don’t have permission to open the folder “%(folder_name)s”."),a.createElement(m.Modal,{ref:"modal",style:"default",acceptButtonText:e?y._("Go to the content tab"):y._("Done"),dismissButtonText:e?y._("Cancel"):null,onAccept:this.handleAcceptClick,title:y._("No access to the folder “%(folder_name)s”").format({folder_name:i.Emstring.em_snippet(this.props.folderName,f.SNIPPET_SIZES.FILENAME)})},a.createElement("div",null,_.reactFormat(t,{folder_name:i.Emstring.em_snippet(this.props.folderName,f.SNIPPET_SIZES.FILENAME),admin_link:a.createElement("a",{href:"/team?_tk=left_nav_team#members",target:"_blank",key:"admin_link",rel:"noopener noreferrer"})})))},t})(a.Component);t.NoAccessFolderModal=L;var C=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptAndCloseModal=function(){t.props.onAccept(),m.Modal.close()},t}return o.__extends(t,e),t.prototype.render=function(){var e=y._("If you make this move, you'll no longer be the owner of some of the folders.");return a.createElement(m.Modal,{ref:"modal",style:"default",onAccept:this.handleAcceptAndCloseModal,acceptButtonText:y._("Move items anyways"),dismissButtonText:y._("Cancel"),title:y._("Move items?")},a.createElement("div",null,e))},t})(a.Component);t.ConfirmOwnershipTransferModal=C;var F=(function(e){function t(t){var o=e.call(this,t)||this;return o.handleAccept=function(){o.state.fswIndex+1===o.props.fsws.length?(o.getCurrentFSW().blocking?o.props.onAbortAction&&o.props.onAbortAction():o.props.onFinalAccept(),o.setState({isModalOpen:!1})):o.setState({fswIndex:o.state.fswIndex+1})},o.handleCancel=function(){o.props.onAbortAction&&o.props.onAbortAction(),o.setState({isModalOpen:!1})},o.redirectToLearnMoreLink=function(){g.open_tab(o.getCurrentFSW().learn_more)},o.cancelButtonCreator=function(e){return o.getCurrentFSW().blocking?a.createElement("span",null):a.createElement(r.Button,{onClick:e,variant:"secondary"},y._("Cancel"))},o.state={isModalOpen:!0,fswIndex:0},o}return o.__extends(t,e),t.prototype.getCurrentFSW=function(){return this.props.fsws[this.state.fswIndex]},t.prototype.render=function(){if(this.state.fswIndex>this.props.fsws.length)return null;var e=this.getCurrentFSW();return a.createElement(s.UtilityModal,{ariaLabel:e.title,className:"fsw-modal",link:y._("Learn more"),onLink:this.redirectToLearnMoreLink,onPrimaryAction:this.handleAccept,onSecondaryAction:this.handleCancel,open:this.state.isModalOpen,overlayClassName:"fsw-modal--overlay",primaryAction:e.blocking?y._("Okay"):this.props.confirmText,secondaryAction:this.cancelButtonCreator,title:e.title},e.text)},t})(a.Component);t.FileSystemWarningsModalWithoutCSS=F,t.FileSystemWarningsModal=c(F,["/static/css/react/file_modal-vflYXf2D3.css"]),t.DeleteFileModal=c(D,["/static/css/react/file_modal-vflYXf2D3.css"])}),define("modules/clean/react/file_uploader/actions",["require","exports","modules/core/cookies","modules/core/exception","modules/core/i18n","modules/clean/ajax","modules/clean/analytics","modules/clean/filepath","modules/clean/web_upload_action_events","modules/clean/flux/dispatcher","modules/clean/react/async_file_modal_controller","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploaderDispatcher=d.Dispatcher;var f=["1password","abbu","agilekeychain","aplibrary","app","band","cmproj","dvdproj","fcpbundle","gameproj","graffle","imovielibrary","imovieproject","itlp","key","logic","logicx","lpdf","lrdata","mindnode","mindnode","mpkg","numbers","pages","photolibrary","rcproject","rtfd","screenflow","scriv","sketch","theater","xcodeproj","xd","ydevice","bundle","framework","plugin","kext","pkg"],E=(function(){function e(){}return e.prototype.initPLU=function(e,t,o,E,g){var y=this;if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===E&&(E=!1),void 0===g&&(g=!1),!m.isInitialized){m.init(t);var S=e?function(e,t){y.setPath({path:e}),void 0!==t&&y.setFolderNsId({folderNsId:t})}:void 0,v=function(){y.setFolderNsId({folderNsId:null})};m.onFilesAdded({isContentManager:t,rootNSIDForCM:o,setPathAndFolderNsId:S,expWebNsidRouting:E,resetFolderNsId:v,expUploadWithFolderPicker:g,cb:function(t){var o=_.uploaderStore.user();e&&y.setIsUploadModalOpen({isUploadModalOpen:!1});for(var a=[],s=0,n=t;s<n.length;s++){var p=n[s];null==p.size&&a.push(p)}for(var m=0,h=a;m<h.length;m++){var E=h[m];d.Dispatcher.dispatch({type:c.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:E,errorType:c.UploadErrorType.EMPTY_OR_FOLDER,errorMessage:r._("This folder or empty file could not be uploaded                             because of browser limitations. Try zipping up                             the content before uploading it, or use the                             Dropbox desktop client to sync it.")}}),u.logUploadAction(o.id,l.WebUploadActionEvent.UPLOAD_FAILURE,E),y._broadcastUploadErrored(E)}t=t.filter(function(e){return null!=e.size});for(var g=function(e){return f.includes(i.file_extension(e.name))&&e.size%34===0},S=[],v=0,T=t;v<T.length;v++){var p=T[v];g(p)&&S.push(p)}for(var A=0,b=S;A<b.length;A++){var U=b[A];d.Dispatcher.dispatch({type:c.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:U,errorType:c.UploadErrorType.PACKAGE_FILE,errorMessage:r._("This file is a package file and can’t be                             uploaded directly. To upload a package file via                             the web, try zipping it first.")}}),u.logUploadAction(o.id,l.WebUploadActionEvent.UPLOAD_FAILURE,U),y._broadcastUploadErrored(U)}t=t.filter(function(e){return!g(e)}),a.length&&y.cancelUploads({files:a}),S.length&&y.cancelUploads({files:S}),d.Dispatcher.dispatch({type:c.UploaderActionType.QUEUE_UPLOADS,data:{files:t}}),y._startNextUploadIfAvailable()}}),m.onUploadProgress(function(e,t){if(!_.uploaderStore.isUploadCancelled(e.uploadId)){var o=e.percentUploaded;a.assert(null!=_.uploaderStore.currentUpload(),"UploaderStore.currentUpload() is null");var r=o*_.uploaderStore.currentUpload().size/100,s=h.calculateSizeOfUploads(_.uploaderStore.fileList(),[c.FileStatusType.COMPLETE]),n=r+s,i=h.calculateSizeOfUploads(_.uploaderStore.fileList(),[c.FileStatusType.COMPLETE,c.FileStatusType.PENDING,c.FileStatusType.UPLOADING]),l=m.bytesPerSec(),p=_.uploaderStore.fileList().count(function(e){return e.status===c.FileStatusType.PENDING||e.status===c.FileStatusType.UPLOADING});d.Dispatcher.dispatch({type:c.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:o,numSecondsLeft:t?(i-n)/l+p:void 0}})}}),m.onFileUploaded(function(e,o){if(!_.uploaderStore.isUploadCancelled(e.uploadId)){y.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1});var s=void 0,n=!1,i=!1,p=!1,f=void 0,E=void 0,g=_.uploaderStore.user();try{s=JSON.parse(o.response),i=!!s&&!!s.error,p=!!s&&"ignored"===s.error}catch(e){a.reportException({err:e,severity:a.SEVERITY.NONCRITICAL}),n=!0}if(f=p?c.UploadErrorType.IGNORED:c.UploadErrorType.GENERIC,E=p?r._("This file was skipped because it’s an internal system file."):void 0,n||i||p)m.removeFiles({files:[e]}),d.Dispatcher.dispatch({type:c.UploaderActionType.UPLOAD_ERROR,data:{uploadId:e.uploadId,errorType:f,errorMessage:E}}),y._broadcastUploadErrored(e),u.logUploadAction(g.id,l.WebUploadActionEvent.UPLOAD_FAILURE,e);else if(a.assert(!!s,"unable to parse file uploaded response"),a.assert(!!s&&"complete"===s.status,"response status is not complete"),t&&(a.assert(!!s&&s.total_size===e.size,"response total size does not equal file size"),a.assert(!!s&&s.upload_id===e.uploadId,"response body upload ID does not equal the file uploadId")),d.Dispatcher.dispatch({type:c.UploaderActionType.COMPLETE_UPLOAD,data:{uploadId:e.uploadId}}),y._broadcastUploadComplete(e),u.logUploadAction(g.id,l.WebUploadActionEvent.UPLOAD_FILE,e),!h.checkIfThereArePendingUploadsWithoutCurrent({fileList:_.uploaderStore.fileList(),uploadId:e.uploadId})){var S=_.uploaderStore.fileList().valueSeq().filter(function(e){return e.status===c.FileStatusType.COMPLETE}).toArray();y._broadcastAllUploadsComplete(S)}y._startNextUploadIfAvailable()}}),m.onError(function(e,t,o){_.uploaderStore.fileList().has(e.uploadId)?(d.Dispatcher.dispatch({type:c.UploaderActionType.UPLOAD_ERROR,data:{uploadId:e.uploadId,errorType:t,errorMessage:o}}),y._broadcastUploadErrored(e)):(d.Dispatcher.dispatch({type:c.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:e,errorType:t,errorMessage:o}}),y._broadcastUploadErrored(e)),y._startNextUploadIfAvailable()}),m.onBeforeUpload(function(e,t){var o=r._("Something went wrong while uploading this file. There was a       server error during the upload request.");if(_.uploaderStore.confirmedFSWBatchIds().filter(function(t){return e.batchId===t}).length)return void t();var a={path:e.dest,to_path:e.name,fsw_request:"check",_subject_uid:e.userId};return y.ajaxInterceptor&&(a=y.ajaxInterceptor.interceptUploadPrecheck(a)),s.SilentBackgroundRequest({url:"/cmd/upload_precheck",data:a,success:function(a){var s,i=!1;try{s=JSON.parse(a),i=!(!s||!s.failure_details)}catch(t){return void y.manuallySetInErrorState({file:e,errorType:c.UploadErrorType.UPLOAD_PRECHECK_ERROR,errorMessage:o})}if(i){var l=s.failure_details.filter(function(e){return!_.uploaderStore.confirmedFSWs().includes(e.id)});if(0===l.length)return void t();n.WebMiscActivityLogger.log("file-upload-fsw-returned",{file_name:e.name,all_fsw_ids:s.failure_details.map(function(e){return e.id}).join(","),filtered_fsw_ids:l.map(function(e){return e.id}).join(",")},e.userId);var u=function(){var e=_.uploaderStore.fileList().valueSeq().toArray().filter(function(e){return e.status===c.FileStatusType.PENDING||e.status===c.FileStatusType.UPLOADING});y.cancelUploads({files:e}),y.setIsUploadModalOpen({isUploadModalOpen:!1})},m=function(){y.setIsUploadModalOpen({isUploadModalOpen:!1}),t(),d.Dispatcher.dispatch({type:c.UploaderActionType.CONFIRM_FSW,data:{fswIds:l.map(function(e){return e.id}),batchId:e.batchId}})};p.showFileSystemWarningsModal({confirmText:r._("Upload"),fsws:l,onFinalAccept:m,onAbortAction:u})}else d.Dispatcher.dispatch({type:c.UploaderActionType.CONFIRM_FSW,data:{fswIds:[],batchId:e.batchId}}),t()},error:function(){this.manuallySetInErrorState({file:e,errorType:c.UploadErrorType.UPLOAD_PRECHECK_ERROR,errorMessage:o})}})})}},e.prototype.setPath=function(e){var t=e.path,o=e.hasPermissionToUploadToFolder,a=void 0===o||o;t===_.uploaderStore.path()&&a===_.uploaderStore.hasPermissionToUploadToFolder()||d.Dispatcher.dispatch({type:c.UploaderActionType.SET_PATH,data:{path:t,hasPermissionToUploadToFolder:a}})},e.prototype.setFolderNsId=function(e){var t=e.folderNsId;d.Dispatcher.dispatch({type:c.UploaderActionType.SET_FOLDER_NS_ID,data:{folderNsId:t}})},e.prototype.setUser=function(e){var t=e.user;d.Dispatcher.dispatch({type:c.UploaderActionType.SET_USER,data:{user:t}})},e.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,o=e.isInternalTransfer,a=void 0!==o&&o;d.Dispatcher.dispatch({type:c.UploaderActionType.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:t,isInternalTransfer:a}})},e.prototype.addFilesToPLU=function(e){var t=e.files,o=e.path,a=e.dropTarget;m.addFiles({files:t,path:o}),this._broadcastUploadBegin(t,a),this.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1})},e.prototype.addDirectoriesToPLU=function(e){for(var t=this,o=e.directoryEntries,a=e.dropTarget,s=e.batchId,n=[],p=0,m=function(){var e=function(){if(n.length>0){var o=n.pop();if(o){var r=o.entry,i=o.dest;if(r&&r.file)return r.file(function(o){var r=o;r.batchId=s,t.addFilesToPLU({files:[r],path:i,dropTarget:a}),e()})}}};e()},h=function(e){if(p+=1,e&&e.createReader){var t=e.createReader(),o=function(){return t.readEntries(function(t){if(t.length>0){for(var a=0,r=t;a<r.length;a++){var s=r[a];s.isDirectory?h(s):n.push({entry:s,dest:e.fullPath||""})}o()}else p-=1,0===p&&m()})};o()}},E=0,g=o;E<g.length;E++){var y=g[E];if(f.includes(i.file_extension(y.name))){var S=new c.FileUpload({name:y.name,dest:y.fullPath});d.Dispatcher.dispatch({type:c.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:S,errorType:c.UploadErrorType.PACKAGE_FILE,errorMessage:r._("Due to browser limitations, OSX package files                              files cannot be uploaded using drag-and-drop.                              Please try using the “Upload…“ dialog.")}}),u.logUploadAction(_.uploaderStore.user().id,l.WebUploadActionEvent.UPLOAD_FAILURE,S),this._broadcastUploadErrored(S)}else h(y)}},e.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;d.Dispatcher.dispatch({type:c.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},e.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;d.Dispatcher.dispatch({type:c.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED,data:{inlineStatusShouldBeDismissed:t}})},e.prototype.setAjaxInterceptor=function(e){this.ajaxInterceptor=e,m.setAjaxInterceptor(e)},e.prototype.setIsContentManager=function(e){void 0===e&&(e=!1),this.isContentManager=e},e.prototype.cancelUploads=function(e){var t=this,o=e.files;m.removeFiles({files:o}),d.Dispatcher.dispatch({type:c.UploaderActionType.CANCEL_UPLOADS,data:{files:o}}),this._startNextUploadIfAvailable(),o.forEach(function(e){return t._broadcastUploadCancelled(e)})},e.prototype.manuallySetInErrorState=function(e){var t=e.file,o=e.errorType,a=e.errorMessage;m.removeFiles({files:[t]}),d.Dispatcher.dispatch({type:c.UploaderActionType.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:o,errorMessage:a}}),u.logUploadAction(_.uploaderStore.user().id,l.WebUploadActionEvent.UPLOAD_FAILURE,t),this.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1}),this._startNextUploadIfAvailable(),this._broadcastUploadErrored(t)},e.prototype._startUpload=function(e){var t,a,r=e.file;return d.Dispatcher.dispatch({type:c.UploaderActionType.START_UPLOAD,data:{file:r}}),t=["url","webloc","website"].includes(i.file_extension(r.name))?0:1,a=this.isContentManager?{dest:r.dest,reported_total_size:r.size,upload_id:r.uploadId,_subject_uid:r.userId,offset:0,ns_id_for_routing:r.ns_id,overwrite:t,t:o.Cookies.read("__Host-js_csrf")}:{_subject_uid:r.userId,t:o.Cookies.read("__Host-js_csrf"),dest:r.dest,overwrite:t,reported_total_size:r.size,ns_id_for_routing:r.ns_id},m.setAjaxParams(r,a),m.start(),!0},e.prototype._startNextUploadIfAvailable=function(){var e=_.uploaderStore.nextUpload();null!=e&&null==_.uploaderStore.currentUpload()&&(a.assert(e instanceof c.FileUpload,"the nextUpload is not of type FileUpload"),this._startUpload({file:e}))},e.prototype._doBroadcast=function(e,t){if("function"==typeof CustomEvent)window.dispatchEvent(new CustomEvent(e,t));else{var o=document.createEvent("CustomEvent");o.initCustomEvent(e,!0,!0,t?t.detail:void 0),document.dispatchEvent(o)}},e.prototype._broadcastUploadBegin=function(e,t){if(e.length){var o={detail:{files:e.map(function(e){return{name:e.name,path:_.uploaderStore.path()}}),target:t}};this._doBroadcast(c.UPLOAD_BEGIN_EVENT,o)}},e.prototype._broadcastUploadCancelled=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(c.UPLOAD_CANCEL_EVENT,t)},e.prototype._broadcastUploadErrored=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(c.UPLOAD_ERROR_EVENT,t)},e.prototype._broadcastUploadComplete=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(c.UPLOAD_COMPLETE_EVENT,t)},e.prototype._broadcastAllUploadsComplete=function(e){if(e.length){var t={detail:{files:e.map(function(e){return{path:e.dest,name:e.name}})}};this._doBroadcast(c.ALL_UPLOADS_COMPLETE_EVENT,t)}},e})();t.UploaderActions=new E}),define("modules/clean/react/file_uploader/file_uploader_modal",["require","exports","tslib","external/classnames","external/react","external/react-dom","jquery","modules/core/browser","modules/clean/browse_interface","modules/clean/css","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/analytics","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/utils","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/nearquota_upload_alt_action","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/uploader_modal","modules/clean/react/flag","modules/clean/react/icon/icon_helper","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/react_format","modules/clean/static_urls","modules/clean/viewer","modules/constants/payments","modules/constants/trademark","modules/core/exception","modules/core/i18n","modules/core/uri"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h,f,E,g,y,S,v,T,A,b,U,I,R,D,O,L,C,F,w,M,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var k=function(e){var t,o=e.user,a=e.path,r=e.maxLength,s=void 0===r?1e3:r,n=L.Viewer.get_viewer();n.is_paired&&o.is_team&&(t=n.team_name);var i;if("/"===a)i=n.is_paired?o.is_team?M._("upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:t}):M._("upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):M._("upload to your Dropbox");else{var l=c.Emstring.em_snippet(m.filename(a),s);i=n.is_paired?o.is_team?M._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:l,team_name:t}):M._("upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:l}):M._("upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:l})}return i},x=(function(e){function t(o){var i=e.call(this,o)||this;return i._onUploaderStoreChanged=function(){i.setState(i._get_state_from_store())},i._focusChooseButton=function(){n(s.findDOMNode(i.refs.pluFileChooseButton)).focus()},i._handleFileChoose=function(){y.showFilePicker()},i._handleClose=function(){i.state.fileList.find(function(e){return e.status===E.FileStatusType.PENDING||e.status===E.FileStatusType.UPLOADING})||h.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0}),h.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),U.Modal.close(),i.props.onModalDismissed&&i.props.onModalDismissed(),_.NQOQLogger.logCancelModal("wb_oq_upm",{modal_type:"utility"})},i._handleCancel=function(e){h.UploaderActions.cancelUploads({files:[e]})},i._handleOnDismiss=function(e){h.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),_.NQOQLogger.logCloseModal("wb_oq_upm",{modal_type:"utility"})},i._limitedTeamOverquotaLink=function(e){var t,o=i.state.user;return o.is_cdm_member&&!o.is_team_admin&&i.props.numTeamAdmins>0?i.props.promptAdminToUpgradeEmailTemplateUrl:(t=1===i.props.numTeamMembers?"/plans":"/team/upgrade",new N.URI({path:t,query:{_tk:"over_quota",_camp:"upload_modal",oqa:e?"upl":"upl_b"}}).toString())},i.trackCTAClick=function(){var e=i.getButtonProps().tracking_upgrade_CTA;_.NQOQLogger.logAcceptModal("wb_oq_upm_"+i.OQALocationCode,{modal_type:"utility",cta_text:e})},i._renderIntroModalButtons=function(){var e=i.getButtonProps().upgrade_CTA,t=r.createElement("div",{className:"u-font-medium"},i.props.overQuotaStatus===E.OverQuotaStatusType.BASIC_OVER_QUOTA?D.reactFormat(M._("Before you can upload files, you need to <a>get more space</a>."),{a:r.createElement("a",{"aria-label":M._("Get more space"),className:"overquota-uploader-link",href:"/out-of-space?oqa=wb_oq_upm_"+i.OQALocationCode,onClick:i.trackCTAClick})}):i.state.user.is_cdm_member&&[E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,E.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(i.props.overQuotaStatus)?"":i.props.overQuotaStatus===E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA?D.reactFormat(M._("Before you can upload files, you need to <a>get more space</a>."),{a:r.createElement("a",{"aria-label":M._("Get more space"),className:"overquota-uploader-link",href:i._limitedTeamOverquotaLink(!0)})}):M._("Having problems? Please try again.")),o=null,a=null;if(i.props.overQuotaStatus===E.OverQuotaStatusType.BASIC_OVER_QUOTA){var s=C.OUT_OF_SPACE_URL+"?oqa=wb_oq_upm_"+i.OQALocationCode;o=r.createElement("a",{className:"dbmodal-button c-btn c-btn--primary",href:s,onClick:i.trackCTAClick},e)}else o=[E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,E.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(i.props.overQuotaStatus)?r.createElement("a",{className:"dbmodal-button c-btn c-btn--primary",href:i._limitedTeamOverquotaLink(!1)},e):r.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary",onClick:i._handleFileChoose},M._("Choose files"));if(a=r.createElement("button",{className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:i._handleClose},M._("Cancel")),i.props.overQuotaStatus===E.OverQuotaStatusType.BASIC_OVER_QUOTA||i.props.overQuotaStatus===E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA&&!i.state.user.is_cdm_member){return r.createElement("div",{className:"u-mar-vertical-l clearfix"},r.createElement("div",{className:"u-l-fr"},o,a),r.createElement("div",{className:"upload-overquota-banner__container"},r.createElement("div",{id:"upload-overquota-banner",className:"c-banner c-banner--warning upload-overquota-banner__content"},t)))}return r.createElement("div",{className:"u-mar-top-l"},r.createElement(T.Flag,{spacing:"s",rightAttachment:r.createElement("div",null,o,a)},t))},i._renderFileListModalButtons=function(){var e=i.state.fileList.find(function(e){return e.status===E.FileStatusType.PENDING||e.status===E.FileStatusType.UPLOADING}),t=e?"tertiary":"primary",o=r.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary",onClick:i._handleFileChoose},M._("Add more files")),a=r.createElement("button",{className:"dbmodal-button c-btn c-btn--"+t,onClick:i._handleClose},e?M._("Hide"):M._("Done"));return r.createElement("div",{className:"u-mar-top-s"},r.createElement(T.Flag,{spacing:"s",leftAttachment:o,rightAttachment:a},r.createElement("div",{className:"u-font-small"},!e&&M._("Having problems? Please try again."))))},i._renderIntroMessage=function(){var e=k({user:i.state.user,path:i.state.path}),t=L.Viewer.get_viewer().team_name;if(i.state.user.is_cdm_member&&[E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,E.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(i.props.overQuotaStatus)){var o=void 0;return o=i.props.overQuotaStatus===E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA?M._("Your member folder is full, so no new files can be added"):M._("The %(team_name)s shared workspace is full, so no new files can be added").format({team_name:t}),i.state.user.is_team_admin||!i.props.numTeamAdmins?D.reactFormat(M.ungettext("%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade your account </upgradeLink>.","%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade to %(trademark_business)s</upgradeLink>.",i.props.numTeamMembers),{dropbox_full_message:o,trademark_business:F.TRADEMARK_BUSINESS,upgradeLink:r.createElement("a",{href:i._limitedTeamOverquotaLink(!1)})}):M.ungettext("%(dropbox_full_message)s. To get more space, ask your Dropbox admin (%(admin_email)s).","%(dropbox_full_message)s. To get more space, ask your Dropbox admins (%(admin_email)s and %(num_other_admins)s others).",i.props.numTeamAdmins).format({dropbox_full_message:o,admin_email:i.props.teamAdminEmail,num_other_admins:i.props.numTeamAdmins-1})}return[E.OverQuotaStatusType.BASIC_OVER_QUOTA,E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA].includes(i.props.overQuotaStatus)?M._("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):i.props.isTeamOnboarding?M._("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:t}):i.props.dragAndDropEnabled?M._("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:e}):M._("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:e})},i._renderDropzone=function(){return r.createElement("div",{ref:"dropzone",id:t.DROPZONE_ID,style:{display:"none"}},r.createElement("div",null,M.ungettext("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",i.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:k({user:i.state.user,path:i.state.path,maxLength:20})})))},i._renderFileListRowStatus=function(e){var t=function(t){return t.preventDefault(),i._handleCancel(e)};return e.status===E.FileStatusType.UPLOADING&&100===e.percentUploaded?r.createElement(b.Image,{src:O.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:O.static_url("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):e.status===E.FileStatusType.PENDING||e.status===E.FileStatusType.UPLOADING?r.createElement("button",{className:"button-as-link",onClick:t},r.createElement(I.Sprite,{group:"web",name:"xclose",alt:M._("Cancel")})):e.status===E.FileStatusType.COMPLETE?r.createElement(I.Sprite,{group:"web",name:"s_check",alt:M._("Upload successful")}):e.status===E.FileStatusType.CANCELLED?r.createElement(b.Image,{src:O.static_url("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:O.static_url("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:M._("Upload cancelled")}):e.status===E.FileStatusType.FAILED?r.createElement(b.Image,{src:O.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:O.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:M._("Error")}):void 0},i._renderFileListRowError=function(e){var t=e.errorMessage||M._("Something went wrong while uploading this file.");return r.createElement("div",{className:"error-col"},r.createElement("span",{className:"error-msg"},e.errorType===E.UploadErrorType.FILE_SIZE_ERROR?M._("File too large"):M._("Upload Error"),r.createElement("span",{className:"error-details"},r.createElement(R.Tooltip,{position:R.TooltipPosition.RIGHT,tooltip_contents:r.createElement("div",null,t),tooltip_classname:"upload-error-tooltip"},r.createElement(I.Sprite,{group:"web",name:"information",alt:M._("More information")})))))},
i._renderFileListRowDest=function(e){if(e.status===E.FileStatusType.CANCELLED)return M._("Canceled");var o=void 0,a=L.Viewer.get_viewer().get_user_by_id(e.userId);return o=i.props.isContentManager?"":l.get_browse_root_name(a),r.createElement("a",{href:l.browse_uri_for_fq_path(a,e.dest).toString()},c.Emstring.em_snippet(""+o+e.dest,t.DEST_SNIPPET_LENGTH,0))},i._renderFileListRow=function(e,o){var s=e.status===E.FileStatusType.UPLOADING?e.percentUploaded:e.status===E.FileStatusType.PENDING?0:100,n={"upload-file":!0,complete:e.status===E.FileStatusType.COMPLETE,cancelled:e.status===E.FileStatusType.CANCELLED,error:e.status===E.FileStatusType.FAILED};return r.createElement("li",{className:a(n),key:e.uploadId,style:{backgroundSize:s+"% 100%"}},r.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},r.createElement("div",{className:"filename-col"},r.createElement(I.Sprite,{group:"web",name:A.file_icon(e.name),alt:""}),r.createElement("span",{className:"filename"},c.Emstring.em_snippet(e.name,t.FILENAME_SNIPPET_LENGTH)),null!=e.size&&r.createElement("span",{className:"size"}," - ",u.format_bytes(e.size))),e.status!==E.FileStatusType.FAILED&&o&&r.createElement("div",{className:"dest-col"},i._renderFileListRowDest(e)),e.status===E.FileStatusType.FAILED&&i._renderFileListRowError(e),r.createElement("div",{className:"status-col"},i._renderFileListRowStatus(e))))},i._renderFileList=function(e,t){return void 0===t&&(t=!0),r.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map(function(e){return i._renderFileListRow(e,t)}))},i._renderTimeLeft=function(){var e=i.state.currentUpload;return null!=e&&e.status===E.FileStatusType.UPLOADING?r.createElement("div",{style:{marginTop:8,textAlign:"right"}},M._("%(time_left)s left").format({time_left:i.state.numSecondsLeft?p.format_time(i.state.numSecondsLeft):""})):void 0},i.state=i._get_state_from_store(),i.OQALocationCode=f.getOQmodalOQALocationCode(o.pathname),i}return o.__extends(t,e),t.prototype._get_state_from_store=function(){var e=S.uploaderStore.user();return w.assert(null!==e,"Expected non-null user in file_uploader_modal"),{user:e,path:S.uploaderStore.path(),fileList:S.uploaderStore.fileList(),numDraggingFiles:S.uploaderStore.numDraggingFiles(),currentUpload:S.uploaderStore.currentUpload(),numSecondsLeft:S.uploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:S.uploaderStore.hasPermissionToUploadToFolder()}},t.prototype.componentDidMount=function(){var e=this;S.uploaderStore.add_change_listener(this._onUploaderStoreChanged),this._usingFileUploaderModal()&&(d.require_css("/static/css/scooter/scooter-scoped-vflrM1SRf.css"),this._focusChooseButton(),setTimeout(function(){return e.forceUpdate()},250),n(window).on("resize.uploaderModal",function(){e._focusChooseButton()}))},t.prototype.componentDidUpdate=function(e,o){if(this._usingFileUploaderModal()){if(this._focusChooseButton(),this.state.numDraggingFiles){n(s.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+t.DROPZONE_ID).length||n("#"+t.DROPZONE_ID).clone().prependTo(n(s.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)}else n(s.findDOMNode(this.refs.modal)).find("#"+t.DROPZONE_ID).remove();if(this.state.fileList.count()>o.fileList.count()){var a=n(s.findDOMNode(this.refs.uploadFilesList)),r=a.find(".upload-file")?a.find(".upload-file").eq(o.fileList.count()):void 0;r&&r.length&&a.scrollTop(a.scrollTop()+r.position().top)}}},t.prototype.componentWillUnmount=function(){S.uploaderStore.remove_change_listener(this._onUploaderStoreChanged),n(window).off("resize.uploaderModal")},t.prototype._usingFileUploaderModal=function(){return 0===this.state.fileList.count()},t.prototype.getButtonProps=function(){var e=M._("Upgrade to Upload"),t="upgrade to upload";return this.state.user.is_cdm_member&&(this.state.user.is_team_admin||0===this.props.numTeamAdmins?(e=M._("Get more space"),t="get more space"):(e=M._("Ask for more space"),t="ask for more space")),{upgrade_CTA:e,tracking_upgrade_CTA:t}},t.prototype.render=function(){var e;e=this.props.isTeamOnboarding?M._("Which files would you like to add?"):!this.state.user.is_cdm_member||this.props.overQuotaStatus!==E.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA&&this.props.overQuotaStatus!==E.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA?M._("Upload to Dropbox"):M._("More space needed");var t=null;if(null!=this.state.fileList.find(function(e){return e.status===E.FileStatusType.COMPLETE})&&this.props.overQuotaStatus===E.OverQuotaStatusType.BASIC_NEAR_QUOTA){var o=g.getNearquotaUploadAltActionOQA(this.props.lastFileUploadMethod,i.get_uri().path);t=r.createElement(g.NearquotaUploadAltAction,{oqa:o})}return r.createElement("div",{ref:"container"},this._renderDropzone(),this._usingFileUploaderModal()?r.createElement(U.Modal,{ref:"modal",title:e,showX:!1,clickOutToClose:!0,altAction:t,buttonComponent:0===this.state.fileList.count()?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:this._handleOnDismiss},0===this.state.fileList.count()?r.createElement("span",null,this._renderIntroMessage()):this._renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this._renderTimeLeft()):r.createElement(v.UploaderModal,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,overQuotaStatus:this.props.overQuotaStatus,isContentManager:this.props.isContentManager,isTeamOnboarding:this.props.isTeamOnboarding,uploaderExperiments:this.props.uploaderExperiments,lastFileUploadMethod:this.props.lastFileUploadMethod}))},t.DROPZONE_ID="upload-modal-dropzone",t.FILENAME_SNIPPET_LENGTH=15,t.DEST_SNIPPET_LENGTH=13,t})(r.PureComponent);t.FileUploaderModal=x}),define("modules/clean/react/file_uploader/inline_upload_status",["require","exports","external/react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/file_uploader/actions","modules/clean/react/snackbar","modules/clean/react/file_uploader/constants","modules/core/i18n","modules/constants/trademark","modules/core/accessible_announce"],function(e,t,o,a,r,s,n,i,l,d,p){"use strict";function u(e){return e.some(function(e){return e.status===i.FileStatusType.PENDING||e.status===i.FileStatusType.UPLOADING})?v.UPLOADING:e.some(function(e){return e.status===i.FileStatusType.FAILED})?v.ERROR:v.COMPLETE}function c(e,t){var o=u(e);return o===v.UPLOADING&&t?t.percentUploaded:o===v.COMPLETE||o===v.ERROR?100:0}function m(e,t){return e.count(function(e){return e.status===t})}function _(e){return e.count(function(e){return e.status!==i.FileStatusType.CANCELLED})}function h(e){switch(e){case i.UploadErrorType.OVER_QUOTA_ERROR:return l._("out of space");case i.UploadErrorType.FILE_SIZE_ERROR:return l._("file too large");case i.UploadErrorType.CONNECTION_ERROR:return l._("lost connection");case i.UploadErrorType.HTTP_ERROR:return l._("server error");case i.UploadErrorType.EMPTY_OR_FOLDER:return l._("can’t upload folders or empty files");case i.UploadErrorType.FOLDER_SAFARI:return l._("try uploading files separately");case i.UploadErrorType.PACKAGE_FILE:return l._("OSX package file");case i.UploadErrorType.BLOCKS_MISSING_ERROR:case i.UploadErrorType.COMMIT_HTTP_ERROR:case i.UploadErrorType.UPLOAD_BLOCK_ERROR:case i.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case i.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case i.UploadErrorType.HASHES_NOT_EQUAL_ERROR:case i.UploadErrorType.UPLOAD_PRECHECK_ERROR:return l._("server error");case i.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case i.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case i.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case i.UploadErrorType.BLOCK_INDEX_ERROR:case i.UploadErrorType.BLOCK_EMPTY_ERROR:case i.UploadErrorType.BLOB_EMPTY_ERROR:case i.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case i.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:case i.UploadErrorType.COMMIT_READINESS_ERROR:return l._("upload processing error");default:return""}}function f(e){var t=m(e,i.FileStatusType.PENDING),o=l.ungettext("%(num_pending_files)d file left","%(num_pending_files)d files left",t).format({num_pending_files:t});return t>0?o:l._("View details")}function E(e,t){var o=u(e),a=_(e);if(t)return l._("Uploading %(filename)s").format({filename:r.Emstring.em_snippet(t.name,20)});if(o===v.UPLOADING)return l._("Starting upload...");if(o===v.COMPLETE){if(a>1)return l._("Uploaded %(num_files)d files").format({num_files:a});if(1===a){var s=e.filter(function(e){return e.status!==i.FileStatusType.CANCELLED}).last();return l._("Uploaded %(filename)s").format({filename:r.Emstring.em_snippet(s.name,20)})}return l._("Upload cancelled")}return""}function g(e){var t=_(e),o=m(e,i.FileStatusType.FAILED);if(t>1)return l.ungettext("Uploaded %(num_completed)d of %(num_files)d files - %(num_errors)d error","Uploaded %(num_completed)d of %(num_files)d files - %(num_errors)d errors",o).format({num_completed:m(e,i.FileStatusType.COMPLETE),num_files:t,num_errors:o});var a=e.last().errorType;return a===i.UploadErrorType.GENERIC?l._("Unable to upload %(filename)s").format({filename:r.Emstring.em_snippet(e.last().name,20)}):a===i.UploadErrorType.LOCKED_TEAM_ERROR?l._("Can’t upload. Your team no longer has full use of %(trademark_business)s features.").format({trademark_business:d.TRADEMARK_BUSINESS}):l._("Unable to upload %(filename)s: %(reason)s").format({filename:r.Emstring.em_snippet(e.last().name,20),reason:h(a)})}function y(e,t){var o=u(e);return t||o!==v.ERROR?E(e,t):g(e)}function S(e){var t,r=e.fileList,i=e.currentUpload,d=e.numSecondsLeft,m=e.onViewDetails,_=e.onShown,h=e.onClosed,E=u(r);t=E===v.UPLOADING?"sync":E===v.ERROR?"fail":"complete";var g="",S="";E===v.UPLOADING&&d?S=" - "+l._("%(time_left)s left").format({time_left:a.format_time(d)}):g=l._("Close");var T=y(r,i);"complete"!==t&&"fail"!==t||p.AccessibleAnnounce.polite(T),n.Snackbar.update(o.createElement(n.Snackbar,{closeButtonText:g,onCloseClick:function(){s.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0})},actionButtonText:f(r),onActionClick:m,title:T+S,variant:t,externalProgress:c(r,i),onClosed:h,onShown:_}))}Object.defineProperty(t,"__esModule",{value:!0});var v;(function(e){e.UPLOADING="uploading",e.ERROR="error",e.COMPLETE="complete"})(v||(v={})),t.showInlineUploadStatusSnackbar=S}),define("modules/clean/react/file_uploader/mapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(){this.fileIdMap={}}return e.prototype.uploadIdOf=function(e){return this.fileIdMap[e]||null},e.prototype.set=function(e,t){this.fileIdMap[e]=t},e})();t.uploaderMapper=new o}),define("modules/clean/react/file_uploader/nearquota_upload_alt_action",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n","modules/clean/react_format"],function(e,t,o,a,r,s,n,i,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNearquotaUploadAltActionOQA=function(e,t){var o="/h"===t?"ho":"fb";return e&&t?"wb_nq_"+e+"_"+o:"upl_nq"};var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.oqa?"?oqa="+this.props.oqa:"";return a.createElement("div",{className:"nearquota-alt-action"},a.createElement("div",null,a.createElement(s.Image,{className:"nearquota-alt-action__warning",src:n.static_url("/static/images/browse/warning-vflZsXcW-.svg"),alt:i._("Warning")})),a.createElement("p",{className:"nearquota-alt-action__copy"},l.reactFormat(i._("Thanks for adding stuff to Dropbox! Just so you know, you’re getting close\n          to your space limit. <overQuotaLink>Learn more</overQuotaLink> about what to do if you\n          run out of space."),{overQuotaLink:a.createElement("a",{key:"nq-link",href:"/low-space"+e})})))},t})(a.Component);t.NearquotaUploadAltAction=r(d,["/static/css/nearquota_upload_alt_action-vfln2t6dC.css"])}),define("modules/clean/react/file_uploader/oq_drag_drop_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react/modal","modules/clean/react_format","modules/clean/analytics","modules/clean/react/file_uploader/utils","modules/clean/static_urls","modules/constants/payments","modules/constants/trademark","modules/clean/viewer"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var o=e.call(this,t)||this;return o.trackClose=function(){d.NQOQLogger.logCloseModal("wb_oq_dnd",{modal_type:"billboard"})},o.trackCTAClick=function(){var e=o.getButtonProps().tracking_button_label;d.NQOQLogger.logAcceptModal("wb_oq_dnd",{modal_type:"billboard",cta_text:e})},o.state={showTeamMemberContent:o.props.isTeamUser&&!o.props.isContentManager},o}return o.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){this.setState({showTeamMemberContent:e.isTeamUser&&!e.isContentManager})},t.prototype.render=function(){return a.createElement("div",{className:"drag-drop-oq"},a.createElement(i.Modal,{style:"clean",className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480,onDismiss:this.trackClose},a.createElement("div",null,a.createElement(s.Image,{src:u.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:u.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})),this.renderTitle(),this.renderBody()))},t.prototype.renderBody=function(){var e=l.reactFormat(n._("In order to finish uploading %(filename)s, you need to add more storage to your Dropbox."),{filename:this.props.oqFilename});return this.props.isLockedTeam?e=_.Viewer.get_viewer().work_user.is_team_admin?l.reactFormat(n._("Your team no longer has full use of %(trademark_business)s features. Add your billing info now and you can pick up right where you left off.").format({trademark_business:m.TRADEMARK_BUSINESS})):l.reactFormat(n._("Your team no longer has full use of %(trademark_business)s features. To keep using %(trademark_business)s, contact your admin.").format({trademark_business:m.TRADEMARK_BUSINESS})):this.state.showTeamMemberContent&&(e=l.reactFormat(n._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."))),a.createElement("div",{className:"drag-drop-oq--copy"},e)},t.prototype.renderTitle=function(){var e=n._("Your Dropbox is full");return this.props.isLockedTeam?e=n._("Can’t upload to Dropbox"):this.state.showTeamMemberContent&&(e=n._("Can’t upload file")),a.createElement("div",{className:"drag-drop-oq--header"},e)},t.prototype.getButtonProps=function(){var e=p.getOQmodalOQALocationCode(this.props.pathname),t=c.OUT_OF_SPACE_URL+"?oqa=wb_oq_dnd_"+e,o=n._("Get more space"),a="get more space";return this.props.isLockedTeam?(t="/team/decide",o=n._("See next steps"),a="see next steps"):this.state.showTeamMemberContent&&(t="/help/business/space-limit-full",o=n._("Learn more about Dropbox space"),a="learn more about dropbox space"),{button_url:t,button_label:o,tracking_button_label:a}},t.prototype.renderButtons=function(){var e=this.getButtonProps(),t=e.button_url,o=e.button_label;return a.createElement("div",{className:"drag-drop-oq--buttons"},a.createElement("a",{href:t,onClick:this.trackCTAClick,className:"drag-drop-oq--button c-btn c-btn--primary"},o))},t})(a.Component);t.OQDragDropModalComponent=h,t.OQDragDropModal=r(h,["/static/css/browse/oq_drag_drop_upsell-vflgzU8Ie.css"])}),define("modules/clean/react/file_uploader/plu_wrapper",["require","exports","tslib","external/plupload_dev","external/lodash","modules/clean/filepath","modules/clean/react/async_fileops_modals","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/mapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/web_upload_action_events","modules/constants/trademark","modules/core/browser","modules/core/cookies","modules/core/exception","modules/core/i18n"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h,f,E){"use strict";var g=function(e,t){var o=r.assignIn({},t,e);return new l.FileUpload({uploadId:o.uploadId,dest:o.dest,name:o.name,size:o.size,userId:o.userId,percentUploaded:null!=o.percent?o.percent:0,ns_id:o.nsIdForRouting,batchId:o.batchId})};return new((function(){function e(){var e=this;this.queuedFiles=[],this.setAjaxInterceptor=function(t){e.ajaxInterceptor=t},this.init=this.init.bind(this),this.addFiles=this.addFiles.bind(this),this.start=this.start.bind(this),this.setAjaxParams=this.setAjaxParams.bind(this),this.showFilePicker=this.showFilePicker.bind(this),this.onFilesAdded=this.onFilesAdded.bind(this),this.onUploadProgress=this.onUploadProgress.bind(this),this.onFileUploaded=this.onFileUploaded.bind(this),this.onError=this.onError.bind(this),this.onBeforeUpload=this.onBeforeUpload.bind(this),this.bytesPerSec=this.bytesPerSec.bind(this),this.removeFiles=this.removeFiles.bind(this),this.isInitialized=!1}return e.prototype.init=function(e){var t=this;if(void 0===e&&(e=!1),!this.isInitialized){this.isInitialized=!0,this.secretFilePickerButton=document.createElement("button"),this.secretFilePickerButton.setAttribute("class","secret-file-uploader-button"),this.secretFilePickerButton.style.display="none",document.body.appendChild(this.secretFilePickerButton),this.secretFolderPickerButton=document.createElement("input"),this.secretFolderPickerButton.setAttribute("type","file"),this.secretFolderPickerButton.setAttribute("webkitdirectory","true"),this.secretFolderPickerButton.style.display="none",this.secretFolderPickerButton.addEventListener("change",function(e){var o=e.target,a=o.files;if(a&&a.length>0){for(var r=u.generateBatchId(),n=Object.create(null),i=0;i<a.length;i++){var l=a.item(i);l.batchId=r;var d=s.parent_dir(l.webkitRelativePath),p=n[d];p?p.push(l):n[d]=[l]}for(var c in n){var p=n[c];t.uploader.addFile(p,c)}}o.value=""}),document.body.appendChild(this.secretFolderPickerButton),this.pluContainer=document.createElement("div"),this.pluContainer.id="flash-upload-container",this.pluContainer.style.position="absolute",this.pluContainer.style.left="-2000",document.body.appendChild(this.pluContainer);var o=!e,r={url:"https://dl-web.dropbox.com/chunked_upload",upload_block_url:"https://dl-web.dropbox.com/upload_web_file_block",commit_file_url:"https://dl-web.dropbox.com/commit_web_upload_file",file_data_name:"file",runtimes:"html5",multipart_params:{},multipart:!1,max_retries:2,browse_button:this.secretFilePickerButton,max_file_size:"50000mb",chunk_size:o?"4mb":"8mb",parallel_uploads:o,container:"flash-upload-container",init:{ChunkUploaded:function(e,o,a){var r=d.uploaderMapper.uploadIdOf(o.id);f.assert(null!=r,"uploadId is null"),f.assert(JSON.parse(a.response).upload_id===r,"uploadId in the response does not match the current uploadId");var s=p.uploaderStore.fileList().get(r);f.assert(null!=s,"fileUpload is null");var n=s,i=n.dest,l=n.size,u=n.userId,c=n.ns_id;return t.setAjaxParams(n,{dest:i,reported_total_size:l,upload_id:r,_subject_uid:u,offset:a.offset,ns_id_for_routing:c,overwrite:1,t:h.Cookies.read("__Host-js_csrf")})}}};f.assert("string"==typeof r.chunk_size&&r.chunk_size in l.ValidChunkSizeStrings,"we only allow a valid chunk size specified as a string"),this.uploader=new a.Uploader(r),this.uploader.init()}},e.prototype.addFiles=function(e){var t=e.files,o=e.path;this.isInitialized||this.init(),this.uploader.addFile(t,o)},e.prototype.start=function(){this.isInitialized||this.init(),this.uploader.start()},e.prototype.setAjaxParams=function(e,t){this.isInitialized||this.init(),this.ajaxInterceptor&&(t=this.ajaxInterceptor.interceptUpload(e,t)),this.uploader.settings.multipart_params=t},e.prototype.showFilePicker=function(){this.isInitialized||this.init(),this.secretFilePickerButton.click()},e.prototype.showFolderPicker=function(){this.isInitialized||this.init(),this.secretFolderPickerButton.click()},e.prototype.getErrorOnStatus507=function(e){var t=l.UploadErrorType.OVER_QUOTA_ERROR;try{"locked_team"===JSON.parse(e.response).error&&(t=l.UploadErrorType.LOCKED_TEAM_ERROR)}catch(e){}return t},e.prototype.getParallelUploadHttpErrorType=function(e){var t=l.UploadErrorType.GENERIC;if(0===e.status)t=_.safari&&0===e.file.loaded&&""===e.file.type&&e.file.size>0?l.UploadErrorType.FOLDER_SAFARI:l.UploadErrorType.CONNECTION_ERROR;else switch(e.code){case a.UPLOAD_BLOCK_ERROR:t=l.UploadErrorType.UPLOAD_BLOCK_ERROR;break;case a.COMMIT_HTTP_ERROR:t=l.UploadErrorType.COMMIT_HTTP_ERROR}return t},e.prototype.onFilesAdded=function(e){var t=this,a=e.isContentManager,r=e.rootNSIDForCM,l=e.setPathAndFolderNsId,m=e.expWebNsidRouting,_=e.resetFolderNsId,h=e.expUploadWithFolderPicker,E=e.cb;this.isInitialized||this.init(),this.uploader.bind("FilesAdded",function(e,y){var S=p.uploaderStore.user();f.assert(y&&y.length>=1,"FilesAdded should be called with an array of PluploadFile with at least one entry");for(var v=!!y[0].batchId,T=y[0].batchId?y[0].batchId:u.generateBatchId(),A=0,b=y;A<b.length;A++){var U=b[A];v?f.assert(U.batchId===T,"All entries should have the same batchId"):(f.assert(void 0===U.batchId,"No entries should have their batchId set"),U.batchId=T)}t.queuedFiles=t.queuedFiles.concat(y);var I=function(){f.assert(null!=p.uploaderStore.user(),"UploaderStore.user() is null");var e=t.queuedFiles;t.queuedFiles=[];var o=e.map(function(t){var o=p.uploaderStore.user(),a=u.generateUploadId(),r=p.uploaderStore.path();t.dest=s.normalize(r)+s.normalize(t.dest),d.uploaderMapper.set(t.id,a),f.assert(!!t.batchId,"At this point, a PluploadFile should have a batchId set");var n={uploadId:a,userId:o.id};if(m){var l=p.uploaderStore.folderNsId();""===s.normalize(r)?n.nsIdForRouting=o.root_ns_id:null!==l&&(n.nsIdForRouting=l)}var _=g(t,n);return i.logUploadAction(o.id,c.WebUploadActionEvent.UPLOAD_ATTEMPT,_,void 0,void 0,e.length),_});null!==p.uploaderStore.folderNsId()&&_&&_(),E(o)},R=function(){t.queuedFiles.forEach(function(t){return e.removeFile(t)}),t.queuedFiles=[]};if(l){var D={user:S,onAccept:l,onSuccess:I,onCancel:R};if(a)n.showAdminUpload(o.__assign({},D,{rootNSID:r}));else{var O=o.__assign({},D,{showUploadWithFolderPicker:h});n.showUpload(o.__assign({},O))}}else I()})},e.prototype.onUploadProgress=function(e){this.isInitialized||this.init(),this.uploader.bind("UploadProgress",function(t,o,a){var r=d.uploaderMapper.uploadIdOf(o.id);f.assert(null!=r,"uploadIs is null");var s=p.uploaderStore.fileList().get(r);f.assert(null!=s,"existingUpload is null"),e(s.set("percentUploaded",o.percent),a)})},e.prototype.onFileUploaded=function(e){this.isInitialized||this.init(),this.uploader.bind("FileUploaded",function(t,o,a){var r=d.uploaderMapper.uploadIdOf(o.id);f.assert(null!=r,"uploadIs is null"),e(p.uploaderStore.fileList().get(r),a)})},e.prototype.onError=function(e){var t=this;this.isInitialized||this.init(),this.uploader.bind("Error",function(o,r){if(null==r.file)throw new Error("PLU error without an associated file.");var s;switch(r.code){case a.FILE_SIZE_ERROR:s=l.UploadErrorType.FILE_SIZE_ERROR;break;case a.BLOCKS_MISSING_ERROR:s=l.UploadErrorType.BLOCKS_MISSING_ERROR,f.reportException({err:new Error("Blocks missing from web upload."),tags:["web_upload","blocks_missing"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case a.COMMIT_HTTP_ERROR:s=507===r.status?t.getErrorOnStatus507(r):t.getParallelUploadHttpErrorType(r);break;case a.UPLOAD_BLOCK_ERROR:507===r.status?s=t.getErrorOnStatus507(r):(s=t.getParallelUploadHttpErrorType(r),s===l.UploadErrorType.UPLOAD_BLOCK_ERROR&&f.reportException({err:new Error("Server error encountered when trying to upload a block."),tags:["web_upload","upload_block_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}}));break;case a.CHUNKS_NOT_ENABLED_ERROR:s=l.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR,f.reportException({err:new Error("Chunks not enabled."),tags:["web_upload","chunks_not_enabled_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case a.SERVER_HASH_RESPONSE_ERROR:s=l.UploadErrorType.SERVER_HASH_RESPONSE_ERROR,f.reportException({err:new Error("Server hash response error."),tags:["web_upload","server_hash_response_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case a.BLOCK_RUNTIME_ID_MISSING_ERROR:s=l.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR,f.reportException({err:new Error("Block runtime id missing."),tags:["web_upload","block_runtime_id_missing"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case a.CLIENT_HASH_EMPTY_ERROR:s=l.UploadErrorType.CLIENT_HASH_EMPTY_ERROR,f.reportException({err:new Error("Client hash is empty or undefined."),tags:["web_upload","client_hash_empty"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case a.SERVER_HASH_EMPTY_ERROR:s=l.UploadErrorType.SERVER_HASH_EMPTY_ERROR,f.reportException({err:new Error("Server hash is empty or undefined."),tags:["web_upload","server_hash_empty"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case a.HASHES_NOT_EQUAL_ERROR:s=l.UploadErrorType.HASHES_NOT_EQUAL_ERROR,f.reportException({err:new Error("Client and server hashes are not equal."),tags:["web_upload","hashes_not_equal"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case a.BLOCK_INDEX_ERROR:s=l.UploadErrorType.BLOCK_INDEX_ERROR,f.reportException({err:new Error("Block index error."),tags:["web_upload","block_index_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case a.BLOCK_EMPTY_ERROR:s=l.UploadErrorType.BLOCK_EMPTY_ERROR,f.reportException({err:new Error("Empty block error."),tags:["web_upload","block_empty_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex,offset:r.offset}});break;case a.BLOB_EMPTY_ERROR:s=l.UploadErrorType.BLOB_EMPTY_ERROR,f.reportException({err:new Error("Empty blob error."),tags:["web_upload","blob_empty_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case a.CLIENT_HASH_DIGEST_ERROR:s=l.UploadErrorType.CLIENT_HASH_DIGEST_ERROR,f.reportException({err:new Error("Client hash digest error."),tags:["web_upload","client_hash_digest_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex,digestError:r.message}});break;case a.FILE_READER_NULL_RESULT_ERROR:s=l.UploadErrorType.FILE_READER_NULL_RESULT_ERROR,f.reportException({err:new Error("File reader null result error."),tags:["web_upload","file_reader_null_result_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case a.COMMIT_READINESS_ERROR:s=l.UploadErrorType.COMMIT_READINESS_ERROR,f.reportException({err:new Error("Commit readiness error."),tags:["web_upload","commit_readiness_error"],severity:f.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,reason:r.message}});break;case a.HTTP_ERROR:s=0===r.status?_.safari&&0===r.file.loaded&&""===r.file.type&&r.file.size>0?l.UploadErrorType.FOLDER_SAFARI:l.UploadErrorType.CONNECTION_ERROR:507===r.status?t.getErrorOnStatus507(r):l.UploadErrorType.HTTP_ERROR;break;default:s=l.UploadErrorType.GENERIC}var n;switch(s){case l.UploadErrorType.OVER_QUOTA_ERROR:n=E._("This file can’t be uploaded because you are over your                       storage quota. If you believe this message to be in error, try                       refreshing the page.");break;case l.UploadErrorType.LOCKED_TEAM_ERROR:n=E._("Can’t upload. Your team no longer has full use of %(trademark_business)s features.").format({trademark_business:m.TRADEMARK_BUSINESS});break;case l.UploadErrorType.FILE_SIZE_ERROR:n=E._("This file is too large to upload using the Dropbox website.                       Please use the desktop client.");break;case l.UploadErrorType.HTTP_ERROR:n=E._("Something went wrong while uploading this file. There was a                       server error during the upload request.");break;case l.UploadErrorType.CONNECTION_ERROR:n=E._("Something went wrong while uploading this file. Check your                       connection to the internet and try again.");break;case l.UploadErrorType.FOLDER_SAFARI:n=E._("Can’t upload folders in Safari. Upload the files separately or try another browser.");break;case l.UploadErrorType.BLOCKS_MISSING_ERROR:case l.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case l.UploadErrorType.BLOCK_INDEX_ERROR:case l.UploadErrorType.BLOCK_EMPTY_ERROR:case l.UploadErrorType.BLOB_EMPTY_ERROR:case l.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case l.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:n=E._("Something went wrong while uploading this file.");break;case l.UploadErrorType.COMMIT_HTTP_ERROR:case l.UploadErrorType.UPLOAD_BLOCK_ERROR:case l.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case l.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case l.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case l.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case l.UploadErrorType.HASHES_NOT_EQUAL_ERROR:n=E._("Something went wrong while uploading this file. There was a                             server error during the upload request.");break;default:n=E._("Something went wrong while uploading this file.")}var h,y=d.uploaderMapper.uploadIdOf(r.file.id);h=y&&p.uploaderStore.fileList().has(y)?p.uploaderStore.fileList().get(y):g(r.file,{uploadId:u.generateUploadId()});var S=p.uploaderStore.user();h&&i.logUploadAction(S.id,c.WebUploadActionEvent.UPLOAD_FAILURE,h),e(h,s,n)})},e.prototype.onBeforeUpload=function(e){this.isInitialized||this.init(),this.uploader.bind("BeforeUpload",function(t,o){var r=d.uploaderMapper.uploadIdOf(o.id);return f.assert(null!=r,"uploadId is null"),e(p.uploaderStore.fileList().get(r),function(){o.status=a.UPLOADING,t.trigger("UploadFile",o)}),!1})},e.prototype.bytesPerSec=function(){return this.isInitialized||this.init(),null!=this.uploader.total?this.uploader.total.bytesPerSec:void 0},e.prototype.removeFiles=function(e){var t=e.files;this.isInitialized||this.init();for(var o=function(e){var t=r.find(a.uploader.files,function(t){return d.uploaderMapper.uploadIdOf(t.id)===e.uploadId});a.uploader.removeFile(t)},a=this,s=0,n=t;s<n.length;s++){o(n[s])}this.uploader.stop(),this.uploader.start()},e})())}),define("modules/clean/react/file_uploader/uploader_modal",["require","exports","tslib","external/classnames","external/react-dom","external/react","spectrum/file_icon","spectrum/button","spectrum/icon_action","spectrum/modal","spectrum/popover","jquery","modules/clean/browse_interface","modules/core/browser","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/web_user_action_events","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/nearquota_upload_alt_action","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/image","modules/clean/react/tooltip","modules/clean/react/sprite","modules/core/i18n","modules/clean/viewer","modules/clean/static_urls","modules/core/exception","modules/clean/react_format","modules/clean/react/file_uploader/types"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h,f,E,g,y,S,v,T,A,b,U,I,R,D,O,L,C,F,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var M=(function(e){function t(t){
var o=e.call(this,t)||this;return o.focusChooseButton=function(){u(".mc-util-modal-actions-buttons .mc-button-secondary").focus()},o.handleStoreChanged=function(){o.setState(o.getStateFromStores())},o.handleFileChoose=function(e){var t=A.uploaderStore.user();e?(b.showFolderPicker(),t&&y.logUploadAction(t.id,g.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,void 0,w.ChooserType.FOLDER,w.UploadMethod.CHOOSER)):(b.showFilePicker(),t&&y.logUploadAction(t.id,g.WebUserActionLogEvent.UPLOAD_FILES_CLICK,void 0,w.ChooserType.FILE,w.UploadMethod.CHOOSER))},o.handleClose=function(){var e=o.isSomethingUploading(),t=A.uploaderStore.user();e||S.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0}),S.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),o.props.onModalDismissed&&o.props.onModalDismissed(),t&&y.logUploadAction(t.id,g.WebUserActionLogEvent.CLOSE_MODAL_CLICK)},o.handleCancel=function(e){var t=A.uploaderStore.user();return t&&y.logUploadAction(t.id,g.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK),S.UploaderActions.cancelUploads({files:[e]})},o.handleDismiss=function(){S.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1})},o.renderLink=function(e){return s.createElement("div",{className:"upload-modal-link"},F.reactFormat(D._("Having problems? Please try again or see our Help center <a>here</a>."),{a:s.createElement("a",{href:"/help/space/upload-limitations",rel:"noopener noreferrer",target:"_blank"})}))},o.logAddMoreFilesClick=function(){var e=A.uploaderStore.user();e&&y.logUploadAction(e.id,g.WebUserActionLogEvent.ADD_MORE_FILES_CLICK)},o.renderAddMoreFilesButton=function(e){return s.createElement(p.Popover,{onSelection:o.handleFileChoose},s.createElement(p.PopoverTrigger,null,s.createElement(i.Button,{variant:"secondary",onClick:o.logAddMoreFilesClick},D._("Add more files"))),s.createElement(p.PopoverContent,{position:"above"},s.createElement(p.PopoverContentItem,{key:"Files",value:!1,className:"action-upload-files",disabled:!1},s.createElement(l.IconAction,{name:"upload-file",className:"popover-item-icon"}),D._("Files")),s.createElement(p.PopoverContentItem,{key:"Folder",value:!0,className:"action-upload-folder",disabled:!1},s.createElement(l.IconAction,{name:"upload-folder",className:"popover-item-icon"}),D._("Folder"))))},o.handleFileChooseOnlyFiles=function(){o.handleFileChoose(!1),o.logAddMoreFilesClick()},o.state=o.getStateFromStores(),o}return o.__extends(t,e),t.prototype.getStateFromStores=function(){return{path:A.uploaderStore.path(),user:A.uploaderStore.user(),fileList:A.uploaderStore.fileList(),numDraggingFiles:A.uploaderStore.numDraggingFiles(),currentUpload:A.uploaderStore.currentUpload(),numSecondsLeft:A.uploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:A.uploaderStore.hasPermissionToUploadToFolder(),isUploadModalOpen:A.uploaderStore.isUploadModalOpen()}},t.prototype.componentDidMount=function(){A.uploaderStore.add_change_listener(this.handleStoreChanged)},t.prototype.componentDidUpdate=function(e,t){var o=this,a=u(".mc-modal").find("#upload-modal-dropzone");this.state.numDraggingFiles?a.length||u("#upload-modal-dropzone").clone().prependTo(u(".mc-modal")).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1):a.remove(),this.state.fileList.count()>t.fileList.count()&&(this.focusChooseButton(),setTimeout(function(){var e,a=u(r.findDOMNode(o.refs.uploadFilesList));a.find(".upload-file")&&(e=a.find(".upload-file").eq(t.fileList.count())),e&&e.length&&a.scrollTop(a.scrollTop()+e.position().top)},0))},t.prototype.componentWillUnmount=function(){A.uploaderStore.remove_change_listener(this.handleStoreChanged),u(window).off("resize.uploaderModal")},t.prototype.isSomethingUploading=function(){return this.state.fileList.some(function(e){return e.status===v.FileStatusType.PENDING||e.status===v.FileStatusType.UPLOADING})},t.prototype.makeUploadSnippet=function(e){var t,o=this.state,a=o.user,r=o.path,s=O.Viewer.get_viewer();return C.assert(null!=a,"user is null"),s.is_paired&&a.is_team&&(t=s.team_name),s.is_paired?a.is_team?this.makeTeamSnippet(r,e,t):this.makePersonalSnippet(r,e):this.makeUnpairedSnippet(r,e)},t.prototype.makeTeamSnippet=function(e,t,o){var a=f.Emstring.em_snippet(E.filename(e),t);return"/"===e?D._("upload to your %(team_name)s Dropbox").format({team_name:o}):D._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox").format({folder:a,team_name:o})},t.prototype.makePersonalSnippet=function(e,t){var o=f.Emstring.em_snippet(E.filename(e),t);return"/"===e?D._("upload to your personal Dropbox"):D._("upload to the folder ‘%(folder)s’ in your personal Dropbox").format({folder:o})},t.prototype.makeUnpairedSnippet=function(e,t){var o=f.Emstring.em_snippet(E.filename(e),t);return"/"===e?D._("upload to your Dropbox"):D._("upload to the folder ‘%(folder)s’").format({folder:o})},t.prototype.renderDropzone=function(){var e=D.ungettext("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles).format({upload_action:this.makeUploadSnippet(20)});return s.createElement("div",{ref:"dropzone",id:"upload-modal-dropzone",style:{display:"none"}},e)},t.prototype.createCancelFileHandler=function(e){var t=this;return function(o){return o.preventDefault(),t.handleCancel(e)}},t.prototype.renderFileListRowStatus=function(e){return e.status===v.FileStatusType.UPLOADING&&100===e.percentUploaded?s.createElement("div",{className:"status-col"},s.createElement(U.Image,{src:L.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:L.static_url("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")})):e.status===v.FileStatusType.PENDING||e.status===v.FileStatusType.UPLOADING?s.createElement("div",{className:"status-col"},s.createElement("button",{className:"button-as-link",onClick:this.createCancelFileHandler(e)},s.createElement(R.Sprite,{group:"web",name:"xclose",alt:D._("Cancel")}))):e.status===v.FileStatusType.COMPLETE?s.createElement("div",{className:"status-col"},s.createElement(R.Sprite,{group:"web",name:"s_check",alt:D._("Upload successful")})):e.status===v.FileStatusType.CANCELLED?s.createElement("div",{className:"status-col"},s.createElement(U.Image,{src:L.static_url("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:L.static_url("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:D._("Upload cancelled")})):e.status===v.FileStatusType.FAILED?s.createElement("div",{className:"status-col"},s.createElement(U.Image,{src:L.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:L.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:D._("Error")})):s.createElement("div",{className:"status-col"})},t.prototype.renderFileListRowError=function(e){var t;t=e.errorMessage&&e.errorMessage.length>0?e.errorMessage:D._("Something went wrong while uploading this file.");var o;return o=e.errorType===v.UploadErrorType.FILE_SIZE_ERROR?D._("File too large"):D._("Upload Error"),C.assert(null!=this.state.user,"user is null"),this.state.user.is_team&&e.errorType===v.UploadErrorType.OVER_QUOTA_ERROR&&!this.props.isContentManager&&(t=D._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."),o=D._("Can’t upload file")),s.createElement("div",{className:"error-col"},s.createElement("span",{className:"error-msg"},o),s.createElement("span",{className:"error-details"},s.createElement(I.Tooltip,{position:I.TooltipPosition.RIGHT,tooltip_contents:s.createElement("div",{},t),tooltip_classname:"upload-error-tooltip"},s.createElement(R.Sprite,{group:"web",name:"information",alt:D._("More information")}))))},t.prototype.renderFileListRowDest=function(e){if(e.status===v.FileStatusType.CANCELLED)return s.createElement("div",{className:"dest-col"},D._("Canceled"));var t=void 0,o=O.Viewer.get_viewer().get_user_by_id(e.userId);t=this.props.isContentManager?"":c.get_browse_root_name(o);var a=f.Emstring.em_snippet(t+e.dest,13,0);return s.createElement("div",{className:"dest-col"},s.createElement("a",{href:c.browse_uri_for_fq_path(o,e.dest).toString()},a))},t.prototype.renderFileListRowContent=function(e,t){return e.status!==v.FileStatusType.FAILED&&t?this.renderFileListRowDest(e):this.renderFileListRowError(e)},t.prototype.renderFileListRow=function(e,t){var o;o=e.status===v.FileStatusType.UPLOADING?e.percentUploaded:e.status===v.FileStatusType.PENDING?0:100;var r={"upload-file":!0,complete:e.status===v.FileStatusType.COMPLETE,cancelled:e.status===v.FileStatusType.CANCELLED,error:e.status===v.FileStatusType.FAILED},i=a(r),l=f.Emstring.em_snippet(e.name,15),d=e.size?h.format_bytes(e.size):"";return s.createElement("li",{className:i,key:e.uploadId,style:{backgroundSize:o+"% 100%"}},s.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},s.createElement("div",{className:"filename-col"},s.createElement(n.FileIcon,{className:"brws-file-name-cell-icon",path:e.name}),s.createElement("span",{className:"filename"}," ",l," "),s.createElement("span",{className:"size"}," ",d," ")),this.renderFileListRowContent(e,t),this.renderFileListRowStatus(e)))},t.prototype.renderFileList=function(e,t){var o=this;return s.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map(function(e){return o.renderFileListRow(e,t)}))},t.prototype.renderTimeLeft=function(){var e=this.state.currentUpload,t=D._("%(time_left)s left").format({time_left:this.state.numSecondsLeft?_.format_time(this.state.numSecondsLeft):""});if(e&&e.status===v.FileStatusType.UPLOADING)return s.createElement("div",{style:{marginTop:8,textAlign:"right"}},t)},t.prototype.renderTitle=function(){return C.assert(null!=this.state.user,"user is null"),this.props.isTeamOnboarding?D._("Which files would you like to add?"):this.state.user.is_cdm_member&&this.props.overQuotaStatus in[v.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,v.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA]?D._("More space needed"):D._("Upload details")},t.prototype.getAltAction=function(){if(this.state.fileList.some(function(e){return e.status===v.FileStatusType.COMPLETE})&&this.props.overQuotaStatus===v.OverQuotaStatusType.BASIC_NEAR_QUOTA){var e=T.getNearquotaUploadAltActionOQA(this.props.lastFileUploadMethod,m.get_uri().path);return s.createElement(T.NearquotaUploadAltAction,{oqa:e})}return null},t.prototype.render=function(){var e=this.isSomethingUploading()?D._("Hide"):D._("Done"),t=this.renderTitle(),a=m.is_input_webkitdirectory_supported()?{secondaryAction:this.renderAddMoreFilesButton}:{secondaryAction:D._("Add more files"),onSecondaryAction:this.handleFileChooseOnlyFiles};return s.createElement("div",{ref:"container"},this.renderDropzone(),s.createElement(d.UtilityModal,o.__assign({},a,{ariaLabel:t,title:t,open:this.state.isUploadModalOpen,width:"640px",overlayClickClose:!0,shouldRequestCloseOnActions:!1,onRequestClose:this.handleDismiss,primaryAction:e,onPrimaryAction:this.handleClose,link:this.renderLink,onReady:this.focusChooseButton}),this.renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this.renderTimeLeft(),this.getAltAction()))},t})(s.PureComponent);t.UploaderModal=M}),define("modules/clean/react/file_uploader/uploader_new",["require","exports","tslib","external/react","external/lodash","jquery","modules/clean/ajax","modules/clean/analytics","modules/clean/browse/browse_drag_utils","modules/clean/em_string","modules/clean/ajax_as_promised","modules/clean/filepath","modules/clean/web_upload_action_events","modules/clean/web_user_action_events","modules/clean/react/fileops_actions","modules/clean/analytics","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader_modal","modules/clean/react/file_uploader/inline_upload_status","modules/clean/react/file_uploader/oq_drag_drop_modal","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/types","modules/clean/react/modal","modules/clean/viewer","modules/constants/trademark","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/browse/client_download_modal","modules/core/exception","modules/clean/react/snackbar","modules/clean/react/file_uploader/utils"],function(e,t,o,a,r,s,n,i,l,d,p,u,c,m,_,h,f,E,g,y,S,v,T,A,b,U,I,R,D,O,L,C,F,w,M,N,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var x=null,P=(function(t){function O(e){var s=t.call(this,e)||this;return s._dragEnterCount=0,s._lastEnteredElement=null,s.handleStoreChanged=function(){s.setState(s.getStateFromStores())},s.handleDropOver=function(e){e.preventDefault(),e.stopPropagation()},s.handleDropEnter=function(e){if(e.preventDefault(),e.stopPropagation(),e.target!==s._lastEnteredElement){s._lastEnteredElement=e.target,s._dragEnterCount++;var t=e.originalEvent,o=t.dataTransfer,a=o.mozItemCount,n=0;o.items&&(n=Object.keys(o.items).length);var i=1;a?i=a:n&&(i=n);var l=o.types,d=["Files","application/x-moz-file",D.INTERNAL_FILE_DATA_TRANSFER_TYPE,"text/x-moz-url","text/uri-list","Url"];if(l&&l.indexOf&&r.intersection(l,d).length||l instanceof DOMStringList&&(l.contains("Files")||l.contains("text/x-moz-url")||l.contains(D.INTERNAL_FILE_DATA_TRANSFER_TYPE)||D.msie&&(l.contains("Text")||l.contains("text/plain")))){var p=s.isInternalTransfer(l);E.UploaderActions.setNumDraggingFiles({numDraggingFiles:i,isInternalTransfer:p})}}},s.handleDragLeave=function(e){e.preventDefault(),e.stopPropagation(),s._lastEnteredElement=null,s._dragEnterCount--,s._dragEnterCount<1&&(s._dragEnterCount=0,E.UploaderActions.setNumDraggingFiles({numDraggingFiles:0}))},s.handleUnload=function(e){if(s.isSomethingUploading(s.state)&&s.state.fileList.count()){var t=L._("Leaving this page will cancel your uploads.");return e.returnValue=t,t}},s.handleFileDrop=function(e){var t=A.uploaderStore.user(),o=b.ChooserType.FILE,r=k.generateBatchId();s.setState({fileWasDragged:!0,lastFileUploadMethod:"dnd"}),e.preventDefault(),e.stopPropagation(),s._dragEnterCount=0,s._lastEnteredElement=null,E.UploaderActions.setNumDraggingFiles({numDraggingFiles:0});var n=e.originalEvent.dataTransfer,i=n.getData(D.INTERNAL_FILE_DATA_TRANSFER_TYPE),d=s.state.user;if(M.assert(null!=d,"user is null"),i)try{var p=JSON.parse(i),u=p.userId,h=p.fromPath,y=p.filePaths;if(y&&y.length&&h&&u){if(s.props.isContentManager)return;if(!s.state.hasPermissionToUploadToFolder)return void C.Notify.error(L._("You don’t have permission to add to this folder."));if(u!==d.id)return void C.Notify.error(L._("You can’t move or copy files here from another Dropbox."));return void(e.ctrlKey||e.altKey?_.copyFiles({user:d,files:y.map(function(e){return{fq_path:e}}),newPath:s.state.path,checkFSWs:!0}):h!==s.state.path&&_.moveFiles({user:d,path:h,files:y.map(function(e){return{fq_path:e}}),newPath:s.state.path,checkFSWs:!0}))}}catch(e){}if(I.Viewer.get_viewer().team_is_locked)return void s.showOOQModal(!0);if(s.state.hasPermissionToUploadToFolder){if(s.state.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA)return void s.showOOQModal();var S=l.getDraggedLink(n);if(S){var v=l.buildUrlLinkfileContents(S),T=new Blob([v],{type:"text/plain"}),U=F.URI.parse(S).getAuthority();if(U===D.get_hostname()||"dl-web.dropbox.com"===U||U===["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com"][0]||U===["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com"][1]||U===["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com"][2])return;return T.name="#"+U+".url",T.overwrite=!1,T.batchId=r,void E.UploaderActions.addFilesToPLU({files:[T],dropTarget:e.target})}var R=n.items,O=n.files;if(R&&R[0].webkitGetAsEntry){for(var w=[],x=0;x<R.length;x++)w.push(R[x].webkitGetAsEntry());for(var P=[],B=[],q=0,Q=w;q<Q.length;q++){var H=Q[q];H&&H.isFile&&P.push(H),H&&H.isDirectory&&(B.push(H),o=b.ChooserType.FOLDER)}P.length>0&&B.length>0&&(o=b.ChooserType.FILE_FOLDER),f.logUploadAction(t.id,m.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,void 0,o,b.UploadMethod.DRAG);for(var W=0,V=P;W<V.length;W++){var j=V[W];j.file&&j.file(function(o){var a=o;a.batchId=r,E.UploaderActions.addFilesToPLU({files:[a],dropTarget:e.target}),f.logUploadAction(t.id,c.WebUploadActionEvent.UPLOAD_ATTEMPT,a,b.ChooserType.FILE,b.UploadMethod.DRAG,P.length)})}B.length&&(E.UploaderActions.addDirectoriesToPLU({directoryEntries:B,dropTarget:e.target,batchId:r}),f.logUploadAction(t.id,c.WebUploadActionEvent.UPLOAD_ATTEMPT,void 0,b.ChooserType.FOLDER,b.UploadMethod.DRAG,void 0,B.length))}else if(O&&O.length){for(var z=[],x=0;x<O.length;x++){var G=O.item(x);G.batchId=r,z.push(G)}o=b.ChooserType.UNKNOWN,f.logUploadAction(t.id,m.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,void 0,o,b.UploadMethod.DRAG),E.UploaderActions.addFilesToPLU({files:z,dropTarget:e.target});for(var K=0,Y=z;K<Y.length;K++){var G=Y[K];f.logUploadAction(t.id,c.WebUploadActionEvent.UPLOAD_ATTEMPT,G,o,b.UploadMethod.DRAG,z.length)}}else D.msie&&O&&0===O.length&&(o=b.ChooserType.FOLDER,N.Snackbar.show(a.createElement(N.Snackbar,{title:L._("Can’t upload folders in Internet Explorer. Upload the files separately or try another browser."),variant:"fail",closeButtonText:"Close"})),f.logUploadAction(t.id,m.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,void 0,o,b.UploadMethod.DRAG))}},s.state=o.__assign({},s.getStateFromStores(),{isTeamOnboarding:!1,hasOverquotaError:!1,userQuotaUsageRatio:0,tsdQuotaUsageRatio:0,numTeamMembers:0,numTeamAdmins:0,teamAdminEmail:"",teamAdminFname:"",promptAdminToUpgradeEmailTemplateUrl:"",overQuotaStatus:g.OverQuotaStatusType.NONE,fileWasDragged:!1,isInlineStatusShowing:!1}),s}return o.__extends(O,t),O.prototype.getStateFromStores=function(){return{path:A.uploaderStore.path(),user:A.uploaderStore.user(),fileList:A.uploaderStore.fileList(),numDraggingFiles:A.uploaderStore.numDraggingFiles(),isInternalTransfer:A.uploaderStore.isInternalTransfer(),currentUpload:A.uploaderStore.currentUpload(),isUploadModalOpen:A.uploaderStore.isUploadModalOpen(),numSecondsLeft:A.uploaderStore.numSecondsLeft(),inlineStatusShouldBeDismissed:A.uploaderStore.inlineStatusShouldBeDismissed(),hasPermissionToUploadToFolder:A.uploaderStore.hasPermissionToUploadToFolder()}},O.showModal=function(){x&&x.showModal()},O.showOOQModal=function(e){void 0===e&&(e=!1),x&&x.showOOQModal(e)},O.showModalWithTeamOnboarding=function(){x&&x.setState({isTeamOnboarding:!0},x.showModal)},O.prototype.handleUploadButtonClick=function(e){var t=A.uploaderStore.user();this.setState({lastFileUploadMethod:"upm"}),this.state.overQuotaStatus!==g.OverQuotaStatusType.NONE&&this.state.overQuotaStatus!==g.OverQuotaStatusType.BASIC_NEAR_QUOTA?this.showModal():e?(T.showFolderPicker(),f.logUploadAction(t.id,m.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,void 0,b.ChooserType.FOLDER,b.UploadMethod.CHOOSER)):(T.showFilePicker(),f.logUploadAction(t.id,m.WebUserActionLogEvent.UPLOAD_FILES_CLICK,void 0,b.ChooserType.FILE,b.UploadMethod.CHOOSER))},O.prototype.showModal=function(){if(this.setState({fileWasDragged:!1}),this.fetchQuotaUpsellInfo(),I.Viewer.get_viewer().team_is_locked)this.showOOQModal(!0);else if(this.state.fileList.count()||this.state.overQuotaStatus!==g.OverQuotaStatusType.NONE&&this.state.overQuotaStatus!==g.OverQuotaStatusType.BASIC_NEAR_QUOTA){var t=this.props.uploaderExperiments||{},o=this.props.uploaderPostTTIExperiments||{},r=o.expProOQUploadModal;if(p.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_oq_upload_modal",variant:r}}),this.state.user&&!this.state.user.is_team&&"V1"===r){var s=this.props.browseViewType?"wb_oq_upm_fb":"wb_oq_upm_h";e(["modules/clean/react/overquota_modal_controller"],function(e){e.showOverquota({oqa:s,tagline:L._("Before you can upload to Dropbox, you need to get more space."),ctaText:L._("Upgrade to Upload")})})}else U.Modal.showInstance(a.createElement(y.FileUploaderModal,{dragAndDropEnabled:!!this.props.dragAndDropEnabled,shouldShowDestinationLink:!!this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,isTeamOnboarding:this.state.isTeamOnboarding,isContentManager:!!this.props.isContentManager,numTeamMembers:this.state.numTeamMembers,numTeamAdmins:this.state.numTeamAdmins,teamAdminEmail:this.state.teamAdminEmail,teamAdminFname:this.state.teamAdminFname,promptAdminToUpgradeEmailTemplateUrl:this.state.promptAdminToUpgradeEmailTemplateUrl,overQuotaStatus:this.state.overQuotaStatus,uploaderExperiments:t,lastFileUploadMethod:this.state.lastFileUploadMethod})),E.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!0}),this.state.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA&&h.NQOQLogger.logViewModal("wb_oq_upm",{modal_type:"utility"})}},O.prototype.showOOQModal=function(e){void 0===e&&(e=!1);var t=this.state.fileList.toArray().filter(function(e){return e.errorType===g.UploadErrorType.OVER_QUOTA_ERROR||e.errorType===g.UploadErrorType.GENERIC||e.errorType===g.UploadErrorType.LOCKED_TEAM_ERROR}),o=t&&t[t.length-1]?t[t.length-1].name:L._("this file"),r=e||this.state.fileList.toArray().filter(function(e){return e.errorType===g.UploadErrorType.LOCKED_TEAM_ERROR}).length>0;U.Modal.showInstance(a.createElement(v.OQDragDropModal,{oqFilename:o,isLockedTeam:r,isContentManager:!!this.props.isContentManager,isTeamUser:!!this.state.user.is_team})),h.NQOQLogger.logViewModal("wb_oq_dnd",{modal_type:"billboard"})},O.prototype.componentWillMount=function(){if(x)throw new Error("Only one FileUploader component may be rendered to the page at any time.You have tried to instantiate multiple uploaders.");x=this},O.prototype.componentDidMount=function(){var e=this.props.uploaderExperiments,t=void 0===e?{}:e,o=t.expWebNsidRouting,a=t.expUploadWithFolderPicker;A.uploaderStore.add_change_listener(this.handleStoreChanged),E.UploaderActions.initPLU(this.props.chooseDestination,this.props.isContentManager,this.props.rootNSIDForCM,o,a),E.UploaderActions.setAjaxInterceptor(this.props.ajaxInterceptor),E.UploaderActions.setIsContentManager(this.props.isContentManager),this._dragEnterCount=0,this._lastEnteredElement=null,this.props.dragAndDropEnabled&&s(document).on("dragover.fileUploader",this.handleDropOver).on("dragenter.fileUploader",this.handleDropEnter).on("dragleave.fileUploader",this.handleDragLeave).on("drop.fileUploader",this.handleFileDrop),s(window).on("beforeunload.fileUploader",this.handleUnload),this.state.user&&this.fetchQuotaUpsellInfo()},O.prototype.updateInlineStatus=function(){var e=this,t=A.uploaderStore.user(),o=this.isSomethingUploading(this.state);!this.state.isUploadModalOpen&&(o||!o&&!this.state.inlineStatusShouldBeDismissed&&this.state.fileList.toArray().filter(function(e){return e.status!==g.FileStatusType.CANCELLED}).length>0)?S.showInlineUploadStatusSnackbar({fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:function(){e.showModal(),f.logUploadAction(t.id,m.WebUserActionLogEvent.VIEW_DETAILS_CLICK)},numSecondsLeft:this.state.numSecondsLeft,onShown:function(){e.setState({isInlineStatusShowing:!0})},onClosed:function(){e.setState({isInlineStatusShowing:!1})}}):this.state.isInlineStatusShowing&&N.Snackbar.close()},O.prototype.componentWillReceiveProps=function(e){this.showOverquotaError()&&this.setState({hasOverquotaError:!0,inlineStatusShouldBeDismissed:!0})},O.prototype.componentWillUpdate=function(e,t){if(!t.currentUpload&&this.state.currentUpload&&(this.props.onFileUploadComplete&&this.props.onFileUploadComplete(this.state.currentUpload),this.state.isTeamOnboarding&&i.TeamsWebActionsLogger.log("uploaded_file")),t.fileList!==this.state.fileList){!this.isSomethingUploading(t)&&t.fileList.count()&&(t.fileWasDragged||w.maybeShowClientDownloadModal(!1),this.props.onAllFileUploadsComplete&&this.props.onAllFileUploadsComplete(this.state.fileList))}!this.state.hasOverquotaError&&t.hasOverquotaError&&this.showOOQModal()},O.prototype.componentDidUpdate=function(e,t){var o=s(".external-drop-indicator");if(this.state.numDraggingFiles&&!this.state.isInternalTransfer){if(t.numDraggingFiles||o.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?o.removeClass("external-drop-indicator--uploads-disabled"):o.addClass("external-drop-indicator--uploads-disabled"),!this.state.isUploadModalOpen)if(this.state.hasPermissionToUploadToFolder)if(I.Viewer.get_viewer().team_is_locked)C.Notify.error(L._("Can’t upload. Your team no longer has full use of %(trademark_business)s features.").format({trademark_business:R.TRADEMARK_BUSINESS}));else{var a=L._("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:this.makeUploadSnippet(1e3)});C.Notify.success(a,60)}else C.Notify.error(L._("You don’t have permission to add to this folder."))}else!this.state.numDraggingFiles&&t.numDraggingFiles&&(o.hide().removeClass("external-drop-indicator--uploads-disabled"),C.Notify.clear());this.updateInlineStatus(),!t.user&&this.state.user&&this.fetchQuotaUpsellInfo(),this.showOverquotaError()&&this.setState({hasOverquotaError:!0})},O.prototype.fetchQuotaUpsellInfo=function(){var e=this;M.assert(null!=this.state.user,"user is null"),n.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:this.state.user.id},success:function(t){t=JSON.parse(t),e.setState({userQuotaUsageRatio:t.user_quota_usage_ratio,tsdQuotaUsageRatio:t.tsd_quota_usage_ratio,promptAdminToUpgradeEmailTemplateUrl:t.prompt_admin_to_upgrade_email_template_url,numTeamMembers:t.num_team_members,numTeamAdmins:t.num_team_admins,teamAdminEmail:t.team_admin_email,teamAdminFname:t.team_admin_fname}),e.fetchOverQuotaStatus()}})},O.prototype.fetchOverQuotaStatus=function(){M.assert(null!=this.state.user,"user is null");var e=g.OverQuotaStatusType.NONE;if(!this.state.user.paid)if("personal"===this.state.user.role)this.state.userQuotaUsageRatio>1?e=g.OverQuotaStatusType.BASIC_OVER_QUOTA:this.state.userQuotaUsageRatio>.9&&(e=g.OverQuotaStatusType.BASIC_NEAR_QUOTA);else if(this.state.user.is_team&&I.Viewer.get_viewer().team_is_limited){var t=this.state.user.cdm_tmf_path;!this.state.user.is_cdm_member||t&&this.state.path.startsWith(t)?this.state.userQuotaUsageRatio>1&&(e=g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA):this.state.tsdQuotaUsageRatio>1&&(e=g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA)}else this.state.user.is_team&&I.Viewer.get_viewer().team_is_locked&&(e=g.OverQuotaStatusType.LOCKED_TEAM_USER_OVER_QUOTA);this.setState({overQuotaStatus:e})},O.prototype.componentWillUnmount=function(){A.uploaderStore.remove_change_listener(this.handleStoreChanged),s(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),s(window).off("beforeunload.fileUploader"),x=null},O.prototype.isSomethingUploading=function(e){return e.fileList.some(function(e){return e.status===g.FileStatusType.PENDING||e.status===g.FileStatusType.UPLOADING})},O.prototype.makeUploadSnippet=function(e){var t,o=this.state,a=o.user,r=o.path,s=I.Viewer.get_viewer();return M.assert(null!=a,"user is null"),s.is_paired&&a.is_team&&(t=s.team_name),s.is_paired?a.is_team?this.makeTeamSnippet(r,e,t):this.makePersonalSnippet(r,e):this.makeUnpairedSnippet(r,e)},O.prototype.makeTeamSnippet=function(e,t,o){var a=d.Emstring.em_snippet(u.filename(e),t);return"/"===e?L._("upload to your %(team_name)s Dropbox").format({team_name:o}):L._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox").format({folder:a,team_name:o})},O.prototype.makePersonalSnippet=function(e,t){var o=d.Emstring.em_snippet(u.filename(e),t);return"/"===e?L._("upload to your personal Dropbox"):L._("upload to the folder ‘%(folder)s’ in your personal Dropbox").format({folder:o})},O.prototype.makeUnpairedSnippet=function(e,t){var o=d.Emstring.em_snippet(u.filename(e),t);return"/"===e?L._("upload to your Dropbox"):L._("upload to the folder ‘%(folder)s’").format({folder:o})},O.prototype.isInternalTransfer=function(e){return e instanceof DOMStringList?e.contains("Text")||e.contains("text/plain"):e.includes(D.INTERNAL_FILE_DATA_TRANSFER_TYPE)||e.includes("text/plain")},O.prototype.showOverquotaError=function(){return this.state.fileList&&this.state.fileList.last()&&(this.state.fileList.last().errorType===g.UploadErrorType.OVER_QUOTA_ERROR||this.state.fileList.last().errorType===g.UploadErrorType.LOCKED_TEAM_ERROR)},O.prototype.render=function(){return a.createElement("div",null)},O.defaultProps={dragAndDropEnabled:!0,shouldShowDestinationLink:!0,isContentManager:!1,chooseDestination:!1},O})(a.PureComponent);t.FileUploader=P}),define("modules/clean/react/overquota_modal",["require","exports","tslib","external/react","spectrum/tertiary_link","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/analytics","modules/clean/static_urls","modules/clean/react/modal","modules/constants/payments","modules/clean/react/overquota_modal_helpers"],function(e,t,o,a,r,s,n,i,l,d,p,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dismiss=function(){p.Modal.close(),t.trackCancel()},t.trackCTAClick=function(){var e=t.props.ctaTextUntranslated,o=e?e.toLowerCase():"";l.NQOQLogger.logAcceptModal(t.props.oqa,{modal_type:"billboard",cta_text:o})},t.trackClose=function(){l.NQOQLogger.logCloseModal(t.props.oqa,{modal_type:"billboard"})},t.trackCancel=function(){l.NQOQLogger.logCancelModal(t.props.oqa,{modal_type:"billboard"})},t._renderButtons=function(){var e=t.props.oqa,o=u.OUT_OF_SPACE_URL+"?oqa="+e;return e.search("_nq_")!==-1&&(o=u.LOW_SPACE_URL+"?oqa="+e),a.createElement(p.ModalButtons,{className:"oq-modal__buttons"},a.createElement("a",{href:o,id:"oq-cta-button",className:"mc-button mc-button-primary",onClick:t.trackCTAClick},t.props.ctaText))},t}return o.__extends(t,e),t.prototype._renderAltAction=function(){return this.props.dismissText?a.createElement("div",{className:"overquota_modal__alt-action-container"},a.createElement(r.TertiaryLink,{onClick:this.dismiss},this.props.dismissText)):null},t.prototype._renderContentTitle=function(){return a.createElement("p",{className:"oq-modal__content--title"},this.props.headline)},t.prototype._renderImage=function(){if(this.props.imageObject){var e=this.props.imageObject,t=e.height,o=e.width,r=e.src,s=e.srcHiRes;return a.createElement(n.Image,{height:t,width:o,src:d.static_url(r),srcHiRes:d.static_url(s)})}},t.prototype.render=function(){return a.createElement(p.Modal,{className:"overquota_modal",title:this.props.headline,buttonComponent:this._renderButtons(),altAction:this._renderAltAction(),style:"clean",showX:this.props.showX,onDismiss:this.trackClose},a.createElement("div",{className:"oq-modal__content"},this._renderImage(),this._renderContentTitle(),a.createElement("p",null,this.props.tagline)))},t.defaultProps={headline:i._("Your Dropbox is full"),tagline:i._("Before you can update or move your files, you need more space."),imageObject:c.constructImageObject(),oqa:"",ctaText:i._("Get more space"),ctaTextUntranslated:"Get more space",showX:!0},t})(a.Component);t.OverquotaModalElement=m,t.OverquotaModal=s(m,["/static/css/react/overquota_modal-vflG9lYFj.css"])});
//# sourceMappingURL=pkg-file_uploader.min.js-vflNDFH2X.map