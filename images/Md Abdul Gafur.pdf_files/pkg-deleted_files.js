define("modules/clean/events/rollback",["require","exports","modules/clean/ajax","modules/clean/react/modal","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,n,s,o,i,a,l){"use strict";function c(e,t,r,s){var a=i.ungettext("Restore this file","Restore %(num)d files",s).format({num:s}),l=i.ungettext("Are you sure you want to restore this file?","Are you sure you want to restore these %(num)d files?",s).format({num:s});return function(){return n.SimpleModal.show({title_text:a,body_html:o.HTML.escape(l).toHTML(),cancel_text:i._("Cancel"),confirm_text:i._("Restore"),confirm_callback:function(){d(e,t,r)}})}}function d(e,t,n,o,c,d){var u={ns_to_cs:JSON.stringify((p={},p[t]=n,p))};r.WebProgressRequest({url:"/cmd/restore_changesets",data:u,subject_user:e,progress_text:i._("Restoring files..."),success:function(){a.Notify.success(i._("Finished restoring files.")),c&&c(),o&&(d?s.replace_location(d):s.redirect(new l.URI({path:"/browse_cs/"+e+"/"+t+"/"+n}).toString()))}});var p}Object.defineProperty(t,"__esModule",{value:!0}),t.createRollbackHandler=c,t.rollback=d}),define("modules/clean/react/folder_dialog/api",["require","exports","modules/clean/ajax"],function(e,t,r){"use strict";function n(e,t){var n={folder:t};return new Promise(function(t,s){r.WebRequestOref({url:"/browse_util/tree_view_folders",type:"POST",subject_user:e,data:n,dataType:"json",skipNotifyError:!0}).then(t,function(e,t,r){return s(r)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getFolderContents=n}),define("modules/clean/react/folder_dialog/constants",["require","exports","modules/core/i18n","modules/clean/static_urls"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_SCOPE="folder_picker_keyboard_selection",t.INVALID_FOCUS_INDEX=-1,t.MAX_FOLDER_NAME_LENGTH=20,t.TEAM_MEMBER="team_member";(function(e){e[e.ACCESS=0]="ACCESS",e.LIMITED_ACCESS="locked",e.NO_ACCESS="no_access"})(t.ACCESS_LEVEL||(t.ACCESS_LEVEL={}));(function(e){e[e.COPY=0]="COPY",e[e.MOVE=1]="MOVE"})(t.Operation||(t.Operation={})),t.IMAGE_URL=n.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working-vflCTJCxH.png"),t.errorDialogProps={primaryAction:r._("Try again"),secondaryAction:r._("Cancel"),title:r._("Something went wrong on our end"),ariaLabel:"",open:!0,variant:"regular"},t.DIALOG_HEAD_HEIGHT=64,t.DIALOG_ACTIONS_HEIGHT=64,t.PATH_BREADCRUMB_HEIGHT=40,t.DIALOG_BODY_PADDING=24}),define("modules/clean/react/folder_dialog/folder_picker",["require","exports","tslib","external/classnames","external/keymaster","external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css","modules/clean/react/folder_dialog/constants","modules/clean/react/icon/folder_icon","modules/clean/react/selectable_list","modules/clean/react/path_breadcrumbs","modules/core/i18n","spectrum/dimensions","spectrum/icon_arrow","spectrum/icon_content","spectrum/media_table","spectrum/table","spectrum/table/table_head_cell"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h,m,f,E,g,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y="",S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){var e=t.props;(0,e.onClick)(e.folder,e.allowSelect)},t.handleMouseMove=function(){var e=t.props,r=e.folder;(0,e.mouseMove)(r.path)},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.folder,r=e.isSelected,s=e.allowAccess,l=e.isFocused,u=i.Emstring.em_snippet(a.filename(t.path),c.MAX_FOLDER_NAME_LENGTH),p=[o.createElement(E.MediaCell,{key:u,icon:o.createElement(f.IconContent,{name:d.convertLegacyFolderIconToSpectrum(t.icon,"small"),disabled:!s}),title:u}),t.has_subdirs&&s?o.createElement(E.MediaCell,{key:"has_subdirs",icon:o.createElement(m.IconArrow,{name:"right"})}):o.createElement(E.MediaCell,{key:"has_subdirs"})],_=n({read_only:!s,focused:l,selected:r});return s?o.createElement(E.MediaRow,{onClick:this.handleClick,onMouseMove:this.handleMouseMove,className:_},p):o.createElement(E.MediaRow,{className:_},p)},t})(o.Component),I=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleSelectPrevious=function(e){r.state.isLoading||r.selectNeighboringItem(u.SelectDirection.PREV)},r.handleSelectNext=function(e){r.state.isLoading||r.selectNeighboringItem(u.SelectDirection.NEXT)},r.handleSelectParent=function(e){if(!r.state.isLoading){var t=r.state.path,n=a.parent_dir(t);r.handleBreadcrumbClick({path:n})}},r.handleSelectCurrentFolder=function(e){var t=r.state,n=t.focusIndex,s=t.folders,o=t.path,i=r.getFolderIndex(s,o);r.state.isLoading||n===i||r.handleSelect(e)},r.handleSelect=function(e){if(!r.state.isLoading){var t=r.state,n=t.focusIndex,s=t.folders,o=t.path;if(r.getFolderIndex(s,o)===n)r.handleOnSuccess();else{var i=s[n],a=r.getAllowSelect(i);r.onFolderClick(s[n],a)}}},r.handleOnSuccess=function(){r.props.onSuccess()},r.mouseMove=function(e){var t=r.state,n=t.folders,s=t.focusIndex,o=r.getFolderIndex(n,e);o!==s&&r.setState({focusIndex:o})},r.getFolderIndex=function(e,t){for(var r=0;r<e.length;r++)if(t===e[r].path)return r;return c.INVALID_FOCUS_INDEX},r.getFolderViewArray=function(e,t,r){if(a.normalize(t)||!r)return e;var n=-1,s=e.map(function(e,t){return e.icon.endsWith(c.TEAM_MEMBER)&&(n=t),e});if(n!==-1){var o=s[n];s.splice(n,1),s.unshift(o)}return s},r.addSubFolders=function(e,t){r.data.subFolders.set(e,t),t.map(function(e){r.data.selectable.has(e.path)||r.data.selectable.set(e.path,r.getAllowSelect(e))})},r.loadFolder=function(e){var t=r.props,n=t.apiClient,s=t.user,o=t.onError;n.getFolderContents(s.id,e).then(function(t){var n=r.state.loadingPath,o=r.getFolderViewArray(t,e,!!s.cdm_tmf_path);if(r.addSubFolders(e,o),e===n&&(o.length||"/"===e)){var i=r.getFolderIndex(t,n);r.endLoading(n,o,i)}}).catch(o)},r.getContents=function(e){var t=r.data.subFolders.get(e);return t?t.length||"/"===e?t:r.getContents(a.parent_dir(e)):t},r.changeFolder=function(e,t,n,s){var o=r.state.folders;if(s?r.props.onFolderSelected(e):r.props.onFolderSelected(""),r.startLoading(),t){var i=r.getContents(e);i?r.endLoading(e,i,c.INVALID_FOCUS_INDEX):r.loadFolder(e)}else r.endLoading(e,o,n)},r.onFolderClick=function(e,t){var n=r.state.folders.indexOf(e),s=r.normalizePath(e.path);r.setState({loadingPath:s}),r.changeFolder(s,e.has_subdirs,n,t)},r.normalizePath=function(e){var t=a.normalize(e);return""===t?"/":t},r.startLoading=function(){r.setState({isLoading:!0}),setTimeout(function(){r.state.isLoading&&r.setState({showLoadingItem:!0})},200)},r.endLoading=function(e,t,n){r.setState({isLoading:!1,showLoadingItem:!1,path:e,folders:t,focusIndex:n,isFirstLoad:!1})},r.handleBreadcrumbClick=function(e){var t=e.path,n=r.props,s=n.apiClient,o=n.user,i=n.forceRootSelectable,l=n.onError,d=r.state,u=d.folders,p=d.path,_=d.isFirstLoad,h=r.getFolderIndex(u,p),m=r.normalizePath(t);r.startLoading(),r.setState({loadingPath:m});var f=m!==a.parent_dir(p)||h===c.INVALID_FOCUS_INDEX;if("/"===m)r.changeFolder(m,f,c.INVALID_FOCUS_INDEX,i);else{var E=r.data.selectable.get(m);void 0!==E?r.changeFolder(m,f,c.INVALID_FOCUS_INDEX,!!E):s.getFolderContents(o.id,a.parent_dir(m)).then(function(e){r.state.loadingPath===m&&e.forEach(function(t){var n=r.getAllowSelect(t);r.data.selectable.set(t.path,n),t.path===m&&(_&&!t.has_subdirs&&(r.setState({folders:e,isFirstLoad:!1}),f=!1),r.changeFolder(m,f,c.INVALID_FOCUS_INDEX,n))})}).catch(l)}},r.getUrlForBreadcrumb=function(){return"#"},r.renderLoadingMessage=function(){return o.createElement("div",{className:"folder_picker-loading"},o.createElement("span",{className:"folder_picker-view__loading-label"},_._("Loading your foldersâ€¦")))},r.setViewRef=function(e){null!==e&&(r.view=e.getElementsByClassName("folder_picker-view").item(0))},r.getAccessLevel=function(e){return e.icon.endsWith(c.ACCESS_LEVEL.NO_ACCESS)?c.ACCESS_LEVEL.NO_ACCESS:e.icon.endsWith(c.ACCESS_LEVEL.LIMITED_ACCESS)||e.read_only?c.ACCESS_LEVEL.LIMITED_ACCESS:c.ACCESS_LEVEL.ACCESS},r.getAllowAccess=function(e){var t=r.getAccessLevel(e);return t===c.ACCESS_LEVEL.ACCESS||t===c.ACCESS_LEVEL.LIMITED_ACCESS&&(r.props.allowReadonly||e.has_subdirs)},r.getAllowSelect=function(e){var t=r.getAccessLevel(e);return t===c.ACCESS_LEVEL.ACCESS||r.props.allowReadonly&&t===c.ACCESS_LEVEL.LIMITED_ACCESS},r.data={selectable:new Map,subFolders:new Map},r.state={folders:[],focusIndex:c.INVALID_FOCUS_INDEX,isFirstLoad:!0,isLoading:!1,path:t.initialFolderSelection,loadingPath:t.initialFolderSelection,showLoadingItem:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.setupKeyboardShortcuts(),this.handleBreadcrumbClick({path:this.props.initialFolderSelection})},t.prototype.componentDidUpdate=function(){this.scrollToFocused()},t.prototype.componentWillUnmount=function(){this.cleanupKeyboardShortcuts()},t.prototype.cleanupKeyboardShortcuts=function(){s.clearScope(c.KEY_SCOPE),y&&s.setScope(y),s.resetFilter()},t.prototype.setupKeyboardShortcuts=function(){y=s.getScope(),y!==c.KEY_SCOPE&&s.setScope(c.KEY_SCOPE),s("up",c.KEY_SCOPE,this.handleSelectPrevious),s("down",c.KEY_SCOPE,this.handleSelectNext),s("left",c.KEY_SCOPE,this.handleSelectParent),s("right",c.KEY_SCOPE,this.handleSelectCurrentFolder),s("enter",c.KEY_SCOPE,this.handleSelect)},t.prototype.selectNeighboringItem=function(e){var t=this.state,r=t.folders,n=t.focusIndex,s=r.length,o=n;e===u.SelectDirection.PREV&&n===c.INVALID_FOCUS_INDEX&&o++;for(var i=0;i<s;i++){e===u.SelectDirection.PREV?o=(o+s-1)%s:e===u.SelectDirection.NEXT&&(o=(o+1)%s);if(this.getAllowAccess(r[o]))return void this.setState({focusIndex:o})}},t.prototype.scrollToFocused=function(){if(this.view){var e=this.view.getElementsByClassName("focused").item(0);if(e){var t=e.getBoundingClientRect().top,r=e.getBoundingClientRect().bottom,n=this.view.getBoundingClientRect().top,s=this.view.getBoundingClientRect().bottom;t<n||t>s?this.view.scrollTop+=t-n:r>s&&(this.view.scrollTop+=r-s)}}},t.prototype.renderTableBody=function(e){var t=this;if(!e)return null;var n=this.state,s=n.focusIndex,i=n.isLoading;return o.createElement(g.TableBody,{className:"folder_picker-view",style:{height:e-c.PATH_BREADCRUMB_HEIGHT}},this.state.showLoadingItem?this.renderLoadingMessage():this.state.folders.map(function(e,n){var a=t.getAllowAccess(e),l=t.getAllowSelect(e),c={folder:e,isFocused:!1,isSelected:t.state.path===e.path&&!i,allowAccess:a,allowSelect:l,onClick:t.onFolderClick,mouseMove:t.mouseMove};return n===s?o.createElement(S,r.__assign({},c,{isFocused:!0,key:e.path,ref:"focused"})):o.createElement(S,r.__assign({},c,{key:e.path}))}))},t.prototype.render=function(){var e=this,t=this.props.treeRootName;return o.createElement(h.Dimensions,{className:"folder_picker-container"},function(r){var n=r.height;return o.createElement("div",{className:"folder_picker",ref:e.setViewRef},o.createElement(g.Table,{columnFlex:[9,1],className:"folder_picker-table"},o.createElement(g.TableHead,null,o.createElement(v.TableHeadCell,{className:"folder_picker__breadcrumbs"},o.createElement(p.PathBreadcrumbs,{firstBreadcrumbName:t,firstBreadcrumbAlt:t,getUrlForPath:e.getUrlForBreadcrumb,setUrl:e.handleBreadcrumbClick,path:e.state.path,size:p.PathBreadcrumbsSize.SMALL}))),e.renderTableBody(n)))})},t.defaultProps={initialFolderSelection:"/"},t})(o.Component);t.FolderPicker=l(I,["/static/css/browse/browse-vflpmcKA1.css","/static/css/react/folder_picker-vfllrGCT2.css"])}),define("modules/clean/react/folder_selector_modal",["require","exports","tslib","external/react","spectrum/button","spectrum/modal","modules/clean/react/modal","modules/clean/react/folder_dialog/api","modules/clean/react/folder_dialog/constants","modules/clean/react/folder_dialog/folder_picker","modules/clean/react/tree_view","modules/clean/viewer","modules/clean/web_timing_logger","modules/core/i18n"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var o=e.call(this,t)||this;return o.onPathSelected=function(e){return o.setState({currentFolderSelection:e})},o.onModalAccept=function(){var e=o.state.currentFolderSelection;e&&o.props.onFolderSelected(e)},o.renderPrimaryActionButton=function(e){var t=o.props.primaryAction,r=o.state.currentFolderSelection;return n.createElement(s.Button,{variant:"primary",onClick:e,disabled:!r},t)},o.closeModal=function(){return i.Modal.close()},o.onError=function(e){o.setState({disconnect:!0})},o.onTry=function(){o.setState({disconnect:!1})},o.renderFolderChooser=function(){var e=o.props,t=e.user,s=e.forceRootSelectable,i=e.showFolderPicker,h=e.initialFolderSelection,m={user:t,onFolderSelected:o.onPathSelected,treeRootName:u.Viewer.get_role_title(t)||_._("Dropbox")};if(i){var f={display:o.state.disconnect?"":"none"},E=n.createElement("div",{className:"error_message-image_container"},n.createElement("img",{src:l.IMAGE_URL,className:"error_message-image",alt:"Error: Disconnect",style:f}));return o.state.disconnect?E:n.createElement("div",{className:"folder_picker-container__fixed-size"},n.createElement(c.FolderPicker,r.__assign({},m,{webTimer:p.get_timer(),initialFolderSelection:h,allowReadonly:!0,onSuccess:function(){o.onModalAccept(),o.closeModal()},forceRootSelectable:!0,apiClient:{getFolderContents:a.getFolderContents},onError:o.onError})),E)}return n.createElement(d.UserFolderTreeView,r.__assign({},m,{is_paired:u.Viewer.get_viewer().is_paired,forceRootSelectable:s}))},o.state={currentFolderSelection:t.initialFolderSelection,disconnect:!1},o}return r.__extends(t,e),t.prototype.render=function(){var e,t=this.props,s=t.secondaryAction,i=t.title,a=t.ariaLabel;return e=this.state.disconnect?r.__assign({},l.errorDialogProps,{onPrimaryAction:this.onTry,onSecondaryAction:this.closeModal}):{primaryAction:this.renderPrimaryActionButton,secondaryAction:s,title:i,ariaLabel:a,onPrimaryAction:this.onModalAccept,onRequestClose:this.closeModal,onSecondaryAction:this.closeModal,open:!0,variant:"regular"},n.createElement(o.UtilityModal,r.__assign({},e),this.renderFolderChooser())},t.show=function(e){i.Modal.showInstance(n.createElement(t,r.__assign({},e)))},t.defaultProps={initialFolderSelection:""},t})(n.Component);t.FolderSelectorModal=h}),define("modules/clean/react/trash/actions",["require","exports","tslib","external/lodash","external/immutable","modules/clean/analytics","modules/clean/react/snackbar","modules/clean/react/trash/api","modules/clean/react/trash/constants","modules/clean/react/trash/selectors","modules/clean/react/trash/utils","modules/constants/ajax_strings","modules/core/notify","modules/core/i18n","modules/clean/js_client_stopwatch","modules/clean/web_timing_logger"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h,m){"use strict";function f(){p.Notify.error(u.PROBLEM_COMPLETING_REQUEST)}function E(e){var t=e.start_ts,r=e.end_ts,n=e.actor_email,s=e.selected_host_ids,o=e.fq_path;return{start_ts:t||0,end_ts:d.determineMaxTs(r),actor_email:n,host_ids:s,fq_path:o}}function g(){var e=this;return h.JSStopwatch.create_stopwatch_if_not_exist("maestro_trash_tracing"),function(t,o){return r.__awaiter(e,void 0,void 0,function(){var e,i,u,g,v,y,S,I,T,b,A,C,w,F,R;return r.__generator(this,function(r){switch(r.label){case 0:if(e=o(),i=e.fetchPhase,u=null,null!=i)return[2];g=e.user_id,v=c.getRootNsId(e),y=e.ns_id,S=y||v,r.label=1;case 1:return r.trys.push([1,7,8,9]),t({type:l.START_FETCH_PHASE1}),I=a.tryPrefetchDeletions(g).catch(function(){return a.fetchDeletionsForNamespace({userId:g,nsId:S,filters:E(e),nsIdToCursor:s.Map()})}),I.then(function(){h.JSStopwatch.recordTrace("received_initial_events",{stopwatchName:"maestro_trash_tracing"})}),T=a.tryPrefetchNamespaceList(g).catch(function(){return a.fetchNamespaceList(g)}),T.then(function(){h.JSStopwatch.recordTrace("received_namespace_list",{stopwatchName:"maestro_trash_tracing"})}),[4,Promise.all([I,T])];case 2:return b=r.sent(),A=b[0],C=b[1],m.log_js_modules_fetched_data_required_for_tti(),t({type:l.COMPLETE_FETCH_PHASE1,deletionEvents:A.events,mountedNamespaces:C,requestedNsIdToCursor:A.ns_id_to_cursor||null}),requestAnimationFrame(function(){u=p.Notify.info(_._("Loading deleted files..."),9999)}),[4,d.nextRAF()];case 3:return r.sent(),w=C.map(function(e){return e.ns_id}),y&&(w=n.without(w,y),w.push(v)),w.length>0?[4,a.fetchDeletionsForNamespaceMulti({userId:g,nsIds:w,filters:E(e),nsIdToCursor:s.Map()})]:[3,5];case 4:return F=r.sent(),t({type:l.COMPLETE_FETCH_PHASE2,deletionEvents:F.events,requestedNsIds:F.ns_ids,requestedNsIdToCursor:F.ns_id_to_cursor||null}),[3,6];case 5:t({type:l.COMPLETE_FETCH_PHASE2,deletionEvents:[],requestedNsIds:[],requestedNsIdToCursor:null}),r.label=6;case 6:return[3,9];case 7:throw R=r.sent(),f(),R;case 8:return p.Notify.current()&&p.Notify.current()===u&&p.Notify.clear(),[7];case 9:return[2]}})})}}function v(e){if(e.isLoadingMore||e.fetchPhase!==l.FetchPhase.PHASE3)return!1;var t=e.ns_id,r=e.events;if(t){if(!r.has(t)||r.get(t).done)return!1}else if(r.every(function(e){return e.done}))return!1;return!0}function y(){var e=this;return function(t,n){return r.__awaiter(e,void 0,void 0,function(){var e,o,i,c,d,u,p;return r.__generator(this,function(r){switch(r.label){case 0:if(e=n(),!v(e))return[2];t({type:l.REQUEST_MORE_DATA}),o=e.ns_id,i=e.events,c=o?[o]:i.filter(function(e){return!e.done}).keySeq().toArray(),d=s.Map(c.map(function(e){return[e,i.has(e)?i.get(e).cursor:l.DELETED_FILES_CURSOR_FETCH_ALL]})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a.fetchDeletionsForNamespaceMulti({userId:e.user_id,nsIds:c,filters:E(e),nsIdToCursor:d})];case 2:return u=r.sent(),t({type:l.RECEIVE_MORE_DATA,deletionEvents:u.events,requestedNsIds:u.ns_ids,requestedNsIdToCursor:u.ns_id_to_cursor||null}),[3,4];case 3:return p=r.sent(),f(),t({type:l.FAIL_REQUESTING_MORE_DATA}),[3,4];case 4:return[2]}})})}}function S(e,t){return{type:l.REMOVE_ROW,ns_id:e,pkey:t}}function I(e){return function(t){t({type:l.SET_NAMESPACE,ns_id:e}),t(y())}}function T(e,t){return{type:l.SET_USER_ID,userId:e,isNonUserRelativeContext:t}}function b(e){return{type:l.TRASH_INIT,data:r.__assign({},e)}}function A(){return function(e,t){var r=t().user_id;a.markRestoreFilesTipAsSeen(r),e({type:l.DISMISS_RESTORE_FILES_TIP})}}function C(e){return function(t){t({type:l.SET_TIMESTAMP,timestamp_ms:e}),t(y())}}function w(e){return function(t){t({type:l.SET_START_TS,ts:e}),t(y())}}function F(e){return function(t){t({type:l.SET_END_TS,ts:e}),t(y())}}function R(e){return function(t,r){t({type:l.SET_ACTOR_USER_EMAIL,user_email:e});var n=r();e&&!n.user_host_details_map.get(e)&&P(e)(t,r),t(y())}}function P(e){return function(t,r){a.getHostDetailsForActor(r().user_id,e).then(function(r){t({type:l.RECEIVE_HOST_DETAILS,host_details:r,email:e})})}}function N(e){return function(t){t({type:l.SET_HOST_IDS,host_ids:e}),t(y())}}function M(e){return function(t){t({type:l.SET_FQ_PATH,folder_path:e}),t(y())}}function D(){return function(e){e({type:l.CLEAR_FILTERS}),e(y())}}function O(e,t,r){return function(n){n({type:l.SET_TRASH_MODAL_DATA,deletedContentInfo:e,deletorInfo:r,permissions:t})}}function L(e,t){var s=this;return function(i,l){return r.__awaiter(s,void 0,void 0,function(){var s,c,d,u,p,_,h,m,f,E,g,v=this;return r.__generator(this,function(y){switch(y.label){case 0:for(s=l().user_id,c={},d=0,u=e;d<u.length;d++)p=u[d],_=c[p.ns_id],c[p.ns_id]=_?_.concat(p.cs_info.sjids_for_display):p.cs_info.sjids_for_display;y.label=1;case 1:return y.trys.push([1,3,,4]),h=void 0,h=t?(function(){return r.__awaiter(v,void 0,void 0,function(){var e,t,o,i,l,d,u,p;return r.__generator(this,function(r){switch(r.label){case 0:return[4,a.fetchDeletionEventDetailsByNsIdSjIdsBatch({userId:s,nsSjIds:c})];case 1:for(e=r.sent(),t={},o=0,i=e;o<i.length;o++)for(l=i[o],d=0,u=l.event_details;d<u.length;d++)p=u[d],t[p.fq_path]=l.has_acl_restore;return[2,{event_details:n.flatten(e.map(function(e){return e.event_details})),has_acl_restore:t}]}})})})():(function(){return r.__awaiter(v,void 0,void 0,function(){var e,t,n,o,i;return r.__generator(this,function(r){switch(r.label){case 0:return[4,a.fetchDeletionEventDetailsByNsIdSjIds({userId:s,nsSjIds:c})];case 1:for(e=r.sent(),t={},n=0,o=e.event_details;n<o.length;n++)i=o[n],t[i.fq_path]=e.has_acl_restore;return[2,{event_details:e.event_details,has_acl_restore:t}]}})})})(),[4,H(s,h,i)];case 2:return y.sent(),[3,4];case 3:return m=y.sent(),f=e.map(function(e){return e.ns_id}),E=e.map(function(e){return e.cs_info.cs_id}),g={requested_ns_ids:f.join(","),requested_cs_ids:E.join(","),requested_ns_id_count:f.length},o.WebMiscActivityLogger.log("trash-fetch-events-details-failure",g,s),[3,4];case 4:return[2]}})})}}function x(e,t){var n=this;return function(s,i){return r.__awaiter(n,void 0,void 0,function(){var n,l,c,d;return r.__generator(this,function(r){switch(r.label){case 0:n=i().user_id,l=t?t.map(function(e){return e.ns_path}):[e.currentNSPath],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,H(n,a.fetchDeletionEventDetailsByPaths({userId:n,nsId:e.currentNSID,nsPaths:l,isAdminConsole:e.isNonUserRelativeContext}),s)];case 2:return r.sent(),[3,4];case 3:return c=r.sent(),d={requested_ns_ids:""+e.currentNSID},o.WebMiscActivityLogger.log("trash-fetch-events-details-failure",d,n),[3,4];case 4:return[2]}})})}}function H(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var e,s,o,i;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,t];case 1:return e=r.sent(),s=e.event_details,o=!(1===s.length&&!s[0].can_display_content),n({type:l.RECEIVE_EVENT_DETAILS,deletionEventDetails:s,canDisplayContent:o,hasAclRestore:e.has_acl_restore}),[3,3];case 2:throw i=r.sent(),p.Notify.error(_._("We were unable to fetch deleted files details.")),n({type:l.FETCH_EVENT_DETAILS_ERROR}),i;case 3:return[2]}})})}function k(e,t){return function(r){r({type:l.SET_PURGE_MODAL_DATA,browseContentInfo:e,deletorInfo:t})}}function U(e,t){var n=this;return function(s,i){return r.__awaiter(n,void 0,void 0,function(){var n,c,d,u;return r.__generator(this,function(r){switch(r.label){case 0:n=i().user_id,c=t?t.map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path}}):null!=e.currentNSPath?[{ns_id:e.currentNSID,ns_path:e.currentNSPath}]:[],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,B(n,a.fetchPurgeModalEventDetailsByPaths({userId:n,nsPaths:c}),s)];case 2:return r.sent(),[3,4];case 3:return d=r.sent(),u={requested_ns_id:e.currentNSID},s({type:l.FETCH_EVENT_DETAILS_ERROR}),o.WebMiscActivityLogger.log("purge-fetch-event-details-failure",u,n),[3,4];case 4:return[2]}})})}}function B(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var e,s;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,t];case 1:return e=r.sent(),n({type:l.RECEIVE_PURGE_EVENT_DETAILS,purgeEventDetails:e}),[3,3];case 2:throw s=r.sent(),p.Notify.error(_._("We were unable to fetch deleted files details.")),n({type:l.FETCH_EVENT_DETAILS_ERROR}),s;case 3:return[2]}})})}function q(e,t){var n=this;return function(s,o){return r.__awaiter(n,void 0,void 0,function(){var n,l,c,d,u,p;return r.__generator(this,function(r){switch(r.label){case 0:if(0===e.length)return[2];if(n=o().user_id,!t)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a.purgeDeletionEventBatch(n,e)];case 2:return r.sent(),[3,4];case 3:throw l=r.sent(),i.Snackbar.fail(_._("There was an error permanently deleting the selected items.")),l;case 4:return[3,8];case 5:return r.trys.push([5,7,,8]),e=[e[0]],[4,a.purgeDeletionEvent(n,e[0])];case 6:return r.sent(),[3,8];case 7:throw c=r.sent(),i.Snackbar.fail(_._("There was an error permanently deleting the selected items.")),c;case 8:for(d=0,u=e;d<u.length;d++)p=u[d],s(S(p.ns_id,p.pkey));return[2]}})})}}function W(e){return{type:l.CREATE_SNACKBAR,state:"restoring",count:e}}function V(){return{type:l.UPDATE_SNACKBAR,state:"done"}}function j(){return{type:l.UPDATE_SNACKBAR,state:"none"}}function K(e){return{type:l.MARK_ROW_AS_RESTORING,pkey:e}}function G(e,t,n){var s=this;return function(o,i){return r.__awaiter(s,void 0,void 0,function(){var s,c,d,u,p,_;return r.__generator(this,function(r){switch(r.label){case 0:return 0===e.length?[2]:(s=i(),c=s.user_id,d=s.fq_path,n?(o(W(e.length)),[4,a.restoreDeletionEventBatch(c,e,d||void 0,t)]):[3,2]);case 1:return r.sent(),[3,4];case 2:return o(W(1)),e=[e[0]],[4,a.restoreDeletionEvent(c,e[0],d||void 0,t)];case 3:r.sent(),r.label=4;case 4:for(u=0,p=e;u<p.length;u++)_=p[u],o(K(_.pkey));return setTimeout(function(){for(var t=0,r=e;t<r.length;t++){var n=r[t];o(S(n.ns_id,n.pkey))}},l.SNACKBAR_TIMEOUT_MS),[2]}})})}}function Y(e){var t=this;return function(n,s){return r.__awaiter(t,void 0,void 0,function(){var t,o,i,c,d,u,p;return r.__generator(this,function(r){switch(r.label){case 0:if(t=s(),o=t.shareClient,i=t.currentModalInfo,!(o&&i&&i.eventDetails&&i.hasAclRestore))return[2];if(c=i.eventDetails.map(function(e){return e.fq_path}),!c||0===c.length)return n({type:l.RECEIVE_MEMBERSHIP,membershipInfo:{membershipByFQPath:{},noAccessPaths:[]}}),[2];d=c.filter(function(e){return i.hasAclRestore&&i.hasAclRestore[e]}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a.fetchMembershipForPaths(o,d,e)];case 2:return u=r.sent(),n({type:l.RECEIVE_MEMBERSHIP,membershipInfo:u}),[3,4];case 3:return p=r.sent(),[2,Promise.resolve()];case 4:return[2]}})})}}function z(e,t){var n=this;return function(s){return r.__awaiter(n,void 0,void 0,function(){return r.__generator(this,function(r){return s(e).then(function(){return s(Y(t))}).then(function(){return s({type:l.FINISH_LOADING_MODAL_DATA})}),[2]})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.initiateFetchPhases=g,t.loadMore=y,t.removeRow=S,t.setNamespace=I,t.setUserId=T,t.initialize=b,t.dismissRestoreFilesTip=A,t.setTimestampMs=C,t.setMinDateTs=w,t.setMaxDateTs=F,t.setActorUserEmail=R,t.loadHostsForActorEmail=P,t.setActorHostIds=N,t.setDeletedContainingFqPath=M,t.clearFilters=D,t.initializeModal=O,t.getEventDetailsFromEvents=L,t.getEventDetailsFromBrowse=x,t.initializePurgeModal=k,t.getPurgeEventDetailsFromBrowse=U,t.purgeByDeletionEvents=q,t.showRestoreSnackbar=W,t.showDoneSnackbar=V,t.hideSnackbar=j,t.markRowAsRestoring=K,t.restoreByDeletionEvents=G,t.fetchMembership=Y,t.loadModalData=z}),define("modules/clean/react/trash/api",["require","exports","tslib","external/immutable","modules/clean/ajax_as_promised","modules/clean/react/trash/client","modules/clean/analytics","modules/clean/sharing/api/util/types","modules/clean/sharing/ui_util","modules/core/i18n","modules/core/notify"],function(e,t,r,n,s,o,i,a,l,c,d){"use strict";function u(e,t,n){return void 0===n&&(n={}),function(s){"abort"!==s.jqXHR.statusText&&i.WebMiscActivityLogger.log(t,r.__assign({},n,{is_prefetch:!1}),e)}}function p(e,t,n){return void 0===n&&(n={}),function(){return i.WebMiscActivityLogger.log(t,r.__assign({},n,{is_prefetch:!0}),e)}}function _(e,t,r){void 0===r&&(r={}),i.WebMiscActivityLogger.log(t,r,e)}function h(e){var t=window.__REGISTER_TRASH_PRELOAD_HANDLER;if(t){var r=new Promise(function(e,r){t(function(t){try{e(JSON.parse(t))}catch(e){r()}},r)});return r.catch(p(e,"trash-fetch-deletions-failure",{requested_ns_count:1})),r}return Promise.reject(null)}function m(e,t){return t.namespaces.map(function(t){return{name:t.name,user_id:e,ns_id:t.nsId}})}function f(e){var t=window.__REGISTER_TRASH_NS_LIST_PRELOAD_HANDLER;if(t){var r=new Promise(function(r,n){t(function(t){try{r(m(e,JSON.parse(t)))}catch(e){n()}},n)});return r.catch(p(e,"trash-fetch-ns-list-failure")),r}return Promise.reject(null)}function E(e){var t=s.BackgroundRequest({type:"GET",url:"/trash/namespace_list",subject_user:e,dataType:"json"});return t.catch(u(e,"trash-fetch-ns-list-failure")),t.then(function(t){return m(e,t)})}function g(e){return v({userId:e.userId,nsIds:[e.nsId],filters:e.filters,nsIdToCursor:e.nsIdToCursor})}function v(e){var t={ns_ids:e.nsIds.join(","),ns_id_to_cursor:JSON.stringify(e.nsIdToCursor)};t.start_ts=e.filters.start_ts,t.end_ts=e.filters.end_ts,t.actor_email=e.filters.actor_email,t.host_ids=e.filters.host_ids?e.filters.host_ids.join(","):null,t.fq_path=e.filters.fq_path;var r=s.BackgroundRequest({type:"POST",url:"/deleted_files_with_mixed_cs/ajax",subject_user:e.userId,dataType:"json",data:t});return r.catch(u(e.userId,"trash-fetch-deletions-failure",{requested_ns_count:e.nsIds.length})),r}function y(e){return s.SilentBackgroundRequest({url:"/trash/seen_restore_files_tip",subject_user:e})}function S(e){return r.__awaiter(this,void 0,void 0,function(){var t,n;return r.__generator(this,function(r){switch(r.label){case 0:return t=Object.keys(e.nsSjIds)[0],n={_subject_uid:e.userId,ns_id:Number(t),sjids:e.nsSjIds[Number(t)].join(",")},[4,s.BackgroundRequest({type:"POST",url:"/trash_details/ajax_by_sjids",dataType:"json",data:n})];case 1:return[2,r.sent()]}})})}function I(e){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(r){switch(r.label){case 0:return t={_subject_uid:e.userId,ns_sj_ids:JSON.stringify(e.nsSjIds)},[4,s.BackgroundRequest({type:"POST",url:"/trash_details/ajax_by_sjids_batch",dataType:"json",data:t})];case 1:return[2,r.sent()]}})})}function T(e){for(var t={},r=0,n=e.event_details;r<n.length;r++){t[n[r].fq_path]=e.has_acl_restore}return{event_details:e.event_details,has_acl_restore:t}}function b(e){return r.__awaiter(this,void 0,void 0,function(){var t,n;return r.__generator(this,function(r){switch(r.label){case 0:return t={_subject_uid:e.userId,ns_id:e.nsId,ns_paths:e.nsPaths,recursive:!0,admin_console:e.isAdminConsole||!1},[4,s.BackgroundRequest({type:"POST",url:"/trash_details/ajax_by_path",dataType:"json",data:t})];case 1:return n=r.sent(),[2,T(n)]}})})}function A(e){return r.__awaiter(this,void 0,void 0,function(){var t,n;return r.__generator(this,function(r){switch(r.label){case 0:return t=new o.RestoreClient(e.userId),[4,t.getPurgeDetailsByPath(e.userId,e.nsPaths)];case 1:return n=r.sent(),[2,n.ns_details]}})})}function C(e,t,n,s){return r.__awaiter(this,void 0,void 0,function(){var i,a,l,u;return r.__generator(this,function(r){switch(r.label){case 0:return i=t.ns_id,a=t.cs_info.cs_id,l=new o.RestoreClient(e),[4,l.restoreTrueDeletion(i,a,n,s)];case 1:return u=r.sent(),"async_job_id"!==u[".tag"]?[3,3]:[4,l.pollAsyncRestoreStatus(u.async_job_id)];case 2:r.sent(),r.label=3;case 3:return d.Notify.success(c._("Files restored successfully.")),[2]}})})}function w(e,t,n,s){return r.__awaiter(this,void 0,void 0,function(){var i,a,l,c,d,u;return r.__generator(this,function(r){switch(r.label){case 0:for(i=[],a=0,l=t;a<l.length;a++)c=l[a],i.push({ns_id:c.ns_id,cs_id:c.cs_info.cs_id});return d=new o.RestoreClient(e),[4,d.restoreTrueDeletionBatch(i,n,s)];case 1:return u=r.sent(),"async_job_id"!==u[".tag"]?[3,3]:[4,d.pollAsyncRestoreStatus(u.async_job_id)];case 2:r.sent(),r.label=3;case 3:return[2]}})})}function F(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o,i;return r.__generator(this,function(r){switch(r.label){case 0:return n="/cmd/purge_changeset",o={ns_to_cs:JSON.stringify((i={},i[t.ns_id]=t.cs_info.cs_id,i))},[4,s.WebProgressRequest({url:n,data:o,subject_user:e,progress_text:c._("Deleting files permanently...")}).then(function(){d.Notify.success(c._("Finished permanently deleting files."))})];case 1:return[2,r.sent()]}})})}function R(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o,i,a,l;return r.__generator(this,function(r){switch(r.label){case 0:for(o={},i=0,a=t;i<a.length;i++)l=a[i],o[l.ns_id]=(o[l.ns_id]||[]).concat(l.cs_info.cs_id);return n={ns_to_cs:JSON.stringify(o)},[4,s.WebProgressRequest({url:"/cmd/purge_changeset",data:n,subject_user:e,progress_text:c._("Deleting files permanently...")}).then(function(){d.Notify.success(c._("Finished permanently deleting files."))})];case 1:return[2,r.sent()]}})})}function P(e,t,s){return r.__awaiter(this,void 0,void 0,function(){var o,i,c,d,u,p,_,h,m;return r.__generator(this,function(r){switch(r.label){case 0:return 0===t.length?[2,{membershipByFQPath:{},noAccessPaths:[]
}]:s?[4,e.ns("sharing").rpc("preview_restored_acl/batch_nsids",{entries:t},{subjectUserId:e.userId})]:[3,2];case 1:return o=r.sent(),[3,4];case 2:return[4,e.ns("sharing").rpc("preview_restored_acl/batch",{entries:t},{subjectUserId:e.userId})];case 3:o=r.sent(),r.label=4;case 4:for(i={},c=[],d=0,u=o.entries;d<u.length;d++)p=u[d],_=p.result,"path_error"===_[".tag"]&&"no_access"===_.path_error[".tag"]&&c.push(p.path),"shared_folder"===_[".tag"]&&(i[p.path]=a.membershipApiToRecord(_.members));return[4,e._addAccountsToMembershipBatch(n.Map(i))];case 5:return h=r.sent(),m={},h.forEach(function(e,t){m[t]={groups:e.groups.valueSeq().map(l.apiGroupMemberToAvatarInfo).toArray(),invitees:e.invitees.valueSeq().map(l.apiInviteeMemberToAvatarInfo).toArray(),users:e.users.valueSeq().map(l.apiUserMemberToAvatarInfo).toArray()}}),[2,{membershipByFQPath:m,noAccessPaths:c}]}})})}function N(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,s.BackgroundRequest({url:"/account/get_connected_devices_for_team_member",subject_user:e,data:{user_email:t},dataType:"json"})];case 1:return n=r.sent(),"ok"===n.status?[2,n.hosts]:[3,3];case 2:return o=r.sent(),[3,3];case 3:return[2,{}]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.logPurgeModalActivity=_,t.tryPrefetchDeletions=h,t.tryPrefetchNamespaceList=f,t.fetchNamespaceList=E,t.fetchDeletionsForNamespace=g,t.fetchDeletionsForNamespaceMulti=v,t.markRestoreFilesTipAsSeen=y,t.fetchDeletionEventDetailsByNsIdSjIds=S,t.fetchDeletionEventDetailsByNsIdSjIdsBatch=I,t.fetchDeletionEventDetailsByPaths=b,t.fetchPurgeModalEventDetailsByPaths=A,t.restoreDeletionEvent=C,t.restoreDeletionEventBatch=w,t.purgeDeletionEvent=F,t.purgeDeletionEventBatch=R,t.fetchMembershipForPaths=P,t.getHostDetailsForActor=N}),define("modules/clean/react/trash/client",["require","exports","modules/clean/api_v2/root_aware_client"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){this.client=new r.UserActionsRootAwareClient,this.userId=e}return e.prototype.restoreTrueDeletion=function(e,t,r,n){return this.client.ns("restorations").rpc("changeset/restore_true_deletions",{ns_id:e,cs_id:t,path:r,initiation_location:n},{subjectUserId:this.userId})},e.prototype.restoreTrueDeletionBatch=function(e,t,r){return this.client.ns("restorations").rpc("changeset/restore_true_deletions_batch",{ns_cs_ids:e,path:t,initiation_location:r},{subjectUserId:this.userId})},e.prototype.getPurgeDetailsByPath=function(e,t){return this.client.ns("restorations").rpc("purge/get_details_by_path",{ns_paths:t},{subjectUserId:this.userId})},e.prototype.pollAsyncRestoreStatus=function(e){var t=Date.now()+3e5,r=this.client,n=this.userId,s=function(o,i){return Date.now()>t?i("timeout"):r.ns("restorations").rpc("changeset/restore_true_deletions/job_status/check",{async_job_id:e},{subjectUserId:n}).then(function(e){switch(e[".tag"]){case"complete":return o(e);case"in_progress":return window.setTimeout(s,1e3,o,i)}}).catch(function(e){return i(e)})};return new Promise(s)},e})();t.RestoreClient=n}),define("modules/clean/react/trash/constants",["require","exports","modules/core/i18n"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_DAY_MS=864e5;(function(e){e[e.PHASE1=1]="PHASE1",e[e.PHASE2=2]="PHASE2",e[e.PHASE3=3]="PHASE3"})(t.FetchPhase||(t.FetchPhase={})),t.MAX_FILE_COUNT_TO_DISPLAY=100,t.MODAL_ITEM_ROW_HEIGHT=64,t.ACL_RESTORE_MODAL_ROW_HEIGHT=72,t.MODAL_MAX_SHOWN_AVATARS=5,t.TRASH_VIEW_COLUMN_MULTISELECT_FLEX=["0 0 36px",3,2],t.TRASH_VIEW_COLUMN_FLEX=[3,2],t.DELETED_FILES_CURSOR_FETCH_ALL=0,t.DELETED_FILES_CURSOR_DONE=-1,t.SNACKBAR_TIMEOUT_MS=3e3,t.START_FETCH_PHASE1="START_FETCH_PHASE1",t.COMPLETE_FETCH_PHASE1="COMPLETE_FETCH_PHASE1",t.COMPLETE_FETCH_PHASE2="COMPLETE_FETCH_PHASE2",t.REQUEST_MORE_DATA="REQUEST_MORE_DATA",t.RECEIVE_MORE_DATA="RECEIVE_MORE_DATA",t.FAIL_REQUESTING_MORE_DATA="FAIL_REQUESTING_MORE_DATA",t.SET_NAMESPACE="SET_NAMESPACE",t.SET_TIMESTAMP="SET_TIMESTAMP",t.SET_START_TS="SET_START_TS",t.SET_END_TS="SET_END_TS",t.SET_ACTOR_USER_EMAIL="SET_ACTOR_USER_EMAIL",t.RECEIVE_HOST_DETAILS="RECEIVE_HOST_DETAILS",t.SET_HOST_IDS="SET_HOST_IDS",t.SET_FQ_PATH="SET_FQ_PATH",t.CLEAR_FILTERS="CLEAR_FILTERS",t.TRASH_INIT="TRASH_INIT",t.REMOVE_ROW="REMOVE_ROW",t.MARK_ROW_AS_RESTORING="MARK_ROW_AS_RESTORING",t.DISMISS_RESTORE_FILES_TIP="DISMISS_RESTORE_FILES_TIP",t.SET_USER_ID="SET_USER_ID",t.UPDATE_SNACKBAR="UPDATE_SNACKBAR",t.CREATE_SNACKBAR="CREATE_SNACKBAR",t.SET_TRASH_MODAL_DATA="SET_TRASH_MODAL_DATA",t.RECEIVE_EVENT_DETAILS="RECEIVE_EVENT_DETAILS",t.FETCH_EVENT_DETAILS_ERROR="FETCH_EVENT_DETAILS_ERROR",t.RECEIVE_MEMBERSHIP="RECEIVE_MEMBERSHIP",t.FINISH_LOADING_MODAL_DATA="FINISH_LOADING_MODAL_DATA",t.RECEIVE_PURGE_EVENT_DETAILS="RECEIVE_PURGE_EVENT_DETAILS",t.SET_PURGE_MODAL_DATA="SET_PURGE_MODAL_DATA",t.PURGE_HELP_PAGE_LINK="https://www.dropbox.com/help/desktop-web/delete-files#permanent_delete",t.PERSONAL_ITEMS="personal_items",t.SHARED_FOLDERS_OWNED="shared_folders_owned",t.ITEMS_OWNED_WITHIN_SHARED="items_owned_within_shared_folders",t.SHARED_FOLDERS_WITH_ACCESS="shared_folders_with_access",t.ITEMS_NOT_OWNED_WITHIN_SHARED="items_not_owned_within_shared_folders",t.SHARED_FOLDERS_WITHOUT_ACCESS="shared_folders_without_access",t.OFF_TEAM="off_team",t.MEMBER="member",t.ADMIN="admin",t.NON_TEAM="non_team";(function(e){e.NONE="none",e.SOME="some",e.ALL="all"})(t.EventViewState||(t.EventViewState={})),t.BODY_BANNER="body_banner",t.SELECTABLE_LIST_TILES_PER_ROW=1,t.descriptionGenerator={personal_items:{one:r._("<strong>%(filename)s</strong> will be gone forever and you       wonâ€™t be able to restore it. Permanently deleting items       wonâ€™t free up space."),moreThanOne:function(e){return r.ungettext("<strong>%(filename)s</strong> and %(count)s more item will be gone forever and you       wonâ€™t be able to restore them. Permanently deleting these items       wonâ€™t free up space.","<strong>%(filename)s</strong> and %(count)s more items will be gone forever and you       wonâ€™t be able to restore them. Permanently deleting these items       wonâ€™t free up space.",e)}},shared_folders_owned:{one:r._("<strong>%(filename)s</strong> will be gone forever for       everyone, including for anyone still using the shared folder. Permanently       deleting folders wonâ€™t free up space."),moreThanOne:function(e){return r.ungettext("<strong>%(filename)s</strong> and %(count)s more item will be gone forever for       everyone, including for anyone still using the shared folders. Permanently       deleting folders wonâ€™t free up space.","<strong>%(filename)s</strong> and %(count)s more items will be gone forever for       everyone, including for anyone still using the shared folders. Permanently       deleting folders wonâ€™t free up space.",e)}},items_owned_within_shared_folders:{one:r._("<strong>%(filename)s</strong> will be gone forever for       everyone, including for anyone still using the file. Permanently deleting       items wonâ€™t free up space."),oneFolder:r._("<strong>%(filename)s</strong> will be gone forever for       everyone, including for anyone still using the folder. Permanently       deleting this folder wonâ€™t free up space."),moreThanOne:function(e){return r.ungettext("<strong>%(filename)s</strong> and %(count)s more item will be gone forever for       everyone, including for anyone still using the items. Permanently deleting       items wonâ€™t free up space.","<strong>%(filename)s</strong> and %(count)s more items will be gone forever for       everyone, including for anyone still using the items. Permanently deleting       items wonâ€™t free up space.",e)}},shared_folders_with_access:{one:r._("<strong>%(filename)s</strong> is shared with       you, but youâ€™re not the owner. Itâ€™ll be removed from your account, but not       deleted for anyone else. Removing your access wonâ€™t free up space."),moreThanOne:function(e){return r.ungettext("<strong>%(filename)s</strong> and %(count)s more item is shared with       you, but youâ€™re not the owner. Theyâ€™ll be removed from your account, but not       deleted for anyone else. Removing your access wonâ€™t free up space.","<strong>%(filename)s</strong> and %(count)s more items are shared with       you, but youâ€™re not the owner. Theyâ€™ll be removed from your account, but not       deleted for anyone else. Removing your access wonâ€™t free up space.",e)}},body_banner:{one:r._("<strong>%(filename)s</strong> will be gone forever and you       canâ€™t undo this action. Keep in mind that permanently deleting this wonâ€™t       free up space. <a>Learn more</a>"),moreThanOne:function(e){return r.ungettext("<strong>%(filename)s</strong> and %(count)s more item will be gone forever and you       canâ€™t undo this action. Keep in mind that permanently deleting these items wonâ€™t       free up space. <a>Learn more</a>","<strong>%(filename)s</strong> and %(count)s more items will be gone forever and you       canâ€™t undo this action. Keep in mind that permanently deleting these items wonâ€™t       free up space. <a>Learn more</a>",e)}},shared_folders_without_access:{one:r._("You no longer have access to <strong>%(filename)s</strong>.       You canâ€™t make any changes to it, but you can hide it from your view. Hiding       folders wonâ€™t free up space."),moreThanOne:function(e){return r.ungettext("You no longer have access to <strong>%(filename)s</strong>. and %(count)s more item.       You canâ€™t make any changes to it, but you can hide it from your view. Hiding       folders wonâ€™t free up space.","You no longer have access to <strong>%(filename)s</strong>. and %(count)s more items.       You canâ€™t make any changes to it, but you can hide it from your view. Hiding       folders wonâ€™t free up space.",e)}}}}),define("modules/clean/react/trash/purge_modal",["require","exports","tslib","external/react","external/react-redux","spectrum/modal","modules/clean/em_string","modules/clean/react/css","modules/clean/react_format","modules/clean/react/modal","modules/clean/react/trash/constants","modules/clean/react/trash/store","modules/core/i18n","modules/clean/react/trash/api","modules/clean/components/loading_indicator"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h){"use strict";function m(e){return d.descriptionGenerator[e]}function f(e){var t=e.currentModalInfo,r=t.deletedContentInfo,n=t.error,s=t.readyToDisplayContent,o=0;if(void 0!==r.ns_info)for(var i=0,a=r.ns_info;i<a.length;i++){var l=a[i];o+=l.fileCount}else o=r.fileCount;return{error:n,totalFileCount:o,fileName:r.fileName,fqPaths:r.fqPaths,referenceFileName:r.referenceFileName,readyToDisplayContent:s,userId:e.user_id,namespacesInfo:void 0!==r.ns_info?r.ns_info:[]}}function E(e){c.Modal.showInstance(n.createElement(t.PurgeModal,r.__assign({},e)))}function g(e,t,r,n,s){var o=n!==d.NON_TEAM,i=r+t>0;return o?!i&&s:s}Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return n.createElement("fieldset",{id:"form-entry",className:"purge-info-form-entry"},n.createElement("div",{id:"entry-title",className:"purge-info-form-entry__title"},this.props.title),n.createElement("div",{id:"entry-description",className:"purge-info-form-entry__description"},this.props.description))},t.displayName="PurgeInfoEntry",t})(n.Component),y=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return n.createElement("fieldset",{id:"simple-modal-content"},n.createElement("div",{id:"simple-modal-content"},this.props.description))},t.displayName="SimplePurgeInfo",t})(n.Component),S=a(v,["/static/css/trash-vfljooVx9.css"]),I=a(y,["/static/css/modal-vflI292PU.css"]),T=(function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.state={isModalOpen:!0},r.onRequestClose=function(){r.props.error&&_.logPurgeModalActivity(r.props.userId,"purge-modal-error"),r.setState({isModalOpen:!1})},r.onPrimary=function(){var e=r.getTabsWithPolicyInfo(),t=[];if(e.forEach(function(e,r){t=t.concat(e)}),void 0!==r.props.onPurge){r.props.onPurge();var n={policies:t.join(",")};_.logPurgeModalActivity(r.props.userId,"purge-modal-do-action",n)}},r._render_body_banner=function(){var e=r.props,s=e.referenceFileName,o=e.totalFileCount,i=r.isOneFolder();return n.createElement(I,{description:l.reactFormat(t.getDescription(d.BODY_BANNER,s,o,i),{a:n.createElement("a",{href:d.PURGE_HELP_PAGE_LINK,target:"_blank",rel:"noopener noreferrer"}),strong:n.createElement("strong",null)})})},r._renderListHeader=function(){return n.createElement(S,{title:t.getStrong(p._("You selected")),description:t.getStrong(p._("What will happen"))})},r._renderPolicyListEntry=function(e,r){var s=t.getPolicyInfo(e,r);return n.createElement(S,s)},r._renderPolicy=function(e){var t=r.getSimpleDescription(e);return n.createElement(I,t)},r.helpLinkCreator=function(){return n.createElement("span",null,l.reactFormat(p._("<a>Learn more</a>"),{a:n.createElement("a",{href:d.PURGE_HELP_PAGE_LINK,target:"_blank",rel:"noopener noreferrer"})}))},r}return r.__extends(t,e),t.renderError=function(){return n.createElement("div",{id:"modal-error-state"},n.createElement("h3",null,p._("Oops! An error occurred. Please try again later!")))},t.renderLoader=function(){return n.createElement("div",{id:"purge-modal-loading"},n.createElement(h.LoadingIndicator,{style:h.LoadingIndicator.LoadingIndicatorStyle.BLUE_SPINNER}))},t.prototype.renderDisabled=function(e){var t=this.props,r=t.referenceFileName,s=t.totalFileCount;switch(e.userType){case d.ADMIN:return n.createElement("div",null,l.reactFormat(p.ungettext("You can permanently delete %(filename)s only in the <a>admin console</a>.","You can permanently delete these items only in the <a>admin console</a>.",s).format({filename:r}),{a:n.createElement("a",{href:"/team/admin/content/home",target:"_blank",rel:"noopener noreferrer"})}));case d.MEMBER:return n.createElement("div",null,p.ungettext("Only an admin can permanently delete %(filename)s.","Only an admin can permanently delete these items.",s).format({filename:r}));default:return n.createElement("div",null,p.ungettext("You do not have permission to permanently delete %(filename)s.","You do not have permission to permanently delete these items.",s).format({filename:r}))}},t.getNonOwnedDesc=function(e){switch(e){case d.ADMIN:return l.reactFormat(p._("Nothing, they wonâ€™t be deleted forever or hidden. You can         permanently delete them in the <a>admin console</a>"),{a:n.createElement("a",{href:"/team/admin/content/home",target:"_blank",rel:"noopener noreferrer"})});case d.MEMBER:return l.reactFormat(p._("Nothing, they wonâ€™t be deleted forever or hidden. Only an admin           can permanently delete these items."));case d.OFF_TEAM:case d.NON_TEAM:default:return l.reactFormat(p._("Nothing, they wonâ€™t be deleted forever or hidden. Only the owner           can permanently delete these items."))}},t.getStrong=function(e){return l.reactFormat(p._("<strong>%(description)s</strong>"),{description:e,strong:n.createElement("strong",null)})},t.getPolicyInfo=function(e,r){var n=r.userType;switch(e){case d.PERSONAL_ITEMS:return{title:l.reactFormat(p._("Items only you can access")),description:l.reactFormat(p._("Deleted forever."))};case d.SHARED_FOLDERS_OWNED:return{title:l.reactFormat(p._("Shared folders you own")),description:l.reactFormat(p._("Deleted forever for everyone, including for anyone             still using them."))};case d.ITEMS_OWNED_WITHIN_SHARED:return{title:l.reactFormat(p._("Items you added to a shared folder")),description:l.reactFormat(p._("Deleted forever for everyone, including for anyone             still using them."))};case d.SHARED_FOLDERS_WITH_ACCESS:return{title:l.reactFormat(p._("Shared folders you donâ€™t own")),description:l.reactFormat(p._("Your access will be removed, but they wonâ€™t be             deleted for anyone else"))};case d.ITEMS_NOT_OWNED_WITHIN_SHARED:return{title:l.reactFormat(p._("Items you donâ€™t own in a shared folder")),description:t.getNonOwnedDesc(n)};case d.SHARED_FOLDERS_WITHOUT_ACCESS:return{title:l.reactFormat(p._("Shared folders you can no longer access")),description:l.reactFormat(p._("Hidden forever for you, but not deleted for anyone else."))};default:throw new Error("tabName not found"+e)}},t.prototype.isOneFolder=function(){var e=this.props.namespacesInfo;return 1===e.length&&e[0].isOneCompleteFolder},t.prototype.getSimpleDescription=function(e){var r=this.props,s=r.totalFileCount,o=r.referenceFileName,i=this.isOneFolder();if(e!==d.ITEMS_NOT_OWNED_WITHIN_SHARED){var a=t.getDescription(e,o,s,i);return{description:l.reactFormat(a,{strong:n.createElement("strong",null)})}}throw new Error("description not available")},t.getDescription=function(e,t,r,n){var s=m(e);if(void 0===s)throw new Error("description not defined");if(r>1&&!n){var o=r-1;return s.moreThanOne(o).format({filename:i.Emstring.em_snippet(t,30).toString(),count:o})}return(s.oneFolder&&n?s.oneFolder:s.one).format({filename:i.Emstring.em_snippet(t,30).toString()})},t.prototype.getPolicyValidator=function(e){return this.getPolicyValidatorForNsInfo(e,this.props.namespacesInfo[0])},t.prototype.getPolicyValidatorForNsInfo=function(e,t){switch(e){case d.PERSONAL_ITEMS:return function(){var e=t.fileCount,r=t.sfWithAccessCount,n=t.sfWithoutAccessCount,s=t.ownedSfCount,o=t.isHomeNsId;return e>r+n+s&&o};case d.SHARED_FOLDERS_OWNED:return function(){return t.ownedSfCount>0};case d.ITEMS_OWNED_WITHIN_SHARED:return function(){var e=t.fileCount,r=t.sfWithAccessCount,n=t.sfWithoutAccessCount,s=t.ownedSfCount,o=t.isUserOwnedNs,i=t.canPurge,a=t.userType,l=t.isHomeNsId,c=a===d.ADMIN||a===d.MEMBER;return e>r+n+s&&!l&&(c&&i||!c&&(o||i))};case d.SHARED_FOLDERS_WITH_ACCESS:return function(){return t.sfWithAccessCount>0};case d.ITEMS_NOT_OWNED_WITHIN_SHARED:return function(){var e=t.fileCount,r=t.sfWithAccessCount,n=t.sfWithoutAccessCount,s=t.ownedSfCount,o=t.isUserOwnedNs,i=t.userType,a=t.canPurge,l=e>r+n+s,c=i===d.ADMIN||i===d.MEMBER;return l&&(c&&!a||!c&&!o&&!a)};case d.SHARED_FOLDERS_WITHOUT_ACCESS:return function(){return t.sfWithoutAccessCount>0};default:throw new Error("policy not found")}},t.prototype.getTabsWithPolicyInfo=function(){var e=this,t=[d.PERSONAL_ITEMS,d.SHARED_FOLDERS_OWNED,d.ITEMS_OWNED_WITHIN_SHARED,d.SHARED_FOLDERS_WITH_ACCESS,d.ITEMS_NOT_OWNED_WITHIN_SHARED,d.SHARED_FOLDERS_WITHOUT_ACCESS],r=this.props.namespacesInfo,n=new Map;if(void 0===r)return n;for(var s=function(r){var s=t.filter(function(t){return e.getPolicyValidatorForNsInfo(t,r)()});s.length>0&&n.set(r,s)},o=0,i=r;o<i.length;o++){s(i[o])}return n},t.prototype.renderPolicies=function(e){var r=this,s=t.getUniquePolicies(e);if(1===s.length)return n.createElement("div",null,this._renderPolicy(s[0]));var o=[this._render_body_banner(),this._renderListHeader()];return t.getPoliciesWithNamespaceInfo(e).forEach(function(e,t){o.push(r._renderPolicyListEntry(t,e))}),n.createElement("div",null,o)},t.getPoliciesWithNamespaceInfo=function(e){var t=new Map;return e.forEach(function(e,r){for(var n=0,s=e;n<s.length;n++){var o=s[n];t.has(o)||t.set(o,r)}}),t},t.getUniquePolicies=function(e){var t=[];return e.forEach(function(e,r){e.forEach(function(e){t.indexOf(e)===-1&&t.push(e)})}),t},t.prototype.getTitle=function(){var e=this.props.totalFileCount,t=this.isOneFolder()?1:e;return p.ungettext("Permanently delete %(num)s item?","Permanently delete %(num)s items?",t).format({num:t})},t.getPrimaryAction=function(e){if(void 0===e||1!==e.length)return p._("Permanently delete");switch(e[0]){case d.PERSONAL_ITEMS:case d.SHARED_FOLDERS_OWNED:case d.ITEMS_OWNED_WITHIN_SHARED:return p._("Permanently delete");case d.SHARED_FOLDERS_WITH_ACCESS:return p._("Remove my access");case d.ITEMS_NOT_OWNED_WITHIN_SHARED:return p._("Ok");case d.SHARED_FOLDERS_WITHOUT_ACCESS:return p._("Hide folders");default:throw new Error("policy not found")}},t.is_purge_disallowed=function(e){return 1===e.length&&e[0]===d.ITEMS_NOT_OWNED_WITHIN_SHARED},t.prototype.getModalContent=function(e,t){return void 0!==t?this.renderDisabled(t):this.renderPolicies(e)},t.prototype.render=function(){var e,r=this.props,s=r.readyToDisplayContent,i=r.namespacesInfo,a=null,l=void 0,c=t.getPrimaryAction(),d=function(){};if(this.props.error)a=t.renderError(),c=p._("Ok");else if(s){for(var u=0,_=i;u<_.length;u++){var h=_[u];if(!g(h.isHomeNsId,h.sfWithAccessCount,h.sfWithoutAccessCount,h.userType,h.canPurge)){e=h;break}}var m=this.getTabsWithPolicyInfo(),f=t.getUniquePolicies(m);l=1===f.length?this.helpLinkCreator:void 0,a=this.getModalContent(m,e),c=void 0===e?t.getPrimaryAction(f):p._("Ok"),d=void 0!==e||t.is_purge_disallowed(f)?function(){}:this.onPrimary}else a=t.renderLoader();var E=this.getTitle();return n.createElement(o.UtilityModal,{displayCloseButton:!0,overlayClickClose:!0,className:"purge-modal",primaryAction:c,secondaryAction:p._("Cancel"),ariaLabel:c,onPrimaryAction:d,onSecondaryAction:this.onRequestClose,link:l,title:E,overlayClassName:"purge-modal--overlay",onRequestClose:this.onRequestClose,open:this.state.isModalOpen},a)},t})(n.Component);t.InternalPurgeModal=T;var b=s.connect(f)(T),A=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return n.createElement(s.Provider,{store:u.TrashStore},n.createElement(b,r.__assign({},this.props)))},t})(n.Component);t.PurgeModal=a(A,["/static/css/modal-vflI292PU.css"]),t.showPurgeModal=E,t.isPurgeModalActionAllowed=g}),define("modules/clean/react/trash/reducer",["require","exports","tslib","external/lodash","external/immutable","modules/clean/react/trash/constants","modules/clean/sharing/api/client","external/react-addons-update","modules/clean/react/trash/selectors"],function(e,t,r,n,s,o,i,a,l){"use strict";function c(e,t,r,s,i){if(0===t.length&&0===r.length)return e;var a=n.groupBy(t,"ns_id");return e.withMutations(function(e){Object.keys(a).forEach(function(t){var r=parseInt(t,10),n=a[t];if(e.has(r)){var s=e.get(r);n=n.filter(function(e){return e.timestamp<s.earliest});var i=s.events.concat(n);e.set(r,{earliest:Math.min.apply(Math,i.map(function(e){return e.timestamp})),events:i,done:!1,cursor:s.cursor})}else e.set(r,{earliest:Math.min.apply(Math,n.map(function(e){return e.timestamp})),events:n,done:!1,cursor:o.DELETED_FILES_CURSOR_FETCH_ALL})});for(var t=0,n=r;t<n.length;t++){var i=n[t];if(s&&s[i]){var l=e.get(i);l?l.cursor=s[i]:(l={earliest:Number.MAX_VALUE,events:[],done:!1,cursor:s[i]},e.set(i,l)),s[i]===o.DELETED_FILES_CURSOR_DONE&&(l.done=!0)}}return e})}function d(e,t,n,i){return r.__assign({},e,{events:c(s.Map(),t,[e.root_ns_ids[e.user_id]],i,e.user_id),namespaces:s.List(n),fetchPhase:o.FetchPhase.PHASE2})}function u(e,t,n,s){return r.__assign({},e,{events:c(e.events,t,n,s,e.user_id),fetchPhase:o.FetchPhase.PHASE3})}function p(e,t,n,s){return r.__assign({},e,{events:c(e.events,t,n,s,e.user_id),isLoadingMore:!1})}function _(e){return{earliest:Number.MAX_VALUE,events:[],done:!1,cursor:o.DELETED_FILES_CURSOR_FETCH_ALL}}function h(e){var t=s.Map().withMutations(function(t){e.namespaces.forEach(function(r){r.user_id===e.user_id&&t.set(r.ns_id,_(r.ns_id))});var r=e.root_ns_ids[e.user_id];t.set(r,_(r))});return r.__assign({},e,{events:t})}function m(e,t){return r.__assign({},e,{snackbarState:r.__assign({},e.snackbarState,{state:t})})}function f(e,t){return r.__assign({},e,{snackbarState:{state:"restoring",fileCountForSnackbarToDisplay:t}})}function E(e,t){var n=new Set;return e.filesCurrentlyBeingRestored.forEach(function(e){return n.add(e)}),n.add(t),r.__assign({},e,{filesCurrentlyBeingRestored:n})}function g(e){var t=e.ns_id,r=null!=t?e.events.get(t):null;return r?[r]:e.events.toArray()}function v(e){return Math.max.apply(Math,g(e).map(function(e){return e.earliest}))}function y(e,t){var n=1e3*v(e),s=r.__assign({},e,{timestamp_ms:t});return(n<0||t<n||t>e.latest_ms)&&(s=h(r.__assign({},s,{latest_ms:t}))),s}function S(e,t,s){var o=e.events,i=o.get(t),l=i?n.findIndex(i.events,function(e){return e.pkey===s}):-1;return l!==-1&&(o=o.update(t,function(e){return a(e,{events:{$splice:[[l,1]]}})})),r.__assign({},e,{events:o})}function I(e,t){return h(r.__assign({},e,{namespaces:s.List(t.ns_entries),root_ns_ids:t.root_ns_ids,home_ns_ids:t.home_ns_ids,timestamp_ms:t.date,latest_ms:t.date,ns_id:t.active_ns_id,seenRestoreFilesTip:Boolean(t.seenRestoreFilesTip),start_ts:t.start_ts||null,end_ts:t.end_ts||null,actor_email:t.actor_email||null,selected_host_ids:t.selected_host_ids||[],fq_path:t.fq_path||null}))}function T(e,t,n,s){var o={deletorInfo:s,deletedContentInfo:t,permissions:n,canDisplayContent:!0,error:!1,readyToDisplayContent:!1};return r.__assign({},e,{currentModalInfo:o})}function b(e,t,n,s){var o=r.__assign({},e.currentModalInfo,{eventDetails:t,canDisplayContent:n,hasAclRestore:s});return r.__assign({},e,{currentModalInfo:o})}function A(e,t,n){var s=r.__assign({},void 0!==e.currentModalInfo?e.currentModalInfo.deletedContentInfo:void 0,{fileName:t.fileName,referenceFileName:t.referenceFileName,fileCount:t.fileCount,eventCount:t.fileCount,readOnlyEventCount:0,fqPaths:t.fqPaths,isSingleFile:t.isSingleFile,displayPath:t.displayPath,sharedFolderPurgeInfo:void 0}),o=r.__assign({},e.currentModalInfo,{deletedContentInfo:s,deletorInfo:n,error:!1,readyToDisplayContent:!1});return r.__assign({},e,{currentModalInfo:o})}function C(e,t){for(var n=t.map(function(e){var t=l.getUserType(e.user_type);return{nsId:e.ns_id,isUserOwnedNs:e.is_user_owned_ns_id,userType:t,isOneCompleteFolder:e.is_one_complete_folder,isHomeNsId:e.is_home_ns_id,sfWithAccessCount:e.sf_with_access_count-e.owned_sf_count,sfWithoutAccessCount:e.sf_without_access_count,ownedSfCount:e.owned_sf_count,canPurge:e.can_purge,fileCount:e.file_count}}),s=0,o=0,i=n;o<i.length;o++){s+=i[o].fileCount}var a={ownedSfCount:t[0].owned_sf_count,sfWithAccessCount:t[0].sf_with_access_count,sfWithoutAccessCount:t[0].sf_without_access_count,isUserOwnedNs:t[0].is_user_owned_ns_id,userType:t[0].user_type,isOneCompleteFolder:t[0].is_one_complete_folder},c=r.__assign({},e.currentModalInfo.deletedContentInfo,{ns_info:n,sharedFolderPurgeInfo:a,fileCount:s}),d={canPurge:t[0].can_purge,canRollback:!1,isReadOnly:!1},u=r.__assign({},e.currentModalInfo,{deletedContentInfo:c,error:!1,permissions:d});return r.__assign({},e,{currentModalInfo:u})}function w(e,t,n){var s=r.__assign({},e.currentModalInfo,{membershipByFQPath:t,noAccessPaths:n});return r.__assign({},e,{currentModalInfo:s})}function F(e,t){switch(t.type){case o.START_FETCH_PHASE1:return r.__assign({},e,{fetchPhase:o.FetchPhase.PHASE1});case o.COMPLETE_FETCH_PHASE1:return d(e,t.deletionEvents,t.mountedNamespaces,t.requestedNsIdToCursor);case o.COMPLETE_FETCH_PHASE2:return u(e,t.deletionEvents,t.requestedNsIds,t.requestedNsIdToCursor);case o.REQUEST_MORE_DATA:return r.__assign({},e,{isLoadingMore:!0});case o.RECEIVE_MORE_DATA:return p(e,t.deletionEvents,t.requestedNsIds,t.requestedNsIdToCursor);case o.FAIL_REQUESTING_MORE_DATA:return r.__assign({},e,{isLoadingMore:!1});case o.SET_NAMESPACE:return r.__assign({},e,{ns_id:t.ns_id});case o.SET_TIMESTAMP:return y(e,t.timestamp_ms);case o.SET_START_TS:return h(r.__assign({},e,{start_ts:t.ts}));case o.SET_END_TS:return h(r.__assign({},e,{end_ts:t.ts}));case o.SET_ACTOR_USER_EMAIL:var n=e.actor_email===t.user_email,s=n?e.selected_host_ids:[];return h(r.__assign({},e,{actor_email:t.user_email,selected_host_ids:s}));case o.RECEIVE_HOST_DETAILS:return r.__assign({},e,{user_host_details_map:e.user_host_details_map.set(t.email,t.host_details)});case o.SET_HOST_IDS:return h(r.__assign({},e,{selected_host_ids:t.host_ids}));case o.SET_FQ_PATH:return h(r.__assign({},e,{fq_path:t.folder_path}));case o.UPDATE_SNACKBAR:return m(e,t.state);case o.CREATE_SNACKBAR:return f(e,t.count);case o.CLEAR_FILTERS:return h(r.__assign({},e,{start_ts:null,end_ts:null,actor_email:null,selected_host_ids:[],fq_path:null}));case o.TRASH_INIT:return I(e,t.data);case o.MARK_ROW_AS_RESTORING:return E(e,t.pkey);case o.REMOVE_ROW:return S(e,t.ns_id,t.pkey);case o.DISMISS_RESTORE_FILES_TIP:return r.__assign({},e,{seenRestoreFilesTip:!0});case o.SET_USER_ID:return r.__assign({},e,{user_id:t.userId,shareClient:new i.ShareApiClient({userId:t.userId,isNonUserRelativeContext:t.isNonUserRelativeContext})});case o.SET_TRASH_MODAL_DATA:return T(e,t.deletedContentInfo,t.permissions,t.deletorInfo);case o.RECEIVE_EVENT_DETAILS:return b(e,t.deletionEventDetails,t.canDisplayContent,t.hasAclRestore);case o.RECEIVE_PURGE_EVENT_DETAILS:return C(e,t.purgeEventDetails);case o.SET_PURGE_MODAL_DATA:return A(e,t.browseContentInfo,t.deletorInfo);case o.FETCH_EVENT_DETAILS_ERROR:return r.__assign({},e,{currentModalInfo:r.__assign({},e.currentModalInfo,{error:!0})});case o.RECEIVE_MEMBERSHIP:return w(e,t.membershipInfo.membershipByFQPath,t.membershipInfo.noAccessPaths);case o.FINISH_LOADING_MODAL_DATA:return r.__assign({},e,{currentModalInfo:r.__assign({},e.currentModalInfo,{readyToDisplayContent:!0})});default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=F}),define("modules/clean/react/trash/selectors",["require","exports","modules/clean/react/trash/constants"],function(e,t,r){"use strict";function n(e,t){return null==t?c:e.get(t,c)}function s(e){return e.root_ns_ids[e.user_id]}function o(e){return e.home_ns_ids[e.user_id]}function i(e){switch(e){case r.OFF_TEAM:return r.OFF_TEAM;case r.MEMBER:return r.MEMBER;case r.ADMIN:return r.ADMIN;case r.NON_TEAM:default:return r.NON_TEAM}}function a(e){return e.fetchPhase!==r.FetchPhase.PHASE3||e.isLoadingMore}function l(e){var t=e.fetchPhase;return null===t||t===r.FetchPhase.PHASE1||a(e)}Object.defineProperty(t,"__esModule",{value:!0});var c=Object.freeze({earliest:+(1/0),events:Object.freeze([]),done:!0,cursor:r.DELETED_FILES_CURSOR_DONE});t.getEventsForNs=n,t.getRootNsId=s,t.getHomeNsId=o,t.getUserType=i,t.isLoading=a,t.eventFetchInProgress=l}),define("modules/clean/react/trash/store",["require","exports","external/immutable","external/redux","external/redux-thunk","modules/clean/react/trash/reducer"],function(e,t,r,n,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n.compose,a=n.createStore(o.reducer,{user_id:0,shareClient:null,ns_id:void 0,root_ns_ids:{},home_ns_ids:{},events:r.Map(),namespaces:r.List(),latest_ms:Number.MAX_VALUE,timestamp_ms:null,start_ts:null,end_ts:null,actor_email:null,user_host_details_map:r.Map(),selected_host_ids:[],fq_path:null,fetchPhase:null,isLoadingMore:!1,seenRestoreFilesTip:!1,filesCurrentlyBeingRestored:new Set,snackbarState:{state:"none",fileCountForSnackbarToDisplay:0}},i(n.applyMiddleware(s)));t.TrashStore=a}),define("modules/clean/react/trash/trash",["require","exports","tslib","external/react","external/react-redux","external/immutable","external/lodash","spectrum/scroll_monitor","modules/clean/analytics","modules/clean/history","modules/clean/pagelet_logger","modules/clean/viewer","modules/clean/web_timing_logger","modules/clean/react/trash/actions","modules/clean/react/trash/selectors","modules/clean/react/trash/store","modules/clean/react/trash/trash_view","modules/clean/react/trash/utils","modules/clean/react/trash/trash_filter_util","modules/clean/web_timing_logger","modules/clean/search/search_bar/data/action_creators","modules/clean/search/search_bar/data/store","modules/clean/react/snackbar","modules/clean/react_format","modules/core/i18n","modules/clean/search/search_bar/experiments"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h,m,f,E,g,v,y,S,I,T,b,A){"use strict";function C(e){var t,r=e.ns_id;return t=r?[h.getEventsForNs(e.events,r)]:e.events.toList().toJS(),{namespaces:e.namespaces,restoringFiles:e.filesCurrentlyBeingRestored,root_ns_ids:e.root_ns_ids,home_ns_ids:e.home_ns_ids,active_ns_id:e.ns_id,loading:h.isLoading(e),timestamp_ms:e.timestamp_ms,seenRestoreFilesTip:e.seenRestoreFilesTip,
filterViewDisabled:h.eventFetchInProgress(e),start_ts:e.start_ts,end_ts:e.end_ts,actor_email:e.actor_email,user_host_details:g.HostDetailsWrapper.fromUserHostMap(e.user_host_details_map),selected_host_ids:e.selected_host_ids,fq_path:e.fq_path,snackbarState:e.snackbarState,valid_nss:t}}Object.defineProperty(t,"__esModule",{value:!0});var w=(function(t){function s(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageletLogger=new d.PageletLogger("trash",["TrashView"]),e._currentFromBottom=null,e.loggedFilterTypes=o.Set(),e.state={user:u.Viewer.get_viewer().get_user_by_id(e.props.user_id)},e.handleComponentReady=function(t){e.pageletLogger.componentReady(t)},e.handleDateChange=function(t){var r=Number(t);e.props.dispatch(_.setTimestampMs(r))},e.handleRestoreFilesTipDismiss=function(){e.props.dispatch(_.dismissRestoreFilesTip())},e.handleScroll=function(t){var r=t.fromBottom;e._currentFromBottom=r,e.loadMoreIfNearBottom()},e.purgeDeletionEvent=function(t,n){return r.__awaiter(e,void 0,void 0,function(){return r.__generator(this,function(e){switch(e.label){case 0:return[4,this.props.dispatch(_.purgeByDeletionEvents(t,n))];case 1:return e.sent(),l.WebMiscActivityLogger.log("trash-purge",{source:"modal",with_mixed_cs:!0}),[2]}})})},e.restoreDeletionEvent=function(t){return r.__awaiter(e,void 0,void 0,function(){var e;return r.__generator(this,function(r){switch(r.label){case 0:I.Snackbar.show(n.createElement(I.Snackbar,{key:"restore-snackbar",syncProgressLoop:!0,title:b._("Restoring files..."),variant:"sync"})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.props.dispatch(_.restoreByDeletionEvents(t,{".tag":"deleted_files"},this.props.deleted_files_multiselect))];case 2:return r.sent(),I.Snackbar.close(),I.Snackbar.generic(T.reactFormat(b.ungettext("Successfully restored %(num)d item.","Successfully restored %(num)d items.",this.props.snackbarState.fileCountForSnackbarToDisplay).format({num:this.props.snackbarState.fileCountForSnackbarToDisplay}),{strong:n.createElement("strong",null)})),[3,4];case 3:return e=r.sent(),"timeout"===e?I.Snackbar.generic(b._("Large restorations may take a few hours to complete, please check back later.")):I.Snackbar.fail(b._("We were unable to restore those files.")),[3,4];case 4:return l.WebMiscActivityLogger.log("trash-restore",{source:"modal",with_mixed_cs:!0}),this.logRestoreWithFilter(),[2]}})})},e.updateNSFilter=function(t){var r="all"===t?null:t;e.props.dispatch(_.setNamespace(r))},e.handleMinTsUpdate=function(t){e.logFilterUsed("calender_from"),e.props.dispatch(_.setMinDateTs(t))},e.handleMaxTsUpdate=function(t){e.logFilterUsed("calender_to"),e.props.dispatch(_.setMaxDateTs(t))},e.handleUserFilterUpdate=function(t){e.logFilterUsed("user"),t!==e.props.actor_email&&e.props.dispatch(_.setActorUserEmail(t||null))},e.handleHostFilterUpdate=function(t){e.logFilterUsed("host"),e.props.dispatch(_.setActorHostIds(t))},e.handleParentFolderSettingUpdate=function(t){e.logFilterUsed("parent_folder"),e.props.dispatch(_.setDeletedContainingFqPath(t))},e.handleFilterClear=function(){e.props.dispatch(_.clearFilters())},e.logFilterUsed=function(t){0===e.loggedFilterTypes.size&&l.WebMiscActivityLogger.log("trash-session-filter-used"),e.loggedFilterTypes.has(t)||(e.loggedFilterTypes=e.loggedFilterTypes.add(t),l.WebMiscActivityLogger.log("trash-filter-used-%(filter)s".format({filter:t})))},e.logRestoreWithFilter=function(){e.loggedFilterTypes.size>0&&l.WebMiscActivityLogger.log("trash-restore-with-filters")},e}return r.__extends(s,t),s.prototype.componentWillMount=function(){p.log_js_modules_application_code_start(),A.isInDeletedFilterRightRailExperiment(this.props.searchBarExperiments)&&(S.getStoreForSearchBar().dispatch(y.setDeletedChipEnabled({enabled:!0})),S.getStoreForSearchBar().dispatch(y.setDeletedChip({deletedChip:!0})))},s.prototype.componentDidMount=function(){this.props.dispatch(_.initiateFetchPhases()),v.waitForTTI().then(function(){e(["modules/clean/growth/experiments/overquota_helper"],function(e){e.OverquotaHelper.maybeShowSubgrowthProOQRecurringModal("wb_oq_ups_recur_fb")})})},s.prototype.componentDidUpdate=function(){this.setUrlWithFilters()},s.prototype.setUrlWithFilters=function(){var e=this.props,t=e.start_ts,r=e.end_ts,n=e.actor_email,s=e.selected_host_ids,o=e.fq_path,i={};null!==t&&(i.start_ts=t),null!==r&&(i.end_ts=r),null!==n&&(i.actor_email=n),s&&s.length&&(i.host_ids=s.join(",")),null!==o&&(i.fq_path=o),c.push_state("/deleted_files",i)},s.prototype.getFilteredEvents=function(){var e=i.flattenDeep(this.props.valid_nss.map(function(e){return e.events}));return E.getFilteredEventsWithFilters(e,this.props)},s.prototype.getFilteredNamespaces=function(){var e=this;return this.props.namespaces.filter(function(t){return t.user_id===e.props.user_id})},s.prototype.loadMoreIfNearBottom=function(){null!==this._currentFromBottom&&this._currentFromBottom>=0&&this._currentFromBottom<=400&&this.props.dispatch(_.loadMore())},s.prototype.getFilterStatus=function(){return{calendarFilterSettings:{onMinTsUpdated:this.handleMinTsUpdate,onMaxTsUpdated:this.handleMaxTsUpdate,minTs:this.props.start_ts||void 0,maxTs:this.props.end_ts||void 0},userFilterSettings:{onUserSelected:this.handleUserFilterUpdate,selectedUserEmail:this.props.actor_email||null},hostFilterSettings:{userHostDetails:this.props.user_host_details,onHostSelected:this.handleHostFilterUpdate,selectedHostIds:this.props.selected_host_ids||void 0},parentFolderSettings:{selectedPath:this.props.fq_path||void 0,onPathSelected:this.handleParentFolderSettingUpdate},onFilterClear:this.handleFilterClear}},s.prototype.render=function(){return n.createElement("div",null,n.createElement(f.TrashView,{user:this.state.user,onDateChange:this.handleDateChange,calendarInitDate:new Date(this.props.initial_timestamp),calendarLastDay:new Date,activeNS:this.props.active_ns_id,defaultNS:this.props.initial_active_ns_id,events:this.getFilteredEvents(),namespaces:this.getFilteredNamespaces(),homeNsIds:this.props.home_ns_ids,onNamespaceChange:this.updateNSFilter,onPurgeDeletionEvent:this.purgeDeletionEvent,onRestoreDeletionEvent:this.restoreDeletionEvent,loading:this.props.loading,evhUserType:this.props.evh_user_type,isOverFreeQuota:this.props.is_over_free_quota,handleComponentReady:this.handleComponentReady,seenRestoreFilesTip:this.props.seenRestoreFilesTip,onRestoreFilesTipDismiss:this.handleRestoreFilesTipDismiss,filterViewDisabled:this.props.filterViewDisabled,searchBarExperiments:this.props.searchBarExperiments,deletionFilterStatus:this.getFilterStatus(),deletedFilesMultiselectExp:this.props.deleted_files_multiselect,filesCurrentlyBeingRestored:this.props.restoringFiles,snackbarState:this.props.snackbarState}),n.createElement(a.WindowScrollMonitor,{onScroll:this.handleScroll}))},s})(n.Component);t.InnerTrash_TESTING=w;var F=s.connect(C)(w),R=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentWillMount=function(){m.TrashStore.dispatch(_.setUserId(this.props.user_id)),m.TrashStore.dispatch(_.initialize({date:this.getInitialTimestamp(),ns_entries:this.props.namespaces,root_ns_ids:this.props.root_ns_ids,home_ns_ids:this.props.home_ns_ids,active_ns_id:this.props.initial_active_ns_id,seenRestoreFilesTip:this.props.seenRestoreFilesTip,start_ts:this.props.start_ts,end_ts:this.props.end_ts,actor_email:this.props.actor_email,selected_host_ids:this.getHostIds(),fq_path:this.props.fq_path})),this.props.actor_email&&m.TrashStore.dispatch(_.loadHostsForActorEmail(this.props.actor_email))},t.prototype.getHostIds=function(){var e=this.props.selected_host_ids;return"string"==typeof e?e.split(",").map(function(e){return parseInt(e,10)}):[]},t.prototype.getInitialTimestamp=function(){var e=this.props.date_str;return e?E.parseDateFromString(e)||Date.now():Date.now()},t.prototype.render=function(){var e=this.props,t=e.initial_active_ns_id,r=e.evh_user_type,o=e.is_over_free_quota,i=e.user_id,a=e.searchBarExperiments,l=e.deleted_files_multiselect,c=this.getInitialTimestamp();return n.createElement(s.Provider,{store:m.TrashStore},n.createElement(F,{evh_user_type:r,deleted_files_multiselect:l,is_over_free_quota:o,initial_active_ns_id:t,initial_timestamp:c,user_id:i,searchBarExperiments:a}))},t})(n.Component);t.Trash=R}),define("modules/clean/react/trash/trash_filter_sidebar",["require","exports","tslib","external/react","external/classnames","spectrum/dropdown_button","spectrum/dropdown_menu","spectrum/tertiary_link","modules/core/i18n","modules/clean/react/title_bubble","modules/clean/static_urls","modules/clean/contacts/types","modules/clean/contacts/tokenizer","modules/clean/contacts/contact","modules/clean/react/calendar","modules/clean/react/folder_selector_modal","modules/clean/react/css","modules/clean/react/sprite","modules/clean/react/trash/trash_filter_util","modules/clean/react/path_filter_button"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h,m,f,E,g,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=(function(e){function t(t){var r=e.call(this,t)||this;return r.onMinDateSelected=function(e){return r.props.calendarFilter.onMinTsUpdated(g.jsDateToUnixSeconds(e))},r.onMaxDateSelected=function(e){return r.props.calendarFilter.onMaxTsUpdated(g.jsDateToUnixSeconds(g.lastSecondOfDay(e)))},r.renderCalendarFilter=function(){var e=[];return e.push(n.createElement("div",{className:"filter-item__row"},n.createElement("div",{className:"filter-item__column"},n.createElement("div",{className:"filter-item__desc"},l._("From date")),n.createElement("div",{className:"filter-item__filter filter-item__filter--minDate"},n.createElement(h.Calendar,{placeholderText:l._("Any day"),disabled:r.props.disabled,firstDay:g.unixSecondToJsDate(1167609600),lastDay:g.unixSecondToJsDate(r.props.calendarFilter.maxTs)||new Date,initDate:g.unixSecondToJsDate(r.props.calendarFilter.minTs),isMaestroDesign:!0,alignAtLeft:!1,onDateChange:r.onMinDateSelected}))))),e.push(n.createElement("div",{className:"filter-item__row"},n.createElement("div",{className:"filter-item__column"},n.createElement("div",{className:"filter-item__desc"},l._("To date")),n.createElement("div",{className:"filter-item__filter filter-item__filter--maxDate"},n.createElement(h.Calendar,{placeholderText:l._("Any day"),disabled:r.props.disabled,firstDay:g.unixSecondToJsDate(r.props.calendarFilter.minTs)||g.unixSecondToJsDate(1167609600),lastDay:new Date,initDate:g.unixSecondToJsDate(r.props.calendarFilter.maxTs),isMaestroDesign:!0,alignAtLeft:!1,onDateChange:r.onMaxDateSelected}))))),e},r.onTokenizerContentsChange=function(e,t){var n=null;e.length&&(n=e[0].email),n!==r.props.userFilter.selectedUserEmail&&(r.props.userFilter.onUserSelected(n),r.setState({emailFromUrl:null}))},r.getPopulatedInputData=function(){var e=r.state.emailFromUrl,t=[];return e&&t.push(new _.Contact({email:e,invalid:!1,name:e,type:u.EMAIL})),{tokens:t}},r.renderUserFilter=function(){var e=function(e){return e.type!==u.NEW_STYLE_GROUP};return n.createElement("div",{className:"filter-item__row"},n.createElement("div",{className:"filter-item__column"},n.createElement("div",{className:"filter-item__desc"},l._("Deleted by")),n.createElement(p.ContactsTokenizer,{customClass:"filter-item__filter filter-item__filter--actorEmail",customContactFilter:e,ref:"tokenizer",context:"deleted_files",focusOnMount:!1,onContentsChange:r.onTokenizerContentsChange,placeholder:l._("Email or name"),showContactImport:!1,user:r.props.user,disabled:r.props.disabled,disableAdditionalInput:!!r.props.userFilter.selectedUserEmail,populatedInputData:r.getPopulatedInputData()})))},r.onHostSelected=function(e){r.props.hostFilter.onHostSelected(e?[e]:[])},r.renderHostFilterLoading=function(){return n.createElement("div",{className:"filter-item__row"},n.createElement("div",{className:"filter-item__column"},n.createElement("div",{className:"filter-item__desc"},l._("Device")),n.createElement("div",{className:"filter-item__filter filter-item__filter--hostId filter-item__filter--loading"},n.createElement("img",{src:d.static_url("/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"),alt:l._("Loading")}))))},r.renderNoHosts=function(e){var t=e?l._("Can only filter by your teamâ€™s devices"):l._("Can only filter by your devices");return n.createElement("div",{className:"filter-item__row"},n.createElement("div",{className:"filter-item__column"},n.createElement("div",{className:"filter-item__desc"},l._("From device")),n.createElement("div",{className:"filter-item__filter filter-item__filter--hostId filter-item__filter--disabled"},n.createElement(c.TitleBubble,{content:t,position:c.TitleBubble.POSITIONS.BOTTOM},n.createElement(o.DropdownButton,{disabled:!0},l._("Any device"))))))},r.renderHostFilterWithItems=function(e,t){var s=function(t){var r=null!==t&&e.getHostIcon(t),s=null!==t?e.getHostShortName(t):l._("All devices");return n.createElement("div",{className:"host-name host-name__row"},r&&n.createElement(E.Sprite,{className:"host-name__sprite",alt:"",group:"web",name:r}),n.createElement("span",{className:"host-name__description"},s))},o=t&&t.length?t[0]:null,a=n.createElement(i.DropdownMenu,{className:"filter-item__filter filter-item__filter--hostId",onSelection:r.onHostSelected},n.createElement(i.DropdownMenuButton,{disabled:r.props.disabled},s(o)),n.createElement(i.Menu,null,n.createElement(i.MenuItem,{value:null},s(null)),e.getHostIdsOrderedByType().map(function(e,t){return n.createElement(i.MenuItem,{key:t,value:e},s(e))})));return n.createElement("div",{className:"filter-item__row"},n.createElement("div",{className:"filter-item__column"},n.createElement("div",{className:"filter-item__desc"},l._("Device")),a))},r.renderHostFilter=function(e){var t=r.props.hostFilter,n=t.userHostDetails,s=t.selectedHostIds,o=n.get(e);return void 0===o?r.renderHostFilterLoading():o.hasHosts()?r.renderHostFilterWithItems(o,s):r.renderNoHosts(!!r.props.user.is_team)},r.onPathSelected=function(e){var t="/"===e?null:e;r.props.parentFolderFilter.onPathSelected(t)},r.showFolderFilterModal=function(){return m.FolderSelectorModal.show({primaryAction:l._("Select"),secondaryAction:l._("Cancel"),title:l._("Folder filter selector"),ariaLabel:l._("Folder selector"),user:r.props.user,initialFolderSelection:r.props.parentFolderFilter.selectedPath||"/",onFolderSelected:r.onPathSelected,showFolderPicker:!1})},r.renderFolderFilter=function(){return n.createElement("div",{className:"filter-item__row"},n.createElement("div",{className:"filter-item__column"},n.createElement("div",{className:"filter-item__desc"},l._("In folder")),n.createElement(v.PathFilterButton,{path:r.props.parentFolderFilter.selectedPath,defaultText:l._("Any folder"),dropdownClasses:"filter-item__filter filter-item__filter--fqPath",onClick:r.showFolderFilterModal})))},r.renderResetButton=function(){return n.createElement("div",{className:"filter-item__resetRow"},n.createElement(a.TertiaryLink,{onClick:r.props.onFilterClear,className:"filter-item__resetButton"},l._("Reset filters")))},r.state={emailFromUrl:r.props.userFilter.selectedUserEmail},r}return r.__extends(t,e),t.prototype.render=function(){var e=s({"filter-item-container":!0,"filter-item-container--disabled":this.props.disabled});return n.createElement("div",{className:e},this.renderCalendarFilter(),this.renderUserFilter(),this.props.userFilter.selectedUserEmail&&this.renderHostFilter(this.props.userFilter.selectedUserEmail),this.renderFolderFilter(),g.filtersHaveValue(this.props)&&this.renderResetButton())},t})(n.Component);t.TrashFilterViewWithoutCSS=y,t.DeletedFilesFilterView=f(y,["/static/css/spectrum/index.web-vflu1RHct.css","/static/css/trash/filter-vflmEAZ-L.css","/static/css/react/contacts_tokenizer-vflQsfYaG.css","/static/css/sprites/web_sprites-vflv2MHAO.css"])}),define("modules/clean/react/trash/trash_filter_util",["require","exports","external/immutable","modules/core/i18n"],function(e,t,r,n){"use strict";function s(e){return!!(e.calendarFilter.minTs||e.calendarFilter.maxTs||e.userFilter.selectedUserEmail||e.hostFilter.selectedHostIds&&e.hostFilter.selectedHostIds.length||e.parentFolderFilter.selectedPath)}Object.defineProperty(t,"__esModule",{value:!0}),t.lastSecondOfDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()+1),new Date(t.getTime()-1)},t.jsDateToUnixSeconds=function(e){return Math.floor(e.getTime()/1e3)},t.unixSecondToJsDate=function(e){return e?new Date(1e3*e):void 0};var o=(function(){function e(t){this.UNKNOWN_HOST_STRING=n._("Unknown"),this.HOST_TYPE_DISPLAY_NAME={iphone:n._("iPhone"),android:n._("Android"),blackberry:n._("Blackberry"),ipad:n._("iPad"),windows_phone:n._("Windows Phone"),win:n._("Windows PC"),mac:n._("Mac"),lnx:n._("Linux"),web:n._("Web")},this.HOST_TYPE_DISPLAY_ICON={iphone:"s_device_mobile_iphone",android:"s_device_mobile_android",blackberry:"s_device_mobile_blackberry",ipad:"s_device_mobile_ipad",windows_phone:"s_device_windows",win:"s_device_windows",mac:"s_device_mac",lnx:"s_device_linux",web:"s_browser_generic"},this.allHostDetails=t,this.groupedHosts=e.groupHostByType(t)}return e.fromUserHostMap=function(t){return r.Map(t.map(function(t){return new e(t)}))},e.groupHostByType=function(e){var t=r.Map().withMutations(function(t){for(var r in e)if(e.hasOwnProperty(r)){var n=e[r].type,s=t.get(n,[]);s.push(parseInt(r,10)),t.set(n,s)}});return r.Map(t.map(function(e){return e.sort()}))},e.prototype.hasHosts=function(){return 0!==Object.keys(this.allHostDetails).length},e.prototype.hasDetailsForHost=function(e){return void 0!==this.allHostDetails[e]},e.prototype.getHostShortName=function(e){if(this.hasDetailsForHost(e)){var t=this.allHostDetails[e].type,r=this.allHostDetails&&this.HOST_TYPE_DISPLAY_NAME[t],n=this.groupedHosts.get(t,[]);if(n.length>1){return r+" ("+(n.indexOf(e)+1)+")"}return r}return this.UNKNOWN_HOST_STRING},e.prototype.getHostDisplayName=function(e){return this.hasDetailsForHost(e)?this.allHostDetails[e].name:this.UNKNOWN_HOST_STRING},e.prototype.getHostIcon=function(e){return this.hasDetailsForHost(e)?this.HOST_TYPE_DISPLAY_ICON[this.allHostDetails[e].type]:null},e.prototype.getHostIdsOrderedByType=function(){var e=[];return this.groupedHosts.forEach(function(t){e=e.concat(t)}),e},e})();t.HostDetailsWrapper=o,t.filtersHaveValue=s}),define("modules/clean/react/trash/trash_modal",["require","exports","tslib","external/react","external/react-redux","spectrum/button","spectrum/file_icon","spectrum/icon_content","spectrum/media_table","spectrum/modal","spectrum/table","spectrum/tertiary_link","modules/clean/components/loading_indicator","modules/clean/em_string","modules/clean/react/css","modules/clean/react/icon/folder_icon","modules/clean/react/modal","modules/clean/react/tooltip","modules/clean/react/trash/constants","modules/clean/react/trash/selectors","modules/clean/react/trash/store","modules/clean/sharing/member_avatars","modules/core/browser","modules/core/i18n","modules/clean/react/trash/purge_modal","modules/clean/react/trash/api"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h,m,f,E,g,v,y,S,I,T,b,A){"use strict";function C(e,t,r){return m.isLegacyFolderIcon(e)?n.createElement(a.IconContent,{name:m.convertLegacyFolderIconToSpectrum(e,r),alt:t}):n.createElement(i.FileIcon,{path:t,variant:r})}function w(e){var t,r=e.currentModalInfo,n=r.canDisplayContent,s=r.deletedContentInfo,o=r.deletorInfo,i=r.error,a=r.eventDetails,l=r.hasAclRestore,c=r.membershipByFQPath,d=r.noAccessPaths,u=r.permissions,p=r.readyToDisplayContent,_=e.currentModalInfo.deletedContentInfo.sharedFolderPurgeInfo;if(_){t={hasUnmountFromHome:!!(_.sfWithAccessCount+_.sfWithoutAccessCount>0&&s.ns_info&&s.ns_info.map(function(e){return e.nsId}).includes(v.getHomeNsId(e))),sharedFolderWithAccessCount:_.sfWithAccessCount,sharedFolderWithoutAccessCount:_.sfWithoutAccessCount,isOneCompleteFolder:_.isOneCompleteFolder,isUserOwnedNs:_.isUserOwnedNs,userType:v.getUserType(_.userType)}}return{canDisplayContent:n,canPurge:u.canPurge,canRollback:u.canRollback,deletorInfo:o,displayPath:s.displayPath,error:i,eventDetailsURI:s.eventDetailsURI,eventCount:s.eventCount,readOnlyEventCount:s.readOnlyEventCount,fileCount:s.fileCount,fileName:s.fileName,fqPaths:s.fqPaths,referenceFileName:s.referenceFileName,hasAclRestore:l,isReadOnly:u.isReadOnly,isSingleFile:s.isSingleFile,items:a,membershipByFQPath:c,noAccessPaths:d,readyToDisplayContent:p,userId:e.user_id,sharedFolderPurgeInfo:t}}function F(e){f.Modal.showInstance(n.createElement(t.TrashModal,r.__assign({},e)))}Object.defineProperty(t,"__esModule",{value:!0}),t.SingleModalView=function(e){return n.createElement("div",{id:"modal-single-container"},n.createElement("div",null,C(e.icon,e.text,"large"),n.createElement("div",{id:"modal-single-name"},_.Emstring.em_snippet(e.text,34)),n.createElement("div",{id:"modal-single-path"},_.Emstring.em_snippet(e.src_path,34,0)),n.createElement("div",{id:"modal-single-size"},e.size),n.createElement("div",{id:"modal-single-time"},e.deletionString||"")))};var R=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.TableHeader=function(){return n.createElement("div",{id:"modal-table-header"},n.createElement("div",{id:"modal-path",className:"lfloat"},_.Emstring.em_snippet(t.props.displayPath,13,0)),n.createElement("div",{id:"modal-timestamp",className:"rfloat"},t.props.deletionString))},t.createSingleModalItem=function(e,r,s){var o=t.props.membershipByFQPath&&t.props.membershipByFQPath[e.fq_path],i=o&&S.buildGroupsAndMembersText(o.groups,o.users,o.invitees,g.MODAL_MAX_SHOWN_AVATARS,"trash-modal__tooltip");return t.props.noAccessPaths&&t.props.noAccessPaths.includes(e.fq_path)&&(i=T._("You donâ€™t have access to this content")),n.createElement(l.CulledMediaRow,{key:e.fq_path,topOffset:s,doubleLine:!!t.props.hasAclRestore&&t.props.hasAclRestore[e.fq_path],className:"trash-modal__item-row"},function(){return[n.createElement(l.MediaCell,{key:"item_name",highlight:!1,icon:C(e.icon,e.name,"small"),title:_.Emstring.em_snippet(e.name,25),subtitle:i}),n.createElement(l.MediaCell,{className:"trash-modal__item-size",key:"item_size",title:e.size,variant:"detail"})]})},t}return r.__extends(t,e),t.prototype.renderEmptyState=function(){return n.createElement("div",{id:"modal-empty-state"},n.createElement("h3",null,T._("This folder is empty")))},t.prototype.renderPreviewUnavailable=function(){return n.createElement("div",{id:"modal-empty-state"},n.createElement("h3",null,T._("Preview not available")))},t.prototype.renderTableContents=function(){var e=this.props,t=e.canDisplayContent,r=e.items;return t?0===r.length?this.renderEmptyState():this.renderListView():this.renderPreviewUnavailable()},t.prototype.renderListView=function(){return n.createElement(d.CulledTableBody,{items:this.props.items,className:"mc-table-body mc-table-body-culled modal-table-contents",listItemHeight:this.props.hasAclRestore?g.ACL_RESTORE_MODAL_ROW_HEIGHT:g.MODAL_ITEM_ROW_HEIGHT,renderRow:this.createSingleModalItem,shouldUseWindowAsScrollContainer:!1})},t.prototype.render=function(){return n.createElement(d.Table,{columnFlex:["1 1 75%","1 1 25%"]},n.createElement(this.TableHeader,null),this.renderTableContents())},t})(n.Component);t.GroupModalView=R;var P=(function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isModalOpen:!0},t.onRequestClose=function(){t.props.canPurge&&!t.canShowPurgeModal()&&A.logPurgeModalActivity(t.props.userId,"purge-modal-action-disallowed"),t.setState({isModalOpen:!1})},t.redirectToEventDetails=function(){t.props.eventDetailsURI&&I.redirect(t.props.eventDetailsURI)},t.confirmRestore=function(){var e,r=t.props,n=r.referenceFileName,o=r.fileCount,i=t.props.sharedFolderPurgeInfo&&t.props.sharedFolderPurgeInfo.sharedFolderWithAccessCount||0,a=t.props.sharedFolderPurgeInfo&&t.props.sharedFolderPurgeInfo.sharedFolderWithoutAccessCount||0,l=t.props.sharedFolderPurgeInfo&&t.props.sharedFolderPurgeInfo.isOneCompleteFolder||!1,c=T._("Restore"),d=!0;0===a?e=1===o?T._("This shared folder will be added back to your Dropbox account.<br><br> Because            this folder is shared, other people might have made changes to it since it was            removed from your account."):T._("Some of these items are shared, so other people might have made changes since         they were removed from your account."):i>0?e=T._("Some of these items are shared. You no longer have access to some of them,          and others might have changed them since you removed them."):o>a?e=T._("Some of these items are shared. You no longer have access to any of them, so you         canâ€™t restore or permanently delete those items."):(e=T._("Your access to these items was removed, so you canâ€™t restore or permanently         delete them."),c=T._("OK"),d=!1),f.SimpleModal.show({title_text:s.getRestoreConfirmationTitle(n,o,l),body_html:e,confirm_text:c,confirm_callback:d?t.props.onRestore:function(){},cancel_text:T._("Cancel")})},t.confirmPurge=function(){var e=t.props.onPurge;b.showPurgeModal({onPurge:e}),A.logPurgeModalActivity(t.props.userId,"purge-modal-show",{location:"deleted_files"})},t.purgeLinkCreator=function(e){var r=T._("Permanently delete"),s=t.canShowPurgeModal(),o=s?n.createElement("span",{className:"trash-modal__purge-link"},r):n.createElement(E.Tooltip,{position:E.TooltipPosition.TOP,tooltip_contents:t.getPurgeLinkToolTipText(),tooltip_classname:"trash-modal__tooltip"},r);return n.createElement(u.TertiaryLink,{onClick:e,disabled:!s},o)},t.restoreButtonCreator=function(e){var r=T._("Go to Event Details");if(t.props.isReadOnly||t.props.canRollback){r=t.props.fileCount>1||t.props.items&&t.props.items.length>1?T._("Restore all files"):T._("Restore")}var s=1===t.props.fileCount?T._("Only people who can edit this item can restore it."):T._("Only people who can edit these items can restore them."),i=t.props.isReadOnly?n.createElement(E.Tooltip,{position:E.TooltipPosition.TOP,tooltip_contents:s,tooltip_classname:"trash-modal__tooltip"},r):r;return n.createElement(o.Button,{variant:"primary",onClick:e,disabled:t.props.isReadOnly},i)},t}return r.__extends(s,e),s.getRestoreConfirmationTitle=function(e,t,r){return t>1&&!r?T.ungettext("Restore %(filename)s and %(count)s more item.","Restore %(filename)s and %(count)s more items.",t-1).format({filename:_.Emstring.em_snippet(e,30).toString(),count:t-1}):T._("Restore %(filename)s?").format({filename:_.Emstring.em_snippet(e,30).toString()})},s.prototype.getDeletionTimeString=function(){if(!this.props.deletorInfo)return"";var e={deletor:"",ago:this.props.deletorInfo.timestamp};if(this.props.deletorInfo.actorName){var t=this.props.isSingleFile?25:15;return e.deletor=_.Emstring.em_snippet(this.props.deletorInfo.actorName,t),T._("%(deletor)s deleted %(ago)s").format(e)}return T._("You deleted %(ago)s").format(e)},s.prototype.renderError=function(){return n.createElement("div",{id:"modal-error-state"},n.createElement("h3",null,T._("Oops! An error occurred. Please try again later!")))},s.prototype.renderLoader=function(){return n.createElement("div",{id:"modal-loading"},n.createElement(p.LoadingIndicator,{style:p.LoadingIndicator.LoadingIndicatorStyle.BLUE_SPINNER}))},s.prototype.renderSingleModal=function(){var e=this.props.items;if(e&&e.length)return n.createElement(t.SingleModalView,{icon:e[0].icon,text:this.props.referenceFileName,src_path:this.props.displayPath,size:e[0].size,deletionString:this.getDeletionTimeString()})},s.prototype.renderGroupModal=function(){var e=this;if(this.props.items){var t=[];if(t=1===this.props.fqPaths.length?this.props.items.filter(function(t){var r=t.fq_path;return e.props.fqPaths.indexOf(r)===-1}):this.props.items.slice(),this.props.fileCount>g.MAX_FILE_COUNT_TO_DISPLAY){var r=void 0;if(this.props.canRollback){var s=this.props.fileCount-g.MAX_FILE_COUNT_TO_DISPLAY;r=T.ungettext("And %(num)d more file.","And %(num)d more files.",s).format({num:s})}else r=T._("To view or restore all %(file_count)d files, visit Event Details page.").format({file_count:this.props.fileCount});t=t.slice(g.MAX_FILE_COUNT_TO_DISPLAY-1),t.push({icon:"",can_display_content:!0,name:r,size:"",src_path:"",fq_path:""})}return n.createElement(R,{items:t,displayPath:this.props.displayPath,membershipByFQPath:this.props.membershipByFQPath,noAccessPaths:this.props.noAccessPaths,deletionString:this.getDeletionTimeString(),canDisplayContent:this.props.canDisplayContent,hasAclRestore:this.props.hasAclRestore})}},s.prototype.renderNoAccessModal=function(){return 1===this.props.fileCount?n.createElement("div",{className:"trash-modal__acl-restore-section"},T._("You donâ€™t have permission to view the contents of â€˜%(folder_name)sâ€™.               Please note that restoring this folder will reinstate access according to its original members,               including any members of child content. â€˜%(folder_name)sâ€™ will remain confidential to you,               but will be accessible by other users.").format({folder_name:this.props.fileName})):n.createElement("div",{className:"trash-modal__acl-restore-section"},T._("You donâ€™t have permission to view those items.               Please note that restoring will reinstate access according to its original members,               including any members of child content. â€˜%(folder_name)sâ€™ will remain confidential to you,               but will be accessible by other users.").format({folder_name:this.props.fileName}))},s.prototype.renderSomeAccessModal=function(){return n.createElement("div",{className:"trash-modal__acl-restore-section"},T._("You donâ€™t have permission to view some of the contents of some of these files.             Please note that restoring these folders will reinstate access according to its original members,             including any members of child content. The folders you lack permission to view will remain             confidential to you, but will be accessible by other users."))},s.prototype.renderModalContainerContents=function(){return this.props.error?this.renderError():this.props.readyToDisplayContent?this.props.isSingleFile?this.renderSingleModal():this.renderGroupModal():this.renderLoader()},s.prototype.getPurgeLinkToolTipText=function(){if(!this.props.sharedFolderPurgeInfo)return"";switch(this.props.sharedFolderPurgeInfo.userType){case g.ADMIN:return T._("Permanently delete in the admin console");case g.MEMBER:return T._("Only an admin can permanently delete");default:return T._("Only the owner can permanently delete")}},s.prototype.canShowPurgeModal=function(){if(!this.props.sharedFolderPurgeInfo)return!1;var e=this.props.canPurge,t=this.props.sharedFolderPurgeInfo,r=t.isUserOwnedNs,n=t.sharedFolderWithAccessCount,s=t.sharedFolderWithoutAccessCount,o=t.userType;return b.isPurgeModalActionAllowed(r,n,s,o,e)},s.prototype.renderSingleAvatar=function(e){return e.hasOwnProperty("gid")?S.renderGroup({group:e}):e.hasOwnProperty("user_id")?S.renderJoinedMember({arePairedUsersInSF:!1,member:e}):e.hasOwnProperty("invitation_id")?S.renderInvitedPerson({invited_member:e}):null},s.prototype.renderAvatars=function(){var e=this.props,t=e.fqPaths,r=e.membershipByFQPath;if(t.length>1)return null;var s=this.props.fqPaths[0];if(!r||!r[s])return null;var o,i=r[s],a=[],l=i.groups.concat(i.users,i.invitees),c=0;l.length>g.MODAL_MAX_SHOWN_AVATARS?(o=l.slice(0,g.MODAL_MAX_SHOWN_AVATARS-1),c=l.length-o.length):o=l;for(var d=0,u=o;d<u.length;d++){var p=u[d],_=this.renderSingleAvatar(p);_&&a.push(_)}return c>0&&a.push(S.renderOverflowCount({overflowCount:c})),n.createElement("div",{className:"trash-modal__avatar-list"},a)},s.prototype.renderACLRestoreTextIfNeeded=function(){if(!this.props.hasAclRestore||!this.props.readyToDisplayContent)return null;if(this.props.isReadOnly)return null;for(var e=0,t=Object.keys(void 0!==this.props.hasAclRestore&&null!==this.props.hasAclRestore?this.props.hasAclRestore:{});e<t.length;e++){var r=t[e];if(this.props.hasAclRestore[r])return n.createElement("div",{className:"trash-modal__acl-restore-section"},T._("Everyone who had access to this content before will have access again."))}return null},
s.prototype.renderUnselectSuggestionIfNeeded=function(){return this.props.isReadOnly?this.props.eventCount<=1?null:this.props.eventCount===this.props.readOnlyEventCount?null:n.createElement("div",{className:"trash-modal__acl-restore-section"},T._("You donâ€™t have access to some of those files. To perform a restore, uncheck the             files you donâ€™t have access to and try again.")):null},s.prototype.howManyEventsCanWeView=function(){var e=this.props,t=e.noAccessPaths,r=e.fqPaths;if(!t)return g.EventViewState.ALL;var n=r.filter(function(e){return!t.includes(e)}).length;return n===this.props.fqPaths.length?g.EventViewState.ALL:0===n?g.EventViewState.NONE:g.EventViewState.SOME},s.prototype.getTitle=function(){var e=this.props,t=e.fileCount,r=e.referenceFileName,n=e.sharedFolderPurgeInfo,s=n&&n.isOneCompleteFolder||!1;return t>1&&!s?_.Emstring.em_snippet(T.ungettext("%(filename)s and %(num)s more item","%(filename)s and %(num)s more items",t-1).format({filename:r,num:t-1}),30):_.Emstring.em_snippet(r,30)},s.prototype.render=function(){var e=this.props,t=e.canPurge,r=e.canRollback,s=e.sharedFolderPurgeInfo,o=s&&s.hasUnmountFromHome,i=this.redirectToEventDetails;r&&(i=o?this.confirmRestore:this.props.onRestore);var a=t?this.purgeLinkCreator:void 0,l=this.props.referenceFileName&&this.getTitle(),d=n.createElement("div",null,l,this.renderAvatars()),u=void 0,p=this.howManyEventsCanWeView();return u=p===g.EventViewState.NONE?this.renderNoAccessModal():n.createElement("div",null,n.createElement("div",{id:"modal-table-container"},this.renderModalContainerContents()),this.renderACLRestoreTextIfNeeded(),this.renderUnselectSuggestionIfNeeded(),p===g.EventViewState.SOME&&this.renderSomeAccessModal()),n.createElement(c.UtilityModal,{displayCloseButton:!this.props.hasAclRestore,overlayClickClose:!0,ariaLabel:T._("Restore content"),className:"trash-modal",link:a,onPrimaryAction:i,onSecondaryAction:this.onRequestClose,onLink:this.confirmPurge,onRequestClose:this.onRequestClose,open:this.state.isModalOpen,overlayClassName:"trash-modal--overlay",primaryAction:this.restoreButtonCreator,secondaryAction:T._("Cancel"),title:this.props.hasAclRestore?d:l},u)},s})(n.Component);t.InternalTrashModal=P;var N=s.connect(w)(P),M=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return n.createElement(s.Provider,{store:y.TrashStore},n.createElement(N,r.__assign({},this.props)))},t})(n.Component);t.TrashModal=h(M,["/static/css/trash-vfljooVx9.css"]),t.showTrashModal=F}),define("modules/clean/react/trash/trash_modal_util",["require","exports","tslib","modules/clean/filepath","modules/clean/react/trash/actions","modules/clean/react/trash/constants","modules/clean/react/trash/store","modules/clean/react/trash/trash_modal","modules/clean/viewer","modules/core/i18n","modules/core/uri","modules/clean/react/trash/purge_modal","modules/clean/react/trash/selectors","modules/clean/react/trash/api","modules/clean/react/trash/selectors"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h){"use strict";function m(e,t,r,n,s){f(e,t,s),a.showTrashModal({onRestore:r,onPurge:n})}function f(e,t,r){i.TrashStore.dispatch(s.setUserId(e)),i.TrashStore.dispatch(s.loadModalData(s.getEventDetailsFromEvents(t,r),r));var n=E({userId:e,events:t,multiselectExp:r}),o=n.deletedContentInfo,a=n.permissions,l=n.deletorInfo;i.TrashStore.dispatch(s.initializeModal(o,a,l))}function E(e){var t=e.userId,n=e.events,s=e.multiselectExp;if(n.length<1)throw new Error("At least one event expected");var o={fqPaths:n.map(function(e){return e.containing_deletion_path}),isSingleFile:1===n.length&&1===n[0].file_count&&!n[0].is_folder,fileCount:n.reduce(function(e,t){return e+t.file_count},0),eventCount:n.length,readOnlyEventCount:n.reduce(function(e,t){return e+(t.cs_info.is_read_only?1:0)},0),ns_info:n.map(function(e){return{nsId:e.ns_id,isUserOwnedNs:e.is_user_owned_ns_id,userType:p.getUserType(e.user_type),ownedSfCount:e.owned_sf_count,isHomeNsId:e.ns_id===h.getHomeNsId(i.TrashStore.getState()),sfWithAccessCount:e.sf_with_access_count-e.owned_sf_count,sfWithoutAccessCount:e.sf_without_access_count,canPurge:e.cs_info.can_purge,fileCount:e.file_count,isOneCompleteFolder:e.is_folder}}),referenceFileName:n[0].reference_file_name};if(1===n.length){var a=n[0],l=new d.URI({path:"/event_details/"+t+"/"+a.ns_id+"/"+a.cs_info.cs_id+"/0"}).toString(),c=r.__assign({displayPath:a.src_path,eventDetailsURI:l,fileName:a.file_name,ns_id:a.ns_id,sharedFolderPurgeInfo:{sfWithAccessCount:a.sf_with_access_count,sfWithoutAccessCount:a.sf_without_access_count,isOneCompleteFolder:a.is_folder,ownedSfCount:a.owned_sf_count,isUserOwnedNs:a.is_user_owned_ns_id,userType:a.user_type}},o),u={actorName:a.name,timestamp:a.ago},_={canRollback:a.cs_info.can_rollback,canPurge:!s&&a.cs_info.can_purge,isReadOnly:a.cs_info.is_read_only||!1};return{deletedContentInfo:c,permissions:_,deletorInfo:u}}var u=void 0,c=r.__assign({fileName:n[0].file_name,displayPath:"Selected items",sharedFolderPurgeInfo:{sfWithAccessCount:n.reduce(function(e,t){return e+t.sf_with_access_count},0),sfWithoutAccessCount:n.reduce(function(e,t){return e+t.sf_without_access_count},0),isOneCompleteFolder:!1,ownedSfCount:n.reduce(function(e,t){return e+t.owned_sf_count},0),isUserOwnedNs:n.reduce(function(e,t){return e&&t.is_user_owned_ns_id},!0),userType:n.reduce(function(e,t){if("off_team"===e)return"off_team";if("non_team"===e)return"non_team";var r=t.user_type;return"admin"===e?"admin"!==r?r:e:"member"===e?"member"!==r&&"admin"!==r?r:e:"non_team"},n[0].user_type)}},o),_={canRollback:!0,canPurge:!1,isReadOnly:n.reduce(function(e,t){return e||t.cs_info.is_read_only},!1)||!1};return{deletedContentInfo:c,permissions:_,deletorInfo:u}}function g(e){var t=e.userId,r=e.context,n=e.files,d=e.onRestore;i.TrashStore.dispatch(s.setUserId(t,r.isNonUserRelativeContext)),i.TrashStore.dispatch(s.loadModalData(s.getEventDetailsFromBrowse(r,n&&n.slice(0,o.MAX_FILE_COUNT_TO_DISPLAY)),!1));var u=n?n.length:1,p=l.Viewer.get_root_name(l.Viewer.get_viewer().get_user_by_id(t)),_=y(n,r,p),h={fileCount:u,fqPaths:[_.fqPath],eventCount:u,readOnlyEventCount:0,fileName:n&&u>1?c._("Restore %(file_count)s itemsâ€¦").format({file_count:u}):_.fileName,referenceFileName:_.fileName,displayPath:(_.fqPath.startsWith("/")?_.fqPath.slice(1):_.fqPath)||p,isSingleFile:!(!n||1!==u||n[0].is_dir),sharedFolderPurgeInfo:void 0},m={canRollback:!0,canPurge:!1,isReadOnly:!1};i.TrashStore.dispatch(s.initializeModal(h,m,_.deletorInfo)),a.showTrashModal({onRestore:d})}function v(e){var t=e.userId,r=e.context,a=e.files,d=e.onPurge;i.TrashStore.dispatch(s.setUserId(t,r.isNonUserRelativeContext));var p=a?a.length:1,h=l.Viewer.get_root_name(l.Viewer.get_viewer().get_user_by_id(t)),m=y(a,r,h),f=a&&p>1?c._("%(filename)s and %(file_count)s other %(item)s").format({filename:n.filename(a[0].fq_path,h),file_count:p-1,item:p-1>1?c._("items"):c._("item")}):m.fileName,E=(m.fqPath.startsWith("/")?m.fqPath.slice(1):m.fqPath)||h,g={fileCount:p,fqPaths:[m.fqPath],fileName:f,displayPath:E,referenceFileName:a&&p>1?n.filename(a[0].fq_path,h):m.fileName,isSingleFile:!(!a||1!==p||a[0].is_dir)};i.TrashStore.dispatch(s.initializePurgeModal(g,m.deletorInfo)),i.TrashStore.dispatch(s.loadModalData(s.getPurgeEventDetailsFromBrowse(r,a&&a.slice(0,o.MAX_FILE_COUNT_TO_DISPLAY)),!1)),u.showPurgeModal({onPurge:d}),_.logPurgeModalActivity(t,"purge-modal-show",{location:"browse"})}function y(e,t,r){var s,o,i,a=e?e.length:1;if(e&&1===a){var l=e[0];i=l.ago?{actorName:l.last_modified_name,timestamp:l.ago}:void 0,o=n.filename(l.fq_path,r),s=l.is_dir?l.fq_path:n.parent_dir(l.fq_path)}else s=t.currentFQPath,o=n.filename(s,r);return{fileName:o,fqPath:s,deletorInfo:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.openTrashModalFromDeletionEvent=m,t.initializeTrashStore=f,t.getTrashStoreProps=E,t.openTrashModalFromBrowseFiles=g,t.openPurgeModalFromBrowseFiles=v}),define("modules/clean/react/trash/trash_view",["require","exports","tslib","spectrum/table","spectrum/tip_card","spectrum/vertically_fixed","external/react","modules/clean/analytics","modules/clean/analytics","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/selection","modules/clean/static_urls","modules/clean/react/trash/trash_modal_util","modules/constants/trademark","modules/core/i18n","modules/clean/react/trash/trash_filter_sidebar","modules/clean/react/trash/trash_filter_util","modules/clean/react/trash/trash_view_row","modules/clean/react/selectable_list","modules/clean/react/trash/constants","modules/clean/account_page/components/sidebar","spectrum/button","external/reselect","spectrum/tertiary_link","modules/clean/react/trash/purge_modal","modules/clean/react/trash/api","modules/clean/search/search_bar/experiments"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h,m,f,E,g,v,y,S,I,T,b,A,C,w,F,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var P=(function(t){function P(r){var s=t.call(this,r)||this;return s.overquotaCallback=function(){e(["modules/clean/react/overquota_modal"],function(e){var t=e.OverquotaModal;u.Modal.showInstance(i.createElement(t,{tagline:E._("Get more space so you can restore your deleted files."),dismissText:E._("Cancel"),oqa:"wb_oq_rstdel_df"})),l.NQOQLogger.logViewModal("wb_oq_rstdel_df",{modal_type:"billboard"})})},s.launchModal=function(e){var t=e.reduce(function(e,t){return e+t.file_count},0);a.WebMiscActivityLogger.log("trash-modal-launch",{file_count:t}),m.openTrashModalFromDeletionEvent(s.props.user.id,e,s.makeRestoreCallback(e),s.makePurgeCallback(e),s.props.deletedFilesMultiselectExp)},s.launchModalWithSelection=function(){s.launchModal(s.getSelectedEvents())},s.updateOnScroll=function(){var e=window.pageYOffset;if(Math.abs(e-s.state.scrollPosition)>s.props.listItemHeight)return s.setState({scrollPosition:e})},s.clickOnRow=function(e){if(!s.isInSelectMode())return s.launchModal([e])},s.isInSelectMode=function(){return s.state.selection.selected.size>0},s.numSelected=function(){return s.state.selection.selected.size},s.makeRowSelectCallback=function(e,t){return function(r,n,s){n?e(r.pkey,s):t(r.pkey,s)}},s.renderRow=function(e,t,r){var n=e.event,o=e.isSelected,a=e.handleSelect,l=e.deletionFilterStatus,c=e.isInSelectionMode,d=s.isInSelectMode(),u=s.props.filesCurrentlyBeingRestored.has(n.pkey);return i.createElement(y.TrashViewRow,{expShowMultiselect:s.props.deletedFilesMultiselectExp,isInSelectionMode:c,onClick:s.clickOnRow,isSelected:o,isRestoring:u,onSelect:a,deletionFilterStatus:l,isInSelectMode:d,event:n,index:t,topOffset:r})},s.handleSelectionChange=function(e){s.setState({selection:e})},s.handleTabbingStart=function(){},s.getTrashViewRowItems=A.createSelector(function(e){return e.events},function(e){return e.selection},function(e){return e.handleSelect},function(e){return e.handleDeselect},function(e){return e.deletionFilterStatus},function(e){return e.selection.selected.size>0},function(e,t,r,n,o,i){return e.map(function(e){return{event:e,isSelected:t.selected.has(e.pkey),handleSelect:s.makeRowSelectCallback(r,n),deletionFilterStatus:o,isInSelectionMode:i}})}),s.renderTrashContentTable=function(e){var t=(e.focusedFileId,e.handleDeselect),r=(e.handleDeselectAll,e.handleFocusFile,e.handleSelect),o=(e.handleSelectAll,e.isSelectableListEvent,s.props.deletedFilesMultiselectExp?I.TRASH_VIEW_COLUMN_MULTISELECT_FLEX:I.TRASH_VIEW_COLUMN_FLEX);return i.createElement(n.Table,{columnFlex:o,key:"trash-content"},s.makeTableHeader(),i.createElement(n.CulledTableBody,{items:s.getTrashViewRowItems({events:s.props.events,handleDeselect:t,handleSelect:r,selection:s.state.selection,deletionFilterStatus:s.props.deletionFilterStatus}),listItemHeight:s.props.listItemHeight,renderRow:s.renderRow}))},s.filtersHaveValue=function(e){var t=e.calendarFilterSettings,r=e.userFilterSettings,n=e.hostFilterSettings,s=e.parentFolderSettings;return v.filtersHaveValue({calendarFilter:t,userFilter:r,hostFilter:n,parentFolderFilter:s})},s.hasEventsToRender=function(){return s.props.events.length>0},s.getSelectedEvents=function(){var e=s.state.selection.selected,t=s.eventsByPKey();return e.toArray().map(function(e){return t[e]})},s.confirmPurge=function(){var e=s.getSelectedEvents(),t=s.makePurgeCallback(e);m.initializeTrashStore(s.props.user.id,s.getSelectedEvents(),s.props.deletedFilesMultiselectExp),w.showPurgeModal({onPurge:t}),F.logPurgeModalActivity(s.props.user.id,"purge-modal-show",{location:"deleted_files"})},s.state={scrollPosition:0,selection:_.createSelection()},s}return r.__extends(P,t),P.prototype.componentDidMount=function(){window.addEventListener("scroll",this.updateOnScroll),this.updateOnScroll()},P.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this.updateOnScroll)},P.prototype.makeRestoreCallback=function(e){var t=this;return this.props.isOverFreeQuota?this.overquotaCallback:function(){t.props.onRestoreDeletionEvent(e),t.setState({selection:_.createSelection()})}},P.prototype.makePurgeCallback=function(e){var t=this;return function(){t.props.onPurgeDeletionEvent(e,t.props.deletedFilesMultiselectExp),t.setState({selection:_.createSelection()})}},P.prototype.makeTableHeader=function(){return i.createElement(n.FixedTableHead,null,this.props.deletedFilesMultiselectExp&&i.createElement(n.TableHeadCell,{className:"trash-checkbox-cell"}),i.createElement(n.TableHeadCell,null,E._("Name")),i.createElement(n.TableHeadCell,null,E._("Deleted")))},P.prototype.renderTrashContent=function(){return i.createElement(S.SelectableList,{itemIds:this.props.events.map(function(e){return e.pkey}),keyScope:S.SELECTABLE_LIST_KEY_SCOPE,onSelectionChange:this.handleSelectionChange,onTabbingStart:this.handleTabbingStart,selection:this.state.selection,tilesPerRow:I.SELECTABLE_LIST_TILES_PER_ROW},this.renderTrashContentTable)},P.prototype.maybeRenderEVHUpsellBanner=function(){var e=this.props.user;return e.is_team?null:e.paid||"basic_biz_domain"===this.props.evhUserType?!e.paid&&"basic_biz_domain"===this.props.evhUserType||e.paid&&"plus_biz_domain_can_have_evh"===this.props.evhUserType?i.createElement("div",{className:"trash-evh-upsell-banner",key:"evhupsell"},i.createElement("span",null,E._("You have up to 30 days to restore a deleted file.")),i.createElement("br",null),p.reactFormat(E._("To keep deleted files for up to 120 days, <a>upgrade to %(trademark)s</a>."),{a:i.createElement("a",{href:"/plans",target:"_blank",rel:"noopener noreferrer"}),trademark:f.TRADEMARK_BUSINESS})):null:i.createElement("div",{className:"trash-evh-upsell-banner",key:"evhupsell"},i.createElement("span",null,E._("You have up to 30 days to restore a deleted file.")),i.createElement("br",null),p.reactFormat(E._("To keep deleted files for up to 120 days, <a>upgrade to Dropbox %(trademark)s</a>."),{a:i.createElement("a",{href:"/plans",target:"_blank",rel:"noopener noreferrer"}),trademark:f.TRADEMARK_PROFESSIONAL}))},P.prototype.renderNoTrash=function(){var e,t;return e=this.filtersHaveValue(this.props.deletionFilterStatus)?E._("No deleted files found. Try adjusting your filters"):E._("You donâ€™t have any recently deleted files"),t=h.static_url("/static/images/empty_states/illo-trash-vflwBmpyb.png"),i.createElement("div",{className:"tab-empty-state",id:"trash-empty-state",key:"notrash"},i.createElement("img",{src:t,alt:""}),i.createElement("div",{className:"empty-explanation"},i.createElement("div",{className:"page-header-text"},e),this.maybeRenderEVHUpsellBanner()))},P.prototype.renderFetchingTrash=function(){return i.createElement("div",{className:"maestro-loading-spinner-wrapper",key:"fetchingtrash"},i.createElement("div",{className:"maestro-loading-spinner"}))},P.prototype.renderFetchingMore=function(){return i.createElement("div",{className:"maestro-loading-spinner-more-data",key:"fetchingmore"},i.createElement("div",{className:"maestro-loading-spinner"}))},P.prototype.renderRestoreFilesTip=function(){return i.createElement("div",{className:"trash-restore-files-tip__shadow",key:"trash-restore-files-tip"},i.createElement(o.VerticallyFixed,{className:"trash-restore-files-tip"},i.createElement(s.TipCard,{onDismiss:this.props.onRestoreFilesTipDismiss,dismissAriaLabel:E._("dismiss"),dismissible:!0},p.reactFormat(E._("Need help restoring deleted files? <a>Learn more</a>",{project:"maestro"}),{a:i.createElement("a",{href:"/help/9217"})}))))},P.prototype.renderBody=function(){var e=[];return this.props.seenRestoreFilesTip||e.push(this.renderRestoreFilesTip()),this.hasEventsToRender()?(e.push(this.renderTrashContent()),this.props.handleComponentReady("TrashView"),this.props.loading?e.push(this.renderFetchingMore()):e.push(this.maybeRenderEVHUpsellBanner())):this.props.loading?e.push(this.renderFetchingTrash()):(e.push(this.renderNoTrash()),this.props.handleComponentReady("TrashView")),i.createElement("div",{className:"trash-body"},e)},P.prototype.renderFilterView=function(){var e=this.props.deletionFilterStatus,t=e.calendarFilterSettings,r=e.userFilterSettings,n=e.hostFilterSettings,s=e.parentFolderSettings,o=e.onFilterClear,a=!!this.props.filterViewDisabled||!this.hasEventsToRender()&&!this.filtersHaveValue(this.props.deletionFilterStatus);return i.createElement(g.DeletedFilesFilterView,{user:this.props.user,disabled:a,calendarFilter:t,userFilter:r,hostFilter:n,parentFolderFilter:s,onFilterClear:o})},P.prototype.eventsByPKey=function(){for(var e={},t=0,r=this.props.events;t<r.length;t++){var n=r[t];e[n.pkey]=n}return e},P.prototype.renderSelectModeSidebarView=function(){return i.createElement(T.Sidebar,{content:i.createElement("div",null,i.createElement("span",{className:"primary-action-menu__header-text"},E.ungettext("%(file_count)d item selected","%(file_count)d items selected",this.numSelected()).format({file_count:this.numSelected()})),i.createElement(b.Button,{onClick:this.launchModalWithSelection,fullWidth:!0},E._("Restore")),i.createElement("ul",{className:"mc-tertiary-list secondary-action-menu"},i.createElement("li",{className:"mc-tertiary-list-element"},i.createElement(C.TertiaryLink,{onClick:this.confirmPurge,icon:"delete"},E._("Permanently delete")))))})},P.prototype.renderSidebar=function(){return this.isInSelectMode()?this.renderSelectModeSidebarView():this.renderFilterView()},P.prototype.render=function(){var e={searchBarExperiments:this.props.searchBarExperiments,enableDeletedChip:R.isInDeletedFilterRightRailExperiment(this.props.searchBarExperiments),currentPath:this.props.deletionFilterStatus.parentFolderSettings.selectedPath};return i.createElement(d.MaestroChrome,{user:this.props.user,titleRegion:i.createElement(c.MaestroHeaderTitle,null,E._("Deleted files")),embeddedAppRegion:this.renderBody(),actionSidebarRegion:this.renderSidebar(),searchBarProps:e})},P.defaultProps={filterViewDisabled:!1,listItemHeight:72,loading:!1,seenRestoreFilesTip:!1,handleComponentReady:function(e){return null}},P})(i.Component);t.TrashView=P}),define("modules/clean/react/trash/trash_view_row",["require","exports","tslib","external/react","external/react-dom","external/classnames","spectrum/checkbox","modules/clean/react/tooltip","modules/core/i18n","spectrum/media_table","modules/clean/react/file_path_breadcrumb","spectrum/file_icon","spectrum/icon_content","modules/clean/react/icon/folder_icon","spectrum/icon_status"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.handleClick=function(e){var r=t.props.event;if(!(t.props.isRestoring||t.checkboxRef&&s.findDOMNode(t.checkboxRef).contains(e.target)))return t.props.isInSelectionMode&&t.props.onSelect?void t.props.onSelect(t.props.event,!t.props.isSelected,!1):t.props.onClick(r)},t.handleSelectionChange=function(e,r,n){t.props.onSelect&&t.props.onSelect(t.props.event,"checked"===e,r.shiftKey)},t.setCheckboxRef=function(e){t.checkboxRef=e},t}return r.__extends(t,e),t.prototype.renderLeftmostColumn=function(e){var t=this.props,r=t.isInSelectMode,s=t.isRestoring,o=e||r;return s?n.createElement("div",{className:"trash-vertically-center"},n.createElement(h.IconStatus,{name:"sync",rotating:!0})):e||r?n.createElement("div",{className:"trash-vertically-center"},n.createElement(i.Checkbox,{ref:this.setCheckboxRef,checked:this.props.isSelected?"checked":"unchecked",ariaLabel:"selected",variant:o?"default":"invisible",onChange:this.handleSelectionChange})):void 0},t.prototype.render=function(){var e=this,t=this.props,r=t.event,s=t.topOffset,i=t.isSelected,d=t.isRestoring,u=r.is_folder,p=u||r.file_count>1,_=this.props.deletionFilterStatus,h=void 0;if(r.actor_email&&_.userFilterSettings.selectedUserEmail){var m=_.hostFilterSettings.userHostDetails.get(r.actor_email);m&&(h=n.createElement(a.Tooltip,{position:a.TooltipPosition.RIGHT,tooltip_contents:m.getHostDisplayName(r.host_id),tooltip_classname:"trash-row__tooltip"},m.getHostShortName(r.host_id)))}else r.name&&(h=l._("by %(event_name)s").format({event_name:r.name}));return n.createElement(c.CulledMediaRow,{key:r.pkey,doubleLine:!0,variant:"selected",className:o("mc-table-row-culled",{"trash-group-item":!!p,"trash-row-selected":i,"trash-row-restoring":d}),onClick:this.handleClick,topOffset:s},function(t){var s=t.isHovered,o=s&&!e.props.isRestoring,i=[];return e.props.expShowMultiselect&&i.push(n.createElement(c.MediaCell,{key:"checkboxCell",className:"trash-checkbox-cell"},e.renderLeftmostColumn(s))),i=i.concat([n.createElement(c.MediaCell,{key:"event_title",highlight:o,icon:e.renderEventIcon(r,u),title:r.file_name,subtitle:e.renderDeletionPath(r.src_path)}),n.createElement(c.MediaCell,{key:"event_meta",title:r.ago,subtitle:h,variant:"detail"})])})},t.prototype.renderEventIcon=function(e,t){return t?n.createElement(p.IconContent,{name:_.convertLegacyFolderIconToSpectrum(e.icon,"small")}):n.createElement(u.FileIcon,{path:e.file_name})},t.prototype.renderDeletionPath=function(e){if(e){for(var t=[{name:"Dropbox",url:""}],r=0,s=e.split("/");r<s.length;r++){var o=s[r];t.push({name:o,url:""})}return n.createElement("span",{className:"deletion-path"},n.createElement(d.FilePathBreadcrumb,{paths:t,useLinks:!1,pathClassname:"deletion-path__item",maxWidth:25}))}},t})(n.Component);t.TrashViewRow=m}),define("modules/clean/react/trash/utils",["require","exports","tslib"],function(e,t,r){"use strict";function n(e){var t=e.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(null==t)return null;var r=t[1],n=t[2],s=t[3];1===r.length&&(r="0"+r),1===n.length&&(n="0"+n);var o=Date.parse(s+"-"+n+"-"+r);return isNaN(o)?null:Number(new Date(Number(s),Number(n)-1,Number(r)))}function s(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(e){return[2,new Promise(function(e){requestAnimationFrame(function(){return e()})})]})})}function o(e){return Math.floor(Math.min(e||+(1/0),Date.now()/1e3))}function i(e,t){var r=function(e){var t=i||Number.MIN_VALUE,r=a||Number.MAX_VALUE;return e.timestamp>=t&&e.timestamp<=r},n=function(e){return null===l||e.actor_email===l},s=function(e){return null===c||0===c.length||c.includes(e.host_id)},o=function(e){return null===d||e.containing_deletion_path.startsWith(d)},i=t.start_ts,a=t.end_ts,l=t.actor_email,c=t.selected_host_ids,d=t.fq_path;return e.sort(function(e,t){return t.timestamp-e.timestamp}).filter(function(e){return r(e)&&n(e)&&s(e)&&o(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.parseDateFromString=n,t.nextRAF=s,t.determineMaxTs=o,t.getFilteredEventsWithFilters=i}),define("modules/clean/react/tree_view",["require","exports","tslib","external/classnames","external/immutable","external/react","external/react-dom","external/lodash","modules/clean/react/icon/folder_icon","spectrum/icon_content","jquery","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/keycode","modules/clean/react/css","modules/clean/react/sprite","modules/core/i18n","modules/core/notify"],function(e,t,r,n,s,o,i,a,l,c,d,u,p,_,h,m,f,E,g){"use strict";function v(e,t,r){var n={ns_id:r,ns_path:t,hide_tmfs:!0};return u.WebRequestOref({url:"/browse_util/tree_view_team_folder_contents",type:"POST",subject_user:e,data:n,dataType:"json"})}function y(e){var t=e.mkAjaxRequest||function(t){return v(e.userId,t,e.rootNSID)};return o.createElement(O,r.__assign({},e,{isRootSelectable:!0,rootIcon:P.DROPBOX,mkAjaxRequest:t}))}function S(e,t){var r={folder:t};return u.WebRequestOref({url:"/browse_util/tree_view_folders",type:"POST",subject_user:e,data:r,dataType:"json"})}function I(e){var t=e.mkAjaxRequest||function(t){return S(e.user.id,t)},n=e.forceRootSelectable||"edit"===e.user.user_root_permissions,s=e.is_paired?e.user.is_team?P.BRIEFCASE:P.HOUSE:P.DROPBOX,i=r.__assign({},e,{mkAjaxRequest:t,isRootSelectable:n,rootIcon:s});if(e.user.is_cdm_member){var a=e.user.cdm_tmf_path;return o.createElement(L,r.__assign({},i,{pinnedFolder:a}))}return o.createElement(O,r.__assign({},i))}Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_LABEL_LENGTH=20,t.INDENT_SIZE_PX=15;var T;(function(e){e[e.None=0]="None",e[e.TreeItem=1]="TreeItem",e[e.HeaderItem=2]="HeaderItem",e[e.StaticHeader=3]="StaticHeader"})(T=t.RootStyle||(t.RootStyle={}));var b=(function(){function e(e){this.key=e.key,this.label=e.label?e.label:"",this.icon=e.icon?e.icon:"",this.disabled=!!e.disabled,this.canExpand=!!e.canExpand,this.forceExpanded=!!e.forceExpanded}return e})();t.TreeItem=b;var A=(function(){function e(e){var t=s.Map();this.rootItem=e.rootItem,this.items=e.items,this.childItemsByParentKey=e.childItemsByParentKey||t,this.parentItemByChildKey=e.parentItemByChildKey||s.Map()}return e.createWithRootItem=function(t){return new e({rootItem:t,items:s.Map([[t.key,t]])})},e.prototype.getParentItem=function(e){if(e){var t=this.parentItemByChildKey.get(e.key);return t?this.items.get(t):null}},e.prototype.getChildItems=function(e){return this.childItemsByParentKey.get(e.key)||null},e.prototype.isParent=function(e){return this.childItemsByParentKey.has(e.key)},e.prototype.setChildItems=function(t,r){r=s.List(r);var n=s.Map(r.map(function(e){return[e.key,e]})),o=s.Map(this.items).merge(n),i=s.Map(this.childItemsByParentKey).set(t.key,r),a=s.Map(this.parentItemByChildKey);return r.forEach(function(e){return a=a.set(e.key,t.key)}),new e({rootItem:this.rootItem,items:o,childItemsByParentKey:i,parentItemByChildKey:a})},e})();t.Tree=A;var C=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return o.createElement("ul",{className:"tree-view__group",role:"group"},this.props.children)},t})(o.Component),w=(function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(e){if(e.preventDefault(),e.stopPropagation(),!t.props.item.disabled){var r=i.findDOMNode(t.refs.expandButton);r&&r.contains(e.target)||t.props.onClick&&t.props.onClick(t.props.item)}},t.handleExpandClick=function(e){e.preventDefault(),t.props.onExpandButtonClick&&t.props.onExpandButtonClick(t.props.item,!t.props.isExpanded)},t}return r.__extends(s,e),s.prototype.renderExpandButton=function(){return o.createElement("div",{className:"tree-view__expand-button",onClick:this.handleExpandClick,ref:"expandButton",role:"button"},o.createElement(f.Sprite,{group:"web",name:this.props.isExpanded?"bullet_minus":"bullet_plus",alt:this.props.isExpanded?E._("Collapse"):E._("Expand")}))},s.prototype.renderIcon=function(){var e=this.props.item,t=e.icon,r=e.disabled;return o.createElement("div",{className:"tree-view__icon-wrapper"},o.createElement(c.IconContent,{className:"tree-view__item-icon",name:l.convertLegacyFolderIconToSpectrum(t,"small"),disabled:r,height:19,width:19}))},s.prototype.render=function(){var e=!this.props.canExpand,r=n({"tree-view__item":!0,"tree-view__item--leaf":e}),s=this.props.canExpand&&!this.props.showAsHeader;return o.createElement("li",{key:this.props.item.key,id:this.props.id,className:r,onClick:this.handleClick,role:"treeitem","aria-disabled":this.props.item.disabled,"aria-label":this.props.item.label,"aria-level":this.props.level+1,"aria-selected":!!this.props.isSelected||void 0,"aria-expanded":s?this.props.isExpanded:void 0},o.createElement("span",{className:n({"tree-view__item-row":!0,"tree-view__item-row--disabled":this.props.item.disabled}),style:{paddingLeft:this.props.showAsHeader?0:this.props.level*t.INDENT_SIZE_PX}},this.props.showAsHeader||e?void 0:this.renderExpandButton(),this.props.item.icon?this.renderIcon():void 0,this.props.item.label?o.createElement("span",{className:"tree-view__item-label"},p.Emstring.em_snippet(this.props.item.label,t.MAX_LABEL_LENGTH)):void 0),this.props.children)},s.defaultProps={isSelected:!1,isExpanded:!1,canExpand:!1,level:0,onClick:a.noop,onExpandButtonClick:a.noop,showAsHeader:!1},s})(o.Component);t.TreeItemView=w;var F=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.renderIcon=function(){return this.props.item.icon?o.createElement(f.Sprite,{className:"tree-view__header-icon",group:"web",name:this.props.item.icon,alt:""}):null},t.prototype.render=function(){return o.createElement("div",{className:"tree-view__item-row"},this.renderIcon(),o.createElement("h3",{className:"tree-view__header",id:this.props.id},this.props.item.label))},t})(o.Component),R=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={selectedItemKey:null,expandedItemKeys:s.Set([t.props.tree.rootItem.key]),showFocused:!1},t.selectItem=function(e){t.setState({selectedItemKey:null!=e&&e.key?e.key:null}),t.props.onItemSelected(e)},t.handleExpandButtonClick=function(e,r){t.setState({expandedItemKeys:t.setItemExpanded(e.key,r)}),t.props.onItemExpanded(e,r)},t.handleKeyDown=function(e){switch(e.which){case h.KeyCode.UP:t.advanceSelection(!0)&&e.preventDefault();break;case h.KeyCode.DOWN:t.advanceSelection(!1)&&e.preventDefault();break;case h.KeyCode.RIGHT:if(null!=t.state.selectedItemKey){var r=t.props.tree.items.get(t.state.selectedItemKey);t.canItemExpand(r)&&(t.handleExpandButtonClick(r,!0),e.preventDefault())}break;case h.KeyCode.LEFT:if(t.state.selectedItemKey){var r=t.props.tree.items.get(t.state.selectedItemKey);t.canItemExpand(r)&&(t.handleExpandButtonClick(r,!1),e.preventDefault())}}},t.handleOnFocus=function(){return t.setState({showFocused:!0})},t.handleOnBlur=function(){return t.setState({showFocused:!1})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){d(i.findDOMNode(this)).on({keydown:this.handleKeyDown})},t.prototype.componentWillReceiveProps=function(e){e.resetSelectedItem&&e.resetSelectedItem!==this.props.resetSelectedItem&&this.setState({selectedItemKey:null})},t.prototype.componentWillUnmount=function(){d(i.findDOMNode(this)).off("keydown")},t.prototype.componentDidUpdate=function(e,t){if(this.state.selectedItemKey&&this.state.selectedItemKey!==t.selectedItemKey){var r=d(i.findDOMNode(this)),n=r.find('[aria-selected="true"]').eq(0);n.length&&this.scrollElementIntoViewIfNeeded(n,r)}},t.prototype.scrollElementIntoViewIfNeeded=function(e,t){var r=t.scrollTop(),n=r+e.position().top;if(n-r<0)return void t.scrollTop(n);var s=t.innerHeight(),o=r+s,i=e.innerHeight();n+i>o&&t.scrollTop(n-s+i)},t.prototype.hasSelectableRootItem=function(){var e=this.props.rootStyle;return e===T.TreeItem||e===T.HeaderItem},t.prototype.getHTMLIdPrefix=function(){return this.HTMLIdPrefix||(this.HTMLIdPrefix="tree-view-"+Math.floor(16777215*Math.random()).toString(16))},t.prototype.getLastLeafOf=function(e){var t=this.props.tree.getChildItems(e);return this.state.expandedItemKeys.contains(e.key)&&null!=t&&t.size>0?this.getLastLeafOf(t.last()):e},t.prototype.getPrevItem=function(e){if(!e)return null;var t=this.props.tree.getParentItem(e);if(!t)return null;var r=this.props.tree.getChildItems(t),n=r.indexOf(e);if(n>0)return this.getLastLeafOf(r.get(n-1));if(0===n){
return t===this.props.tree.rootItem&&!this.hasSelectableRootItem()?null:t}return null},t.prototype.getNextItem=function(e,t){if(void 0===t&&(t=!0),!e)return null;var r=this.state.expandedItemKeys.contains(e.key),n=r&&this.props.tree.isParent(e);if(t&&n)return this.props.tree.getChildItems(e).first();var s=this.props.tree.getParentItem(e);if(!s)return null;var o=this.props.tree.getChildItems(s),i=o.size-1,a=o.indexOf(e);return a===i?this.getNextItem(s,!1):0<=a&&a<i?o.get(a+1)||null:null},t.prototype.advanceSelection=function(e){if(void 0===e&&(e=!1),!this.state.selectedItemKey){var t=void 0;if(this.hasSelectableRootItem())t=this.props.tree.rootItem;else{var r=this.props.tree.getChildItems(this.props.tree.rootItem);t=r?r.first():null}return this.selectItem(t),!0}var n=this.props.tree.items.get(this.state.selectedItemKey),s=e?this.getPrevItem(n):this.getNextItem(n);return!!s&&(this.selectItem(s),!0)},t.prototype.getValidHTMLIdForItem=function(e){return(""+this.getHTMLIdPrefix()+e.key).replace(/\s+/g,"_")},t.prototype.setItemExpanded=function(e,t){return t?this.state.expandedItemKeys.add(e):this.state.expandedItemKeys.delete(e)},t.prototype.canItemExpand=function(e){return e&&(e.canExpand||this.props.tree.isParent(e))},t.prototype.renderSingleItem=function(e,t,n,s){void 0===s&&(s={});var i=r.__assign({id:this.getValidHTMLIdForItem(e),key:e.key,item:e,isSelected:this.state.selectedItemKey===e.key,isExpanded:this.state.expandedItemKeys.contains(e.key)||e.forceExpanded,canExpand:this.canItemExpand(e)&&!e.forceExpanded,level:t,onClick:this.selectItem,onExpandButtonClick:this.handleExpandButtonClick},s),a=this.props.treeItemView;return o.createElement(a,r.__assign({},i),n)},t.prototype.renderItemAndDescendants=function(e,t){var r,n=this.state.expandedItemKeys.contains(e.key)||e.forceExpanded;return this.props.tree.isParent(e)&&n&&(r=this.renderChildrenOfItemAsGroup(e,t+1)),this.renderSingleItem(e,t,r)},t.prototype.renderChildrenOfItemAsGroup=function(e,t){var r=this;if(!e||!this.props.tree.isParent(e))return null;var n=this.props.tree.getChildItems(e).map(function(e){return r.renderItemAndDescendants(e,t)});return o.createElement(C,null,n.toJS())},t.prototype.render=function(){var e,t,r,s=this.props.tree.rootItem;if(this.props.rootStyle===T.TreeItem)t=o.createElement(C,null,this.renderItemAndDescendants(s,0));else if(this.props.rootStyle===T.HeaderItem)e=this.getValidHTMLIdForItem(s),t=o.createElement(C,null,this.renderSingleItem(s,0,null,{showAsHeader:!0,id:e}),this.renderChildrenOfItemAsGroup(s,0));else if(this.props.rootStyle===T.StaticHeader)e=this.getValidHTMLIdForItem(s),t=o.createElement(C,null,o.createElement(F,{item:s,id:e}),this.renderChildrenOfItemAsGroup(s,0));else{if(this.props.rootStyle!==T.None)throw new Error("Unknown root style: "+this.props.rootStyle);t=this.renderChildrenOfItemAsGroup(this.props.tree.rootItem,0)}if(this.state.selectedItemKey){var i=this.props.tree.items.get(this.state.selectedItemKey);r=this.getValidHTMLIdForItem(i)}return o.createElement("div",{role:"tree",tabIndex:0,onFocus:this.handleOnFocus,onBlur:this.handleOnBlur,className:n("tree-view","ax-focusable",{"is-focused":this.state.showFocused}),"aria-labelledby":e?e:void 0,"aria-activedescendant":r},t,this.props.children)},t.defaultProps={rootStyle:T.None,onItemSelected:function(e){},onItemExpanded:function(e,t){},treeItemView:w},t})(o.Component);t.TreeView=m(R,["/static/css/react/tree_view-vflwT7sZY.css","/static/css/accessibility-vflMYBl-j.css"]);var P;(function(e){e.BRIEFCASE="s_briefcase",e.HOUSE="s_house",e.DROPBOX="dropbox"})(P=t.RootIcon||(t.RootIcon={}));var N=(function(e){function t(t,r){var n=e.call(this,t)||this;return n.folderNsId=r,n}return r.__extends(t,e),t})(b);t.FolderTreeItem=N;var M=function(e){return new N({key:e.path,label:_.filename(e.path),canExpand:e.has_subdirs,icon:e.icon,disabled:e.read_only},e.contained_ns)},D=(function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._pendingAjaxRequest=null,t.state={showLoadingScreen:!1,tree:A.createWithRootItem(new b({key:"/",icon:t.props.rootIcon,label:t.props.treeRootName}))},t.asyncFetchSubFoldersForItem=function(e){var r=e===t.state.tree.rootItem;r&&t.setState({showLoadingScreen:!0}),t._pendingAjaxRequest&&t._pendingAjaxRequest.abort(),t._pendingAjaxRequest=t.props.mkAjaxRequest(e.key),Promise.resolve(t._pendingAjaxRequest).then(function(r){var n=t.parseFolderList(r),s=t.state.tree.setChildItems(e,n);t.setState({tree:s})}).catch(t.props.handleError).then(function(){if(null!=t._pendingAjaxRequest){t._pendingAjaxRequest=null,r&&(t.props.isLoadingAdditionalData||t.setState({showLoadingScreen:!1}));var e=i.findDOMNode(t.refs.treeView);e&&e.focus()}})},t.handleItemSelected=function(e){e instanceof N?t.props.onFolderSelected(e.key,e.folderNsId):t.props.onFolderSelected(e.key)},t.handleExpandButtonClick=function(e,r){r&&!t.state.tree.isParent(e)&&t.asyncFetchSubFoldersForItem(e)},t.renderLoadingMessage=function(){return o.createElement("span",{className:"tree-view__loading-label"},E._("Loading your foldersâ€¦"))},t}return r.__extends(n,e),n.prototype.componentDidMount=function(){this.asyncFetchSubFoldersForItem(this.state.tree.rootItem)},n.prototype.componentWillReceiveProps=function(e){e.isLoadingAdditionalData||e.isLoadingAdditionalData===this.props.isLoadingAdditionalData||this.setState({showLoadingScreen:!1})},n.prototype.componentWillUnmount=function(){this._pendingAjaxRequest&&(this._pendingAjaxRequest.abort(),this._pendingAjaxRequest=null)},n.prototype.parseFolderList=function(e){return e.map(M)},n.prototype.render=function(){var e=this.props.isRootSelectable?T.HeaderItem:T.StaticHeader;return o.createElement(t.TreeView,{ref:"treeView",tree:this.state.tree,rootStyle:e,onItemSelected:this.handleItemSelected,onItemExpanded:this.handleExpandButtonClick,resetSelectedItem:this.props.resetSelectedItem},this.state.showLoadingScreen?this.renderLoadingMessage():void 0)},n.defaultProps={onFolderSelected:function(e,t){},handleError:function(e){g.Notify.error(E._("An error occurred while trying to load your folder."))}},n})(o.Component),O=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(D);t.FolderTreeView=O;var L=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.parseFolderList=function(e){var t=this,r=-1,n=e.map(function(e,n){var s=e.path;return t.props.pinnedFolder&&s===t.props.pinnedFolder&&(r=n),M(e)});if(r!==-1){var s=n[r];n.splice(r,1),n.unshift(s)}return n},t})(D);t.PinnedFolderTreeView=L,t.AdminFolderTreeView=y,t.UserFolderTreeView=I}),define("spectrum/scroll_monitor",["require","exports","tslib","spectrum/scroll_monitor/index"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(n,t)});
//# sourceMappingURL=pkg-deleted_files.min.js-vflm73Ds_.map