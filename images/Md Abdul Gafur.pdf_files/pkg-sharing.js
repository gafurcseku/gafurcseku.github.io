(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define("react-aria-menubutton",["react","react-dom"],t):"object"==typeof exports?exports.ReactAriaMenuButton=t(require("react"),require("react-dom")):e.ReactAriaMenuButton=t(e.React,e.ReactDOM)})(this,function(e,t){return(function(e){function t(r){if(n[r])return n[r].exports;var s=n[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=14)})([function(e,t,n){"use strict";e.exports=function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&(n[r]||(e[r]=t[r]))}},function(e,t,n){if("production"!==JSON.stringify("production")){var r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,s=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r};e.exports=n(18)(s,!0)}else e.exports=n(17)()},function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){return function(){return e}}var s=function(){};s.thatReturns=r,s.thatReturnsFalse=r(!1),s.thatReturnsTrue=r(!0),s.thatReturnsNull=r(null),s.thatReturnsThis=function(){return this},s.thatReturnsArgument=function(e){return e},e.exports=s},function(e,t,n){"use strict";function r(e,t,n,r,i,a,o,l){if(s(t),!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[n,r,i,a,o,l],p=0;c=new Error(t.replace(/%s/g,function(){return d[p++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}}var s=function(e){};"production"!==JSON.stringify("production")&&(s=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),e.exports=r},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";function r(e,t){o[e]=t}function s(e){delete o[e]}function i(e,t){var n=o[e];if(!n)throw new Error("Cannot open "+l);n.openMenu(t)}function a(e,t){var n=o[e];if(!n)throw new Error("Cannot close "+l);n.closeMenu(t)}var o={},l="a menu outside a mounted Wrapper with an id, or a menu that does not exist";e.exports={registerManager:r,unregisterManager:s,openMenu:i,closeMenu:a}},function(e,t,n){"use strict";var r=n(3),s=r;if("production"!==JSON.stringify("production")){var i=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=0,i="Warning: "+e.replace(/%s/g,function(){return n[s++]});"undefined"!=typeof console&&console.error(i);try{throw new Error(i)}catch(e){}};s=function(e,t){if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){for(var n=arguments.length,r=Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];i.apply(void 0,[t].concat(r))}}}e.exports=s},function(e,n){e.exports=t},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=(function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}})(),o=n(2),l=n(1),c=n(0),d={children:l.node.isRequired,disabled:l.bool,tag:l.string},p=(function(e){function t(){var e,n,i,a;r(this,t);for(var o=arguments.length,l=Array(o),c=0;c<o;c++)l[c]=arguments[c];return n=i=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.handleKeyDown=function(e){if(!i.props.disabled){var t=i.context.ambManager;switch(e.key){case"ArrowDown":e.preventDefault(),t.isOpen?t.focusItem(0):t.openMenu();break;case"Enter":case" ":e.preventDefault(),t.toggleMenu();break;case"Escape":t.handleMenuKey(e);break;default:t.handleButtonNonArrowKey(e)}}},i.handleClick=function(){i.props.disabled||i.context.ambManager.toggleMenu({},{focusMenu:!1})},a=n,s(i,a)}return i(t,e),a(t,[{key:"componentWillMount",value:function(){this.context.ambManager.button=this}},{key:"componentWillUnmount",value:function(){this.context.ambManager.destroy()}},{key:"render",value:function(){var e=this.props,t={role:"button",tabIndex:e.disabled?"":"0","aria-haspopup":!0,"aria-expanded":this.context.ambManager.isOpen,"aria-disabled":e.disabled,onKeyDown:this.handleKeyDown,onClick:this.handleClick,onBlur:this.context.ambManager.handleBlur};return c(t,e,d),o.createElement(e.tag,t,e.children)}}]),t})(o.Component);p.propTypes=d,p.contextTypes={ambManager:l.object.isRequired},p.defaultProps={tag:"span"},e.exports=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a,o,l=(function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}})(),c=n(2),d=n(8),p=n(1),u=n(19),m=n(0),h={children:p.oneOfType([p.func,p.node]).isRequired,tag:p.string};e.exports=(o=a=(function(e){function t(){var e,n,i,a;r(this,t);for(var o=arguments.length,l=Array(o),c=0;c<o;c++)l[c]=arguments[c];return n=i=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.addTapListener=function(){var e=d.findDOMNode(i);if(e){var t=e.ownerDocument;t&&(i.tapListener=u(t.documentElement,i.handleTap))}},i.handleTap=function(e){d.findDOMNode(i).contains(e.target)||d.findDOMNode(i.context.ambManager.button).contains(e.target)||i.context.ambManager.closeMenu()},a=n,s(i,a)}return i(t,e),l(t,[{key:"componentWillMount",value:function(){this.context.ambManager.menu=this}},{key:"componentDidUpdate",value:function(){var e=this.context.ambManager;e.isOpen&&!this.tapListener?this.addTapListener():!e.isOpen&&this.tapListener&&(this.tapListener.remove(),delete this.tapListener),e.isOpen||e.clearItems()}},{key:"componentWillUnmount",value:function(){this.tapListener&&this.tapListener.remove(),this.context.ambManager.destroy()}},{key:"render",value:function(){var e=this.props,t=this.context.ambManager,n=(function(){return"function"==typeof e.children?e.children({isOpen:t.isOpen}):!!t.isOpen&&e.children})();if(!n)return!1;var r={onKeyDown:t.handleMenuKey,role:"menu",onBlur:t.handleBlur,tabIndex:-1};return m(r,e,h),c.createElement(e.tag,r,n)}}]),t})(c.Component),a.propTypes=h,a.defaultProps={tag:"div"},a.contextTypes={ambManager:p.object.isRequired},o)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=(function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}})(),o=n(2),l=n(1),c=n(0),d={children:l.node.isRequired,tag:l.string,text:l.string,value:l.any},p=(function(e){function t(){var e,n,i,a;r(this,t);for(var o=arguments.length,l=Array(o),c=0;c<o;c++)l[c]=arguments[c];return n=i=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.handleKeyDown=function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i.selectItem(e))},i.selectItem=function(e){var t=void 0!==i.props.value?i.props.value:i.props.children;i.context.ambManager.handleSelection(t,e)},i.registerNode=function(e){i.node=e},a=n,s(i,a)}return i(t,e),a(t,[{key:"componentDidMount",value:function(){this.context.ambManager.addItem({node:this.node,text:this.props.text})}},{key:"render",value:function(){var e={onClick:this.selectItem,onKeyDown:this.handleKeyDown,role:"menuitem",tabIndex:"-1",ref:this.registerNode};return c(e,this.props,d),o.createElement(this.props.tag,e,this.props.children)}}]),t})(o.Component);p.propTypes=d,p.defaultProps={tag:"div"},p.contextTypes={ambManager:l.object.isRequired},e.exports=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=(function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}})(),o=n(2),l=n(1),c=n(13),d=n(0),p={children:l.node.isRequired,onMenuToggle:l.func,onSelection:l.func.isRequired,closeOnSelection:l.bool,tag:l.string},u=(function(e){function t(){return r(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),a(t,[{key:"getChildContext",value:function(){return{ambManager:this.manager}}},{key:"componentWillMount",value:function(){this.manager=c({onMenuToggle:this.props.onMenuToggle,onSelection:this.props.onSelection,closeOnSelection:this.props.closeOnSelection,id:this.props.id})}},{key:"render",value:function(){var e={};return d(e,this.props,p),o.createElement(this.props.tag,e,this.props.children)}}]),t})(o.Component);u.propTypes=p,u.defaultProps={tag:"div"},u.childContextTypes={ambManager:l.object},e.exports=u},function(e,t,n){"use strict";function r(){var e=this;e.blurTimer=setTimeout(function(){var t=a.findDOMNode(e.button);if(t){var n=t.ownerDocument.activeElement;if(!t||n!==t){var r=a.findDOMNode(e.menu);if(r===n)return void e.focusItem(0);r&&r.contains(n)||e.isOpen&&e.closeMenu({focusButton:!1})}}},0)}function s(e,t){this.options.closeOnSelection&&this.closeMenu({focusButton:!0}),this.options.onSelection(e,t)}function i(e){this.isOpen&&"Escape"===e.key&&(e.preventDefault(),this.closeMenu({focusButton:!0}))}var a=n(8),o=n(15),l=n(6),c={wrap:!0,stringSearch:!0},d={init:function(e){this.options=e||{},void 0===this.options.closeOnSelection&&(this.options.closeOnSelection=!0),this.options.id&&l.registerManager(this.options.id,this),this.handleBlur=r.bind(this),this.handleSelection=s.bind(this),this.handleMenuKey=i.bind(this),this.focusGroup=o(c),this.button=null,this.menu=null,this.isOpen=!1},focusItem:function(e){this.focusGroup.focusNodeAtIndex(e)},addItem:function(e){this.focusGroup.addMember(e)},clearItems:function(){this.focusGroup.clearMembers()},handleButtonNonArrowKey:function(e){this.focusGroup._handleUnboundKey(e)},destroy:function(){this.button=null,this.menu=null,this.focusGroup.deactivate(),clearTimeout(this.blurTimer),clearTimeout(this.moveFocusTimer)},update:function(){this.menu.setState({isOpen:this.isOpen}),this.button.setState({menuOpen:this.isOpen}),this.options.onMenuToggle&&this.options.onMenuToggle({isOpen:this.isOpen})},openMenu:function(e){if(!this.isOpen&&(e=e||{},void 0===e.focusMenu&&(e.focusMenu=!0),this.isOpen=!0,this.update(),this.focusGroup.activate(),e.focusMenu)){var t=this;this.moveFocusTimer=setTimeout(function(){t.focusItem(0)},0)}},closeMenu:function(e){this.isOpen&&(e=e||{},this.isOpen=!1,this.update(),e.focusButton&&a.findDOMNode(this.button).focus())},toggleMenu:function(e,t){e=e||{},t=t||{},this.isOpen?this.closeMenu(e):this.openMenu(t)}};e.exports=function(e){var t=Object.create(d);return t.init(e),t}},function(e,t,n){"use strict";var r=n(6);e.exports={Wrapper:n(12),Button:n(9),Menu:n(10),MenuItem:n(11),openMenu:r.openMenu,closeMenu:r.closeMenu}},function(e,t){function n(e){e=e||{};var t=e.keybindings||{};this._settings={keybindings:{next:t.next||{keyCode:40},prev:t.prev||{keyCode:38},first:t.first,last:t.last},wrap:e.wrap,stringSearch:e.stringSearch,stringSearchDelay:800},this._keybindingsLookup=[];var n,r;for(n in this._settings.keybindings)r=this._settings.keybindings[n],r&&[].concat(r).forEach(function(e){e.metaKey=e.metaKey||!1,e.ctrlKey=e.ctrlKey||!1,e.altKey=e.altKey||!1,e.shiftKey=e.shiftKey||!1,this._keybindingsLookup.push({action:n,eventMatcher:e})}.bind(this));this._searchString="",this._members=[],e.members&&this.setMembers(e.members),this._boundHandleKeydownEvent=this._handleKeydownEvent.bind(this)}function r(e,t){for(var n in e)if(void 0!==t[n]&&e[n]!==t[n])return!1;return!0}function s(e){return e>=65&&e<=90}function i(e){e&&e.focus&&(e.focus(),"input"===e.tagName.toLowerCase()&&e.select())}n.prototype.activate=function(){return document.addEventListener("keydown",this._boundHandleKeydownEvent,!0),this},n.prototype.deactivate=function(){return document.removeEventListener("keydown",this._boundHandleKeydownEvent,!0),this._clearSearchStringRefreshTimer(),this},n.prototype._handleKeydownEvent=function(e){if(this._getActiveElementIndex()!==-1){var t=!1;this._keybindingsLookup.forEach(function(n){if(r(n.eventMatcher,e))switch(t=!0,e.preventDefault(),n.action){case"next":this.moveFocusForward();break;case"prev":this.moveFocusBack();break;case"first":this.moveFocusToFirst();break;case"last":this.moveFocusToLast();break;default:return}}.bind(this)),t||this._handleUnboundKey(e)}},n.prototype.moveFocusForward=function(){var e,t=this._getActiveElementIndex();return e=t<this._members.length-1?t+1:this._settings.wrap?0:t,this.focusNodeAtIndex(e),e},n.prototype.moveFocusBack=function(){var e,t=this._getActiveElementIndex();return e=t>0?t-1:this._settings.wrap?this._members.length-1:t,this.focusNodeAtIndex(e),e},n.prototype.moveFocusToFirst=function(){this.focusNodeAtIndex(0)},n.prototype.moveFocusToLast=function(){this.focusNodeAtIndex(this._members.length-1)},n.prototype._handleUnboundKey=function(e){if(this._settings.stringSearch){if(""!==this._searchString&&(" "===e.key||32===e.keyCode))return e.preventDefault(),-1;if(!s(e.keyCode))return-1;if(e.ctrlKey||e.metaKey||e.altKey)return-1;e.preventDefault(),this._addToSearchString(String.fromCharCode(e.keyCode)),this._runStringSearch()}},n.prototype._clearSearchString=function(){this._searchString=""},n.prototype._addToSearchString=function(e){this._searchString+=e.toLowerCase()},n.prototype._startSearchStringRefreshTimer=function(){var e=this;this._clearSearchStringRefreshTimer(),this._stringSearchTimer=setTimeout(function(){e._clearSearchString()},this._settings.stringSearchDelay)},n.prototype._clearSearchStringRefreshTimer=function(){clearTimeout(this._stringSearchTimer)},n.prototype._runStringSearch=function(){this._startSearchStringRefreshTimer(),this.moveFocusByString(this._searchString)},n.prototype.moveFocusByString=function(e){for(var t,n=0,r=this._members.length;n<r;n++)if(t=this._members[n],t.text&&0===t.text.indexOf(e))return i(t.node)},n.prototype._findIndexOfNode=function(e){for(var t=0,n=this._members.length;t<n;t++)if(this._members[t].node===e)return t;return-1},n.prototype._getActiveElementIndex=function(){return this._findIndexOfNode(document.activeElement)},n.prototype.focusNodeAtIndex=function(e){var t=this._members[e];return t&&i(t.node),this},n.prototype.addMember=function(e,t){var n=e.node||e,r=e.text||n.getAttribute("data-focus-group-text")||n.textContent||"";this._checkNode(n);var s=r.replace(/[\W_]/g,"").toLowerCase(),i={node:n,text:s};return null!==t&&void 0!==t?this._members.splice(t,0,i):this._members.push(i),this},n.prototype.removeMember=function(e){var t="number"==typeof e?e:this._findIndexOfNode(e);if(t!==-1)return this._members.splice(t,1),this},n.prototype.clearMembers=function(){return this._members=[],this},n.prototype.setMembers=function(e){this.clearMembers();for(var t=0,n=e.length;t<n;t++)this.addMember(e[t]);return this},n.prototype.getMembers=function(){return this._members},n.prototype._checkNode=function(e){if(!e.nodeType||e.nodeType!==window.Node.ELEMENT_NODE)throw new Error("focus-group: only DOM nodes allowed");return e},e.exports=function(e){return new n(e)}},function(e,t,n){"use strict";function r(e,t,n,r,l){if("production"!==JSON.stringify("production"))for(var c in e)if(e.hasOwnProperty(c)){var d;try{s("function"==typeof e[c],"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",r||"React class",n,c),d=e[c](t,c,r,n,null,a)}catch(e){d=e}if(i(!d||d instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,c,typeof d),d instanceof Error&&!(d.message in o)){o[d.message]=!0;var p=l?l():"";i(!1,"Failed %s type: %s%s",n,d.message,null!=p?p:"")}}}if("production"!==JSON.stringify("production"))var s=n(4),i=n(7),a=n(5),o={};e.exports=r},function(e,t,n){"use strict";var r=n(3),s=n(4),i=n(5);e.exports=function(){function e(e,t,n,r,a,o){o!==i&&s(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t};return n.checkPropTypes=r,n.PropTypes=n,n}},function(e,t,n){"use strict";var r=n(3),s=n(4),i=n(7),a=n(5),o=n(16);e.exports=function(e,t){function n(e){var t=e&&(T&&e[T]||e["@@iterator"]);if("function"==typeof t)return t}function l(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function c(e){this.message=e,this.stack=""}function d(e){function n(n,l,d,p,u,m,h){if(p=p||"<<anonymous>>",m=m||d,h!==a)if(t)s(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==JSON.stringify("production")&&"undefined"!=typeof console){var _=p+":"+d;!r[_]&&o<3&&(i(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",m,p),r[_]=!0,o++)}return null==l[d]?n?new c(null===l[d]?"The "+u+" `"+m+"` is marked as required in `"+p+"`, but its value is `null`.":"The "+u+" `"+m+"` is marked as required in `"+p+"`, but its value is `undefined`."):null:e(l,d,p,u,m)}if("production"!==JSON.stringify("production"))var r={},o=0;var l=n.bind(null,!1);return l.isRequired=n.bind(null,!0),l}function p(e){function t(t,n,r,s,i,a){var o=t[n];if(I(o)!==e)return new c("Invalid "+s+" `"+i+"` of type `"+C(o)+"` supplied to `"+r+"`, expected `"+e+"`.");return null}return d(t)}function u(){return d(r.thatReturnsNull)}function m(e){function t(t,n,r,s,i){if("function"!=typeof e)return new c("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside arrayOf.");var o=t[n];if(!Array.isArray(o)){return new c("Invalid "+s+" `"+i+"` of type `"+I(o)+"` supplied to `"+r+"`, expected an array.")}for(var l=0;l<o.length;l++){var d=e(o,l,r,s,i+"["+l+"]",a);if(d instanceof Error)return d}return null}return d(t)}function h(){function t(t,n,r,s,i){var a=t[n];if(!e(a)){return new c("Invalid "+s+" `"+i+"` of type `"+I(a)+"` supplied to `"+r+"`, expected a single ReactElement.")}return null}return d(t)}function _(e){function t(t,n,r,s,i){if(!(t[n]instanceof e)){var a=e.name||"<<anonymous>>";return new c("Invalid "+s+" `"+i+"` of type `"+N(t[n])+"` supplied to `"+r+"`, expected instance of `"+a+"`.")}return null}return d(t)}function f(e){function t(t,n,r,s,i){for(var a=t[n],o=0;o<e.length;o++)if(l(a,e[o]))return null;return new c("Invalid "+s+" `"+i+"` of value `"+a+"` supplied to `"+r+"`, expected one of "+JSON.stringify(e)+".")}return Array.isArray(e)?d(t):("production"!==JSON.stringify("production")&&i(!1,"Invalid argument supplied to oneOf, expected an instance of array."),r.thatReturnsNull)}function g(e){function t(t,n,r,s,i){if("function"!=typeof e)return new c("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside objectOf.");var o=t[n],l=I(o);if("object"!==l)return new c("Invalid "+s+" `"+i+"` of type `"+l+"` supplied to `"+r+"`, expected an object.");for(var d in o)if(o.hasOwnProperty(d)){var p=e(o,d,r,s,i+"."+d,a);if(p instanceof Error)return p}return null}return d(t)}function S(e){function t(t,n,r,s,i){for(var o=0;o<e.length;o++){if(null==(0,e[o])(t,n,r,s,i,a))return null}return new c("Invalid "+s+" `"+i+"` supplied to `"+r+"`.")}if(!Array.isArray(e))return"production"!==JSON.stringify("production")&&i(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),r.thatReturnsNull;for(var n=0;n<e.length;n++){var s=e[n];if("function"!=typeof s)return i(!1,"Invalid argument supplid to oneOfType. Expected an array of check functions, but received %s at index %s.",M(s),n),r.thatReturnsNull}return d(t)}function E(){function e(e,t,n,r,s){return y(e[t])?null:new c("Invalid "+r+" `"+s+"` supplied to `"+n+"`, expected a ReactNode.")}return d(e)}function b(e){function t(t,n,r,s,i){var o=t[n],l=I(o);if("object"!==l)return new c("Invalid "+s+" `"+i+"` of type `"+l+"` supplied to `"+r+"`, expected `object`.");for(var d in e){var p=e[d];if(p){var u=p(o,d,r,s,i+"."+d,a);if(u)return u}}return null}return d(t)}function y(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(y);if(null===t||e(t))return!0;var r=n(t);if(!r)return!1;var s,i=r.call(t);if(r!==t.entries){for(;!(s=i.next()).done;)if(!y(s.value))return!1}else for(;!(s=i.next()).done;){var a=s.value;if(a&&!y(a[1]))return!1}return!0;default:return!1}}function v(e,t){return"symbol"===e||("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}function I(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":v(t,e)?"symbol":t}function C(e){if(void 0===e||null===e)return""+e;var t=I(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function M(e){var t=C(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}function N(e){return e.constructor&&e.constructor.name?e.constructor.name:"<<anonymous>>"}var T="function"==typeof Symbol&&Symbol.iterator,A={array:p("array"),bool:p("boolean"),func:p("function"),number:p("number"),object:p("object"),string:p("string"),symbol:p("symbol"),any:u(),arrayOf:m,element:h(),instanceOf:_,node:E(),objectOf:g,oneOf:f,oneOfType:S,shape:b};return c.prototype=Error.prototype,A.checkPropTypes=o,A.PropTypes=A,A}},function(e,t){e.exports=function(e,t,n){function r(e){h||t(e)}function s(t){h=!0,u||(u=!0,e.addEventListener("touchmove",i,n),e.addEventListener("touchend",a,n),e.addEventListener("touchcancel",o,n),m=!1,d=t.touches[0].clientX,p=t.touches[0].clientY)}function i(e){m||Math.abs(e.touches[0].clientX-d)<=10&&Math.abs(e.touches[0].clientY-p)<=10||(m=!0)}function a(e){u=!1,l(),m||t(e)}function o(){u=!1,m=!1,d=0,p=0}function l(){e.removeEventListener("touchmove",i,n),e.removeEventListener("touchend",a,n),e.removeEventListener("touchcancel",o,n)}function c(){e.removeEventListener("click",r,n),e.removeEventListener("touchstart",s,n),l()}var d=0,p=0,u=!1,m=!1,h=!1;return e.addEventListener("click",r,n),e.addEventListener("touchstart",s,n),{remove:c}}}])}),define("modules/clean/clipboard_v2",["require","exports","external/flash_detect","jquery","modules/clean/clipboard","modules/core/browser","external/react","modules/core/exception"],function(e,t,n,r,s,i){"use strict";return(function(){function e(e,t,n,r){this.do_copy=this.do_copy.bind(this),this.copyText=e,this.onSuccess=t,this.onError=n,this.clickHandler=r}return e.prototype.setupCopy=function(t,n){var i=this,a=r(n),o=r(t);if(!e.is_flashless_clipboard_supported()){var l=function(){return"function"==typeof i.onSuccess&&i.onSuccess(),"function"==typeof i.clickHandler?i.clickHandler():void 0};return s.clipboard_overlay(this.copyText,o,l,a)}},e.prototype.do_copy=function(){if(e.is_supported()&&e.is_flashless_clipboard_supported()){return document.execCommand("copy",!1)?"function"==typeof this.onSuccess?this.onSuccess():void 0:"function"==typeof this.onError?this.onError():void 0}},e.is_supported=function(){return e.is_flashless_clipboard_supported()||n.installed},e.is_flashless_clipboard_supported=function(){var e=parseInt(i.version);return i.chrome?e>=42:i.mozilla?e>=41:i.opera?e>=29:i.msie?e>=9:!!i.edge||!!i.safari&&e>=10},e})()}),define("modules/clean/react/browse/professional_collection_actions",["require","exports","modules/clean/ajax","modules/core/browser","modules/core/notify","modules/core/i18n"],function(e,t,n,r,s,i){"use strict";function a(e,t,a){s.Notify.success(i._("Creating collection...")),n.WebRequest({url:"/premium_sharing/create",subject_user:a,data:{ns_id:e,path:t},success:function(e){var t=JSON.parse(e);t.error?s.Notify.error(t.error):r.redirect(t.collectionUrl)},error:function(){s.Notify.error(i._("Error during the creation of the collection."))}})}function o(t,n,r,s){var i=function(e){return(0,e.showAddToCollectionModal)(t,n,r,s)};i.perfName="add_to_collection_modal_controller",e(["modules/clean/react/professional_collection/add_to_collection_modal_controller"],i)}Object.defineProperty(t,"__esModule",{value:!0}),t.createProfessionalCollection=a,t.showAddToCollectionModal=o}),define("modules/clean/react/file_viewer/collection_viewer",["require","exports","tslib","external/lodash","external/react","external/react-redux","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/store","modules/constants/file_viewer","modules/clean/previews/constants","modules/clean/react/file_viewer/full_screen_helpers"],function(e,t,n,r,s,i,a,o,l,c,d,p,u){"use strict";function m(e,t,n,r,s){var i=t.filter(function(e){return!e.is_dir}),o=i.indexOf(e);if(o===-1)return{files:[e]};if(d.FILE_VIEWER_FLIP_ALL_FILES)return{files:i,sharedLinkInfos:n,sharePermissions:r,shareTokens:s};if(a.FlippableHelpers.isFlippableFile(e)){var l=[];return{files:i.filter(function(e,t){return a.FlippableHelpers.isFlippableFile(e)?(l.push(t),e):null}),sharedLinkInfos:n?l.map(function(e){return n[e]}):void 0,shareTokens:s?l.map(function(e){return s[e]}):void 0,sharePermissions:r?l.map(function(e){return r[e]}):void 0}}return{files:[e],sharePermissions:r?[r[o]]:void 0,shareTokens:s?[s[o]]:void 0,sharedLinkInfos:n?[n[o]]:void 0}}function h(e){var t=e.file,n=e.files,r=e.sharedLinkInfos,s=e.sharePermissions,i=e.shareTokens,a=m(t,n,r,s,i);return{collection:a,currentIndex:a.files.indexOf(t)}}Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.updateFileViewer=function(){var e=n.props,t=e.files,r=e.file,s=e.openFile,i=t.indexOf(r);i=i===-1?0:i,s(r)},n.handleFlipNext=function(){var e=n.state,t=e.collection,r=e.currentIndex,s=r+1===t.files.length?0:r+1;n.switchFile(s)},n.handleFlipPrevious=function(){var e=n.state,t=e.collection,r=e.currentIndex,s=0===r?t.files.length-1:r-1;n.switchFile(s)},n.switchFile=function(e){var t=n.props.openFile,r=n.state,s=r.collection,i=r.currentIndex,a=s.files[i].preview_type,o=s.files[e].preview_type;a===p.PreviewType.Photo&&o!==p.PreviewType.Photo&&u.exitFullScreen(),n.setState({currentIndex:e}),t(s.files[e])},n.state=h(t),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.updateFileViewer()},t.prototype.componentDidMount=function(){var e=this.state,t=e.collection,n=e.currentIndex;a.preloadImages(t.files,n)},t.prototype.componentWillReceiveProps=function(e,t){r.isEqual(this.props,e)?void 0!==t.currentIndex&&this.state.currentIndex!==t.currentIndex&&(a.preloadImages(t.collection.files,t.currentIndex),this.updateFileViewer()):this.setState(h(e))},t.prototype.render=function(){var e=this.props,t=(e.files,e.sharedLinkInfos,e.shareTokens,e.sharePermissions,n.__rest(e,["files","sharedLinkInfos","shareTokens","sharePermissions"])),r=this.state,i=r.currentIndex,a=r.collection;return s.createElement(o.FileViewer,n.__assign({fileIndex:i,fileCount:a.files.length,onFlipNext:this.handleFlipNext,onFlipPrevious:this.handleFlipPrevious,sharedLinkInfo:a.sharedLinkInfos?a.sharedLinkInfos[i]:void 0,shareToken:a.shareTokens?a.shareTokens[i]:void 0,sharePermission:a.sharePermissions?a.sharePermissions[i]:void 0},t))},t})(s.Component);t._FileCollectionViewer=_;var f=i.connect(void 0,{openFile:l.openFile})(_),g=c.getStoreForFileViewer(),S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return s.createElement(i.Provider,{store:g},s.createElement(f,n.__assign({},this.props)))},t})(s.Component);t.FileCollectionViewer=S}),define("modules/clean/react/file_viewer/controller",["require","exports","tslib","external/react","external/react-dom","external/lodash","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/utils","modules/core/browser","modules/clean/react/file_viewer/collection_viewer","modules/clean/file_store/utils","modules/clean/react/file_viewer/url_utils"],function(e,t,n,r,s,i,a,o,l,c,d,p,u){"use strict";function m(e){var t=o.getStoreForFileViewer(),r=n.__assign({},e);o.hydrateFileStore(t,r)}function h(e,t,r,s,i){v=s,a.start();var o=b(i);m(e),S(n.__assign({},o,{titleBarCloseUrl:u.getCurrentFolderHref(),files:e,file:e[t],disableFlipping:!!i.disableFlipping,sharedLinkInfos:i.sharedLinkInfos,shareTokens:i.shareTokens,sharePermissions:i.sharePermissions,user:r}))}function _(e){if(y){m(e);var t=y.props,r=p.getFileRevisionId(t.file),s=i.find(e,function(e){return p.getFileRevisionId(e)===r})||t.file;S(n.__assign({},t,{file:s,files:e}))}}function f(){E()}function g(){return null!=y}function S(e){var t=document.getElementById(v)
;y=s.render(r.createElement(d.FileCollectionViewer,n.__assign({},e)),t)}function E(){var e=document.getElementById(v);s.unmountComponentAtNode(e),y=null}function b(e){var t=(e.disableFlipping,e.initialPreviewSourceAction),r=e.initialPreviewSourceContext,s=(e.sharedLinkInfos,e.sharePermissions,e.shareTokens,n.__rest(e,["disableFlipping","initialPreviewSourceAction","initialPreviewSourceContext","sharedLinkInfos","sharePermissions","shareTokens"]));s.canClose=!0,s.activityContext=l.getActivityContext(s.fileViewTarget);var i=l.determinePathContext();null==r&&(r=l.getSourceContext(i)),null==t&&(t=l.getSourceAction(i));var a=c.is_supported_mobile_browser();s.isMobileUserAgent=a,a&&(s.hideComments=!0);var o=s.onCloseViewer;return s.onCloseViewer=function(){return f(),"function"==typeof o?o():void 0},n.__assign({initialPreviewSourceAction:t,initialPreviewSourceContext:r},s)}Object.defineProperty(t,"__esModule",{value:!0});var y=null,v="";t.open=h,t.updateFiles=_,t.close=f,t.isShown=g,t.render=S}),define("modules/clean/react/pass/action_timestamps",["require","exports","modules/clean/react/pass/constants","modules/core/exception"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=[n.LoggingActions.PRESENCE_RECEIVE,n.LoggingActions.TRANSMITTER_TOKEN_BEGIN,n.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,n.LoggingActions.RECEIVER_TOKEN_BEGIN,n.LoggingActions.RECEIVER_TOKEN_RECEIVE,n.LoggingActions.SEEN_STATE_USERS_BEGIN,n.LoggingActions.SEEN_STATE_USERS_RECEIVE],i=(function(){function e(){this.allTimestamps={}}return e.prototype.record=function(e,t){if(t){var n=(new Date).getTime()/1e3;this.allTimestamps[t]=this.allTimestamps[t]||{};var r=this.allTimestamps[t];r.hasOwnProperty(e)?this.reportStackForRepeatedAction(r,e,t,n):r[e]=n}},e.prototype.get=function(e){return e?this.allTimestamps[e]||{}:{}},e.prototype.reportStackForRepeatedAction=function(e,t,n,i){if(!(s.indexOf(t)>=0)){var a=e[t];r.reportStack("Attempted to record action for which there existed a previous record",{severity:r.SEVERITY.NONCRITICAL,tags:["pass:actionTimestampsTracker"],exc_extra:{preview_session_id:n,action:t,oldTimestamp:a,newTimestamp:i}})}},e})();t.ActionTimestampsTracker=new i}),define("modules/clean/react/pass/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/pass/constants"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){}return e.passPermissionRequest=function(e){n.Dispatcher.dispatch({type:r.ActionTypes.PASS_PERMISSION_REQUEST,data:{fileId:e}})},e.updatePermissions=function(e,t){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_PERMISSIONS,data:{fileId:e,partialPermission:t}})},e.fetchPassError=function(e){n.Dispatcher.dispatch({type:r.ActionTypes.FETCH_PASS_ERROR,data:{fileId:e}})},e.fetchPassConcluded=function(e){n.Dispatcher.dispatch({type:r.ActionTypes.FETCH_PASS_CONCLUDED,data:{fileId:e}})},e.receivePresenceDelta=function(e,t,s,i){n.Dispatcher.dispatch({type:r.ActionTypes.RECEIVE_PRESENCE_DELTA,data:{userId:e,fileId:t,onlineUniqueUsers:s,offlineUniqueUsers:i}})},e.receivePresenceSnapshot=function(e,t,s){n.Dispatcher.dispatch({type:r.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,fileId:t,onlineUniqueUsers:s}})},e.resetPassInfo=function(e){n.Dispatcher.dispatch({type:r.ActionTypes.RESET_PASS_INFO,data:{fileId:e}})},e.updateSeenStateInfo=function(e,t,s){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_SEEN_STATE_INFO,data:{fileId:e,seenStateInfo:t,seenStateCursor:s}})},e.updateSeenStateInfoContinue=function(e,t,s){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE,data:{fileId:e,seenStateInfo:t,seenStateCursor:s}})},e.discontinueSeenStateInfo=function(e){n.Dispatcher.dispatch({type:r.ActionTypes.DISCONTINUE_SEEN_STATE_INFO,data:{fileId:e}})},e.updateSeenStateUnavailable=function(e,t){n.Dispatcher.dispatch({type:r.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE,data:{userId:e,fileId:t}})},e})();t.PassActions=s}),define("modules/clean/react/pass/data_helpers",["require","exports","jquery","external/lodash","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/api_v2/types","modules/clean/beacon","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/clean/react/pass/action_timestamps","modules/clean/react/pass/actions","modules/clean/react/pass/constants","modules/clean/sharing/actions/sharing_actions","modules/clean/uuid","modules/clean/viewer","modules/constants/file_viewer","modules/constants/python"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b){"use strict";function y(e){h.PassActions.resetPassInfo(e),h.PassActions.fetchPassError(e)}function v(e,t,n,r,s,o){return e?t(new a.ApiV2RootAwareClient(s,o).ns("seen_state"),r,{subjectUserId:e.id}):n(new i.ApiV2Client(s,o).ns("seen_state"),r,{subjectUserId:null})}function I(e,t){return{file_identifier:e,url:t}}Object.defineProperty(t,"__esModule",{value:!0});var C=_.MAX_FACES_NORMAL+_.MAX_OVERFLOW_BUTTON_INDICATOR+1,M=(function(){function e(){}return e.setup=function(t){var n=t.user,r=t.fileData,s=t.prevFileData,i=t.shouldWritePresence,a=void 0===i||i,o=t.skipSharingEndpoints,l=void 0!==o&&o,c=t.limit,d=void 0===c?150:c,p=r.file.file_id;this.shouldInitializePass(n,p,a)&&setTimeout(function(){h.PassActions.passPermissionRequest(p),e.makeAllRequests({user:n,fileData:r,prevFileData:s,shouldWritePresence:a,skipSharingEndpoints:l,limit:d})},0)},e.teardown=function(e){var t=e.user,r=e.fileData,s=e.async,i=e.shouldWritePresence,a=void 0===i||i,o=r.file,l=r.url,c=o.file_id;if(this.shouldInitializePass(t,c,a)){n(window).off("beforeunload.passpresence");var d=new N(o,l);T.shutdown({beaconFileData:d,user:t,async:s,shouldWritePresence:a})}},e.shouldInitializePass=function(e,t,n){return d.determinePathContext()!==p.PathContext.SharedLinkCollection&&(null!==e||n)&&t},e.makeAllRequests=function(e){var t=this,r=e.user,s=e.fileData,i=e.prevFileData,a=e.limit,o=void 0===a?150:a,l=e.shouldWritePresence,c=void 0===l||l,d=e.skipSharingEndpoints,p=void 0!==d&&d,m=u.FilePreviewSession.currentSession&&u.FilePreviewSession.currentSession.id,_=s.file,g=s.url,E=_.file_id,b=_.fq_path,y=E||b,v=r&&r.account_id,I=new N(_,g);r?(y&&!p&&(f.SharingActions.fetchFileMemberCount({user:r,contentId:y,limit:C,countGroupsAsMembers:!1,url:g,previewSessionId:m,runViewerInfoChecks:!0}),f.SharingActions.listMembers({user:r,contentId:y,isFolder:!1,limit:6,url:g,previewSessionId:m,includeSeenState:!1})),A.fetchSeenStateInfo(r,E,o,g,m),T.receiveBeaconData({beaconFileData:I,user:r,previewSessionId:m})):h.PassActions.updatePermissions(E,{canReadPresence:!1,canReadSeenState:!1});var M=S.Viewer.get_viewer().is_assume_user_session;if(!c||M)h.PassActions.updatePermissions(E,{canWritePresence:!1});else{var w=i&&new N(i.file,i.url);T.transmitBeaconData({beaconFileData:I,prevBeaconFileData:w,accountId:v,previewSessionId:m}),n(window).off("beforeunload.passpresence"),n(window).on("beforeunload.passpresence",function(e){t.teardown({user:r,fileData:s,async:!1,shouldWritePresence:!0}),e.returnValue=void 0})}},e})();t.PassHelpers=M;var N=(function(){function e(e,t){this.fileId=e.file_id,this.context=e.beacon_context,this.url=t}return e})();t.BeaconFileData=N;var T=(function(){function e(){}return e.shutdown=function(e){var t=e.beaconFileData,n=e.user,r=e.async,s=e.shouldWritePresence,i=void 0===s||s,a=[];this.transmitterData&&(a.push([this.transmitterData.beaconUserId,this.transmitterData.identifier]),this.transmitterData.transmitter.stop()),delete this.transmitterData,a.length>0&&!S.Viewer.get_viewer().is_assume_user_session&&i&&A.updateSeenStateOnResign(n,t,r,a),this.receiverData&&this.receiverData.receiver&&(this.receiverData.receiver.stop(),delete this.receiverData)},e.receiveBeaconData=function(e){var t=this,n=e.beaconFileData,r=e.user,i=e.previewSessionId,a=n.fileId;if(!n.context||0===n.context.length)return void h.PassActions.updatePermissions(a,{canReadPresence:!1});m.ActionTimestampsTracker.record(_.LoggingActions.RECEIVER_TOKEN_BEGIN,i),s.SilentBackgroundRequest({url:"/get_pass_receiver_token",type:"GET",dataType:"json",data:{account_id:r.account_id,context:n.context,shared_link_url:n.url},success:function(e){var s=!0;if(s=!(!e.auth_key||!e.token||e.error),h.PassActions.updatePermissions(a,{canReadPresence:s}),e.error){if("no_permission"===e.error)return;y(a)}else{m.ActionTimestampsTracker.record(_.LoggingActions.RECEIVER_TOKEN_RECEIVE,i);var o=e.token,l=[new c.PresenceParams(c.PresenceType.Context,r.account_id,t.APP,n.context,o)];t.receiverData&&t.receiverData.receiver&&t.receiverData.receiver.stop(),t.receiverData={authKey:e.auth_key,receiver:new c.Receiver(l,function(e){m.ActionTimestampsTracker.record(_.LoggingActions.PRESENCE_RECEIVE,i),t.onUpdate(e,r.id,n)},function(){return t.receiveBeaconData({beaconFileData:n,user:r,previewSessionId:i})})},t.receiverData.receiver.start()}}})},e.onUpdate=function(e,t,n){var r=e[0],s=n.fileId;if(r.delta){var i=this.parseBeaconUpdates(r.delta);h.PassActions.receivePresenceDelta(t,s,i.onlineUniqueUsers,i.offlineUniqueUsers)}else if(r.snapshot){var i=this.parseBeaconUpdates(r.snapshot);h.PassActions.receivePresenceSnapshot(t,s,i.onlineUniqueUsers)}},e.parseBeaconUpdates=function(e){for(var t={},n={},r=0,s=e;r<s.length;r++){var i=s[r],a=i.agent,o=a.user_id,l=a.source.identifier;i.status===b.BEACON_ONLINE_STATUS?(o in t||(t[o]={}),t[o][l]=!0):i.status===b.BEACON_OFFLINE_STATUS&&(o in n||(n[o]={}),n[o][l]=!0)}return{onlineUniqueUsers:t,offlineUniqueUsers:n}},e.transmitBeaconData=function(e){var t=this,n=e.beaconFileData,r=e.prevBeaconFileData,s=e.accountId,i=e.previewSessionId;this.transmitterData&&r&&(this.transmitterData.transmitter.add_or_update_agents([this.getAgentStatusForFile(this.transmitterData.beaconUserId,this.transmitterData.identifier,this.transmitterData.authKey,r,b.BEACON_OFFLINE_STATUS)]),setTimeout(function(){t.transmitterData.transmitter.stop()},1)),this.fetchTransmitterToken(s,n,r,i)},e.getAgentStatusForFile=function(e,t,n,r,s){var i=new c.Source(this.PLATFORM,this.SURFACE,t),a=new c.Agent(e,this.APP,r.context,i);return new c.AgentStatus(a,s,n)},e.fetchTransmitterToken=function(e,t,n,i){var a=this,o=t.fileId,l=t.context,d=t.url;if(!l||0===l.length)return void h.PassActions.updatePermissions(o,{canWritePresence:!1});m.ActionTimestampsTracker.record(_.LoggingActions.TRANSMITTER_TOKEN_BEGIN,i),s.SilentBackgroundRequest({url:"/get_pass_transmitter_token",type:"GET",dataType:"json",data:{account_id:e,context:l,shared_link_url:d},success:function(n){var s=!0;if(s=!(n.error||!n.beacon_user_id||!n.auth_key||!n.token),h.PassActions.updatePermissions(o,{canWritePresence:s}),s&&m.ActionTimestampsTracker.record(_.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,i),n.error){if("no_permission"===n.error)return;y(o)}else{var l=n.token;a.transmitterData={identifier:g.v4({allowInsecure:!0}),beaconUserId:n.beacon_user_id,authKey:n.auth_key,transmitter:new c.Transmitter(l,function(){return a.fetchTransmitterToken(e,t,null,i)},r.noop)},t&&a.transmitterData.transmitter.add_or_update_agents([a.getAgentStatusForFile(a.transmitterData.beaconUserId,a.transmitterData.identifier,a.transmitterData.authKey,t,b.BEACON_ONLINE_STATUS)]),a.transmitterData.transmitter.start()}}})},e.APP="harmony",e.PLATFORM=c.Platforms.WEB,e.SURFACE="file_viewer",e.receiverData=null,e.transmitterData=null,e})();t.BeaconPresenceHelpers=T,t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT=9e3;var A=(function(){function e(){}return e.constructFakeSeenStateInfo=function(e,t,n){for(var r=n.seen_states,s=[],i=0,a=r;i<a.length;i++){var o=a[i];s.push(o.seen_state_user.user_id)}for(var l=0,c=e;l<c.length;l++){var d=c[l];if(!s.includes(d.user_id)){d.sharing_access_type&&(d.sharing_access_type=this.convertToUnion(d.sharing_access_type));var p=[],u={seen_state_user:d,when_last_seen:t,seen_events:p};r.unshift(u)}}return n.seen_states=r,n},e.convertToUnion=function(e){return e?l.Union.parse(e):null},e.parseSeenStatePassPlatform=function(e){if(e){switch(l.Union.parse(e).type){case"web":return _.PASS_PLATFORM.WEB;case"mobile":return _.PASS_PLATFORM.MOBILE;case"desktop":return _.PASS_PLATFORM.DESKTOP}}return _.PASS_PLATFORM.UNKNOWN},e.fetchSeenStateUsers=function(e,t,n,r,s){var i=this,l=Date.now()/1e3,c=u.FilePreviewSession.currentSession&&u.FilePreviewSession.currentSession.id;return m.ActionTimestampsTracker.record(_.LoggingActions.SEEN_STATE_USERS_BEGIN,c),(new a.ApiV2RootAwareClient).ns("seen_state").rpc("get_seen_state_users",{user_ids:n,file_info:I(r,s)},{subjectUserId:e}).catch(o.catchApiError(function(){return y(r),Promise.reject(void 0)})).then(function(e){m.ActionTimestampsTracker.record(_.LoggingActions.SEEN_STATE_USERS_RECEIVE,c);var n=i.constructFakeSeenStateInfo(e,l,t);h.PassActions.updateSeenStateInfo(r,n)})},e.processAndUpdateSeenStateInfo=function(e,t,n,r){var s=n[0],i=s.seen_state_info,a=s.seen_state_error,o=s.seen_state_cursor;if(a)if(r)h.PassActions.discontinueSeenStateInfo(t);else{if("no_permission"===l.Union.parse(a).type)return;y(t)}else{for(var c=0,d=i.seen_states;c<d.length;c++){var p=d[c];p.seen_state_user.sharing_access_type=this.convertToUnion(p.seen_state_user.sharing_access_type),p.platform_type=this.parseSeenStatePassPlatform(p.platform_type)}r?h.PassActions.updateSeenStateInfoContinue(t,i,o):h.PassActions.updateSeenStateInfo(t,i,o)}},e.fetchSeenStateInfo=function(e,t,n,r,s){var i=this;return m.ActionTimestampsTracker.record(_.LoggingActions.SEEN_STATE_BEGIN,s),(new a.ApiV2RootAwareClient).ns("seen_state").rpc("get_seen_state_info",{file_infos:[I(t,r)],limit:n},{subjectUserId:e.id}).catch(o.catchApiError(function(){return y(t),Promise.reject(void 0)})).then(function(n){var a=!0,o=n[0],l=o.seen_state_info,c=o.seen_state_error;a=!(!l||c),h.PassActions.updatePermissions(t,{canReadSeenState:a}),a||h.PassActions.updateSeenStateUnavailable(e.id,t),a&&m.ActionTimestampsTracker.record(_.LoggingActions.SEEN_STATE_RECEIVE,s),i.processAndUpdateSeenStateInfo(e,t,n,!1),a&&i.fetchRemainingSeenStateInfo(e,t,n,r)})},e.fetchRemainingSeenStateInfo=function(e,t,n,r){var s=n[0],i=s.seen_state_cursor;if(i&&i.has_next){var a=i.cursor_state;a&&this.fetchSeenStateInfoContinue(e,t,a,1e5,r)}},e.fetchSeenStateInfoContinue=function(e,t,n,r,s){var i=this;return(new a.ApiV2RootAwareClient).ns("seen_state").rpc("get_seen_state_info/continue",{file_infos:[I(t,s)],cursor:n,limit:r},{subjectUserId:e.id}).catch(o.catchApiError(function(){return h.PassActions.discontinueSeenStateInfo(t),Promise.reject(void 0)})).then(function(n){i.processAndUpdateSeenStateInfo(e,t,n,!0)})},e.getCoachmark=function(e,t,n,r){return(new a.ApiV2RootAwareClient).ns("seen_state").rpc("get_coachmark_info",{file_info:I(t,n)},{subjectUserId:e}).catch(o.catchApiError(function(){return Promise.reject(void 0)})).then(function(e){r(e.type_with_data)})},e.logCoachmarkInteraction=function(e,t,n,r,s){return(new a.ApiV2RootAwareClient).ns("seen_state").rpc("log_coachmark_interaction",{type:r,interaction:s,file_info:I(t,n)},{subjectUserId:e}).catch(o.catchApiError(function(){return Promise.reject(void 0)}))},e.updateSeenStateOnResign=function(e,n,r,s){var i=r?"async":"sync",a=void 0;r||(a=E.PASS_RESIGN_ONBEFOREUNLOAD_TIMEOUT||t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT);for(var o=[],l=0,c=s;l<c.length;l++){var d=c[l],p=d[0],u=d[1];o.push({beacon_user_id:p,context:n.context,shared_link_url:n.url,identifier:u})}return v(e,function(e,t,n){return e.rpc("update_timestamps_and_mark_offline",t,n)},function(e,t,n){return e.rpc("logged_out/mark_offline",t,n)},{beacon_infos:o},i,a)},e})();t.SeenStateHelpers=A}),define("modules/clean/react/pass/store",["require","exports","tslib","external/lodash","modules/clean/flux/base_store","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/core/exception"],function(e,t,n,r,s,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(){this.userIdToUniqueIds={}}return e.prototype.addUniqueUser=function(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0},e.prototype.removeUniqueUser=function(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])},e.prototype.getOnlineUserIds=function(){return Object.keys(this.userIdToUniqueIds)},e})(),c=(function(e){function t(t){var n=e.call(this,t)||this;return n.seenStateInfos={},n.seenStateCursors={},n.presenceInfos={},n.passFetchingStatusMap={},n.userIdsWithoutSeenStateInfoMap={},n.passPermissions={},n}return n.__extends(t,e),t.prototype.presence=function(e){return e in this.presenceInfos?this.presenceInfos[e].getOnlineUserIds():null},t.prototype.seenStateInfo=function(e){return this.seenStateInfos[e]||null},t.prototype.identifiedSeenStateInfo=function(e){if(e in this.seenStateInfos){return{seen_states:r.reject(this.seenStateInfos[e].seen_states,a.AnonymousViewerUtils.isAnonymousSeenState)}}return null},t.prototype.seenStateCursorHasNext=function(e){return e in this.seenStateCursors?this.seenStateCursors[e].has_next:null},t.prototype.seenStateCursorState=function(e){return e in this.seenStateCursors?this.seenStateCursors[e].cursor_state:null},t.prototype.passFetchingStatus=function(e){return this.passFetchingStatusMap[e]||i.PASS_FETCHING_STATUS.NOT_YET_KNOWN},t.prototype.getLinkAndGroupSeenStateInfo=function(e){var t=null,n=null;if(!this.seenStateInfos[e])return{linkSeenStateInfo:t,groupSeenStateInfo:n};t=[],n={};for(var r=0,s=this.seenStateInfos[e].seen_states;r<s.length;r++){var i=s[r];if(!a.AnonymousViewerUtils.isAnonymousSeenState(i)){var o=i.seen_state_user.sharing_access_type;if(o)switch(o.type){case"link_only":t.push(i);break;case"view_member_access":case"edit_member_access":for(var l=o.value.group_ids,c=0,d=l;c<d.length;c++){var p=d[c];p in n||(n[p]=[]),n[p].push(i)}}}}return{linkSeenStateInfo:t,groupSeenStateInfo:n}},t.prototype.anonymousPresence=function(e){return e in this.presenceInfos?a.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[e].getOnlineUserIds()):null},t.prototype.userIdsWithoutSeenStateInfo=function(e){return this.userIdsWithoutSeenStateInfoMap[e]||[]},t.prototype.isPassPermissionsPending=function(e){var t=this.passPermissions[e];return null!=t&&!(t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState")&&t.hasOwnProperty("canWritePresence"))},t.prototype.getPassPermissions=function(e){if(!e)return null;var t=this.passPermissions[e];return null==t||this.isPassPermissionsPending(e)?null:t},t.prototype.resetPassInfo=function(e){delete this.seenStateInfos[e],delete this.seenStateCursors[e],delete this.presenceInfos[e],delete this.passFetchingStatusMap[e],delete this.passPermissions[e],delete this.userIdsWithoutSeenStateInfoMap[e],this.emit_change()},t.prototype.setPassPermissionRequest=function(e){this.passPermissions[e]={},this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.FETCHING)},t.prototype.updatePermissions=function(e,t){this.passPermissions.hasOwnProperty(e)&&(this.passPermissions[e]=n.__assign({},this.passPermissions[e],t),this.emit_change())},t.prototype.markPassConcludedIfNecessary=function(e){var t=this.passPermissions[e];!(t&&t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState"))||t.canReadPresence||t.canReadSeenState||(this.resetPassInfo(e),this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.CONCLUDED),this.updateSeenStateInfoWithEmptyData(e))},t.prototype.receivePresenceDelta=function(e,t,n,r){o.assert([i.PASS_FETCHING_STATUS.FETCHING,i.PASS_FETCHING_STATUS.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t))===-1,"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var s=this.getOnlineUsersForFileId(t);this.updatePresenceInfos(t,n,r),this.updateUserIdsWithoutSeenStateInfo(e,t,s),this.emit_change()},t.prototype.receivePresenceSnapshot=function(e,t,n){o.assert([i.PASS_FETCHING_STATUS.FETCHING,i.PASS_FETCHING_STATUS.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t))===-1,"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var r=this.getOnlineUsersForFileId(t);this.presenceInfos[t]=new l,this.updatePresenceInfos(t,n,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,r),this.emit_change()},t.prototype.getOnlineUsersForFileId=function(e){return e in this.presenceInfos||(this.presenceInfos[e]=new l),this.presenceInfos[e].getOnlineUserIds()},t.prototype.updatePresenceInfos=function(e,t,n){for(var r=0,s=Object.keys(n);r<s.length;r++)for(var i=s[r],a=0,o=Object.keys(n[i]);a<o.length;a++){var l=o[a];this.presenceInfos[e].removeUniqueUser(i,l)}for(var c=0,d=Object.keys(t);c<d.length;c++)for(var p=d[c],u=0,m=Object.keys(t[p]);u<m.length;u++){var l=m[u];this.presenceInfos[e].addUniqueUser(p,l)}},t.prototype.updateUserIdsWithoutSeenStateInfo=function(e,t,n){var s,o=a.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileId(t)),l=a.AnonymousViewerUtils.filterAnonymousUserIds(n),c=r.difference(l,o),d=r.difference(o,l);if(t in this.seenStateInfos){var p=void 0,u=this.passFetchingStatus(t);[i.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED,i.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS].indexOf(u)!==-1?(m=this.createMinimalBaseSeenStateInfo(t,o),s=m.userIdsWithoutSeenStateInfo,p=m.baseSeenStateInfo,this.updateSeenStateInfo(t,p)):(h=this.makeSeenStateAgreeWithUpdatedPresence(t,o,c,d),s=h.userIdsWithoutSeenStateInfo,p=h.baseSeenStateInfo)}else s=[];this.userIdsWithoutSeenStateInfoMap[t]=s;var m,h},t.prototype.makeSeenStateAgreeWithUpdatedPresence=function(e,t,n,r){for(var s=[],i=this.seenStateInfos[e],a=i.seen_states,o=[],l=[],c=[],d=Date.now()/1e3,p=0,u=a;p<u.length;p++){var m=u[p],h=m.seen_state_user.user_id;h&&(s.push(h),r.includes(h)?(m.when_last_seen=d,m.seen_events=m.seen_events||[],l.push(m)):n.includes(h)?(m.when_last_seen=d,m.seen_events=m.seen_events||[],m.seen_events.push({ts:d}),c.push(m)):o.push(m))}return i.seen_states=l.concat(c,o),{userIdsWithoutSeenStateInfo:t.filter(function(e){return!s.includes(e)}),baseSeenStateInfo:i}},t.prototype.createMinimalBaseSeenStateInfo=function(e,t){for(var n=[],s=[],i=0,a=this.seenStateInfos[e].seen_states;i<a.length;i++){var o=a[i],l=o.seen_state_user.user_id;l&&t.includes(l)&&(n.push(o),s.push(l))}return{userIdsWithoutSeenStateInfo:r.difference(t,s),baseSeenStateInfo:{seen_states:n}}},t.prototype.updateSeenStateInfo=function(e,t,n){void 0===n&&(n=!1),o.assert([null,i.PASS_FETCHING_STATUS.FETCHING].indexOf(this.passFetchingStatus(e))===-1,"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled"),n&&e in this.seenStateInfos?this.seenStateInfos[e].seen_states=this.seenStateInfos[e].seen_states.concat(t.seen_states):this.seenStateInfos[e]=t,this.userIdsWithoutSeenStateInfoMap[e]=[],this.emit_change()},t.prototype.updateSeenStateInfoWithEmptyData=function(e){var t={seen_states:[]};this.updateSeenStateInfo(e,t)},t.prototype.setPassFetchingStatus=function(e,t){this.passFetchingStatusMap[e]=t,this.emit_change()},t.prototype.updateSeenStateCursor=function(e,t){t&&(this.seenStateCursors[e]=t,this.emit_change())},t.prototype.assureSeenStateSuccessRegistered=function(e){switch(this.passFetchingStatus(e)){case i.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.SEEN_STATE_SUCCESS);break;case i.PASS_FETCHING_STATUS.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.PASS_SUCCESS);break;case i.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is seen state disallowed",{severity:o.SEVERITY.NONCRITICAL,tags:["pass:fetch_seen_state_disallowed"],exc_extra:{storeHasPresence:e in this.presenceInfos,storeHasSeenState:e in this.seenStateInfos,passPermissions:JSON.stringify(this.passPermissions[e]),fetchingStatus:this.passFetchingStatusMap[e]}});break;case i.PASS_FETCHING_STATUS.NOT_YET_KNOWN:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:o.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},t.prototype.onFetchSeenStateDisabled=function(e){switch(this.passFetchingStatus(e)){case i.PASS_FETCHING_STATUS.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS);break;case i.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED);break;case i.PASS_FETCHING_STATUS.NOT_YET_KNOWN:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:o.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},t.prototype.assurePresenceSuccessRegistered=function(e){switch(this.passFetchingStatus(e)){case i.PASS_FETCHING_STATUS.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.PASS_SUCCESS);break;case i.PASS_FETCHING_STATUS.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.PASS_MIXED_SUCCESS);break;case i.PASS_FETCHING_STATUS.FETCHING:this.setPassFetchingStatus(e,i.PASS_FETCHING_STATUS.PRESENCE_SUCCESS);break;case i.PASS_FETCHING_STATUS.NOT_YET_KNOWN:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:o.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},t.prototype._new_payload=function(e){var t=e.action,n=t.type,r=t.data;if(r){var s=r.userId,a=r.fileId,o=r.seenStateInfo,l=r.seenStateCursor,c=r.onlineUniqueUsers,d=r.offlineUniqueUsers,p=r.partialPermission;switch(s=s,a=a,o=o,l=l,c=c,d=d,p=p,n){case i.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(a,i.PASS_FETCHING_STATUS.ERROR);break;case i.ActionTypes.FETCH_PASS_CONCLUDED:this.setPassFetchingStatus(a,i.PASS_FETCHING_STATUS.CONCLUDED),this.updateSeenStateInfoWithEmptyData(a);break;case i.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(a);break;case i.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(a),this.receivePresenceDelta(s,a,c,d);break;case i.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(a),this.receivePresenceSnapshot(s,a,c);break;case i.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(a);break;case i.ActionTypes.UPDATE_PERMISSIONS:this.updatePermissions(a,p),this.markPassConcludedIfNecessary(a);break;case i.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:l={cursor_state:"",has_next:!1},this.updateSeenStateCursor(a,l);break;case i.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(a),this.updateSeenStateInfo(a,o),this.updateSeenStateCursor(a,l);break;case i.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(a),this.updateSeenStateInfo(a,o,!0),this.updateSeenStateCursor(a,l);break;case i.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:this.onFetchSeenStateDisabled(a),this.updateSeenStateInfoWithEmptyData(a),this.updateUserIdsWithoutSeenStateInfo(s,a,[])}}},t})(s.Store);t.PassStore=c,t.passStore=new c}),define("modules/clean/react/teams/modals/limited_team_folder_settings_modal",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/react/modal","modules/clean/react/teams/modals/limited_team_upsell_modal_banner","modules/clean/sharing/folder_settings_modal","modules/constants/trademark","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c){"use strict";function d(e){var t={altAction:p(a,{upsellText:c._("Want to access these settings as well as other admin controls? Upgrade to %(trademark_business)s.").format({trademark_business:l.TRADEMARK_BUSINESS}),upgradeButtonText:c._("Upgrade now"),redirectQuery:{tk:"team_settings",_camp:"modal"},logEventName:"team_folder_settings_upsell"})},r=i.Modal.showInstance(p(o.SharedFolderSettingsModal,n.__assign({},e,t)));return s.TeamsWebActionsLogger.log("team_folder_settings",null,null,null,!1,s.TeamsWebActionsLogger.LOG_CATEGORY.TEAM_INFO),r}Object.defineProperty(t,"__esModule",{value:!0});var p=r.createElement;t.showWithProps=d}),define("modules/clean/react/teams/modals/limited_team_share_folder_modal",["require","exports","external/create-react-class","external/react","external/react-dom-factories","external/prop-types","external/react-addons-pure-render-mixin","modules/clean/analytics","modules/clean/filepath","modules/clean/react/modal","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,r,s,i,a,o,l,c,d,p,u){"use strict";function m(e){var t=c.Modal.showInstance(h(f,e));return _("team_folder_share"),t}Object.defineProperty(t,"__esModule",{value:!0});var h=r.createElement,_=function(e){return o.TeamsWebActionsLogger.log(e,null,null,null,!1,o.TeamsWebActionsLogger.LOG_CATEGORY.TEAM_INFO)},f=n({mixins:[a],displayName:"LimitedTeamShareFolderModal",propTypes:{fqPath:i.string.isRequired},_navigateToTeam:function(){return _("team_folder_share_invite"),d.redirect(new u.URI({path:"/team",query:{invite_members:"",tk:"team_folder_share_invite",_camp:"modal"}}))},render:function(){var e=l.filename(this.props.fqPath);return h(c.Modal,{title:p._("Share %(folder_name)s").format({folder_name:e}),acceptButtonText:p._("Invite"),onAccept:this._navigateToTeam,showButtonDivider:!0},s.div({},p._("To share the %(folder_name)s with someone, invite them to join your team!").format({folder_name:e})))}});t.showModalInstance=m}),define("modules/clean/react/teams/modals/limited_team_upsell_modal_banner",["require","exports","external/create-react-class","external/react","external/react-dom-factories","external/react-addons-pure-render-mixin","external/prop-types","modules/clean/analytics","modules/clean/react/button","modules/core/browser","modules/core/uri"],function(e,t,n,r,s,i,a,o,l,c,d){"use strict";var p=r.createElement;return n({mixins:[i],propTypes:{upgradeButtonText:a.string.isRequired,upsellText:a.string.isRequired,logEventName:a.string,redirectUrl:a.string,redirectQuery:a.shape({tk:a.string,_camp:a.string})},displayName:"LimitedTeamUpsellModalBanner",_handleCTAClick:function(){return this.props.logEventName&&o.TeamsWebActionsLogger.log(this.props.logEventName,{},null,null,!1,o.TeamsWebActionsLogger.LOG_CATEGORY.UPGRADE),c.redirect(new d.URI({path:this.props.redirectUrl?this.props.redirectUrl:"/team/upgrade",query:this.props.redirectQuery}))},render:function(){return s.div({className:"modal-upsell-bar"},s.div({className:"modal-upsell-bar__message"},this.props.upsellText),s.div({className:"modal-upsell-bar__action"},p(l.button,{className:"modal-upsell-bar__cta-button",onClick:this._handleCTAClick},this.props.upgradeButtonText)))}})}),define("modules/clean/sharing/action_types",["require","exports","modules/clean/flux/action_type"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShareModalActionTypes=n.withActionNamespace("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",
FETCH_MAGNET2018_REQUEST:"fetch-magnet2018-experiment",FETCH_MAGNET2018_SUCCESS:"fetch-magnet2018-success",FETCH_MAGNET2018_FAILURE:"fetch-magnet2018-failure",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:"clear-file-membership-last-seen-info",FETCH_FILE_MEMBER_COUNT_REQUEST:"fetch-file-member-count-request",FETCH_FILE_MEMBER_COUNT_SUCCESS:"fetch-file-member-count-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_REQUEST:"send-share-request",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",MEMBER_ACTION_PENDING:"member-action-pending",MEMBER_ACTION_COMPLETE:"member-action-complete",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",TRANSFER_OWNER_SUCCESS:"transfer-owner-success",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",HANDLE_CONTENT_NAME_FOCUS_CHANGE:"handle-content-name-focus-change",UPDATE_BANNER:"update-banner",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",CHANGE_LINK_AUDIENCE_REQUEST:"change-link-audience-request",CHANGE_LINK_AUDIENCE_SUCCESS:"change-link-audience-success",CHANGE_LINK_AUDIENCE_FAILURE:"change-link-audience-failure",UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:"unblock-member-list-on-pass-load",UPDATE_SHARING_SETTINGS_SUCCESS:"update-sharing-settings-success"}),t.SharingActionTypes=n.withActionNamespace("sharing-actions",{CLEAR_EVERYTHING:"clear-everything",FETCH_METADATA_BATCH_ATTEMPT:"fetch-metadata-batch-attempt",FETCH_METADATA_BATCH_SUCCESS:"fetch-metadata-batch-success",FETCH_METADATA_BATCH_FAIL:"fetch-metadata-batch-fail"})}),define("modules/clean/sharing/actions/share_modal",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/pass/actions","modules/clean/react/pass/constants","modules/clean/react/pass/data_helpers","modules/clean/react/pass/store","modules/clean/react_format","modules/clean/sharing/action_types","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal","modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal","modules/clean/sharing/confirmation_modals/simple_confirm_modal","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/sharing/parent_folder_access_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/views/inherited_members","modules/clean/teams/membership_discovery_util","modules/clean/teams/modals/create_team_prompt_modal","modules/clean/web_user_action_logger","modules/clean/web_user_action_events","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/zendesk_feedback","modules/constants/teams","modules/constants/sharing","modules/core/browser","modules/core/i18n","modules/clean/react/snackbar","modules/clean/sharing/share_modal_util","modules/clean/react/async/loadable","modules/clean/dbmodal_stack"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I,C,M,N,T,A,w,k,L,P,F,R,O,x,D,U,B,H,V,G,q,j,K,W,Y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var z=r.createElement,Q=q.i18n_default_project("sharing")._,X=W.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/sharing/link_settings_modal"],t,n)}).then(function(e){return e.SharedLinkSettingsModal})}}),J=(function(){function t(t,l,u,m,h,_){var E=this;this.groupSeenStateInfo=null,this.linkSeenStateInfo=null,this.presentAccountIds=null,this.hasLoggedSet={},this.setPath=null,this.setUrl=null,this.changeAccess=function(e,t,n){void 0===n&&(n=!1);var r=Promise.resolve({}),s=e.memberId(),i=E.getContentInfo(),a=i.id,o=E.sharingInfo.isNonUserRelativeContext();if(t===N.MEMBER_ACTION.REMOVE)s!==E.user.account_id||o?(r=(i.isFileFolder()?E.client.getParentFolderAccess({contentId:E.sharingInfo.parentSharedFolderId(),memberId:s}):E.removeMember(a,e,n,i.isFolder())).then(function(t){E.showParentFolderAccessModalIfQualified("remove",e,t)}),E.openShareModal()):E.relinquishMembership(a,n);else if(t===M.ACCESS_LEVEL.OWNER)r=E.client.transferContent({contentId:a,memberId:s}).then(function(){E.dispatch(g.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS),P.sharingNotificationSuccess(Q("Made %(name)s the owner").format({name:e.displayName()})),E.fetchDataAndShowShareModal()});else{var l=void 0;if(i.isFileFolder()&&t===M.ACCESS_LEVEL.READER)l=E.client.getParentFolderAccess({contentId:E.sharingInfo.parentSharedFolderId(),memberId:s,accessLevel:t});else{var c=E.getContentInfo().isFileFolder();c&&E.dispatch(g.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:e}),l=E.shareIfFileFolder(Q("Updating member access...")).then(function(){return c&&E.dispatch(g.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e}),E.changeMemberAccess(E.getContentInfo().id,e,t)}).catch(function(t){E.reportShareFailure(t),c&&E.dispatch(g.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e})})}r=l.then(function(t){E.fetchInitialData(),j.Snackbar.complete(Q("Member access updated.")),E.showParentFolderAccessModalIfQualified("update",e,t)})}return r.then(E.refreshSharedWithColumnContentData)},this.changeLinkAudience=function(e){var t=new b.CombinedPolicy({audience:e});if(E.getContentInfo().isFileFolder())return E.shareIfFileFolder(f.reactFormat(Q("Changing link settings for <st>%(folder_name)s</st>..."),{st:r.createElement("strong",null),folder_name:o.Emstring.em_snippet(E.getContentInfo().name(),N.SNIPPET_SIZES.FILENAME)}),t).then(function(){j.Snackbar.complete(f.reactFormat(Q("Changed link settings for <st>%(folder_name)s</st>."),{st:r.createElement("strong",null),folder_name:o.Emstring.em_snippet(E.getContentInfo().name(),N.SNIPPET_SIZES.FILENAME)}))}).catch(function(e){return E.reportShareFailure(e),Promise.reject(e)});var n=E.sharingInfo.linkMetadata(),s=n&&n.current_audience||b.LinkAudience.members;E.dispatch(g.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_REQUEST,{newAudience:e});var a,l;return E.getContentInfo().isFile()?(a=N.ALPHA_FILE_METADATA_PERMISSIONS,l=E.client.updatePolicy.bind(E.client)):(a=N.ALPHA_FOLDER_METADATA_PERMISSIONS,l=E.client.updatePolicyAlpha.bind(E.client)),l({actions:Object.keys(a),contentId:E.getContentInfo().id,newPolicy:t}).then(function(e){E.dispatch(g.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SUCCESS,{metadata:e})}).catch(i.catchApiError(function(){return E.dispatch(g.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_FAILURE,{prevAudience:s}),Promise.reject({})}))},this.changeRecipientAccess=function(e){E.dispatch(g.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS,{newAccess:e})},this.changeRecipientMessage=function(e){E.dispatch(g.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE,{message:e})},this.createSharedLink=function(){return E.log("CLICK_TIB_CREATE_LINK"),E.dispatch(g.ShareModalActionTypes.CREATE_LINK_REQUEST),j.Snackbar.sync(Q("Creating link...")),E.client.createSharedLink({fileIdOrPath:E.getContentInfo().displayPath()}).then(function(e){E.dispatch(g.ShareModalActionTypes.CREATE_LINK_SUCCESS,{linkMetadata:e}),E.refreshSharedWithColumnLinkData(),j.Snackbar.complete(Q("Link created."))}).catch(i.catchApiError(function(e){return e instanceof i.AppError&&e.error&&"access_denied"===e.error[".tag"]&&(E.getContentInfo().isFolder()?P.sharingNotificationError(Q("You don’t have permission to create a link to this folder")):P.sharingNotificationError(Q("You don’t have permission to create a link to this file"))),E.dispatch(g.ShareModalActionTypes.CREATE_LINK_FAILURE),Promise.reject(e)}))},this.fetchMetadataForFile=function(e){return S.SharingActions.loadFileMetadata({user:E.user,contentId:e.id,sourceUrl:e.url(),client:E.client}).catch(i.catchApiError(E.handleLoadingError))},this.fetchMetadataForFileFolder=function(e){var t,r,s=N.MEMBER_ACTION.ALL,a=E.user.is_cdm_member?N.VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE:N.VALIDATE_PATH_PERMISSIONS,o={actions:Object.keys(a),listMembersArg:{actions:s},shouldParseMetadataFromError:!0},l=!!E.sharingInfo.isNonUserRelativeContext();return l&&!E.user.is_cdm_member?(t=function(e){return n.__awaiter(E,void 0,void 0,function(){var t;return n.__generator(this,function(n){return t=this.contentManagerValidateFolderPath(e),[2,this.client.validatePathContinue(t,!1)]})})},r={nsId:e.nsId(),nsPath:e.nsPath()}):(t=E.client.validateFqPath,r={fqPath:e.displayPath(),shareAsConfidential:E.sharingInfo.shareAsConfidential()}),t(n.__assign({},r,o)).then(function(e){var t=e.metadata,n=e.inheritedMembers;E.handleGetMetadataSuccess(t);var r=E.getContentInfo();E.listMembers({contentId:r.id,url:r.url(),members:r.isFileFolder()&&n||void 0,isNonUserRelativeContext:l})}).catch(i.catchApiError(E.handleLoadingError))},this.fetchMetadataForSharedFolder=function(e){return E.client.getMetadata({contentId:e.id,actions:Object.keys(N.ALPHA_FOLDER_METADATA_PERMISSIONS)}).then(E.handleGetMetadataSuccess).catch(i.catchApiError(E.handleLoadingError))},this.handleShowMembershipSuggestionModal=function(t,n,r,s,i){new Promise(function(t,n){e(["modules/clean/teams/membership_suggestion_modal"],t,n)}).then(function(e){return e.MembershipSuggestionModal.show({isAdmin:t,isFile:E.sharingInfo.contentInfo().isFile(),contacts:n,nsId:E.sharingInfo.contentInfo().id,accessLevel:E.sharingInfo.recipientAccess(),redirectUri:i,teamSize:r,experiments:s})})},this.handleSetConfidentialClick=function(e,t){p.Modal.showInstance(r.createElement(F.SetInheritedMembersUIConfidentialModal,{actionHandler:E,initialIsConfidentialFolder:e,contentInfo:E.getContentInfo(),teamName:t,onCancel:E.openShareModal,userId:E.user.id}))},this.handleInheritedMemberAccessChange=function(e,t,n,s,i){var a=E.getContentInfo();p.Modal.showInstance(r.createElement(F.SingleInheritedUserAccessChangeModal,{actionHandler:E,member:e,teamName:n,userId:E.user.id,isSharedFolder:a.isSharedFolder(),parentFolderName:a.parentFolderName(),currentFolderName:a.name(),isUserSelf:e.memberId()===E.user.account_id,isDowngrading:s,newAccessLevel:i}))},this.handleMemberAccessChange=function(e,t){var n=e.displayName();if(t===N.MEMBER_ACTION.REMOVE||t===M.ACCESS_LEVEL.OWNER){var r=t===N.MEMBER_ACTION.REMOVE&&e.memberId()===E.user.account_id,s=E.getContentInfo().isFolder(),i=E.getContentInfo().isNestedSharedFolder(),a=e.permissions.leave_a_copy&&e.permissions.leave_a_copy.allow,o=function(n){E.changeAccess(e,t,n===!0)},l=E.openShareModal,c=E.getContentInfo().parentFolderName(),d=E.getSharingInfo().isConfidentialFolder();r?I.showRelinquishMembershipConfirmationModal(s,i,o,l,a,d):v.showMemberAccessChangeConfirmationModal(n,t,s,i,a,o,l,d,c)}else E.changeAccess(e,t)},this.handleGetMetadataSuccess=function(e){E.dispatch(g.ShareModalActionTypes.FETCH_METADATA_SUCCESS,{metadata:e}),c.Dispatcher.dispatch({type:A.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:E.user})},this.handleLinkSettingsClick=function(){var e=function(){E.refreshSharedWithColumnLinkData(),E.setLinkMetadata(void 0),E.openShareModal()},t=E.sharingInfo.getInitialProps().onDeleteLink||e,n=function(e){E.setLinkMetadata(e),E.refreshSharedWithColumnLinkData()};s.TeamsWebActionsLogger.log("open_link_settings_modal"),p.Modal.showInstance(r.createElement(X,{client:E.client,isFile:E.getContentInfo().isFile(),linkMetadata:E.sharingInfo.linkMetadata(),onClose:E.openShareModal,onDeleteLink:t,onPolicySet:n,isTeam:1===E.user.is_team,user:E.user}))},this.handleLoadingError=function(e){e instanceof i.AppError?("not_a_member"===e.error[".tag"]||"no_access"===e.error[".tag"]?(P.sharingNotificationError(Q("You don’t have permission to share this folder")),p.Modal.close()):"invalid_id"===e.error[".tag"]&&(P.sharingNotificationError(Q("This folder can’t be shared")),p.Modal.close()),E.dispatch(g.ShareModalActionTypes.FETCH_METADATA_FAILURE,{reason:e.error&&e.error.bad_path&&e.error.bad_path[".tag"]})):(P.sharingNotificationError(e.message||Q("There was a problem completing this request.")),p.Modal.close())},this.handleSelectLinkAudience=function(e){if(E.sharingInfo.contentInfo().isFile())return E.changeLinkAudience(e);var t=E.sharingInfo.linkMetadata(),n=t&&t.current_audience||b.LinkAudience.members,s=t.audience_options.toArray().indexOf(n),i=t.audience_options.toArray().indexOf(e);if(i<s){var a="";if(e===b.LinkAudience.public)a=Q("All items in this folder will become viewable by anyone with the link.");else{if(e!==b.LinkAudience.team)throw"audience type not supported: %(newAudience)s".format({newAudience:e});a=Q("All items in this folder will become viewable by anyone on your team.")}p.Modal.showInstance(r.createElement(C.SimpleConfirmModal,{title:Q("Change link audience?"),confirmText:Q("Change audience"),onConfirm:function(){E.changeLinkAudience(e),E.openShareModal()},onCancel:E.openShareModal},a))}else if(i>s)return E.changeLinkAudience(e)},this.handleSetConfidential=function(e,t){void 0===t&&(t=!1);var n=E.getContentInfo(),r=n.isSharedFolder()?n.sharedFolderId().toString():void 0,s=function(e){return E.handleGetMetadataSuccess(e),e},a=function(e,t,n){return E.client.setConfidentiality({contentId:e,confidential:t,keepInheritedMembers:n}).then(s)};return r?a(r,e,t):E.client.share({fqPath:n.displayPath(),confidential:e}).then(s).catch(function(n){if(n instanceof i.AppError&&n.error&&n.error.bad_path&&"already_shared"===n.error.bad_path[".tag"]){var r=y.folderMetadataApiToRecord(n.error.bad_path);E.handleGetMetadataSuccess(r);return a(E.getContentInfo().sharedFolderId().toString(),e,t)}return Promise.reject(n)})},this.openShareModal=function(){R.shouldShowMembershipSuggestionBanner()&&(Y.DBModalStack.unregister(R.MembershipDiscoveryEvents.INVITE_MODAL_CLOSED,K.showShareModalCallback),Y.DBModalStack.register(R.MembershipDiscoveryEvents.INVITE_MODAL_CLOSED,K.showShareModalCallback)),p.Modal.showInstance(z(E.shareModalClass,{actionHandler:E}))},this.recipientsChange=function(e,t){return void 0===t&&(t=""),Promise.resolve({}).then(function(){if(R.isOnExpUjMagnet2018(E.sharingInfo.ownerTeam())||E.sharingInfo.expUjMagnet2018ShouldLogExposure()&&R.isLoggedExpUjMagnet2018(E.sharingInfo.ownerTeam())){var n=R.filterSuggestableUsers(E.user,e,E.sharingInfo.expUjMagnet2018LastEmails()),r=n.promise,s=n.emails,i=n.ts;r&&s&&i&&E.handleExpUjMagnet2018FetchRequest(r,s,i)}E.dispatch(g.ShareModalActionTypes.CHANGE_RECIPIENTS,{recipientTokens:e,recipientRawInput:t})})},this.redirectToPath=function(t,n){if(null!=E.setUrl&&null!=E.setPath&&E.getSharingInfo().getInitialProps().content&&E.getSharingInfo().fqPath()){var r=function(t){n&&new Promise(function(t,n){e(["modules/clean/sharing/share_modal_util"],t,n)}).then(function(e){return(0,e.showShareModal)(E.user,t,{origin:"PARENT_FOLDER_MODAL"},E.setPath,E.setUrl)})};t!==E.getSharingInfo().fqPath()?(E.setUrl({path:t}),E.setPath({path:t,onPathLoaded:r})):r(E.getSharingInfo().getInitialProps().content)}else{var s=a.browse_uri_for_fq_path(E.user,t);n&&s.updateQuery({shareoptions:"1"}),G.redirect(s.toString())}},this.refreshSharedWithColumnContentData=function(){E.getContentInfo().isFolder()?c.Dispatcher.dispatch({type:d.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}}):c.Dispatcher.dispatch({type:d.SharedWithActionType.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[E.getContentInfo().id]}})},this.handleShareClick=function(e){return E.sharingInfo.contentInfo().pathExists()?E.sendShare(e):E.setContentNameAndSendShare(e)},this.failSnackbarWithHelpCenter=function(e,t){var n=function(){G.open_tab(t)};j.Snackbar.show(r.createElement(j.Snackbar,{actionButtonText:Q("Learn more"),closeButtonText:Q("Close"),onActionClick:n,title:e,variant:"fail"}))},this.shareIfFileFolder=function(e,t){if(j.Snackbar.sync(e,!0),!E.getContentInfo().isFileFolder())return Promise.resolve({});if(E.sharingInfo.shareFolderPromise())return E.sharingInfo.shareFolderPromise();var n;if(n=E.sharingInfo.isNonUserRelativeContext()&&!E.user.is_cdm_member?"ns:"+E.getContentInfo().nsId()+E.getContentInfo().nsPath():E.getContentInfo().displayPath(),V.TRUELINK.TRUELINK_UI[E.user.id]){var r=E.sharingInfo.linkMetadata();r&&r.current_audience!==b.LinkAudience.members&&(t||(t=new b.CombinedPolicy),t.audience||(t=t.set("audience",r.current_audience)))}var s=void 0;return null!=E.sharingInfo.shouldSyncThisFolder()&&(s=E.sharingInfo.shouldSyncThisFolder()?"default":"not_synced"),E.shareFolderSimple(n,E.sharingInfo.shareAsConfidential(),s,t)},this.reportShareFailure=function(e){e instanceof i.RateLimitError?E.failSnackbarWithHelpCenter(Q("Couldn’t share. Folder updates in progress."),"/help/9259"):e instanceof i.AppError&&"internal_error"===e.error[".tag"]?E.failSnackbarWithHelpCenter(Q("Sharing unsuccessful. This folder has too many files."),"/help/files-folders/share-with-others#foldersize"):j.Snackbar.fail(L.convertIfHTML(L.genAddMemberErrorMessage(e)))},this.showParentFolderAccessModalIfQualified=function(e,t,n){null!=n&&p.Modal.showInstance(r.createElement(T.ParentFolderAccessModal,{contentInfo:E.getContentInfo(),memberAccessLevelResult:n,memberDisplayName:t.displayName()||"",originalAction:e,isInContentManager:E.sharingInfo.isNonUserRelativeContext(),onClose:E.openShareModal,onParentFolderClicked:E.redirectToPath}))},this.parseParentFolderAccessError=function(e){var t=e.error;if("member_error"===e.error[".tag"]&&(t=e.error.member_error),"no_explicit_access"===t[".tag"])return y.memberAccessLevelApiToRecord(E.user.id,t);P.sharingNotificationError(e.message||Q("There was a problem completing this request."))},this.turnLinkOnIfQualified=function(){var e=E.sharingInfo.linkMetadata();return!V.TRUELINK.TRUELINK_UI[E.user.id]||E.sharingInfo.parentSharedFolderId()||e&&e.current_audience!==b.LinkAudience.members?Promise.resolve({}):E.waitForAllMembersLoaded().then(function(){if(!E.sharingInfo.hasNonOwnerMembers())return E.changeLinkAudience(b.LinkAudience.default_on)})},this.updateLinkSettings=function(){},this.waitForAllMembersLoaded=function(){if(E.sharingInfo.areMembersFullyLoaded())return Promise.resolve({});var e=E.sharingInfo.fetchingMembersRequest();return e&&e.promise||Promise.resolve({})},this.client=t,this.user=l,this.shareModalClass=u,this.setPath=m||null,this.setUrl=h||null,this.contentManagerValidateFolderPath=_}return t.prototype.initializeShareModal=function(e,t){void 0===t&&(t={});var n=e.contentInfo;return c.Dispatcher.dispatch({type:g.ShareModalActionTypes.SHARE_MODAL_OPEN,data:{shareModalInfo:e,initialProps:t},contentIds:k.getContentIdsForContentInfo(n),user:this.user}),this.sharingInfo=w.sharingInfoStore.getSharingInfo(this.user.id,n.id),this.fetchInitialData()},t.prototype.fetchDataAndShowShareModal=function(){this.fetchInitialData(),this.openShareModal()},t.prototype.fetchInitialData=function(){var t=this.sharingInfo.contentInfo(),n=this.sharingInfo.isNonUserRelativeContext();this.beginTime=Date.now(),this.fetchPassInfo(),new Promise(function(t,n){e(["modules/clean/sharing/link_settings_modal"],t,n)}),R.shouldShowMembershipSuggestionBanner()&&new Promise(function(t,n){e(["modules/clean/teams/membership_suggestion_banner"],t,n)});var r=[];return t.isFileFolder()?r.push(this.fetchMetadataForFileFolder(t)):(r.push(this.listMembers({contentId:t.id,url:t.url(),isNonUserRelativeContext:n})),t.isFile()?r.push(this.fetchMetadataForFile(t)):t.isSharedFolder()&&r.push(this.fetchMetadataForSharedFolder(t))),r.push(this.fetchMemberCounts()),V.TRUELINK.TRUELINK_UI[this.user.id]?(this.sharingInfo.isTeamPolicyLoaded()||r.push(this.fetchTeamPolicy()),this.sharingInfo.areSharingPrefsLoaded()||r.push(this.fetchSharingPrefs())):(r.push(this.fetchTeamPolicy()),r.push(this.fetchSharingPrefs()),this.sharingInfo.canShareLink()&&!n&&t.isMounted()&&r.push(this.fetchLinkMetadata())),Promise.all(r)},t.prototype.fetchPassInfo=function(){var e=this;this.sharingInfo.shouldBlockMemberListOnPassLoad()&&setTimeout(function(){return e.dispatch(g.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD)},4e3);var t=this.getPassFileInfo(),n=t.fromBrowse,r=t.fileId;if(n&&r){this.clearCachedPassInfo();var s=_.passStore.passFetchingStatus(r);if(m.fetchingStatusIsSuccessful(s)){var i=_.passStore.getLinkAndGroupSeenStateInfo(r),a=i.groupSeenStateInfo,o=i.linkSeenStateInfo;this.groupSeenStateInfo=a,this.linkSeenStateInfo=o,this.presentAccountIds=_.passStore.presence(r)}else s===m.PASS_FETCHING_STATUS.NOT_YET_KNOWN&&h.PassHelpers.setup({user:this.user,fileData:this.getFileData(),prevFileData:null,shouldWritePresence:!1,skipSharingEndpoints:!0})}},t.prototype.getSharingInfo=function(){return this.sharingInfo},t.prototype.clearCachedPassInfo=function(){e=[null,null,null],this.groupSeenStateInfo=e[0],this.linkSeenStateInfo=e[1],this.presentAccountIds=e[2];var e},t.prototype.getPassInfo=function(){var e=this.getContentInfo();if(e.isFolder())return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:m.PASS_FETCHING_STATUS.ERROR};if(this.groupSeenStateInfo&&this.linkSeenStateInfo&&this.presentAccountIds)return{groupSeenStateInfo:this.groupSeenStateInfo,linkSeenStateInfo:this.linkSeenStateInfo,presentAccountIds:this.presentAccountIds,passFetchingStatus:m.PASS_FETCHING_STATUS.PASS_SUCCESS};var t=this.getPassFileInfo().fileId;if(!t)return o=[{},[],[]],this.groupSeenStateInfo=o[0],this.presentAccountIds=o[1],{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:m.PASS_FETCHING_STATUS.ERROR};var n=_.passStore.getPassPermissions(t),r=_.passStore.passFetchingStatus(t);if(!m.fetchingStatusIsComplete(r))return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:m.PASS_FETCHING_STATUS.FETCHING};if(null==n||!n.canReadPresence)return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:m.PASS_FETCHING_STATUS.ERROR};var s=_.passStore.getLinkAndGroupSeenStateInfo(t),i=s.linkSeenStateInfo,a=s.groupSeenStateInfo;return this.linkSeenStateInfo=i,this.groupSeenStateInfo=a,this.presentAccountIds=(_.passStore.presence(t)||[]).slice(),this.isContentInfoForFilePreview(e)&&this.presentAccountIds.indexOf(this.user.account_id)<0&&this.presentAccountIds.push(this.user.account_id),{groupSeenStateInfo:this.groupSeenStateInfo,linkSeenStateInfo:this.linkSeenStateInfo,presentAccountIds:this.presentAccountIds,passFetchingStatus:r};var o},t.prototype.getPassFileInfo=function(){var e,t,n=this.getContentInfo(),r=n.extras.origin&&!n.isFolder()&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW"].indexOf(n.extras.origin)>=0,s=n.extras.origin&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW","PREVIEW_PAGE","PREVIEW_PAGE_FACEPILE"].indexOf(n.extras.origin)>=0;return s&&!n.isSharedFolder()?(e=n.beaconContext(),t=n.extras.fileId):(e=null,t=null),{beaconContext:e,fromBrowse:r,fileId:t}},t.prototype.getUrl=function(){var e=this.sharingInfo.linkMetadata();return this.getPassFileInfo().fromBrowse?void 0:e&&e.url},t.prototype.getFileData=function(e){var t=this.getPassFileInfo();return{file:{beacon_context:t.beaconContext,file_id:t.fileId},url:e}},t.prototype.getContentInfo=function(){return this.sharingInfo.contentInfo()},t.prototype.dispatch=function(e,t){void 0===t&&(t={}),c.Dispatcher.dispatch({type:e,data:t,contentIds:[this.getContentInfo().id],user:this.user})},t.prototype.changeMemberAccessSimple=function(e,t,n){return this.client.updateMember({contentId:e,memberId:t,accessLevel:n})},t.prototype.changeMemberAccess=function(e,t,n){var r=this,s=t.access_type;return this.dispatch(g.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:n}),this.changeMemberAccessSimple(e,t.memberId(),n).then(function(e){if(e.access_level&&e.warning)return r.dispatch(g.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:e.access_level}),e}).catch(i.catchApiError(function(e){return r.dispatch(g.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:s}),r.parseParentFolderAccessError(e)}))},t.prototype.fetchLinkMetadata=function(){var e=this;return"/"===this.getContentInfo().displayPath()||V.TRUELINK.TRUELINK_UI[this.user.id]?Promise.resolve({}):(this.dispatch(g.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST),this.client.sharedLinkInfo({fileIdOrPath:this.getContentInfo().idForLink()}).then(function(t){e.dispatch(g.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}).catch(function(){e.dispatch(g.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE),e.sharingInfo.isNonUserRelativeContext()||(P.sharingNotificationError(Q("There was a problem completing this request.")),p.Modal.close())}))},t.prototype.fetchMemberCounts=function(){var e=this,t=this.getContentInfo();return this.dispatch(g.ShareModalActionTypes.FETCH_MEMBER_COUNTS_REQUEST),t.isSharedFolder()||t.isFolder()&&t.isInSharedFolder()?this.client.getMemberCounts({contentId:t.isSharedFolder()?t.sharedFolderId():t.nsId()}).then(function(t){e.dispatch(g.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS,{memberCounts:t})}):Promise.resolve({})},t.prototype.fetchSharingPrefs=function(){var e=this;return this.dispatch(g.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST),this.client.getSharingPrefs().then(function(t){e.dispatch(g.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS,{sharingPrefs:t})})},t.prototype.onShareModalUnmount=function(e){this.teardownPass();var t=e&&e.serializeInputData()||{};this.dispatch(g.ShareModalActionTypes.SHARE_MODAL_CLOSE,t)},t.prototype.fetchTeamPolicy=function(){var e=this;return this.dispatch(g.ShareModalActionTypes.FETCH_TEAM_POLICY_REQUEST),this.client.getCurrentAccountCached().then(function(t){e.dispatch(g.ShareModalActionTypes.FETCH_TEAM_POLICY_SUCCESS,{teamPolicy:t.team&&t.team.sharing_policies})})},t.prototype.handleExpUjMagnet2018FetchRequest=function(e,t,n){var r=this;this.dispatch(g.ShareModalActionTypes.FETCH_MAGNET2018_REQUEST,{promise:e,emails:t,ts:n}),e.then(function(t){var s=R.maybeLogExpUjMagnet2018Exposure(r.sharingInfo.expUjMagnet2018ShouldLogExposure(),t,r.user);r.dispatch(g.ShareModalActionTypes.FETCH_MAGNET2018_SUCCESS,{promise:e,ts:n,suggestableUserData:t,loggedExposure:s})}).catch(function(){r.dispatch(g.ShareModalActionTypes.FETCH_MAGNET2018_FAILURE,{ts:n})})},t.prototype.handleContentNameChange=function(e){var t="SIMPLIFIED_WIZARD_UI::CONTENT_NAME_CHANGE";this.hasLoggedSet[t]||(this.sharingExperimentsLog(t),this.hasLoggedSet[t]=!0),this.dispatch(g.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE,{name:e})},t.prototype.handleContentNameFocusChange=function(e){this.dispatch(g.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE,{focus:e})},t.prototype.handleUpdateFilePolicy=function(e,t){this.handleUpdateSharingSettings(e);var n=this.getSharingInfo().filePolicy(),r=this.getPassFileInfo(),s=r.fromBrowse,i=r.fileId;if(i)if(n.viewer_info_policy===b.ViewerInfoPolicy.disabled&&t.viewer_info_policy===b.ViewerInfoPolicy.enabled)this.clearCachedPassInfo(),u.PassActions.resetPassInfo(i),u.PassActions.fetchPassError(i),this.dispatch(g.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO);else{var a=n.audience===b.LinkAudience.members!=(t.audience===b.LinkAudience.members),o=n.viewer_info_policy===b.ViewerInfoPolicy.enabled&&t.viewer_info_policy===b.ViewerInfoPolicy.disabled;if(a||o){this.clearCachedPassInfo();var l=this.getUrl();o&&this.listMembers({contentId:i,url:l,isNonUserRelativeContext:this.sharingInfo.isNonUserRelativeContext()}),h.PassHelpers.setup({user:this.user,fileData:this.getFileData(l),prevFileData:null,shouldWritePresence:!s,skipSharingEndpoints:!0})}}},t.prototype.handleUpdateSharingSettings=function(e){this.dispatch(g.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS,{metadata:e})},t.prototype.listMembers=function(e){var t=e.contentId,n=e.url,r=e.members,s=e.isNonUserRelativeContext,i=void 0!==s&&s;return S.SharingActions.listMembers({user:this.user,contentId:t,isFolder:this.sharingInfo.isFolder(),url:n,members:r,client:this.client,isNonUserRelativeContext:i})},t.prototype.addMembers=function(e,t,n,r){void 0===n&&(n=!1);var s=e.map(function(e){return{member:y.createUnionScalar(e.contactType(),e.contactId()),access_level:y.accessLevelConstToApi(e.access_type)}});return this.client.addMembersWithAccessLevel({contentId:t,members:s,customMessage:r,quiet:n})},t.prototype.isContentInfoForFilePreview=function(e){return("PREVIEW_PAGE"===e.extras.origin||"PREVIEW_PAGE_FACEPILE"===e.extras.origin)&&!e.isFolder()},t.prototype.log=function(e,t){void 0===t&&(t={}),L.logTiburonEvent(this.getContentInfo(),this.user.id,e,t)},t.prototype.logIfHaventBefore=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!0),this.hasLoggedSet[e]||(this.hasLoggedSet[e]=!0,n&&(t.timing=Date.now()-this.beginTime),this.log(e,t))},t.prototype.onClickX=function(e){e&&e.finishLogging(!0),this.showTruelinkFeedbackIfQualified(),p.Modal.close()},t.prototype.redirectToBrowseUrl=function(e){if(null!=this.setUrl)this.setUrl({path:e});else{var t=a.browse_uri_for_fq_path(this.user,e);G.redirect(t.toString())}},t.prototype.redirectToUpgrade=function(){G.redirect("/upgrade?oqa=spw")},t.prototype.refreshSharedWithColumnLinkData=function(){c.Dispatcher.dispatch({type:d.SharedWithActionType.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.getContentInfo().displayPath()]}})},t.prototype.relinquishMembershipSimple=function(e,t){var n=this;return this.client.relinquishMembership({contentId:e,leaveACopy:t}).then(function(){p.Modal.close(),n.redirectToBrowseUrl("/")})},t.prototype.relinquishMembership=function(e,t){var n=this.getContentInfo();return this.relinquishMembershipSimple(e,t).then(function(){n.isFolder()?P.sharingNotificationSuccess(Q("Folder access removed.")):P.sharingNotificationSuccess(Q("File access removed."))})},t.prototype.removeMemberSimple=function(e,t,n){return this.client.removeMember({contentId:e,
memberId:t,leaveACopy:n})},t.prototype.removeMember=function(e,t,n,r){var s=this;return this.dispatch(g.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:t}),this.removeMemberSimple(e,t.memberId(),n).then(function(e){return s.fetchInitialData().then(function(){if(e&&null!=e.access_level&&null!=e.warning)return s.dispatch(g.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS,{member:t,access:e.access_level}),e;r?P.sharingNotificationSuccess(Q("Folder access removed.")):P.sharingNotificationSuccess(Q("File access removed.")),s.dispatch(g.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS,{member:t})})}).catch(i.catchApiError(function(e){return s.dispatch(g.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:t}),s.parseParentFolderAccessError(e)}))},t.prototype.setContentNameAndSendShare=function(e){var t=this,n=this.sharingInfo.contentNameInputValue(),r=l.parent_dir(this.sharingInfo.fqPath()),s=L.getNewFolderPathFromContentName(n,r),i=!this.sharingInfo.isNonUserRelativeContext(),o=a.browse_uri_for_fq_path(this.user,s);o.updateQuery("show_share_success_snackbar","1");var c,d;return R.isLoggedExpUjMagnet2018(this.sharingInfo.ownerTeam())?(c=!1,i&&(d=a.browse_uri_for_fq_path(this.user,s))):c=i,new Promise(function(s,a){new E.SharingApi(t.user).validate_new_sf_path(n,L.getNewFolderPathFromContentName(n,r),function(){t.dispatch(g.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS,{contentName:n}),t.sendShare(e,{keepModalOpen:i,suppressSuccessSnackbar:c,redirectUri:d}).then(function(){t.sharingInfo.shareAsConfidential()&&x.WebUserActionLog.log(t.user.id,D.WebUserActionLogEvent.CONF_BY_CREATE_CONFIDENTIAL_FOLDER,{ns_id:t.sharingInfo.contentId(),who_has_access:D.WebUserActionLogExtraValue.SPECIFIC_PEOPLE,location:t.sharingInfo.isNonUserRelativeContext()?D.WebUserActionLogExtraValue.CONTENT_MANAGER:D.WebUserActionLogExtraValue.BROWSE}),i&&!R.isLoggedExpUjMagnet2018(t.sharingInfo.ownerTeam())&&G.redirect(o.toString()),s()})},function(e){t.sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::INVALID_CONTENT_NAME");var n=U.extract_errors(e.responseText);t.dispatch(g.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR,{errorMsg:n.folder_name&&n.folder_name.message_text}),a()})})},t.prototype.setLinkMetadata=function(e){this.dispatch(g.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:e})},t.prototype.sendShare=function(e,t){var n=this;void 0===t&&(t={keepModalOpen:!1,suppressSuccessSnackbar:!1,redirectUri:void 0}),this.log("CLICK_TIB_SEND_BUTTON");var s,a=Date.now(),l=this.isNewlySharedContent();return this.recipientsChange(e.getContacts()).then(function(){return n.sharingInfo.contactsError().level===L.ContactsErrorLevel.Error?Promise.reject({}):(n.dispatch(g.ShareModalActionTypes.SEND_SHARE_REQUEST),n.prefetchShowcaseUpsell(),s=y.contactsToMembers(n.sharingInfo.recipientTokens()),n.shareIfFileFolder(f.reactFormat(Q("Sharing <st>%(folder_name)s</st>..."),{st:r.createElement("strong",null),folder_name:o.Emstring.em_snippet(n.getContentInfo().name(),N.SNIPPET_SIZES.FILENAME)})))}).then(function(){return n.turnLinkOnIfQualified(),n.client.addMembers({accessLevel:n.sharingInfo.recipientAccess(),contentId:n.sharingInfo.contentInfo().id,customMessage:n.sharingInfo.recipientMessage(),members:s})}).catch(i.catchApiError(function(e){return n.dispatch(g.ShareModalActionTypes.SEND_SHARE_FAILURE),n.reportShareFailure(e),n.log("SHARE_MODAL_SEND_FAIL",{timing:Date.now()-a,num_recipients:s.length}),Promise.reject({})})).then(function(){n.dispatch(g.ShareModalActionTypes.SEND_SHARE_SUCCESS),t.suppressSuccessSnackbar||P.showInBandShareSuccessSnackbar(n.getContentInfo().name()),n.log("SHARE_MODAL_SEND_SUCCESS",{timing:Date.now()-a,num_recipients:s.length}),n.sharingInfo.getInitialProps().onSuccessSharing&&n.sharingInfo.getInitialProps().onSuccessSharing(),e&&e.finishLogging(!1),n.refreshSharedWithColumnContentData(),H.SHOW_CREATE_TEAM_MODAL_AFTER_SHARING&&l&&s.length>=2?p.Modal.showInstance(r.createElement(O.CreateTeamPromptModal,{invitedMembers:n.sharingInfo.recipientTokens().filter(function(e){return e.email!==n.user.email})})):(n.showTruelinkFeedbackIfQualified(),n.showShowcaseUpsellIfQualified(),n.showShowcaseUpsellGifIfQualified(),R.showExpUjMagnet2018PostShareIfQualified(n.sharingInfo.ownerTeam(),n.handleShowMembershipSuggestionModal,n.sharingInfo.expUjMagnet2018SuggestableUserDataPromise(),n.sharingInfo.expUjMagnet2018SuggestableUserData(),t.redirectUri),t.keepModalOpen||p.Modal.close())})},t.prototype.isNewlySharedContent=function(){var e=this.getContentInfo();return e.isFileFolder()||e.isFile()&&!this.sharingInfo.hasNonOwnerMembers()},t.prototype.shareFolderSimple=function(e,t,n,r){var s=this;void 0===t&&(t=!1);var a=function(e){return s.dispatch(g.ShareModalActionTypes.SHARE_FOLDER_SUCCESS,{metadata:e}),c.Dispatcher.dispatch({type:A.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:s.user}),e},o={fqPath:e,confidential:t,syncSetting:n,folderPolicy:r},l=this.client.share(o);return this.dispatch(g.ShareModalActionTypes.SHARE_FOLDER_REQUEST,{promise:l}),l.then(a).catch(function(e){if(e instanceof i.AppError&&e.error&&e.error.bad_path&&"already_shared"===e.error.bad_path[".tag"]){return a(y.folderMetadataApiToRecord(e.error.bad_path))}return s.dispatch(g.ShareModalActionTypes.SHARE_FOLDER_FAILURE),Promise.reject(e)})},t.prototype.sharingExperimentsLog=function(e,t){void 0===t&&(t={});var n=this.getContentInfo().extras.modalSessionId;t.modalSessionId=t.modalSessionId||n,s.SharingExperimentsLogger.log(this.user.id,e,t)},t.prototype.showTruelinkFeedbackIfQualified=function(){V.TRUELINK.TRUELINK_UI[this.user.id]&&(this.sharingInfo.hasChangedSharingSettings()?B.showFeedbackFlyoutIfAllowed("settings"):this.sharingInfo.hasChangedLinkAudience()&&B.showFeedbackFlyoutIfAllowed("sender"))},t.prototype.teardownPass=function(){this.clearCachedPassInfo(),this.getPassFileInfo().fromBrowse&&h.PassHelpers.teardown({user:this.user,fileData:this.getFileData(),async:!0,shouldWritePresence:!1})},t.prototype.prefetchShowcaseUpsell=function(){"personal"!==this.user.role||this.user.paid||new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/post_share_controller"],t,n)})},t.prototype.showShowcaseUpsellIfQualified=function(){return n.__awaiter(this,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return"personal"!==this.user.role||this.user.paid?[3,2]:(t=this.getContentInfo(),[4,new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/post_share_controller"],t,n)})]);case 1:r=n.sent().ShowcaseUpsellPostShareController,r.maybeShow(this.user,t),n.label=2;case 2:return[2]}})})},t.prototype.showShowcaseUpsellGifIfQualified=function(){return n.__awaiter(this,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return"personal"!==this.user.role||this.user.paid?[3,2]:(t=this.getContentInfo(),[4,new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/post_share_gif_controller"],t,n)})]);case 1:r=n.sent().ShowcaseUpsellPostShareGifController,r.maybeShow(this.user,t),n.label=2;case 2:return[2]}})})},t})();t.ShareModalActionHandler=J}),define("modules/clean/sharing/actions/sharing_actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/pass/action_timestamps","modules/clean/react/pass/constants","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/constants/sharing","modules/core/exception"],function(e,t,n,r,s,i,a,o,l,c,d,p,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingActions={loadFileMetadataBatch:function(e,t){return new a.FileShareApiClient({userId:e.id}).getMetadataBatchAlpha({contentIds:t,actions:Object.keys(o.ALPHA_FILE_METADATA_PERMISSIONS)}).then(function(t){return n.Dispatcher.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:e,data:t})})},loadFolderLinkMetadataBatch:function(e,t,r){return Promise.resolve({}).then(function(){return t.forEach(function(t){return n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,user:e,contentIds:[t]})})}),new a.FolderShareApiClient({userId:e.id,isNonUserRelativeContext:r}).validateFolderPathBatch({paths:t}).then(function(t){t.forEach(function(t){var r=t.metadata,s=t.path;r&&r.link_metadata?n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,data:{linkMetadata:r.link_metadata},user:e,contentIds:d.getContentIdsForMetadata(r).concat([s])}):n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE,user:e,contentIds:[s]})})})},loadFileMetadata:function(e){var t=e.user,r=e.contentId,s=e.sourceUrl,d=e.client,p=c.sharingInfoStore.getSharingInfo(t.id,r);if(p&&p.fetchingMetadataPromise())return p.fetchingMetadataPromise();d=d||new a.FileShareApiClient({userId:t.id});var u=d.getMetadataAlpha({contentId:r,actions:Object.keys(o.ALPHA_FILE_METADATA_PERMISSIONS),sourceURL:s}).then(function(e){n.Dispatcher.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:t,data:[e]}),n.Dispatcher.dispatch({type:l.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:t})});return n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_METADATA_REQUEST,contentIds:[r],data:{promise:u},user:t}),u},listMembers:function(e){var t=e.user,o=e.contentId,l=e.isFolder,d=e.limit,p=e.url,m=e.members,h=e.client,_=e.previewSessionId,f=void 0===_?null:_,g=e.includeSeenState,S=void 0===g||g,E=e.isNonUserRelativeContext,b=void 0!==E&&E;u.assert(!d||d<=100,"listMembers not implemented for limit > 100");var y=d||9999999,v=c.sharingInfoStore.getSharingInfo(t.id,o);if(v){var I=v.fetchingMembersRequest();if(I&&y<=I.limitNonNull)return I.promise;if(v.hasDisplayableMembers()&&y<v.members().getMemberCount())return Promise.resolve({})}var C=Math.random().toString(),M=!l;h||(h=l?new a.FolderShareApiClient({userId:t.id,isNonUserRelativeContext:b}):new a.FileShareApiClient({userId:t.id,isNonUserRelativeContext:b}));var N,T=function(e){return e?(n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST,contentIds:[o],user:t}),h.listMembersContinue({cursor:e,url:p,isAlpha:M}).then(function(e){n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,contentIds:[o],data:{members:e,requestId:C},user:t}),T(e.cursor)})):Promise.resolve({})};return r.ActionTimestampsTracker.record(s.LoggingActions.LIST_MEMBERS_BEGIN,f),N=m?Promise.resolve(m):h.listMembers({contentId:o,url:p,limit:d,isAlpha:M,includeSeenState:S}),N=N.then(function(e){r.ActionTimestampsTracker.record(s.LoggingActions.LIST_MEMBERS_RECEIVE,f),n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS,contentIds:[o],data:{members:e,requestId:C},user:t}),d||T(e.cursor)}),n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST,contentIds:[o],data:{limitNonNull:y,requestId:C,promise:N},user:t}),N},fetchFileMemberCount:function(e){var t=e.user,o=e.contentId,l=e.limit,c=e.url,d=e.client,p=e.countGroupsAsMembers,u=void 0!==p&&p,m=e.previewSessionId,h=void 0===m?null:m,_=e.runViewerInfoChecks,f=void 0!==_&&_;d=d||new a.FileShareApiClient({userId:t.id}),r.ActionTimestampsTracker.record(s.LoggingActions.MEMBER_COUNTS_BEGIN,h);var g=d.getMemberCounts({contentId:o,limit:l,url:c,countGroupsAsMembers:u,runViewerInfoChecks:f});return n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_REQUEST,contentIds:[o],user:t}),g.then(function(e){r.ActionTimestampsTracker.record(s.LoggingActions.MEMBER_COUNTS_RECEIVE,h),n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS,contentIds:[o],data:e,user:t})})},fetchLinkMetadata:function(e){var t=e.user,r=e.contentId,s=e.client;p.TRUELINK.TRUELINK_UI[t.id]||(s=s||new a.ShareApiClient({userId:t.id}),n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,contentIds:[r],data:{},user:t}),s.sharedLinkInfo({fileIdOrPath:r}).then(function(e){n.Dispatcher.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,contentIds:[r],data:{linkMetadata:e},user:t})}))}}}),define("modules/clean/sharing/api",["require","exports","jquery","modules/clean/ajax"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){this.user=e}return e.prototype.get_sync_vars_for_ns_id=function(e,t,n){var r={ns_id:e,sub_path:t};this._make_request("/sharing/get_sync_vars_for_ns_id",r,n,null,!0)},e.prototype.validate_new_sf_path=function(e,t,n,r){var s={share_type:"new",folder_name:e,path:t};this._make_request("/share_ajax/validate_folder",s,n,r,!0)},e.prototype.validate_shareable_existing_sf_path=function(e,t,n){var r={share_type:"shareable_existing",path:e};this._make_request("/share_ajax/validate_folder",r,t,n,!0)},e.prototype._make_request=function(t,s,i,a,o,l){void 0===o&&(o=!1),void 0===l&&(l=!0);var c={url:t,data:s,success:function(r,a,o){i(o),n(document).trigger(e.REQUEST_SUCCEEDED_EVENT,{request_url:t,ns_id:s.ns_id||null})},error:function(e){a&&a(e)}};l&&(c.subject_user=this.user.id),o?r.FormWebRequest(c):r.WebRequest(c)},e.REQUEST_SUCCEEDED_EVENT="db:sharing_api:request_succeeded",e})();t.SharingApi=s}),define("modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal",["require","exports","external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/clean/sharing/constants","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=l.i18n_default_project("sharing")._,d=function(e,t,l,d,p,u,m,h,_){void 0===e&&(e=""),void 0===p&&(p=!1),void 0===h&&(h=!1);var f,g,S,E=r.Emstring.em_snippet(e,40),b=null;if(t===a.MEMBER_ACTION.REMOVE){if(S=c("Remove %(name)s?").format({name:E}),l){f=d&&!h?_?s.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access <strong>%(parentname)s</strong> will still be able to access this folder."),{strong:n.createElement("strong",null),name:E,parentname:_}):s.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access the parent folder will still be able to access this folder."),{strong:n.createElement("strong",null),name:E}):s.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this shared folder."),{strong:n.createElement("strong",null),name:E}),p&&(b=c("Let %(name)s keep a copy of this shared folder").format({name:E}))}else f=s.reactFormat(c("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to this file."),{strong:n.createElement("strong",null),name:E});g=c("Remove")}else S=c("Make %(name)s the owner of this folder?").format({name:E}),f=s.reactFormat(c("Only <strong>%(name)s</strong> will be able to unshare this folder or change folder settings."),{strong:n.createElement("strong",null),name:E}),g=c("Make owner");return o.Modal.showInstance(n.createElement(i.ConfirmWithOptionModal,{autoClose:!1,confirmText:g,cancelText:c("Cancel"),onConfirm:u,onCancel:m,optionLabel:b,showOption:null!=b,title:S},f))};t.showMemberAccessChangeConfirmationModal=d}),define("modules/clean/sharing/confirmation_modals/simple_confirm_modal",["require","exports","tslib","external/react","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i.i18n_default_project("sharing")._,o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement(s.Modal,{style:"bare"},r.createElement("div",{className:"simple-confirm-modal"},r.createElement("div",{className:"simple-confirm-modal__main"},r.createElement("div",{className:"simple-confirm-modal__title"},this.props.title),r.createElement("div",{className:"simple-confirm-modal__body"},this.props.children)),r.createElement("div",{className:"simple-confirm-modal__footer"},r.createElement("button",{className:"simple-confirm-modal__cancel c-btn c-btn--secondary",onClick:this.props.onCancel},this.props.cancelText||a("Cancel")),r.createElement("button",{className:"simple-confirm-modal__confirm c-btn c-btn--primary",onClick:this.props.onConfirm},this.props.confirmText))))},t})(r.Component);t.SimpleConfirmModal=o}),define("modules/clean/sharing/content_info",["require","exports","tslib","external/immutable","modules/constants/python"],function(e,t,n,r,s){"use strict";function i(e){var t=(e.isFolder?e.targetNsId:e.fileId)||e.fqPath;if(null===t)throw new Error("Not enough fields provided for extras");return t}Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.createFromParams=function(e){var n=new o(e);return new t({extras:n,id:i(n)})},t.prototype.setNsId=function(e){var t=this.setIn(["extras","targetNsId"],e);return t.set("id",i(t.extras))},t.prototype.setFQPath=function(e){var t=this.setIn(["extras","fqPath"],e);return t.set("id",i(t.extras))},t.prototype.isFolder=function(){return this.extras.isFolder},t.prototype.isFile=function(){return!this.isFolder()},t.prototype.isFileFolder=function(){return this.isFolder()&&!this.isSharedFolder()},t.prototype.isSharedFolder=function(){return Boolean(this.extras.targetNsId)},t.prototype.isTeamSharedFolder=function(){return this.extras.isTeamSharedFolder},t.prototype.isInSharedFolder=function(){return Boolean(this.extras.nsId&&this.extras.nsId!==this.extras.userHomeNs)},t.prototype.isNestedSharedFolder=function(){return this.isInSharedFolder()&&this.isSharedFolder()},t.prototype.isOSXPackage=function(){var e=this.extras.fqPath,t=e.substr(e.lastIndexOf("."));return s.PACKAGE_EXTS.indexOf(t)>=0},t.prototype.isMounted=function(){return!this.extras.url},t.prototype.url=function(){return this.extras.url},t.prototype.pathExists=function(){return Boolean(this.extras.exists)},t.prototype.name=function(){return this.displayPath()?this.displayPath().split("/").pop():this.filename()},t.prototype.idForLink=function(){var e=this.extras.fileId||this.extras.fqPath;if(!e)throw new Error("No identifiers for getting links");return e},t.prototype.sharedFolderId=function(){var e=this.extras.targetNsId;if(!e)throw new Error("No shared folder ID");return e},t.prototype.displayPath=function(){return this.extras.fqPath},t.prototype.parentFolderName=function(){if(this.extras.fqPath){var e=this.displayPath().split("/");if(e.length>1)return e[e.length-2]}return""},t.prototype.filename=function(){return this.extras.filename},t.prototype.nsId=function(){if(!this.extras.nsId)throw new Error("Can't determine nsId");return this.extras.nsId},t.prototype.nsPath=function(){if(null===this.extras.nsPath)throw new Error("Can't determine nsPath");return this.extras.nsPath},t.prototype.sjid=function(){return this.extras.sjid},t.prototype.teamGroupInfo=function(){return this.extras&&this.extras.teamGroupInfo},t.prototype.beaconContext=function(){return this.extras&&this.extras.beaconContext},t})(r.Record({extras:null,id:null},"ContentInfo"));t.ContentInfo=a;var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(r.Record({beaconContext:null,exists:!0,fileId:null,filename:null,fqPath:null,isFolder:null,isTeamSharedFolder:!1,modalSessionId:null,nsId:null,nsPath:null,origin:null,sjid:null,targetNsId:null,url:null,userHomeNs:null,teamGroupInfo:null},"ContentInfoExtras"));t.ContentInfoExtras=o}),define("modules/clean/sharing/delete_link_modal",["require","exports","modules/clean/ajax","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/core/i18n"],function(e,t,n,r,s,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o.i18n_default_project("sharing")._,c=function(e){var t=e.client,n=e.url,o=e.contentName,c=e.onDeleteLink,d=e.onCancel;o=r.Emstring.em_snippet(o,i.SNIPPET_SIZES.FILENAME);var p=function(){return t.revokeSharedLink({url:n}).then(function(){var e=l("Deleted link to “%(name)s”").format({name:o});a.sharingNotificationSuccess(e),s.Modal.close(),c&&c()})};s.SimpleModal.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:d,cancel_text:l("Cancel"),confirm_callback:p,confirm_text:l("Delete"),title_text:l("Delete link to “%(name)s”?").format({name:o}),style:"default-maestro"})};t.deleteLinkWithConfirm=c;var d=function(e){var t=e.client,o=e.tkey,c=e.contentName,d=e.onDeleteLink,p=e.onCancel;if(c=r.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),null===o)return void s.Modal.close();var u=function(){return n.WebRequest({url:"/sm/disable/"+o,type:"POST",data:{tkey:o},subject_user:t.userId,success:function(){var e=l("Deleted link to “%(name)s”").format({name:c});a.sharingNotificationSuccess(e),s.Modal.close(),d&&d()}})};return s.SimpleModal.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:p,cancel_text:l("Cancel"),confirm_callback:u,confirm_text:l("Delete"),title_text:l("Delete link to “%(name)s”?").format({name:c}),style:"default-maestro"})};t.deleteLinkWithConfirmLegacy=d}),define("modules/clean/sharing/file_settings_modal",["require","exports","tslib","external/react","external/lodash","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/util","modules/clean/react_format","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/constants","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_notifications_util","modules/constants/sharing","modules/constants/sharing","modules/core/i18n","modules/clean/react/css"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I,C,M,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=M.i18n_default_project("sharing")._,A=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleAcceptClick=function(){var e=n.getPolicyDiff();e?p.setStatePromise(n,{isSubmitting:!0}).then(function(){return n.getClient().updatePolicy({contentId:n.props.contentId,newPolicy:e,actions:Object.keys(g.ALPHA_FILE_METADATA_PERMISSIONS)})}).catch(i.catchApiError(function(){n.setState({isSubmitting:!1}),Promise.reject({})})).then(function(e){v.sharingNotificationSuccess(T("File settings updated")),n.props.onPolicySet&&n.props.onPolicySet(e)}):n.props.onPolicySet&&n.props.onPolicySet(void 0)},n.handleDismissClick=function(){c.Modal.close(),n.props.onCancel&&n.props.onCancel()},n.handleDismissCompleted=function(){n.props.onCancel&&n.props.onCancel()},n.handlePolicyUpdate=function(e,t){n.setState({desiredPolicy:n.state.desiredPolicy.set(e,t)})},n.getPolicyDiff=function(){var e={};return n.state.desiredPolicy.keySeq().toArray().map(function(t){var r=n.state.desiredPolicy.get(t),i=n.props.initialPolicy.get(t);("object"==typeof r?s.isEqual(r,i):r===i)||(e[t]=n.state.desiredPolicy.get(t))}),e},n.handleUnshareFile=function(){var e=function(){return d.Snackbar.sync(u.reactFormat(T("Unsharing <st>%(file_name)s</st>..."),{st:r.createElement("strong",null),file_name:n.props.fileName}),!0),n.getClient().unshare({contentId:n.props.contentId}).then(function(){n.refreshSharedMemberData(),d.Snackbar.complete(u.reactFormat(T("Unshared <st>%(file_name)s</st>."),{st:r.createElement("strong",null),file_name:n.props.fileName})),c.Modal.close(),I.TRUELINK.TRUELINK_UI[n.props.user.id]&&m.SharingActions.loadFileMetadata({user:n.props.user,contentId:n.props.contentId})})};f.confirmResetAccess({allowLeaveACopy:!1,contentName:n.props.fileName,isFolder:!1,isNestedSharedFolder:!1,onConfirm:e})},n.refreshSharedMemberData=function(){o.Dispatcher.dispatch({type:l.SharedWithActionType.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[n.props.contentId]}})},n.state={isSubmitting:!1,desiredPolicy:t.initialPolicy},n}return n.__extends(t,e),t.prototype.render=function(){return C.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL?this.openSharingSettingsModal():r.createElement(k,{canChangeOptions:this.props.canChangeOptions,canChangeViewerInfo:this.wrapCanChangePolicy(S.VIEWER_INFO_POLICY),canUnshareFile:this.props.canUnshareFile,contentId:this.props.contentId,desiredPolicy:this.state.desiredPolicy,fileName:this.props.fileName,handleUnshareFile:this.handleUnshareFile,isSubmitting:this.state.isSubmitting,onAccept:this.handleAcceptClick,onDismiss:this.handleDismissClick,onDismissCompleted:this.handleDismissCompleted,onPolicyUpdate:this.handlePolicyUpdate,ownerTeam:this.props.ownerTeam,user:this.props.user,viewerInfoDenyReason:y.getPassDenyReason(this.props.initialPolicy,this.props.permissions)})},t.prototype.getClient=function(){return new h.FileShareApiClient({userId:this.props.user.id})},t.prototype.wrapCanChangePolicy=function(e){var t=this.props.canChangeOptions;return y.isCommonSharingSettingsPolicy(e)&&(t=y.canChangePolicy(e,this.props.initialPolicy,this.state.desiredPolicy,this.props.linkMetadata,this.props.permissions)),t},t.prototype.openSharingSettingsModal=function(){var e=this,t=function(t,n){return[e.state.desiredPolicy.get(t),e.wrapCanChangePolicy(t)]};return r.createElement(b.SharingSettingsModal,{contentId:this.props.contentId,currentPolicy:this.props.initialPolicy,fileName:this.props.fileName,folderName:this.props.fileName,getEffectivePolicyValue:t,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isFolder:!1,isLoading:!1,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onDismiss:this.handleDismissClick,onOptionChange:this.handlePolicyUpdate,onSaveSettings:this.handleAcceptClick,onUnshare:this.handleUnshareFile,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,policyUpdate:this.getPolicyDiff(),user:this.props.user})},t.displayName="FileSettingsModal",t})(r.Component);t.FileSettingsModal=A;var w=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e;return this.props.canChangeOptions&&(e=r.createElement(E.SettingsModalButtons,{disableSave:!1,isAccepting:this.props.isSubmitting,onAccept:this.props.onAccept,onDismiss:this.props.onDismiss})),r.createElement(c.Modal,{autoClose:!1,className:"file-settings-modal",buttonComponent:r.createElement("span",null),onDismissCompleted:this.props.onDismissCompleted,title:T("“%(file_name)s” settings").format({file_name:a.Emstring.em_snippet(this.props.fileName,g.SNIPPET_SIZES.FILENAME)})},r.createElement("div",{className:"file-settings-form"},this.renderHeader(),this.renderPolicies(),this.renderButtons(),e))},t.prototype.renderHeader=function(){if(!this.props.canChangeOptions)return r.createElement("div",{className:"u-pad-xs u-font-center u-mar-bottom-s file-settings-form__no-permission-banner"},T("You don’t have permission to change the settings on this file."))},t.prototype.renderPolicies=function(){return r.createElement("div",null,null!=this.props.desiredPolicy.viewer_info_policy?this.renderViewerInfoPolicy():void 0)},t.prototype.renderViewerInfoPolicy=function(){var e;return e=this.props.ownerTeam?T("Show viewer info to members of %(company_name)s and people who can edit").format({company_name:this.props.ownerTeam.name}):T("Show viewer info to people who can edit"),r.createElement(E.SinglePolicyControl,{canChange:this.props.canChangeViewerInfo,denyReason:this.props.viewerInfoDenyReason,policyName:_.ViewerInfoPolicy.policy_name,policyDescription:T("Show who views this file?"),currentValue:this.props.desiredPolicy.viewer_info_policy,options:[{label:e,value:_.ViewerInfoPolicy.enabled},{label:T("Don’t show who views"),value:_.ViewerInfoPolicy.disabled}],handleOptionChange:this.props.onPolicyUpdate})},t.prototype.renderButtons=function(){var e;return this.props.canUnshareFile&&(e=r.createElement("div",{className:"u-l-fl"},r.createElement("button",{className:"button-as-link c-borderless-button",style:{lineHeight:"32px"},onClick:this.props.handleUnshareFile},T("Unshare file")))),r.createElement("div",{className:"u-mar-top-m clearfix"},e)},t.displayName="FileSettingsModalContents",t})(r.Component),k=N(w,["/static/css/modal-vflI292PU.css"]);t.FileSettingsModalContents=k}),define("modules/clean/sharing/folder_settings_modal",["require","exports","tslib","external/classnames","external/purify","external/react","external/react-dom-factories","external/prop-types","external/lodash","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/util","modules/clean/react_format","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/share_page/action_types","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/ui_util","modules/constants/sharing","modules/constants/sharing","modules/constants/trademark","modules/core/browser","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I,C,M,N,T,A,w,k,L,P){"use strict";function F(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var R=i.createElement,O=P.i18n_default_project("sharing")._,x={shared_folder_member_policy:"team"},D={shared_folder_member_policy:"team"},U={member_policy:"shared_folder_member_policy"},B=(function(e){function t(n){var r=e.call(this,n)||this;return r._isMounted=!1,r._handleSaveSettings=function(){var e=r._getPolicyUpdate();if(null!=e){var n=function(){var t=r.props.onPolicySet;return(r._isMounted?f.setStatePromise(r,{isSubmitting:!0}):Promise.resolve()).then(function(){var t=function(t){return _.Snackbar.complete(O("Folder settings updated.")),Promise.resolve({policyUpdate:e,sharedFolderMetadata:t})},n=function(e){return r.props.actionHandler&&r.props.actionHandler.reportShareFailure(e)};if(null!=r.props.folderId){return(0,r._getClient().updatePolicyAlpha)({contentId:r.props.folderId,newPolicy:e,url:null!=r.props.linkMetadata?r.props.linkMetadata.url:void 0}).then(t)}return e=A.TRUELINK.TRUELINK_UI[r.props.user.id]?new E.CombinedPolicy(e):new E.FolderPolicy(e),r.props.actionHandler&&r.props.actionHandler.shareIfFileFolder(O("Updating folder settings..."),e).then(t).catch(n)}).then(function(e){var n=e.policyUpdate,r=e.sharedFolderMetadata;return"function"==typeof t?t(n,r):void 0}).catch(c.catchApiError(function(e){if(r._isMounted)return r.setState({isSubmitting:!1})}))};if(r.state.isPolicyChangeRecursive){var i=r.props;return h.SimpleModal.show({title_text:O("Save settings?"),body_html:r.state.isTeamSharedFolder?s.sanitize(O("Your changes will be applied to this team folder and any folders inside it.")):s.sanitize(O("Your changes will be applied to this folder and any folders inside it.")),confirm_text:O("Save settings"),cancel_text:O("Cancel"),autoclose:!1,
confirm_callback:n,cancel_completed_callback:function(){return h.Modal.showInstance(R(t,i))}})}return n()}},r._handleDismiss=function(){return h.Modal.close(),"function"==typeof r.props.onCancel?r.props.onCancel():void 0},r._handleUnshareFolder=function(){if(null!=r.props.folderId&&F(null!=r.state.permissions?r.state.permissions.unshare:void 0,function(e){return e.allow})){var e=function(e){return _.Snackbar.sync(g.reactFormat(O("Unsharing <st>%(folder_name)s</st>..."),{st:a.strong(),folder_name:d.Emstring.em_snippet(r.props.folderName,y.SNIPPET_SIZES.FILENAME)}),!0),r._getClient().unshare({contentId:r.props.folderId,leaveACopy:e}).then(function(){return _.Snackbar.complete(g.reactFormat(O("Unshared <st>%(folder_name)s</st>."),{st:a.strong(),folder_name:d.Emstring.em_snippet(r.props.folderName,y.SNIPPET_SIZES.FILENAME)})),null!=r.props.actionHandler&&r.props.actionHandler.refreshSharedWithColumnContentData(),h.Modal.close(),u.Dispatcher.dispatch({type:I.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS,metadata:r.state.metadata,user:r.props.user})}).catch(function(e){return"too_many_files"===e.error[".tag"]?r._tooManyFilesSnackbar():N.sharingNotificationError(e.message),u.Dispatcher.dispatch({type:I.SharePageActionTypes.UNSHARE_FOLDER_ERROR,metadata:r.state.metadata,user:r.props.user})})},n=(function(e){return function(){return h.Modal.showInstance(R(t,e))}})(r.props);return b.confirmResetAccess({allowLeaveACopy:F(null!=r.state.permissions?r.state.permissions.leave_a_copy:void 0,function(e){return e.allow}),contentName:r.state.metadata.name,isFolder:!0,isNestedSharedFolder:!!r.state.hasParentSharedFolder,onCancel:n,onConfirm:e})}},r._getPolicyUpdate=function(){if(null==r.state.newPolicy)return null;var e={};return r.state.newPolicy.forEach(function(t,n){var s=r._getEffectivePolicyValue(n),i=s[0];s[1]&&(("object"==typeof t?l.isEqual(t,i):t===i)||(e[n]=t))}),e},r._handleOptionChange=function(e,t){if(F(r._getPolicyUpdate(),function(t){return t[e]})!==t)return"function"==typeof r._handlePolicyUpdate?r._handlePolicyUpdate(e,t):void 0},r._getEffectivePolicyValue=function(e,t){void 0===t&&(t=void 0);var n,s=U[e];null!=s&&null!=r.props.teamPolicy&&(n=r.props.teamPolicy.get(s));var i=null!=(null!=t?t[e]:void 0)?null!=t?t[e]:void 0:r.state.currentPolicy.get(e),a=null!=r.state.permissions.change_options?r.state.permissions.change_options.allow:void 0;return null!=n&&x[s]===n&&(a=!1,i=D[s]),M.isCommonSharingSettingsPolicy(e)&&(a=M.canChangePolicy(e,r.state.currentPolicy,r.state.newPolicy,r.props.linkMetadata,r.state.permissions,r.props.showContentManagerBridge)),r.props.showContentManagerBridge&&(a=!1),[i,a]},r.state={currentPolicy:r.props.initialPolicy,hasParentSharedFolder:r.props.initialHasParentSharedFolder,isLoading:!(null!=r.props.initialPolicy&&null!=r.props.initialPermissions),isPolicyChangeRecursive:r._hasRecursivePolicyChanges(r.props.initialIsTeamSharedFolder,r.props.initialHasParentSharedFolder),isSubmitting:!1,isTeamSharedFolder:r.props.initialIsTeamSharedFolder,metadata:r.props.initialMetadata,teamPolicy:r.props.teamPolicy,newPolicy:r.props.initialPolicy,ownerTeam:r.props.initialOwnerTeam,permissions:r.props.initialPermissions},r}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(this._isMounted=!0,this.state.isLoading)return this._fetchInitialState()},t.prototype.componentWillUnmount=function(){this._isMounted=!1},t.prototype.render=function(){var e={altAction:this.props.altAction,contentId:this.props.folderId,currentPolicy:this.state.currentPolicy,folderId:this.props.folderId,folderName:this.props.folderName,folderPath:this.props.folderPath,getEffectivePolicyValue:this._getEffectivePolicyValue,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,hasParentSharedFolder:this.state.hasParentSharedFolder,isConfidentialFolder:this.props.isConfidentialFolder,isFolder:!0,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isLimitedTeam:this.props.isLimitedTeam,isLoading:this.state.isLoading,isSharedFolder:this.props.isSharedFolder,isSubmitting:this.state.isSubmitting,isTeamSharedFolder:this.state.isTeamSharedFolder,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onDismiss:this._handleDismiss,onOptionChange:this._handleOptionChange,onSaveSettings:this._handleSaveSettings,onUnshare:this._handleUnshareFolder,ownerTeam:this.state.ownerTeam,permissions:this.state.permissions,showContentManagerBridge:this.props.showContentManagerBridge,shouldHideHeader:this.state.shouldHideHeader,teamPolicy:this.state.teamPolicy,policyUpdate:this._getPolicyUpdate(),user:this.props.user};return w.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL?R(C.SharingSettingsModal,e):R(V,e)},t.prototype._getClient=function(){return new S.FolderShareApiClient({userId:this.props.user.id,isNonUserRelativeContext:this.props.isInContentManager})},t.prototype._fetchFolderMetadata=function(){var e=[{".tag":"change_options"},{".tag":"unshare"}];return null!=this.props.folderId?this._getClient().getMetadata({contentId:this.props.folderId,actions:e}):this._getClient().validateFqPath({fqPath:this.props.folderPath,actions:e}).then(function(e){return e})},t.prototype._fetchInitialState=function(){var e=this;return this._fetchFolderMetadata().then(function(t){if(e._isMounted){var n=t.policy,r={hasParentSharedFolder:null!=t.parent_shared_folder_id,isTeamSharedFolder:t.is_team_folder,shouldHideHeader:"folder_is_limited_team_folder"===F(null!=t.permissions?t.permissions.change_options:void 0,function(e){return e.reason}),isLoading:!1,permissions:t.permissions,newPolicy:n,ownerTeam:t.owner_team,metadata:t};return null!=e.props.folderId&&(r.currentPolicy=n),r.isPolicyChangeRecursive=e._hasRecursivePolicyChanges(r.isTeamSharedFolder,r.hasParentSharedFolder),f.setStatePromise(e,r)}}).catch(c.catchApiError(function(){return h.Modal.close()}))},t.prototype._hasRecursivePolicyChanges=function(e,t){return!(!e&&!t)},t.prototype._handlePolicyUpdate=function(e,t){return this.setState({newPolicy:this.state.newPolicy.set(e,t)})},t.prototype._tooManyFilesSnackbar=function(){var e=function(){return L.open_tab("/help/files-folders/unshare-folder#foldersize")};return _.Snackbar.show(R(_.Snackbar,{actionButtonText:O("Learn more"),closeButtonText:O("Close"),onActionClick:e,title:O("Unsharing unsuccessful. This folder has too many files."),variant:"fail"}))},t.displayName="SharedFolderSettingsModal",t})(i.Component);t.SharedFolderSettingsModal=B;var H=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderHeader=function(){if(!t.props.shouldHideHeader){var e={"shared-folder-settings-form__team-folder-banner":!0,"u-pad-xs":!0,"u-font-center":!0,"u-mar-bottom-s":!0},n=a.div({},O("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:t.props.folderName}));if(t.props.isInContentManager)return a.div({className:r(e)},n);if(t.props.showContentManagerBridge){var s=p.parent_dir(t.props.folderPath),i=p.filename(t.props.folderPath),o=T.genContentManagerBridgeUri({containingFolder:s,filenameToSelect:i});return a.div({className:r(e)},n,a.div({},O("You can change these settings in the Admin Console. "),a.a({href:o.toString(),target:"_blank"},O("Open in new tab."))))}return(t.props.isTeamSharedFolder||t.props.hasParentSharedFolder)&&t.props.isUserOnOwnerTeam?a.div({className:r(e)},n,a.div({},a.a({href:"/team",target:"_blank"},O("To edit, ask your admin.")))):F(null!=t.props.permissions?t.props.permissions.change_options:void 0,function(e){return e.allow})?void 0:a.div({className:r(l.assignIn(e,{"shared-folder-settings-form__team-folder-banner":!1,"shared-folder-settings-form__no-permissions-banner":!0}))},O("You don’t have permission to change the settings on this folder."))}},t._renderPolicies=function(){var e=null!=t.props.ownerTeam,n=null!=t.props.ownerTeam&&!t.props.isLimitedTeam,r=null!=t.props.currentPolicy.viewer_info_policy,s=t.props.isTeamSharedFolder||t.props.isFolderInsideTeamFolderTree;return a.div({},e?t._renderPolicy("member_policy",O(s?"Who can be added to folders?":"Who can be invited to this folder?"),[{label:t.props.isLimitedTeam?O("Only people on your team"):O("Only people on your %(trademark_business)s account").format({trademark_business:k.TRADEMARK_BUSINESS}),value:"team"},{label:O("Anyone"),value:"anyone"}]):void 0,t._renderPolicy("acl_update_policy",O(s?"Who can manage access to folders?":"Who can manage access to this folder?"),[{label:O(s?"Only Team Admins":"Only owners"),value:"owner"},{label:e?t.props.isLimitedTeam?O("Anyone on your team with edit permissions"):O("Anyone on your %(trademark_business)s account with edit permissions").format({trademark_business:k.TRADEMARK_BUSINESS}):O("People with edit permissions"),value:"editors"}]),n&&!t.props.isConfidentialFolder?t._renderPolicy("shared_link_policy",O(t.props.isTeamSharedFolder?"Allow members of this team folder to share links with others?":"Allow links to be shared with people outside of this folder?"),[{label:O("No"),value:"members"},{label:O("Yes"),value:"anyone"}]):void 0,(function(){if(r){var e=void 0;return e=t.props.ownerTeam?O("Show viewer info to members of %(company_name)s and people who can edit").format({company_name:t.props.ownerTeam.name}):O("Show viewer info to people who can edit"),t._renderPolicy("viewer_info_policy",O("Show who views files in this folder?"),[{label:e,value:"enabled"},{label:O("Don’t show viewer info"),value:"disabled"}],M.getPassDenyReason(t.props.currentPolicy,t.props.permissions))}})())},t._renderPolicy=function(e,n,r,s){void 0===s&&(s=null);var i=Array.from(t.props.getEffectivePolicyValue(e,t.props.policyUpdate)),a=i[0],o=i[1];return R(v.SinglePolicyControl,{canChange:o,denyReason:s,policyName:e,policyDescription:n,currentValue:a,options:r,handleOptionChange:t.props.onOptionChange})},t._renderButtons=function(){var e=F(null!=t.props.permissions?t.props.permissions.unshare:void 0,function(e){return e.allow});return a.div({className:"u-mar-top-m clearfix"},t.props.isSharedFolder&&e?a.div({className:"u-l-fl"},a.button({className:"button-as-link c-borderless-button",style:{lineHeight:"32px"},onClick:t.props.onUnshare},O(t.props.hasParentSharedFolder?"Reset membership":"Unshare folder"))):void 0,t._renderUpdateSettingsButtons())},t._renderUpdateSettingsButtons=function(){return(null!=t.props.permissions?t.props.permissions.change_options.allow:void 0)?R(v.SettingsModalButtons,{disableSave:null==t.props.policyUpdate,isAccepting:t.props.isSubmitting,onAccept:t.props.onSaveSettings,onDismiss:t.props.onDismiss}):void 0},t}return n.__extends(t,e),t.prototype.render=function(){return R(h.Modal,{altAction:this.props.altAction,autoClose:!1,className:r({"shared-folder-settings-modal":!0,"shared-folder-settings-modal--no-permissions":!F(null!=this.props.permissions?this.props.permissions.change_options:void 0,function(e){return e.allow})}),buttonComponent:a.span(),onDismissCompleted:this.props.onDismiss,title:this.props.isTeamSharedFolder?O("“%(folder_name)s” team folder settings").format({folder_name:d.Emstring.em_snippet(this.props.folderName,y.SNIPPET_SIZES.FILENAME)}):O("“%(folder_name)s” settings").format({folder_name:d.Emstring.em_snippet(this.props.folderName,y.SNIPPET_SIZES.FILENAME)})},this.props.isLoading?a.div({className:"shared-folder-settings-modal__loading-text"},O("Loading...")):a.div({},this._renderHeader(),this._renderPolicies(),this._renderButtons()))},t.displayName="SharedFolderSettingsModalContents",t.propTypes={altAction:o.node,currentPolicy:o.instanceOf(E.FolderPolicy),folderId:o.string,folderName:o.string.isRequired,folderPath:o.string,permissions:o.instanceOf(E.FolderPermissions),getEffectivePolicyValue:o.func,hasParentSharedFolder:o.bool,isConfidentialFolder:o.bool,isLimitedTeam:o.bool,isLoading:o.bool.isRequired,isSharedFolder:o.bool,isSubmitting:o.bool,isTeamSharedFolder:o.bool,isUserOnOwnerTeam:o.bool,onDismiss:o.func,onSaveSettings:o.func,onOptionChange:o.func,onUnshare:o.func,ownerTeam:o.shape({id:o.string.isRequired,name:o.string.isRequired}),showContentManagerBridge:o.bool,shouldHideHeader:o.bool,teamPolicy:o.instanceOf(S.TeamSharingPolicies),policyUpdate:o.instanceOf(E.FolderPolicy)},t.defaultProps={currentPolicy:null,folderId:null,getEffectivePolicyValue:null,hasParentSharedFolder:!1,isConfidentialFolder:!1,isTeamSharedFolder:!1,onDismiss:null,onOptionChange:null,onSaveSettings:null,onUnshareFolder:null,ownerTeam:null,shouldHideHeader:!1,teamPolicy:null,policyUpdate:null},t})(i.Component),V=m(H,["/static/css/sharing/share_modal-vflFs4QGO.css"],[v.SinglePolicyControl]);t.SharedFolderSettingsModalContents=V}),define("modules/clean/sharing/link_settings_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/api_v2/types","modules/clean/react/modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/delete_link_modal","modules/clean/sharing/ui_notifications_util","modules/constants/sharing","modules/core/i18n","modules/clean/sharing/link_settings_modal_contents"],function(e,t,n,r,s,i,a,o,l,c,d,p,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=p.i18n_default_project("sharing")._,h=(function(e){function s(t){var d=e.call(this,t)||this;d.handlePolicyUpdate=function(e,t){"expires"===e&&null!=t&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59));var n=d.state.newPolicy.set(e,t);return d.setState({newPolicy:n})},d.getModifiedSettings=function(){var e=d.state.newPolicy;if(e.requested_visibility===o.RequestedVisibilityPolicy.password){if(null==e.link_password)e=e.set("requested_visibility",null);else if(""===e.link_password)return c.sharingNotificationError(m("Password can’t be empty")),null}else e=e.set("link_password",null);return d.props.linkMetadata.link_permissions.resolved_visibility===o.ResolvedVisibilityPolicy.shared_folder_only&&(e=e.set("requested_visibility",null)),null!=e.expires&&(e=d.props.linkMetadata.link_permissions.can_set_expiry?e.set("expires",i.formatTimestamp(e.expires)):e.set("expires",null)),e.allow_download===d.state.existingPolicy.allow_download&&(e=e.set("allow_download",void 0)),{url:d.props.linkMetadata.url,settings:e,remove_expiration:null!=d.props.linkMetadata.expires&&null==d.state.newPolicy.expires}},d.saveSettings=function(){var e=d.getModifiedSettings();null!=e&&(d.setState({isSubmitting:!0}),d.props.client.modifySharedLinkSettings(e).then(function(e){return c.sharingNotificationSuccess(m("Settings saved.")),"function"==typeof d.props.onPolicySet&&d.props.onPolicySet(e),d.dismissModal()}).catch(function(e){d.setState({isSubmitting:!1})}))},d.dismissModal=function(){return a.Modal.close(),d.handleDismissed()},d.handleDismissed=function(){return"function"==typeof d.props.onClose?d.props.onClose():void 0},d.deleteLink=function(){var e=function(){return"function"==typeof d.props.onDeleteLink?d.props.onDeleteLink():void 0},t=(function(e){return function(){a.Modal.showInstance(r.createElement(s,n.__assign({},e)))}})(d.props);return l.deleteLinkWithConfirm({client:d.props.client,contentName:d.props.linkMetadata.name,onCancel:t,onDeleteLink:e,url:d.props.linkMetadata.url})};var p=t.linkMetadata.link_permissions.requested_visibility,u=t.linkMetadata.link_permissions.resolved_visibility;p===o.RequestedVisibilityPolicy.public&&u===o.ResolvedVisibilityPolicy.team_only&&(p=o.RequestedVisibilityPolicy.team_only);var h=new o.LinkPolicy({requested_visibility:p,link_password:p===o.RequestedVisibilityPolicy.password?null:"",expires:t.linkMetadata.expires,allow_download:t.linkMetadata.link_permissions.allow_download});return d.state={existingPolicy:h,isSubmitting:!1,newPolicy:h},d}return n.__extends(s,e),s.prototype.render=function(){var e=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.disallowed_reason===o.VisibilityDisallowedReason.user_account_type}),n=this.props.linkMetadata.link_permissions.can_disallow_download,s=e.length>0||n===!1;return r.createElement(a.Modal,{autoClose:!1,className:"shared-link-settings-modal",buttonComponent:r.createElement("span",null),onDismissCompleted:this.handleDismissed,title:m("Link permissions for “%(content_name)s”").format({content_name:this.props.linkMetadata.name})},r.createElement(u.SharedLinkSettingsModalContents,{user:this.props.user,canSubmit:!this.state.existingPolicy.equals(this.state.newPolicy),isFile:this.props.isFile,isSubmitting:this.state.isSubmitting,isTeam:this.props.isTeam,linkMetadata:this.props.linkMetadata,newPolicy:this.state.newPolicy,onCancel:this.dismissModal,onDeleteLink:this.deleteLink,onPolicyUpdate:this.handlePolicyUpdate,onSubmit:this.saveSettings,showUpgradeMessage:s,showUpgradeToBiz:t.showUpgradeToBizBanner(this.props.user.id),expLinkSettingsUpsell:this.props.expLinkSettingsUpsell}))},s.displayName="SharedLinkSettingsModal",s})(r.Component);t.SharedLinkSettingsModalComponent=h,t.showUpgradeToBizBanner=function(e){return d.SHARING_MODAL.SHOW_UPGRADE_TO_BIZ_BANNER[e]},t.SharedLinkSettingsModal=s(h,["/static/css/sharing/share_modal-vflFs4QGO.css"])}),define("modules/clean/sharing/link_settings_modal_contents",["require","exports","tslib","external/classnames","external/react","modules/clean/react/css","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/util","modules/clean/react/bubble_menu","modules/clean/react/calendar","modules/clean/react/sprite","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/link_description","modules/clean/static_urls","modules/constants/trademark","modules/core/i18n","modules/clean/growth/experiment","modules/clean/sharing/views/exp_link_settings_upsell_tracker","modules/clean/sharing/views/exp_link_settings_upsell"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=S.i18n_default_project("sharing")._,I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={selectedExpiry:null!=t.props.newPolicy.expires?t.props.linkMetadata.link_permissions.can_set_expiry?"custom":"read-only":"no-expiry"},t.renderHeader=function(){if(t.props.showUpgradeToBiz)return s.createElement("div",{className:"shared-link-settings-modal__upgrade-to-biz-banner"},s.createElement("div",{className:"shared-link-settings-modal__upgrade-to-biz-banner-text"},v("Did you know %(trademark_business)s lets you add passwords and expiration dates to shared links?").format({trademark_business:g.TRADEMARK_BUSINESS})),s.createElement("div",{className:"shared-link-settings-modal__upgrade-to-biz-banner-cta"},s.createElement("a",{className:"c-btn c-btn--secondary shared-link-settings-modal__upgrade-to-biz-banner-cta-button",href:"/business?tk=teams&camp=sharing_link_modal",target:"_blank",rel:"noopener noreferrer"},v("Learn More"))));if(t.props.expLinkSettingsUpsell&&["V1","V2"].indexOf(t.props.expLinkSettingsUpsell.variant)>=0)return s.createElement(y.LinkSettingsUpsell,{user:t.props.user,status:t.props.expLinkSettingsUpsell});if(t.props.showUpgradeMessage){var e=void 0,n=void 0;return t.props.isTeam?(e="/team/upgrade",n=v("Upgrade to %(trademark_business)s to enable permission settings").format({trademark_business:g.TRADEMARK_BUSINESS})):(e="/upgrade?oqa=sfp",n=v("Upgrade to Dropbox %(trademark_professional)s to enable permission settings.").format({trademark_professional:g.TRADEMARK_PROFESSIONAL})),s.createElement("div",{className:"shared-link-settings-modal__upgrade-to-pro-banner"},s.createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer",onClick:function(){t.expLinkSettingsUpsellTrack(b.LinkSettingsUpsellTrackerActions.CLICK_CTA)}},n))}return null},t.renderPolicies=function(){return s.createElement("div",null,t.renderVisibilityPolicies(),t.renderExpiryPolicy(),t.renderDownloadPolicy(),t.renderCommentsPolicy())},t.renderVisibilityPolicies=function(){var e=t.props.linkMetadata.link_permissions,n=e.visibility_policies.filter(function(e){return e.allowed||e.disallowed_reason===m.VisibilityDisallowedReason.user_account_type}),r=e.visibility_policies[0].disallowed_reason;return t.renderFieldset(s.createElement("span",null,v("Who can view this link?"),t.renderBadge(y.BadgeType.PASSWORD)),r===m.VisibilityDisallowedReason.permission_denied&&0===n.length?t.renderNonPermissionVisibility():n.length<2?t.renderRestrictedBySharedFolderVisibility():n.map(t.renderVisibilityOption))},t.renderNonPermissionVisibility=function(){var e=t.props.linkMetadata.link_permissions.resolved_visibility;return s.createElement("span",null,s.createElement("span",{className:"shared-link-settings-modal__visibility-text"},e===m.ResolvedVisibilityPolicy.shared_folder_only?v("Only invited members can view this link."):_.formatLinkVisibilityOption(e))," ",s.createElement("span",{className:"shared-link-settings-modal__visibility-advice u-font-meta"},v("You don’t have permission to change the visibility.")))},t.renderRestrictedBySharedFolderVisibility=function(){var e=t.props.linkMetadata.link_permissions.resolved_visibility,n=t.props.linkMetadata.link_permissions.visibility_policies[0].disallowed_reason;return s.createElement("span",null,s.createElement("span",{className:"shared-link-settings-modal__visibility-text"},(function(){if(e===m.ResolvedVisibilityPolicy.shared_folder_only){var n=t.props.linkMetadata.link_permissions.restricting_shared_folder_path;return n=o.Emstring.em_snippet(n,h.SNIPPET_SIZES.FILENAME),v("Only members of the shared folder “%(shared_folder_name)s” can view this link.").format({shared_folder_name:n})}if(e===m.ResolvedVisibilityPolicy.only_you)return v("Only you can view this link.");throw"Unexpected visibility "+e})())," ",s.createElement("span",{className:"shared-link-settings-modal__visibility-advice u-font-meta"},(function(){if(n===m.VisibilityDisallowedReason.restricted_by_shared_folder)return v("To change who can access the link, go to the shared folder options.");if(n===m.VisibilityDisallowedReason.delete_and_recreate)return v("To change who can access the link, delete this link and create a new one.");throw"Unexpected disallowed reason "+n})()))},t.renderVisibilityOption=function(e){var n=e.disallowed_reason===m.VisibilityDisallowedReason.user_account_type;return[s.createElement("label",{className:r({"u-font-meta":!e.allowed}),key:"visibility-label"},s.createElement("input",{checked:e.policy===t.props.newPolicy.requested_visibility,className:r((i={"shared-link-settings-modal__audience":!0},i["shared-link-settings-modal__audience-"+e.policy]=!0,i)),disabled:n,name:m.RequestedVisibilityPolicy.policy_name,onChange:function(e){return t.props.onPolicyUpdate(e.target.name,e.target.value)},type:"radio",value:e.policy}),t.renderVisibilityLabelText(e)),e.policy===m.RequestedVisibilityPolicy.password&&t.props.newPolicy.requested_visibility===m.RequestedVisibilityPolicy.password?s.createElement("div",{key:"password-input"},t.renderPasswordInput(n)):null];var i},t.renderVisibilityLabelText=function(e){return s.createElement("span",{className:r((t={"shared-link-settings-modal__audience":!0},t["shared-link-settings-modal__audience-"+e.policy+"-label"]=!0,t))},_.formatLinkVisibilityOption(e.resolved_policy));var t},t.renderPasswordInput=function(e){var n=null==t.props.newPolicy.link_password;return s.createElement("div",{className:"shared-link-settings-modal__password-container u-mar-left-m u-mar-right-xl u-mar-top-xs"},s.createElement("input",{className:"shared-link-settings-modal__password-input c-input",disabled:e||n,name:"link_password",onChange:function(e){return t.props.onPolicyUpdate(e.target.name,e.target.value)},placeholder:v("Set password"),value:null!=t.props.newPolicy.link_password?t.props.newPolicy.link_password:"123456",type:"password"}),n&&!e?s.createElement("button",{className:"shared-link-settings-modal__password-change button-as-link",onClick:function(){return t.props.onPolicyUpdate("link_password","")}},v("Change",{comment:"A link to change the password for the shared link"})):null)},t.renderExpiryPolicy=function(){return t.renderFieldset(s.createElement("span",null,v("Add an expiry date to this link?"),t.renderBadge(y.BadgeType.EXPIRATION)),s.createElement("div",null,s.createElement("label",{className:r({"shared-link-settings-modal__expiry-label-yes":!0,"u-font-meta":!t.props.linkMetadata.link_permissions.can_set_expiry})},s.createElement("input",{checked:"no-expiry"!==t.state.selectedExpiry,className:"shared-link-settings-modal__expiry-option-yes",disabled:!t.props.linkMetadata.link_permissions.can_set_expiry,onChange:function(){if("no-expiry"===t.state.selectedExpiry)return t.handleExpirySelectChange(30)},type:"radio"}),t.renderYesExpiryText()),"custom"===t.state.selectedExpiry?t.renderExpiryCustom():null,s.createElement("label",{className:r({"u-font-meta":!t.props.linkMetadata.link_permissions.can_remove_expiry})},s.createElement("input",{checked:null==t.props.newPolicy.expires,className:"shared-link-settings-modal__expiry-option-no",disabled:!t.props.linkMetadata.link_permissions.can_remove_expiry,onChange:function(){return"function"==typeof t.props.onPolicyUpdate&&t.props.onPolicyUpdate("expires",null),t.setState({selectedExpiry:"no-expiry"})},type:"radio"}),v("No"))))},t.renderYesExpiryText=function(){if([7,30].includes(t.state.selectedExpiry))return s.createElement("span",{className:"shared-link-settings-modal__expiry-text-yes"},v("Yes, expires in",{comment:'Label followed by a date range e.g. "Yes, expires in 7 days"'})," ",t.renderExpirySelect());if(["custom","read-only"].includes(t.state.selectedExpiry))return s.createElement("span",{className:"shared-link-settings-modal__expiry-text-yes"},v("Yes, expires on",{comment:'Label followed by a date. e.g. "Yes, expires on 5/10/2017"'})," ","read-only"===t.state.selectedExpiry&&t.props.linkMetadata.expires?a.format_date(t.props.linkMetadata.expires,a.localized_date_format):null);if("no-expiry"===t.state.selectedExpiry)return s.createElement("span",{className:"shared-link-settings-modal__expiry-text-yes"},v("Yes"));throw"Expiry policy is in an unknown state"},t.renderExpirySelect=function(){return s.createElement(d.BubbleMenu,{position:d.BubbleMenu.POSITIONS.BOTTOM,targetFixed:!0,items:[7,30,"custom"].map(function(e){return s.createElement(d.BubbleMenuItem,{onClick:(function(e){return function(){return t.handleExpirySelectChange(e)}})(e)},t.renderExpirySelectLabel(e))}),targetButton:s.createElement("button",{className:"shared-link-settings-modal__selected-expiry button-as-link"},t.renderExpirySelectLabel(t.state.selectedExpiry)," ",s.createElement("img",{alt:"",className:"sprite sprite_web s_web_arrow-down-gray",src:f.static_url("/static/images/icons/icon_spacer-vflN3BYt2.gif")}))})},t.renderExpirySelectLabel=function(e){if(7===e)return v("7 days",{comment:'as in "This link expires in 7 days"'});if(30===e)return v("30 days",{comment:'as in "This link expires in 30 days"'});if("custom"===e)return v("Custom date...",{comment:"Dropdown option for expiry date on a link. The user can choose 7 days, 30 days, or a custom expiry"});throw"Unknown selected expiry"},t.handleExpirySelectChange=function(e){return t.setState({selectedExpiry:e}),"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("expires",a.daysAfterToday("custom"===e?30:e)):void 0},t.renderExpiryCustom=function(){return s.createElement("span",{className:"shared-link-settings-modal__calendar-input"},s.createElement(p.Calendar,{alignAtLeft:!1,onDateChange:function(e){return"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("expires",e):void 0},initDate:t.props.newPolicy.expires||a.daysAfterToday(30),firstDay:a.daysAfterToday(1),lastDay:a.daysAfterToday(365)}))},t.renderDownloadPolicy=function(){var e=t.props.linkMetadata.link_permissions.can_disallow_download,n=t.props.linkMetadata.link_permissions.can_allow_download,i=t.props.linkMetadata.link_permissions.allow_download;if(null!=e&&null!=n&&null!=i){var a=t.shouldRenderNoPreviewFileWarning(),o=e&&!a,l=s.createElement("div",null,v("Disable downloads for this link?"),t.renderBadge(y.BadgeType.NDSL),s.createElement("div",{className:"shared-link-settings-modal__no-download-advice"},s.createElement("a",{href:"/help/files-folders/set-link-permissions",target:"_blank",rel:"noopener noreferrer",onClick:function(){return t.expLinkSettingsUpsellTrack(b.LinkSettingsUpsellTrackerActions.CLICK_LEARN_MORE,{extra:{section:"ndsl"}})}},v("Learn more")))),c=s.createElement("div",null,s.createElement("label",{className:r({"u-font-meta":!o})},s.createElement("input",{checked:!t.props.newPolicy.allow_download,className:"shared-link-settings-modal__disallow-download-yes",disabled:!o,onChange:function(){return"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("allow_download",!1):void 0},type:"radio"}),v("Yes")),s.createElement("label",{className:r({"u-font-meta":!n})},s.createElement("input",{checked:t.props.newPolicy.allow_download,className:"shared-link-settings-modal__disallow-download-no",disabled:!n,onChange:function(){return"function"==typeof t.props.onPolicyUpdate?t.props.onPolicyUpdate("allow_download",!0):void 0},type:"radio"}),v("No")));return t.renderFieldset(l,c,t.renderNoPreviewFileWarning(a))}},t.shouldRenderNoPreviewFileWarning=function(){var e=t.props,n=e.isFile,r=e.linkMetadata;if(!n)return!1;if(null!=(null!=r?r.preview_type:void 0)){var s=r.preview_type;if(Array.from(c.VALID_PREVIEW_TYPES).includes(s))return!1}return!0},t.renderNoPreviewFileWarning=function(e){if(e){var n=l.file_extension(t.props.linkMetadata.name),r=n.toUpperCase();return s.createElement("div",{className:"shared-link-settings-modal__preview-warning c-banner c-banner--warning"},s.createElement("div",{className:"o-flag"},s.createElement("div",{className:"o-flag-fix"},s.createElement(u.Sprite,{alt:"",group:"web",name:"page_white_32"})),s.createElement("div",{className:"o-flag__flex u-pad-left-xs"},v("%(file_extension)s files can’t be previewed. Downloads must be enabled to share.",{comment:'as in "People can’t view this .PDF file'}).format({file_extension:"."+r}))))}},t.renderCommentsPolicy=function(){if(!t.props.linkMetadata.link_permissions.team_restricts_comments){var e=s.createElement("div",null,v("Who can comment?"),s.createElement("div",{className:"shared-link-settings-modal__commenting-advice"},(t.props.linkMetadata.link_permissions.allow_comments,s.createElement("a",{href:"/help/desktop-web/commenting#comments",target:"_blank",rel:"noopener noreferrer",onClick:function(){return t.expLinkSettingsUpsellTrack(b.LinkSettingsUpsellTrackerActions.CLICK_LEARN_MORE,{extra:{section:"comments"}})}},v("Learn more"))))),n=s.createElement("div",null,s.createElement("div",{className:"shared-link-settings-modal__commenting-policy"},_.formatLinkCommentingVisibility(t.props.linkMetadata.link_permissions.allow_comments,t.getResolvedVisibility(t.props.newPolicy.requested_visibility),t.props.linkMetadata.link_permissions.restricting_shared_folder_path)));return t.renderFieldset(e,n)}},t.getResolvedVisibility=function(e){var n=t.props.linkMetadata.link_permissions.visibility_policies.filter(function(t){return t.policy===e});if(1!==n.length)throw"Logic error: "+n.length+" should be 1.";return n[0].resolved_policy},t.renderFieldset=function(e,t,n){return void 0===n&&(n=null),s.createElement("fieldset",{className:"settings-form-entry"},s.createElement("legend",{className:"settings-form-entry__explanation u-trim-margin"},e),s.createElement("div",{className:"settings-form-entry__options"},t),n?s.createElement("div",{className:"u-mar-top-m"},n):null)},t.renderButtons=function(){return s.createElement("div",{className:"u-mar-top-m clearfix"},t.props.linkMetadata.link_permissions.can_revoke?s.createElement("div",{className:"u-l-fl"},s.createElement("button",{className:"button-as-link delete-link",onClick:function(){t.expLinkSettingsUpsellTrack(b.LinkSettingsUpsellTrackerActions.CLICK_DELETE),t.props.onDeleteLink()
},style:{lineHeight:"32px"},type:"button"},v("Delete link"))):null,s.createElement("div",{className:"u-l-fr"},s.createElement("button",{className:"c-btn c-btn--primary confirm-button",disabled:t.props.isSubmitting||!t.props.canSubmit,onClick:function(){t.expLinkSettingsUpsellTrack(b.LinkSettingsUpsellTrackerActions.CLICK_SAVE),t.props.onSubmit()}},v(t.props.isSubmitting?"Saving...":"Save settings")),s.createElement("button",{className:"c-btn c-btn--secondary u-mar-left-xs cancel-button",onClick:function(){t.expLinkSettingsUpsellTrack(b.LinkSettingsUpsellTrackerActions.CLICK_CANCEL),t.props.onCancel()}},v("Cancel"))))},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.expLinkSettingsUpsellTrack(b.LinkSettingsUpsellTrackerActions.VIEW)},t.prototype.expLinkSettingsUpsellTrack=function(e,t){this.props.expLinkSettingsUpsell&&["CONTROL","V1","V2"].indexOf(this.props.expLinkSettingsUpsell.variant)>=0&&this.props.track(e,t)},t.prototype.renderBadge=function(e){return this.props.expLinkSettingsUpsell&&this.props.expLinkSettingsUpsell.is_active?s.createElement(y.LinkSettingsUpsellBadge,{section:e,user:this.props.user}):null},t.prototype.render=function(){return s.createElement("div",{className:"shared-link-settings-modal__contents"},this.renderHeader(),this.renderPolicies(),this.renderButtons())},t.displayName="SharedLinkSettingsModalContents",t})(s.Component);t.SharedLinkSettingsModalContentsComponent=I;var C=function(e){return s.createElement(E.Experiment,{user:e.user,featureName:b.featureName,status:e.expLinkSettingsUpsell,render:function(t){return s.createElement(I,n.__assign({},e,{expLinkSettingsUpsell:t}))}})},M=b.withLinkSettingsUpsellTracking(C);t.SharedLinkSettingsModalContentsWithCss=i.withCss(["/static/css/growth/showcase_upsell/link_settings_upsell-vflyDbUgC.css","/static/js/spectrum-arbor/index.web-vflyCzvlf.css"])(M),t.SharedLinkSettingsModalContents=t.SharedLinkSettingsModalContentsWithCss}),define("modules/clean/sharing/member_constructors",["require","exports","modules/clean/sharing/api/types/metadata","modules/clean/react/pass/utils","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,r,s,i){"use strict";function a(){var e=new n.PermissionSetting({allow:!1});return new n.MemberPermissions({make_editor:e,make_viewer:e,make_owner:e,remove:e})}function o(e){var t=r.AnonymousViewerUtils.getAnonymousUserIds(e),s=c("Guest");return t.map(function(e){return new n.UserMembershipInfo({access_type:"reader",account:new n.BasicAccount({account_id:e,display_name:s,familiar_name:s,given_name:s,surname:""}),account_id:e,initials:r.AnonymousViewerUtils.getAnonymousViewerInitials(s),is_inherited:!1,permissions:a(),same_team:!1,time_last_seen:null})})}function l(e){return e?e.map(function(e){var t=e.seen_state_user,r=t.user_id,s=t.display_name,o=t.email,l=t.photo_circle_url,c=e.when_last_seen;return new n.UserMembershipInfo({access_type:"reader",account:new n.BasicAccount({account_id:r,display_name:s,email:o,email_verified:!0,familiar_name:"",given_name:"",profile_photo_url:l,surname:""}),account_id:r,initials:i.getInitials(s),is_inherited:!1,permissions:a(),same_team:!0,time_last_seen:c?new Date(1e3*c):null})}):[]}Object.defineProperty(t,"__esModule",{value:!0});var c=s.i18n_default_project("sharing")._;t.constructGuests=o,t.constructLinkMembers=l}),define("modules/clean/sharing/parent_folder_access_modal",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/react/flag","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=d.i18n_default_project("sharing"),u=p._,m=p.ungettext,h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dismissModal=function(){a.Modal.close(),t.handleDismissed()},t.handleDismissed=function(){t.props.onClose&&t.props.onClose()},t.handleNavigateToParentFolder=function(e){return function(){a.Modal.close(),t.props.onParentFolderClicked&&t.props.onParentFolderClicked(e.path,t.arePermissionsAllowed(e.permissions))}},t.arePermissionsAllowed=function(e){return e.some(function(e){return e&&e.allow})},t.memberCanEdit=function(){return[l.ACCESS_LEVEL.OWNER,l.ACCESS_LEVEL.WRITER].indexOf(t.props.memberAccessLevelResult.access_level)>-1},t.getInfoStr=function(){return"remove"===t.props.originalAction?t.props.contentInfo.isFolder()?m("As a member of the parent folder listed below, %(member_name)s can still access the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):m("As a member of the parent folder listed below, %(member_name)s can still access “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):t.props.contentInfo.isFolder()?t.memberCanEdit()?m("As a member of the parent folder listed below, %(member_name)s can still edit the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):m("As a member of the parent folder listed below, %(member_name)s can still view the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view the contents of “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):t.memberCanEdit()?m("As a member of the parent folder listed below, %(member_name)s can still edit “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length):m("As a member of the parent folder listed below, %(member_name)s can still view “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view “%(content_name)s”.",t.props.memberAccessLevelResult.parentFolders.length)},t.renderParentFolderContent=function(){var e=t.getInfoStr();return r.createElement("div",null,e.format({member_name:s.Emstring.em_snippet(t.props.memberDisplayName,c.SNIPPET_SIZES.DISPLAY_NAME),content_name:s.Emstring.em_snippet(t.props.contentInfo.name()||"",c.SNIPPET_SIZES.FILENAME)}),r.createElement("div",{className:"parent-folder-access-modal__folder-list u-mar-top-s"},r.createElement("ul",{className:"o-list-ui o-list-ui--dividers"},t.props.memberAccessLevelResult.parentFolders.map(t.renderParentFolder))))},t.renderParentFolder=function(e){var n=r.createElement(o.Sprite,{group:"web",name:"folder_user_32",className:"u-pad-right-xs",alt:""});return r.createElement("li",null,r.createElement("div",{className:"parent-folder-access-modal__parent-folder u-pad-vertical-xs u-pad-horizontal-s",onClick:t.handleNavigateToParentFolder(e)},r.createElement(i.Flag,{leftAttachment:n,rightAttachment:t.renderFolderLink(e)},r.createElement("span",{className:"parent-folder-access-modal__folder-name"},s.Emstring.em_snippet(e.name,c.SNIPPET_SIZES.FILENAME)))))},t.renderFolderLink=function(e){return r.createElement("button",{className:"button-as-link",onClick:t.handleNavigateToParentFolder(e),type:"button"},u(t.arePermissionsAllowed(e.permissions)?"Manage membership":"View folder"))},t.renderSimpleContent=function(){return r.createElement("div",null,r.createElement("span",{className:"parent-folder-access-modal__warning"},t.props.memberAccessLevelResult.warning),r.createElement("div",{className:"u-mar-top-m clearfix"},r.createElement("div",{className:"u-l-fr"},r.createElement("button",{className:"c-btn c-btn--primary confirm-button",onClick:t.dismissModal},u("OK")))))},t.getTitleStr=function(){return u("remove"===t.props.originalAction?t.props.contentInfo.isFolder()?"%(member_name)s can still access this folder":"%(member_name)s can still access this file":t.props.contentInfo.isFolder()?t.memberCanEdit()?"%(member_name)s can still edit this folder":"%(member_name)s can still view this folder":t.memberCanEdit()?"%(member_name)s can still edit this file":"%(member_name)s can still view this file")},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.getTitleStr();return r.createElement(a.Modal,{autoClose:!1,className:"parent-folder-access-modal",buttonComponent:r.createElement("span",null),onDismissCompleted:this.handleDismissed,title:e.format({member_name:s.Emstring.em_snippet(this.props.memberDisplayName,c.SNIPPET_SIZES.DISPLAY_NAME)})},r.createElement("div",{className:"parent-folder-access-modal__contents"},this.props.memberAccessLevelResult.parentFolders&&!this.props.isInContentManager?this.renderParentFolderContent():this.renderSimpleContent()))},t.displayName="ParentFolderAccessModal",t})(r.Component);t.ParentFolderAccessModal=h}),define("modules/clean/sharing/settings_modal_components",["require","exports","tslib","external/classnames","external/react","external/react-dom-factories","external/prop-types","spectrum/button","modules/clean/react/css","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=c.i18n_default_project("sharing")._,p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return i.div({className:"u-l-fr"},s.createElement(o.Button,{className:"cancel-button",variant:"secondary",onClick:this.props.onDismiss},d("Cancel")),s.createElement(o.Button,{className:"confirm-button u-mar-left-s",variant:"primary",disabled:this.props.disableSave||this.props.isAccepting,onClick:this.props.onAccept},d(this.props.isAccepting?"Saving...":"Save")))},t.displayName="SettingsModalButtons",t.propTypes={disableSave:a.bool,isAccepting:a.bool,onAccept:a.func,onDismiss:a.func},t})(s.Component);t.SettingsModalButtons=p;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this;return i.fieldset({className:r({"settings-form-entry":!0,"settings-form-entry--no-permissions":!this.props.canChange})},this.props.canChange||void 0===this.props.denyReason?void 0:i.div({className:"u-pad-xs u-font-center u-mar-bottom-s shared-folder-settings-form__no-permissions-banner"},this.props.denyReason),i.legend({className:"settings-form-entry__explanation u-trim-margin"},this.props.policyDescription),i.div({className:"settings-form-entry__options"},Array.from(this.props.options).map(function(t){return i.label({key:t.value},i.input({checked:t.value===e.props.currentValue,className:"settings-form-entry-option-"+e.props.policyName+"__"+t.value,disabled:!e.props.canChange,name:e.props.policyName,onChange:function(t){return"function"==typeof e.props.handleOptionChange?e.props.handleOptionChange(t.target.name,t.target.value):void 0},type:"radio",value:t.value}),t.label)})))},t.displayName="SinglePolicyControl",t.propTypes={canChange:a.bool,denyReason:a.string,currentValue:a.string,handleOptionChange:a.func,options:a.array,policyDescription:a.string,policyName:a.string},t.defaultProps={canChange:!0},t})(s.Component),m=l(u,["/static/css/sharing/share_modal-vflFs4QGO.css"]);t.SinglePolicyControl=m}),define("modules/clean/sharing/share_modal",["require","exports","tslib","external/immutable","external/react","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/pass/store","modules/clean/sharing/api/util/types","modules/clean/sharing/file_settings_modal","modules/clean/sharing/folder_settings_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/member_constructors","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/modal_content","modules/clean/sharing/views/modal_content_spectrum","modules/clean/viewer","modules/constants/sharing","spectrum/modal","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=v.i18n_default_project("sharing")._,C=function(e){var t=e.actionHandler.getSharingInfo(),s=e.actionHandler.getPassInfo(),i=s.groupSeenStateInfo,a=s.linkSeenStateInfo,o=s.presentAccountIds,l=s.passFetchingStatus,c={actionHandler:e.actionHandler,areMembersFullyLoaded:t.areMembersFullyLoaded(),areSharingPrefsLoaded:t.areSharingPrefsLoaded(),banner:t.banner(),canChangeOptions:t.canChangeOptions(),canEdit:t.canEdit(),canInviteEditor:t.canInviteEditor(),canInviteViewer:t.canInviteViewer(),canInviteViewerNoComment:t.canInviteViewerNoComment(),canMakeViewerNoComment:t.canMakeViewerNoComment(),canRelinquishMembership:t.canRelinquishMembership(),canShareLink:t.canShareLink(),canUnshareFile:t.canUnshareFile(),canUnshareFolder:t.canUnshareFolder(),canUpdateConfidentiality:t.canUpdateConfidentiality(),contactsError:t.contactsError(),contentInfo:t.contentInfo(),contentNameMessage:t.contentNameMessage(),contentNameMessageLevel:t.contentNameMessageLevel(),filePolicy:t.filePolicy(),folderPolicy:t.folderPolicy(),guestMembers:h.constructGuests(o),groupSeenStateInfo:i,hasDisplayableMembers:t.hasDisplayableMembers(),hasNonOwnerMembers:t.hasNonOwnerMembers(),hasParentSharedFolder:t.hasParentSharedFolder(),initialRecipientRawInput:t.initialRecipientRawInput(),initialRecipientTokens:t.initialRecipientTokens(),isConfidentialFolder:t.isConfidentialFolder(),isContentNameFocused:t.isContentNameFocused(),isFolderInsideTeamFolderTree:t.isFolderInsideTeamFolderTree(),isLinkMetadataLoaded:t.isLinkMetadataLoaded(),isMetadataLoaded:t.isMetadataLoaded(),isNoCommentEnabledForFolders:t.isNoCommentEnabledForFolders(),isNoCommentEnabledForLinks:t.isNoCommentEnabledForLinks(),isOwner:t.isOwner(),isTeamPolicyLoaded:t.isTeamPolicyLoaded(),isTeamSharedFolder:t.isTeamSharedFolder(),isTokenizerEmpty:t.isTokenizerEmpty(),isUserOnOwnerTeam:t.isUserOnOwnerTeam(),linkMembers:h.constructLinkMembers(a),linkMetadata:t.linkMetadata(),linkOnlyReason:t.linkOnlyReason(),memberCounts:t.memberCounts(),memberCountWithRecipients:t.memberCountWithRecipients(),members:t.members(),metadata:t.metadata(),ownerTeam:t.ownerTeam(),passFetchingStatus:l,pendingMemberAction:t.pendingMemberAction(),permissions:t.permissions(),presentAccountIds:r.Set(o),recipientAccess:t.recipientAccess(),recipientMessage:t.recipientMessage(),recipientTokens:t.recipientTokens(),shareFolderPromise:t.shareFolderPromise(),shouldBlockMemberListOnPassLoad:t.shouldBlockMemberListOnPassLoad(),teamPolicy:t.teamPolicy(),uiMode:t.uiMode(),hasCreatedShareLink:t.createdShareLink()};return n.__assign({},t.getInitialProps(),c)},M=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSettingsClick=function(){t.props.contentInfo.isFolder()?t.handleFolderSettingsClick():t.handleFileSettingsClick()},t}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){var e=this.getTokenizer();this.props.actionHandler.onShareModalUnmount(e)},t.prototype.render=function(){var e=!b.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL;if(b.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL){var t=function(){l.Modal.close()};return s.createElement(y.Modal,{ariaLabel:I("Sharing Modal"),className:"scl-share-modal",bodyClassName:"scl-share-modal-content",displayCloseButton:!1,open:!0,width:540,overlayClickClose:!0,onRequestClose:t},this.renderModalContent())}return s.createElement(l.Modal,{ref:"modal",acceptButtonText:null,dismissButtonText:null,headerId:"unified-share-modal-title",stopKeyDownEventPropagation:e,style:"bare"},this.renderModalContent())},t.prototype.renderModalContent=function(){var e=c.passStore.getPassPermissions(this.props.contentInfo.extras.fileId),t=e&&e.canReadPresence,r=!!(this.props.contentInfo.isFile()?this.props.filePolicy&&this.props.filePolicy.viewer_info_policy:this.props.folderPolicy&&this.props.folderPolicy.viewer_info_policy),i={headerId:"unified-share-modal-title",areCheckboxSettingsLoaded:this.props.areSharingPrefsLoaded,isLimitedTeam:this.props.viewer.team_is_limited,isPassEnabled:t,isInContentManager:this.props.isInContentManager,onSettingsClick:this.handleSettingsClick,mode:this.props.uiMode,ref:"content",showContentManagerBridge:this.shouldRenderContentManagerBridge(),showPassFileSettings:r};return i=n.__assign({},this.props,i),b.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL?s.createElement(S.ShareModalContentSpectrum,n.__assign({},i)):s.createElement(g.ShareModalContent,n.__assign({},i))},t.prototype.refreshSharedWithColumnLinkData=function(){i.Dispatcher.dispatch({type:o.SharedWithActionType.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.props.contentInfo.displayPath()]}})},t.prototype.handleFolderPolicySuccess=function(e,t){i.Dispatcher.dispatch({type:m.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS,user:this.props.user,metadata:t,folderPolicy:e})},t.prototype.getTokenizer=function(){return this.refs.content&&this.refs.content.getWrappedComponent()&&this.refs.content.getWrappedComponent().refs.tokenizer},t.prototype.handleFileSettingsClick=function(){var e=this,t=b.TRUELINK.TRUELINK_UI[this.props.user.id]?d.getCombinedPolicy(this.props.filePolicy,this.props.linkMetadata):this.props.filePolicy,n=function(n){null!=n&&e.props.actionHandler.handleUpdateFilePolicy(n,t),e.props.actionHandler.openShareModal()};l.Modal.showInstance(s.createElement(p.FileSettingsModal,{fileName:this.props.contentInfo.name(),contentId:this.props.contentInfo.id,canChangeOptions:this.props.canChangeOptions,canUnshareFile:this.props.canUnshareFile,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,initialPolicy:t,linkMetadata:this.props.linkMetadata,onCancel:n,onPolicySet:n,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,user:this.props.user})),f.logTiburonEvent(this.props.contentInfo,this.props.user.id,"OPEN_FILE_SETTINGS_MODAL")},t.prototype.handleFolderSettingsClick=function(){var e=this,t=b.TRUELINK.TRUELINK_UI[this.props.user.id]?d.getCombinedPolicy(this.props.folderPolicy,this.props.linkMetadata):this.props.folderPolicy,n=function(t,n){null!=n&&(e.props.actionHandler.handleUpdateSharingSettings(n),e.handleFolderPolicySuccess(t,n),e.props.onSuccessSharing&&e.props.onSuccessSharing(),n.policy.shared_link_policy!==e.props.folderPolicy.shared_link_policy&&(e.props.actionHandler.fetchLinkMetadata(),e.refreshSharedWithColumnLinkData())),e.props.actionHandler.openShareModal()};l.Modal.showInstance(s.createElement(u.SharedFolderSettingsModal,{actionHandler:this.props.actionHandler,folderName:this.props.contentInfo.name(),folderId:this.props.metadata.shared_folder_id,folderPath:this.props.contentInfo.displayPath(),hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,initialHasParentSharedFolder:this.props.hasParentSharedFolder,initialMetadata:this.props.metadata,initialOwnerTeam:this.props.ownerTeam,initialPermissions:this.props.permissions,initialPolicy:t,isInContentManager:this.props.isInContentManager,isSharedFolder:this.props.contentInfo.isSharedFolder(),initialIsTeamSharedFolder:this.props.isTeamSharedFolder,isConfidentialFolder:this.props.isConfidentialFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isLimitedTeam:this.props.viewer.team_is_limited,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onCancel:this.props.actionHandler.openShareModal,onPolicySet:n,showContentManagerBridge:this.shouldRenderContentManagerBridge(!0),teamPolicy:this.props.teamPolicy,updateLinkSettings:this.props.actionHandler.updateLinkSettings,user:this.props.user}))},t.prototype.shouldRenderContentManagerBridge=function(e){return void 0===e&&(e=!1),!this.props.isInContentManager&&(!!f.GoldenGate.hasContentManagerAndSuperAdmin(this.props.user.id)&&(!!this.props.isTeamSharedFolder||!(!this.props.isFolderInsideTeamFolderTree||!this.props.isUserOnOwnerTeam)&&(e||!this.props.canInviteEditor)))},t.displayName="ShareModal",t.defaultProps={viewer:E.Viewer.get_viewer()},t})(s.Component);t.ShareModal=a.listenToStores(M,{sharingInfoStore:_.sharingInfoStore,passStore:c.passStore},C)}),define("modules/clean/sharing/share_modal_dropdown_util",["require","exports","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/clean/sharing/strings","modules/core/i18n"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i.i18n_default_project("sharing")._;t.shouldShowMemberAction=function(e,t,n,s,i){return t===n||s&&s.get(e)&&s.get(e).allow||t===r.MEMBER_ACTION.REMOVE&&i},t.getMemberActionInfo=function(e,t){var i=s.ACCESS_NAME;t&&(i=s.ACCESS_NAME_NO_COMMENT);var o=s.MEMBER_ACTION_FOLDER;t&&(o=s.MEMBER_ACTION_FOLDER_NO_COMMENT);var l=s.MEMBER_ACTION_FILE;t&&(l=s.MEMBER_ACTION_FILE_NO_COMMENT);var c=a("Remove");return e&&(c=a("Remove my access")),[[r.MEMBER_ACTION.MAKE_EDITOR,{value:n.ACCESS_LEVEL.WRITER,title:i[n.ACCESS_LEVEL.WRITER],folder_description:o[r.MEMBER_ACTION.MAKE_EDITOR],file_description:l[r.MEMBER_ACTION.MAKE_EDITOR]}],[r.MEMBER_ACTION.MAKE_VIEWER,{value:n.ACCESS_LEVEL.READER,title:i[n.ACCESS_LEVEL.READER],folder_description:o[r.MEMBER_ACTION.MAKE_VIEWER],file_description:l[r.MEMBER_ACTION.MAKE_VIEWER]}],[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,{value:n.ACCESS_LEVEL.READER_NO_COMMENT,title:i[n.ACCESS_LEVEL.READER_NO_COMMENT],folder_description:o[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT],file_description:l[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]}],[r.MEMBER_ACTION.MAKE_OWNER,{value:n.ACCESS_LEVEL.OWNER,title:a("Make owner")}],[r.MEMBER_ACTION.REMOVE,{value:"remove",title:c}]]}}),define("modules/clean/sharing/share_modal_icon",["require","exports","tslib","external/react","spectrum/icon_content","modules/clean/filetypes","modules/clean/react/icon/file_icon","modules/clean/react/icon/icon_helper"],function(e,t,n,r,s,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return this.props.isFolder?this.renderFolder():this.renderFile()},t.prototype.renderFile=function(){var e={file:{type:i.FileTypes.FILE,fq_path:this.props.filename},className:this.props.className,variant:"small"};return r.createElement(a.FileIcon,n.__assign({},e))},t.prototype.renderFolder=function(){var e=i.FileTypes.FOLDER;this.props.pathExists&&(this.props.isTeamSharedFolder?e=i.FileTypes.TEAM_SHARED_FOLDER:this.props.isSharedFolder&&(e=i.FileTypes.SHARED_FOLDER));var t=o.spectrum_folder_icon({fileType:e,isViewOnly:this.props.isViewOnly,isInTeamFolderTree:this.props.isFolderInsideTeamFolderTree,size:o.ICON_SIZES.LARGE,isConfidential:this.props.isConfidentialFolder||!1,iconPostfix:this.props.isConfidentialFolder?"_admin_view":"",isCdm:this.props.isCdm});return r.createElement(s.IconContent,{name:t,alt:this.props.alt,className:this.props.className})},t})(r.Component);t.ShareModalIcon=l}),define("modules/clean/sharing/share_modal_util",["require","exports","tslib","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/browse/models","modules/clean/react/teams/modals/limited_team_folder_settings_modal","modules/clean/react/teams/modals/limited_team_share_folder_modal","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/content_info","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/share_modal","modules/clean/sharing/ui_util","modules/clean/viewer","modules/clean/react/browse/logger_util","modules/clean/react/browse/professional_collection_actions","external/immutable","modules/clean/sharing/views/exp_showcase_share_interstitial"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateModalSessionId=function(){return Math.random().toString()},t.getSharingInfo=function(e,r,s){void 0===s&&(s={});var i=null;"number"==typeof e&&(e=E.Viewer.get_viewer().get_user_by_id(e)),null==s.userHomeNs&&(s.userHomeNs=e.home_ns_id);var a=t.getShareModalInfo(r),o=null;if(null!=a){a=n.__assign({},a,s),a.modalSessionId&&(a.modalSessionId=t.generateModalSessionId());var d=a.nsId,p=a.sjid,u=a.fileId,m=a.filename,h=a.fqPath;l.logViewShareModel({uid:e.id,modal_session_id:a.modalSessionId||"",file_nsid:d,file_sjid:p,file_id:u,file_name:m,file_path:h});try{i=_.ContentInfo.createFromParams(a)}catch(e){i=null}o=r instanceof c.BrowseContext?r:a.browseContext}return{browseContext:o,contentInfo:i,shareModalInfo:a,user:e}},t.showShareModal=function(e,n,i,a,o,l){void 0===i&&(i={});var c,d,p;if(M=t.getSharingInfo(e,n,i),c=M.browseContext,d=M.contentInfo,p=M.shareModalInfo,e=M.user,null==d||null==p)return!1;if(S.logTiburonEvent(d,e.id,"BEGIN_SHARE_FLOW"),p&&t.showFastrakShareModalIfAllowed(e,p,c))return!0;if(!p.skipPublicFolderCheck&&d&&c){var m=f.makePublicFolderLink(e.id,c.config,d.displayPath(),d.isFolder());if(m)return f.showPublicFolderLinkModal(m),!0}var _=(null!=c?c.isNonUserRelativeContext:void 0)||p.isNonUserRelativeContext,E=s.SHMODAL;if("PREVIEW_PAGE"===p.origin&&(E=s.SHARE_FILEVIEWER),_||r.EmailVerification.get_for_user(e).verified_or_show(E)){var b=d.isFolder()?h.FolderShareApiClient:h.FileShareApiClient,y=new b({userId:e.id,isNonUserRelativeContext:_}),v=new u.ShareModalActionHandler(y,e,g.ShareModal,a,o,l),I=p.inLinksPage,C=p.prefillContacts;v.initializeShareModal({contentInfo:d,initialRecipientTokens:C,inLinksPage:I},{client:y,content:n,user:e,onDeleteLink:p.onDeleteLink,teamGroupInfo:d.teamGroupInfo(),isInContentManager:_,onSuccessSharing:p.onSuccessSharing,shareAsConfidential:p.shareAsConfidential,initialContentName:p.initialContentName,shouldSyncThisFolder:p.shouldSyncThisFolder,recipientMessage:p.recipientMessage}),v.openShareModal()}else S.logTiburonEvent(d,e.id,"SHARE_MODAL_EMAIL_UNVERIFIED");return!0;var M},t.showFastrakShareModalIfAllowed=function(e,t,n){return!(!t.isTeamSharedFolder||!E.Viewer.get_viewer().team_is_limited)&&(n&&e.is_team_admin&&t.origin&&t.targetNsId&&["BROWSE_SHARED_FOLDER_BANNER","BROWSE_GLOBAL_ACTIONS"].indexOf(t.origin)>-1?d.showWithProps({folderId:t.targetNsId,folderName:n.getNameOfTargetFolder(),user:e}):p.showModalInstance({fqPath:t.fqPath}),!0)},t.getShareModalInfo=function(e){if(e instanceof c.File){var t=[o.FileTypes.FILE,o.FileTypes.PACKAGE].indexOf(e.type)>-1;return{beaconContext:e.beacon_context,exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,isFolder:!t,isTeamSharedFolder:e.type===o.FileTypes.TEAM_SHARED_FOLDER,sjid:e.sjid,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}}return e instanceof c.BrowseContext?C(e):e};var C=function(e){return e.isInsideDeletedFolder||e.isInsideDeletedSharedFolder?null:e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}};t.showNewFolderShareModal=function(e,n,r,s,i,a,o,l,c,d,p){void 0===n&&(n=null),void 0===r&&(r=null),void 0===s&&(s=null),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===o&&(o=null),n||(n=t.generateModalSessionId());var u=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=1;n<=100;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return S.getNewFolderPathFromContentName(e,r||"")},m={fqPath:u(),isFolder:!0,exists:!1,origin:"WIZARD",modalSessionId:n,isNonUserRelativeContext:a,isTeamSharedFolder:!1,initialContentName:s,shareAsConfidential:i,shouldSyncThisFolder:o},h={};return p&&(h.onSuccessSharing=p),t.showShareModal(e,m,h,l,c,d)},t.showSharedContentLinkSyncModal=function(t,n){var r=new m.SharingApi(t),s=function(r){var s=JSON.parse(r.responseText);new Promise(function(t,n){e(["modules/clean/sharing/shared_content_link_sync_utils"],t,n)}).then(function(e){return(0,e.showSharedContentSyncModal)(t.id,s,n)})};return r.get_sync_vars_for_ns_id(n.ns_id,n.ns_path,s)},t.showPrefilledShareModal=function(e){var n,r,s=e.user,o=e.sharePrefillEmail,l=e.content,c=e.setPath,d=e.setUrl,p=e.contentManagerValidateFolderPath;return o?(n="GRANT_ACCESS",r=[new i.Contact({type:a.EMAIL,email:o,name:""})]):(n="DESKTOP_CLIENT",r=[]),t.showShareModal(s,l,{origin:n,prefillContacts:r},c,d,p)},t.expShowShareInterstitialModal=function(e,n,r,s,i,a,o,c){void 0===a&&(a={});var d=function(){t.showShareModal(e,n,a,o,c)},p=function(){var t=b.countFilesAndFolders(v.Set([n])),a=t.num_files_selected,o=t.num_folders_selected;l.logOpenAddToCollectionModal({uid:e.id,source:"FILE_VIEW_ROW",view_type:i,result:n,num_files_selected:a,num_folders_selected:o});var c=n.ns_id,d=n.ns_path,p=n.fq_path;y.showAddToCollectionModal([{ns_id:c,ns_path:d,fq_path:p}],e,r,s)};return I.showShowcaseInterstitial({user:e,onClickShare:d,onClickShowcase:p}),!0},t.showShareModalCallback=function(e,n){var r=n.user,s=n.content,i=n.prefillContacts,a=n.recipientMessage;t.showShareModal(r,s,{prefillContacts:i,recipientMessage:a})}}),define("modules/clean/sharing/sharing_settings_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MEMBER_POLICY="member_policy",t.DOWNLOAD_POLICY="download_policy",t.VIEWER_INFO_POLICY="viewer_info_policy",t.AUDIENCE_POLICY="audience",t.ACCESS_LEVEL_POLICY="access_level",t.FOLDER_LINK_AUDIENCE_POLICY="shared_link_policy",t.PASSWORD_POLICY="password",t.EXPIRY_POLICY="expiry",t.ACL_UPDATE_POLICY="acl_update_policy",t.DROPDOWN="dropdown",t.TOGGLE="toggle",t.PASSWORD_INPUT="password_input",t.EXPIRY_INPUT="expiry_input",t.FILE_SETTINGS="file_settings",t.FOLDER_SETTINGS="folder_settings",t.LINK_SETTINGS="link_settings"}),define("modules/clean/sharing/sharing_settings_dropdown",["require","exports","spectrum/dropdown_button","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,n,r,s,i){"use strict";function a(e){var t=e.customButton||r.createElement(n.DropdownButton,{className:"sharing-settings-dropdown__button"},r.createElement("span",{className:"sharing-settings-dropdown__button-label"},e.optionsDict[e.currentValue].label)),a=e.valuesList.map(function(t){var n=r.createElement("span",null);return t===e.currentValue&&(n=r.createElement(i.Sprite,{alt:"",group:"web",name:"check_gray"})),r.createElement(s.BubbleMenuItem,{checked:t===e.currentValue,key:t,onClick:function(){return e.onValueSelected(t)}},r.createElement("div",{className:"sharing-settings-dropdown-item"},r.createElement("div",{className:"sharing-settings-dropdown-item__left-margin"},n),r.createElement("div",{className:"sharing-settings-dropdown-item__label"},r.createElement("div",{className:"sharing-settings-dropdown-item__title"},e.optionsDict[t].label),r.createElement("div",{className:"sharing-settings-dropdown-item__description u-font-meta"},e.optionsDict[t].description))))});return r.createElement(s.BubbleMenu,{targetButton:t,targetFixed:!0,position:e.openUp?s.BubbleMenu.POSITIONS.TOP_ALIGN_RIGHT:s.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-settings-dropdown",items:a,shouldShowArrow:!1})}Object.defineProperty(t,"__esModule",{value:!0}),t.SettingDropdown=a}),
define("modules/clean/sharing/sharing_settings_modal",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css","spectrum/tabbed_header","spectrum/modal","spectrum/toggle","spectrum/button","spectrum-sharing/sharing_modal_banner","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/core/i18n","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_constants"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=f.i18n_default_project("sharing")._,b=s.createElement,y=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleTogglePasswordPolicy=function(e){n.props.onOptionChange(S.PASSWORD_POLICY,{status:e}),n.setState({passwordInputDisabled:"on"===n.props.currentPolicy.get(S.PASSWORD_POLICY).status})},n.handleChangePasswordClick=function(){n.setState({passwordInputDisabled:!1}),n.props.onOptionChange(S.PASSWORD_POLICY,{status:"on",value:""})},n.state={passwordInputDisabled:!0},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=n.__assign({},this.props);return t=i.assignIn(t,{currentTab:this.state.currentTab,onChangePasswordClick:this.handleChangePasswordClick,onTabSelected:function(t){e.setState({currentTab:t})},onTogglePasswordPolicy:this.handleTogglePasswordPolicy,passwordInputDisabled:this.state.passwordInputDisabled}),b(I,t)},t})(s.Component);t.SharingSettingsModal=y;var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderPrimaryAction=function(){return s.createElement(u.Button,{className:"confirm-button u-mar-left-s",variant:"primary",disabled:!t.allowSaveSettings()||t.props.isSubmitting,onClick:t.props.onSaveSettings},E(t.props.isSubmitting?"Saving...":"Save"))},t}return n.__extends(t,e),t.prototype.getDefaultProps=function(){return{hasDisplayableMembers:!1,hasNonOwnerMembers:!1}},t.prototype.componentDidUpdate=function(e){!this.props.passwordInputDisabled&&e.passwordInputDisabled&&this.refs.passwordInputRef&&this.refs.passwordInputRef.focus()},t.prototype.render=function(){var e;return e=this.props.isLoading?s.createElement("div",{className:"sharing-settings-modal__loading-text"},E("Loading...")):s.createElement("div",{className:"sharing-settings-modal"},this.renderTabs(),this.renderTabContent()),s.createElement(d.UtilityModal,{ariaLabel:this.renderTitle(),title:this.renderTitle(),overlayClickClose:!0,primaryAction:this.renderPrimaryAction,secondaryAction:E("Cancel"),onPrimaryAction:this.props.onSaveSettings,onSecondaryAction:this.props.onDismiss,onLink:this.props.onUnshare,link:this.renderLink(),open:!0,width:580,height:662,onRequestClose:this.props.onDismiss},e)},t.prototype.renderTitle=function(){var e={folder_name:a.Emstring.em_snippet(this.props.folderName,h.SNIPPET_SIZES.FILENAME)};return E("Settings for “%(folder_name)s”").format(e)},t.prototype.renderLink=function(){var e;return!this.props.permissions.unshare.allow||!this.props.isSharedFolder&&this.props.isFolder||(e=E(this.props.isFolder?this.props.isFolderInsideTeamFolderTree?"Reset membership":"Unshare folder":"Unshare file")),e},t.prototype.renderTabs=function(){var e=this;return s.createElement(c.TabbedHeader,{onSelection:this.props.onTabSelected,activeTabId:this.getCurrentTab()},this.getTabs().map(function(t){return s.createElement(c.Tab,{key:t.id,active:e.getCurrentTab()===t.id,id:t.id},t.label)}))},t.prototype.getTabs=function(){var e=this,t={id:S.FILE_SETTINGS,label:E("File settings")},n={id:S.FOLDER_SETTINGS,label:E("Folder settings")},r={id:S.LINK_SETTINGS,label:E("Link settings")},s=this.props.isFolder?[n]:[t];return!this.props.isTeamSharedFolder&&this.props.linkMetadata&&s.push(r),s.filter(function(t){return e.getTabInfo(t.id).policies.length>0})},t.prototype.getCurrentTab=function(){return this.props.currentTab||this.getTabs()[0].id},t.prototype.renderTabContent=function(){var e=this,t=this.getTabInfo(this.getCurrentTab());return s.createElement("div",null,t.banner,this.renderDescription(),s.createElement("div",{className:"sharing-settings-modal__tab-content"},s.createElement("div",null,t.policies.map(function(t){var n=e.getPolicyDict(t);return e.renderPolicy(t,n)}))))},t.prototype.renderDescription=function(){var e=this.getTabInfo(this.getCurrentTab());if(e.description&&""!==e.description){var t=s.createElement("div",null,e.description);return s.createElement(m.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:t})}return null},t.prototype.getFolderSettingsBanner=function(){if(!this.props.shouldHideHeader&&this.props.isFolder){var e,t=E("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:this.props.folderName});if(this.props.isInContentManager)e=t;else if(this.props.showContentManagerBridge){var n=o.parent_dir(this.props.folderPath),r=_.genContentManagerBridgeUri({containingFolder:n,filenameToSelect:this.props.folderName});e=s.createElement("div",null,t,s.createElement("div",null,E("You can change these settings in the Admin Console.")+" ",s.createElement("a",{href:r.toString(),target:"_blank"},E("Open in new tab."))))}else if(this.isTeamFolderTree())e=s.createElement("div",null,t,s.createElement("div",null,s.createElement("a",{href:"/team",target:"_blank"},E("To edit, ask your admin."))));else{if(this.props.permissions.change_options.allow)return;e=E("You don’t have permission to change the settings on this folder.")}return s.createElement(m.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"error",message:e})}},t.prototype.isTeamFolderTree=function(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree},t.prototype.getMemberPolicyQuestion=function(){return E(this.isTeamFolderTree()?"Who can be added to folders?":"Who can be invited to this folder?")},t.prototype.getAclUpdatePolicyQuestion=function(){return E(this.isTeamFolderTree()?"Who can invite new members and create a link to folders?":"Who can invite new members and create a link to this folder?")},t.prototype.getDownloadsPolicyDescription=function(){return E(this.isTeamFolderTree()?"Lets people download the folders. People with edit access can always download.":this.props.isFolder?"Lets people download this folder. People with edit access can always download.":"Lets people download this file. People with edit access can always download.")},t.prototype.getViewerInfoPolicyDescription=function(){if(this.props.ownerTeam){var e=void 0;return e=E(this.props.isFolder?"Shows who viewed the files. Only members of %(team_name)s and people who can edit can see this info.":"Shows who viewed the file. Only members of %(team_name)s and people who can edit can see this info."),e.format({team_name:this.props.ownerTeam.name})}return E(this.props.isFolder?"Shows who viewed the files.":"Shows who viewed the file.")},t.prototype.getFolderSettingPolicies=function(){var e=[];return Boolean(this.props.ownerTeam)&&(e.push(S.FOLDER_LINK_AUDIENCE_POLICY),e.push(S.MEMBER_POLICY)),e.push(S.ACL_UPDATE_POLICY),null==this.props.currentPolicy.viewer_info_policy||this.props.showContentManagerBridge||e.push(S.VIEWER_INFO_POLICY),e},t.prototype.getFileSettingPolicies=function(){var e=[];return null!=this.props.currentPolicy.viewer_info_policy&&e.push(S.VIEWER_INFO_POLICY),e},t.prototype.canChangePolicy=function(e){return this.props.getEffectivePolicyValue(e,this.props.policyUpdate)[1]},t.prototype.getMemberPolicyTeamLabel=function(){return E("Only members of %(team_name)s").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,3,1)})},t.prototype.getAclUpdatePolicyEditorsLabel=function(){return this.props.ownerTeam?E("Members on %(team_name)s with edit access").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,12)}):E("Members with edit access")},t.prototype.getAclUpdatePolicyEditorsDescription=function(){return this.props.ownerTeam?E("Any member of %(team_name)s with edit access to this folder.").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,12)}):E("Anyone with edit access to this folder.")},t.prototype.getPolicyDict=function(e){switch(e){case S.MEMBER_POLICY:return{title:E("Membership"),description:this.getMemberPolicyQuestion(),optionsDict:{team:{label:this.getMemberPolicyTeamLabel()},anyone:{label:E("Anyone")}},optionsList:["anyone","team"],type:S.DROPDOWN};case S.ACL_UPDATE_POLICY:return{title:E("Management"),description:this.getAclUpdatePolicyQuestion(),optionsDict:{owner:{label:E(this.isTeamFolderTree()?"Only Team Admins":"Only the owner"),description:E(this.isTeamFolderTree()?"Only Team Admins.":"Only the owner of this folder.")},editors:{label:this.getAclUpdatePolicyEditorsLabel(),description:this.getAclUpdatePolicyEditorsDescription()}},optionsList:["editors","owner"],type:S.DROPDOWN};case S.DOWNLOAD_POLICY:return{title:E("Downloads"),description:this.getDownloadsPolicyDescription(),optionsDict:{allow:{label:E("On"),value:!0},disallow:{label:E("Off"),value:!1}},optionsList:["allow","disallow"],type:S.TOGGLE};case S.VIEWER_INFO_POLICY:return{title:E("Viewer info"),description:this.getViewerInfoPolicyDescription(),optionsDict:{enabled:{label:E("On"),value:!0},disabled:{label:E("Off"),value:!1}},optionsList:["enabled","disabled"],type:S.TOGGLE};case S.FOLDER_LINK_AUDIENCE_POLICY:if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");return{title:E("Link restrictions"),description:E("Limits who can access this folder via a link."),optionsDict:{anyone:{label:E("No restrictions"),description:E("Show all access options for links.")},team:{label:E("Team and invite-only"),description:E("Show “Only people at %(team_name)s” and “Only                               invited members.”").format({team_name:a.Emstring.em_snippet(this.props.ownerTeam.name,12)})},members:{label:E("Invite-only"),description:E("Show “Only invited members” only.")}},optionsList:["anyone","team","members"],type:S.DROPDOWN};default:throw new Error("Policy name not found")}},t.prototype.getFolderSettingsDescription=function(){return E(this.isTeamFolderTree()?"Only team admins can change these settings":this.canChangePolicy(S.ACL_UPDATE_POLICY)?"Only you (the owner) can change these settings.":"Only the owner can change these settings.")},t.prototype.getTabInfo=function(e){switch(e){case S.FILE_SETTINGS:return{title:E("File settings"),banner:void 0,description:"",policies:this.getFileSettingPolicies()};case S.FOLDER_SETTINGS:return{title:E("Folder settings"),banner:this.getFolderSettingsBanner(),description:this.getFolderSettingsDescription(),policies:this.getFolderSettingPolicies()};case S.LINK_SETTINGS:return{title:E("Link settings"),banner:void 0,description:"",policies:[]};default:throw new Error("tabName not found")}},t.prototype.renderPolicy=function(e,t){var n,i,a=t.title,o=t.description,l=t.optionsDict,c=t.optionsList,d=t.type,p=t.extras,u=void 0===p?null:p;_=this.props.getEffectivePolicyValue(e,this.props.policyUpdate),n=_[0],i=_[1];var m;if(d===S.DROPDOWN)m=this.renderDropdown(e,n,l,c);else{if(d!==S.TOGGLE)throw new Error("Selector type not found");m=this.renderToggle(e,n,l,c)}var h=s.createElement("div",null);return u&&(h=u(n)),s.createElement("div",{className:r({policy:!0,"policy--no-permissions":!i})},s.createElement("div",{className:"policy__left"},s.createElement("div",{className:"policy__title"},a),s.createElement("div",{className:"policy__description u-font-meta"},o)),s.createElement("div",{className:"policy__selector"},m),s.createElement("div",{className:"policy__extras"},h));var _},t.prototype.renderDropdown=function(e,t,n,r){var i=this;return s.createElement(g.SettingDropdown,{currentValue:t,valuesList:r,optionsDict:n,onValueSelected:function(t){return i.props.onOptionChange(e,t)}})},t.prototype.renderToggle=function(e,t,n,r){var i=this,a=function(t,r){for(var s in n){n[s].value===t&&i.props.onOptionChange(e,s)}};return s.createElement(p.Toggle,{ariaLabel:"toggle",labelContent:n[t].label,checked:n[t].value,interactive:!0,onCheckedChange:a})},t.prototype.allowSaveSettings=function(){return!(!this.props.policyUpdate||0===Object.keys(this.props.policyUpdate).length)&&!(this.props.policyUpdate.password&&"on"===this.props.policyUpdate.password.status&&!this.props.passwordInputDisabled&&(!this.props.policyUpdate.password.value||""===this.props.policyUpdate.password.value))},t})(s.Component);t.SharingSettingsModalContentsView=v;var I=l(v,["/static/css/modal-vflI292PU.css","/static/css/sharing/share_modal-vflFs4QGO.css"])}),define("modules/clean/sharing/sharing_settings_util",["require","exports","external/react-dom-factories","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/sharing_settings_constants","modules/core/i18n"],function(e,t,n,r,s,i,a){"use strict";function o(e,t,n,r,s,a){switch(e){case i.AUDIENCE_POLICY:return r&&r.link_permissions.change_audience.allow&&r.audience_options.size>1;case i.PASSWORD_POLICY:return r&&"members"!==n.get(i.AUDIENCE_POLICY)&&(r.link_permissions.set_password.allow||r.link_permissions.remove_password.allow&&"off"!==t.get(i.PASSWORD_POLICY).status);case i.EXPIRY_POLICY:return r&&"members"!==n.get(i.AUDIENCE_POLICY)&&(r.link_permissions.set_expiry.allow||r.link_permissions.remove_expiry.allow&&"off"!==t.get(i.EXPIRY_POLICY).status);case i.DOWNLOAD_POLICY:return!(!s||a)&&("allow"===t.get(i.DOWNLOAD_POLICY)?s.set_download_policy&&s.set_download_policy.allow:s.remove_download_policy&&s.remove_download_policy.allow);case i.VIEWER_INFO_POLICY:return!(!s||a)&&("enabled"===t.get(i.VIEWER_INFO_POLICY)?s.disable_viewer_info&&s.disable_viewer_info.allow:s.enable_viewer_info&&s.enable_viewer_info.allow);default:throw new Error("Link policy not found")}}function l(e){switch(e){case"restricted_by_parent_folder":return u("This setting is turned off for all files in this folder.");case"restricted_by_team":return u("Your admin has disabled this setting.");default:return}}function c(e,t){return"enabled"===e.get(i.VIEWER_INFO_POLICY)?t.disable_viewer_info?l(t.disable_viewer_info.reason):void 0:t.enable_viewer_info?l(t.enable_viewer_info.reason):void 0}function d(e){return[i.AUDIENCE_POLICY,i.DOWNLOAD_POLICY,i.EXPIRY_POLICY,i.VIEWER_INFO_POLICY,i.PASSWORD_POLICY].indexOf(e)!==-1}function p(e,t,i,a){var o,l,c=a&&!i;return c?(o=u("Only you"),l=u(e?"Only you can access this folder.":"Only you can access this file.")):(o=u("Invited members"),l=e?s.reactFormat(u("<strong>Most secure.</strong> Only those specifically invited can access this folder."),{strong:n.strong()}):s.reactFormat(u("<strong>Most secure.</strong> Only those specifically invited can access this file."),{strong:n.strong()})),{public:{label:u("Anyone with the link"),description:u(e?"Anyone who has the link can access this folder.":"Anyone who has the link can access this file.")},team:{label:u("Members of %(team_name)s").format({team_name:r.Emstring.em_snippet(t||"",6,1)}),description:e?u("Only members of %(team_name)s and invited members can access this folder.").format({team_name:t}):u("Only members of %(team_name)s and invited members can access this file.").format({team_name:t})},members:{label:o,description:l}}}Object.defineProperty(t,"__esModule",{value:!0});var u=a.i18n_default_project("sharing")._;t.canChangePolicy=o,t.denyReasonToDenyString=l,t.getPassDenyReason=c,t.isCommonSharingSettingsPolicy=d,t.getAudienceOptionsDict=p}),define("modules/clean/sharing/stores/sharing_info",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/loggers/growth_features_events_logger","modules/clean/sharing/action_types","modules/clean/sharing/api/types/metadata","modules/clean/sharing/access_level","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/constants/sharing","modules/constants/teams","modules/core/exception"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(e,t){return t=String(t),t.startsWith("id:")||(t=t.toLowerCase()),e+"::"+t},g=(function(e){function t(){var t=e.call(this)||this;return t.sharingInfoMap={},t}return n.__extends(t,e),t.prototype.getSharingInfo=function(e,t){return t?this.sharingInfoMap[f(e,t)]:null},t.prototype.mapContentIdsToSharingInfo=function(e,t,n){for(var r=0,s=t;r<s.length;r++){var i=s[r];i&&(this.sharingInfoMap[f(e,i)]=n)}},t.prototype._new_payload=function(e){var t=this;if(e&&e.action&&e.action.type)switch(e.action.type){case o.SharingActionTypes.CLEAR_EVERYTHING:this.sharingInfoMap={};break;case o.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS:var n=e.action.user;e.action.data.forEach(function(e){t._new_payload_for_single_content(o.ShareModalActionTypes.FETCH_METADATA_SUCCESS,n,d.getContentIdsForMetadata(e),{metadata:e})}),this.emit_change();break;default:if(!e.action.contentIds)return;this._new_payload_for_single_content(e.action.type,e.action.user,e.action.contentIds,e.action.data),this.emit_change()}},t.prototype._new_payload_for_single_content=function(e,t,n,r){_.assert(Boolean(t.id),"valid user needed"),_.assert(n.length>0,"contentIds cannot be empty");for(var s=null,i=0,a=n;i<a.length;i++){var o=a[i],l=f(t.id,o);if(l in this.sharingInfoMap){s=this.sharingInfoMap[l];break}}return s||(s=new S(t)),this.mapContentIdsToSharingInfo(t.id,n,s),s._new_payload(e,r)},t})(i.Store);t.sharingInfoStore=new g;var S=(function(){function e(e){this._areMembersFullyLoaded=!1,this._areSharingPrefsLoaded=!1,this._hasDisplayableMembers=!1,this._isLinkMetadataLoaded=!1,this._isTeamPolicyLoaded=!1,this._isUpdatingLinkAudience=!1,this._sharingPrefs=new l.SharingPrefs,this._shouldBlockMemberListOnPassLoad=!0,this._createdShareLink=!1,this._expUjMagnet2018SuggestableUserDataTimestamp=0,this._expUjMagnet2018ShouldLogExposure=a.EXP_UJ_MAGNET2018_LOGGED_VARIANTS.includes(h.UJ_MAGNET2018_ADMIN)||a.EXP_UJ_MAGNET2018_LOGGED_VARIANTS.includes(h.UJ_MAGNET2018_MEMBER),this._expUjMagnet2018LastEmails=[],this._user=e}return e.prototype._new_payload=function(e,n){switch(e){case o.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_REQUEST:var r=this._metadata;this._linkMetadata||(r=r.set("link_metadata",new l.SharedContentLinkMetadata)),r=r.setIn(["link_metadata","current_audience"],n.newAudience),this.setMetadata(r),this._isUpdatingLinkAudience=!0;break;case o.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_FAILURE:this._isUpdatingLinkAudience=!1,this.setMetadata(this._metadata.setIn(["link_metadata","current_audience"],n.prevAudience));break;case o.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SUCCESS:this._modalInfo.hasChangedLinkAudience=!0,this._isUpdatingLinkAudience=!1,this.setMetadata(n.metadata);break;case o.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE:var i=n.member;this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],n.prevAccess);break;case o.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST:var i=n.member;this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],n.newAccess);break;case o.ShareModalActionTypes.CHANGE_RECIPIENTS:this._modalInfo.recipientTokens=n.recipientTokens,this._modalInfo.recipientRawInput=n.recipientRawInput;var a=void 0;n.recipientTokens.length>0||n.recipientRawInput.length>0?this.uiMode()===u.MODES.MEMBERSHIP&&(a=u.MODES.SHARE):this.uiMode()===u.MODES.SHARE&&(a=u.MODES.MEMBERSHIP),a&&(this._modalInfo.uiMode=a);break;case o.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS:this._modalInfo.recipientAccess=n.newAccess;break;case o.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE:this._modalInfo.recipientMessage=n.message;break;case o.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:this._members=this._members.update("users",function(e){return e.map(function(e){return e.set("time_last_seen",null)})});break;case o.ShareModalActionTypes.CREATE_LINK_REQUEST:this._createdShareLink=!0;break;case o.ShareModalActionTypes.CREATE_LINK_SUCCESS:this._linkMetadata=n.linkMetadata;break;case o.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS:this._memberCounts=n.memberCounts;break;case o.ShareModalActionTypes.FETCH_METADATA_FAILURE:this._fetchingMetadataPromise=void 0,this._modalInfo&&(this._modalInfo.uiMode=u.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason!==u.LINK_ONLY_REASON.LINKS_PAGE&&(this._modalInfo.linkOnlyReason=n.reason));break;case o.ShareModalActionTypes.FETCH_METADATA_REQUEST:this._fetchingMetadataPromise=n.promise;break;case o.ShareModalActionTypes.FETCH_METADATA_SUCCESS:this._fetchingMetadataPromise=void 0,this.setMetadata(n.metadata);break;case o.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST:this._areSharingPrefsLoaded=!1;break;case o.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS:this._areSharingPrefsLoaded=!0,this._sharingPrefs=n.sharingPrefs;break;case o.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE:this._isLinkMetadataLoaded=!0,this._linkMetadata=void 0;break;case o.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS:this._isLinkMetadataLoaded=!0,this._linkMetadata=n.linkMetadata;break;case o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST:this._fetchingMembersRequest={limitNonNull:n.limitNonNull,promise:n.promise,requestId:n.requestId};break;case o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;if(this._hasDisplayableMembers&&this._fetchingMembersRequest&&this._fetchingMembersRequest.limitNonNull<this._members.getMemberCount())return;this._hasDisplayableMembers=!0,n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=n.members;break;case o.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=this._members.mergeDeep(n.members);break;case o.ShareModalActionTypes.FETCH_TEAM_POLICY_REQUEST:this._isTeamPolicyLoaded=!1;break;case o.ShareModalActionTypes.FETCH_TEAM_POLICY_SUCCESS:this._isTeamPolicyLoaded=!0,this._teamPolicy=n.teamPolicy;break;case o.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS:this._memberCounts=new l.MemberCounts({total_unique_users:n.count,users_outside_team:0,exceeds_count:n.exceeds_limit});break;case o.ShareModalActionTypes.FETCH_MAGNET2018_REQUEST:this._expUjMagnet2018SuggestableUserDataPromise=n.promise,this._expUjMagnet2018SuggestableUserDataTimestamp=n.ts,this._expUjMagnet2018LastEmails=n.emails;break;case o.ShareModalActionTypes.FETCH_MAGNET2018_SUCCESS:this._expUjMagnet2018ShouldLogExposure=this._expUjMagnet2018ShouldLogExposure&&!n.loggedExposure,n.ts>=this._expUjMagnet2018SuggestableUserDataTimestamp&&(this._expUjMagnet2018SuggestableUserDataPromise=void 0,this._expUjMagnet2018SuggestableUserData=n.suggestableUserData);break;case o.ShareModalActionTypes.FETCH_MAGNET2018_FAILURE:n.ts>=this._expUjMagnet2018SuggestableUserDataTimestamp&&(this._expUjMagnet2018SuggestableUserDataPromise=void 0,this._expUjMagnet2018SuggestableUserData=void 0);break;case o.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE:this._modalInfo.contentNameInputValue=n.name,this._modalInfo.contentNameMessageLevel=u.CONTENT_NAME_MESSAGE_LEVELS.INFO,this._modalInfo.contentNameMessage=""===n.name?u.CONTENT_NAME_EMPTY_TOOLTIP:void 0;break;case o.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE:this._modalInfo.isContentNameFocused=n.focus;break;case o.ShareModalActionTypes.MEMBER_ACTION_COMPLETE:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(n.member.memberKey());break;case o.ShareModalActionTypes.MEMBER_ACTION_PENDING:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.add(n.member.memberKey());break;case o.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS:var i=n.member;this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],n.access),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(i.memberKey());break;case o.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS:var i=n.member;this._members=this._members.deleteIn([i.type(),i.memberKey()]),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(i.memberKey());break;case o.ShareModalActionTypes.SEND_SHARE_FAILURE:this._modalInfo.uiMode=u.MODES.SHARE;break;case o.ShareModalActionTypes.SEND_SHARE_REQUEST:this._modalInfo.uiMode=u.MODES.SHARE_SENDING;break;case o.ShareModalActionTypes.SEND_SHARE_SUCCESS:this._modalInfo.uiMode=u.MODES.SHARE;break;case o.ShareModalActionTypes.SHARE_FOLDER_FAILURE:this._shareFolderPromise=void 0;break;case o.ShareModalActionTypes.SHARE_FOLDER_REQUEST:this._shareFolderPromise=n.promise;break;case o.ShareModalActionTypes.SHARE_FOLDER_SUCCESS:this.setMetadata(n.metadata),this._shareFolderPromise=void 0;break;case o.ShareModalActionTypes.SHARE_MODAL_CLOSE:this._expUjMagnet2018SuggestableUserData=void 0,this._expUjMagnet2018SuggestableUserDataPromise=void 0,this._expUjMagnet2018LastEmails=[],this._modalInfo.initialRecipientTokens=n.tokens||[],this._modalInfo.initialRecipientRawInput=n.value||"";break;case o.ShareModalActionTypes.SHARE_MODAL_OPEN:this.handleShareModalOpen(n);break;case o.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS:this._metadata=void 0,this._isLinkMetadataLoaded=!1,this._hasDisplayableMembers=!1;break;case o.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:this._shouldBlockMemberListOnPassLoad=!1;break;case o.ShareModalActionTypes.UPDATE_BANNER:this._modalInfo.banner=n.banner;break;case o.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS:this._modalInfo&&(this._modalInfo.hasChangedSharingSettings=!0),this.setMetadata(n.metadata);break;case o.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR:this._modalInfo.contentNameMessage=n.errorMsg,this._modalInfo.contentNameMessageLevel=u.CONTENT_NAME_MESSAGE_LEVELS.ERROR;break;case o.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS:var c=s.parent_dir(this.fqPath()),d=p.getNewFolderPathFromContentName(n.contentName,c);this._modalInfo.contentInfo=this._modalInfo.contentInfo.setFQPath(d),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,[d],this)}},e.prototype.handleShareModalOpen=function(e){this._modalInfo=new E(e.shareModalInfo.contentInfo),this._modalInfo.contentNameInputValue=e.initialProps.initialContentName,this._modalInfo.initialRecipientTokens=e.shareModalInfo.initialRecipientTokens||[],this._modalInfo.recipientMessage=e.initialProps.recipientMessage||"",this._initialProps=e.initialProps,e.shareModalInfo.inLinksPage&&(this._modalInfo.uiMode=u.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason=u.LINK_ONLY_REASON.LINKS_PAGE),this._areMembersFullyLoaded=!1,!e.shareModalInfo.contentInfo.pathExists()&&!e.initialProps.initialContentName&&(this._modalInfo.isContentNameFocused=!0,this._modalInfo.contentNameMessage=u.CONTENT_NAME_EMPTY_TOOLTIP)},e.prototype.setMetadata=function(e){m.TRUELINK.TRUELINK_UI[this._user.id]&&(this._isUpdatingLinkAudience&&(e=e.setIn(["link_metadata","current_audience"],this._linkMetadata.current_audience)),this._isLinkMetadataLoaded=!0,e.link_metadata&&(this._linkMetadata=e.link_metadata));var n=e.permissions||this._metadata&&this._metadata.permissions;this._metadata=e.set("permissions",n),this._modalInfo&&e.shared_folder_id&&(this._modalInfo.contentInfo=this._modalInfo.contentInfo.setNsId(e.shared_folder_id)),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,d.getContentIdsForMetadata(e),this)},e.prototype.isViewerNoCommentEnabled=function(){return this.isFolder()?this.isNoCommentEnabledForFolders():this.isNoCommentEnabledForLinks()},e.prototype.hasNonOwnerMembers=function(){var e=this._members&&this._members.getMemberCount();if(!e)return!1;if(1===e&&1===this._members.users.count()){return this._members.users.first().account_id!==this._user.account_id}return!0},e.prototype.hasOutsideTeamMembers=function(){var e=this.memberCounts();return(e?e.users_outside_team:0)>0},e.prototype.memberNum=function(){var e=this.memberCounts(),t=this.members();return e&&e.total_unique_users?e.total_unique_users:t?t.getMemberCount():void 0},e.prototype.memberCountWithRecipients=function(){return(this.memberNum()||0)+p.getMemberCountForTokens(this.recipientTokens())},e.prototype.getInitialProps=function(){return this._initialProps},e.prototype.areMembersFullyLoaded=function(){return this._areMembersFullyLoaded},e.prototype.areSharingPrefsLoaded=function(){return this._areSharingPrefsLoaded},e.prototype.banner=function(){return this._modalInfo.banner},e.prototype.canChangeOptions=function(){return Boolean(this._metadata&&this._metadata.permissions.change_options&&this._metadata.permissions.change_options.allow)},e.prototype.canEdit=function(){return Boolean(this._metadata&&this._metadata.permissions.edit_contents&&this._metadata.permissions.edit_contents.allow)},e.prototype.canInviteEditor=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_editor&&this._metadata.permissions.invite_editor.allow)},e.prototype.canInviteViewer=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer&&this._metadata.permissions.invite_viewer.allow)},e.prototype.canInviteViewerNoComment=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer_no_comment&&this._metadata.permissions.invite_viewer_no_comment.allow)},e.prototype.canMakeViewerNoComment=function(){return this.isViewerNoCommentEnabled()},e.prototype.canRelinquishMembership=function(){return Boolean(this._metadata&&this._metadata.permissions.relinquish_membership&&this._metadata.permissions.relinquish_membership.allow)},e.prototype.canShareLink=function(){return!this.isConfidentialFolder()&&!this.isTeamSharedFolder()&&this.contentInfo().pathExists()&&this.contentInfo().isMounted()},e.prototype.canUnshareFile=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUnshareFolder=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUpdateConfidentiality=function(){return Boolean(this._metadata&&this._metadata.permissions.update_confidentiality&&this._metadata.permissions.update_confidentiality.allow)},e.prototype.contactsError=function(){return this._expUjMagnet2018SuggestableUserDataPromise?{message:p.loadingIndicator(),level:p.ContactsErrorLevel.Warn}:p.validateContacts(this.recipientTokens(),this._user,this.ownerTeam(),this.folderPolicy(),this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree(),this.memberCountWithRecipients(),this.expUjMagnet2018SuggestableUserData(),this.contentInfo(),this.recipientMessage())},e.prototype.contentId=function(){return this._modalInfo.contentInfo.id},e.prototype.contentInfo=function(){return this._modalInfo.contentInfo},e.prototype.contentNameInputValue=function(){return this._modalInfo.contentNameInputValue},e.prototype.contentNameMessage=function(){return this._modalInfo.contentNameMessage},e.prototype.contentNameMessageLevel=function(){return this._modalInfo.contentNameMessageLevel},e.prototype.expUjMagnet2018SuggestableUserData=function(){return this._expUjMagnet2018SuggestableUserData},e.prototype.expUjMagnet2018SuggestableUserDataPromise=function(){return this._expUjMagnet2018SuggestableUserDataPromise},e.prototype.expUjMagnet2018ShouldLogExposure=function(){return this._expUjMagnet2018ShouldLogExposure},e.prototype.expUjMagnet2018LastEmails=function(){return this._expUjMagnet2018LastEmails},e.prototype.fetchingMembersRequest=function(){return this._fetchingMembersRequest},e.prototype.fetchingMetadataPromise=function(){return this._fetchingMetadataPromise},e.prototype.filePolicy=function(){return this._metadata&&this._metadata.file_policy},e.prototype.folderPolicy=function(){return this._metadata&&this._metadata.policy},
e.prototype.fqPath=function(){return this._modalInfo.contentInfo.displayPath()},e.prototype.hasChangedLinkAudience=function(){return this._modalInfo&&this._modalInfo.hasChangedLinkAudience},e.prototype.hasChangedSharingSettings=function(){return this._modalInfo&&this._modalInfo.hasChangedSharingSettings},e.prototype.hasDisplayableMembers=function(){return this._hasDisplayableMembers},e.prototype.hasParentSharedFolder=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.initialRecipientRawInput=function(){return this._modalInfo.initialRecipientRawInput},e.prototype.initialRecipientTokens=function(){return this._modalInfo.initialRecipientTokens},e.prototype.isNoCommentEnabledForFolders=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_shared_folders)},e.prototype.isNoCommentEnabledForLinks=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_content_links)},e.prototype.isNonUserRelativeContext=function(){return this.getInitialProps().isInContentManager},e.prototype.isFolder=function(){return this._modalInfo.contentInfo.isFolder()},e.prototype.isConfidentialFolder=function(){return Boolean(this._metadata&&this._metadata.is_confidential)},e.prototype.isContentNameFocused=function(){return this._modalInfo.isContentNameFocused},e.prototype.isFolderInsideTeamFolderTree=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.isInsideSharedFolder=function(){return Boolean(this._metadata&&this._metadata.parent_shared_folder_id||this.contentInfo().isInSharedFolder())},e.prototype.isLinkMetadataLoaded=function(){return this._isLinkMetadataLoaded},e.prototype.isMetadataLoaded=function(){return Boolean(this._metadata)},e.prototype.isOwner=function(){return Boolean(this._metadata&&this._metadata.access_type===c.ACCESS_LEVEL.OWNER)},e.prototype.isUserOnOwnerTeam=function(){return Boolean(this._metadata&&this._metadata.owner_team&&this._metadata.owner_team.id===this._user.team_dbtid)},e.prototype.isTeamPolicyLoaded=function(){return this._isTeamPolicyLoaded},e.prototype.isTeamSharedFolder=function(){return Boolean(this._metadata&&this._metadata.is_team_folder||this.contentInfo().isTeamSharedFolder())},e.prototype.isTokenizerEmpty=function(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length},e.prototype.isUpdatingLinkAudience=function(){return this._isUpdatingLinkAudience},e.prototype.linkMetadata=function(){return this._linkMetadata},e.prototype.linkOnlyReason=function(){return this._modalInfo.linkOnlyReason},e.prototype.memberCounts=function(){return this._memberCounts},e.prototype.members=function(){return this._members},e.prototype.metadata=function(){return this._metadata},e.prototype.ownerTeam=function(){return this._metadata&&this._metadata.owner_team},e.prototype.parentSharedFolderId=function(){return this._metadata&&this._metadata.parent_shared_folder_id},e.prototype.pendingMemberAction=function(){return this._modalInfo.pendingMemberAction},e.prototype.permissions=function(){return this._metadata&&this._metadata.permissions},e.prototype.recipientAccess=function(){return this._modalInfo.recipientAccess},e.prototype.recipientMessage=function(){return this._modalInfo.recipientMessage},e.prototype.recipientRawInput=function(){return this._modalInfo.recipientRawInput},e.prototype.recipientTokens=function(){return this._modalInfo.recipientTokens},e.prototype.shareAsConfidential=function(){return Boolean(this.getInitialProps().shareAsConfidential)},e.prototype.shareFolderPromise=function(){return this._shareFolderPromise},e.prototype.shouldBlockMemberListOnPassLoad=function(){return this._shouldBlockMemberListOnPassLoad},e.prototype.shouldSyncThisFolder=function(){return this.getInitialProps()?this.getInitialProps().shouldSyncThisFolder:null},e.prototype.teamPolicy=function(){return this._teamPolicy},e.prototype.uiMode=function(){return this._modalInfo.uiMode},e.prototype.createdShareLink=function(){return this._createdShareLink},e})();t.SharingInfo=S;var E=(function(){function e(e){this.banner=u.BANNERS.NO_MEMBERS,this.canRelinquishMembership=!1,this.contentNameInputValue="",this.contentNameMessageLevel=u.CONTENT_NAME_MESSAGE_LEVELS.INFO,this.hasChangedLinkAudience=!1,this.hasChangedSharingSettings=!1,this.initialRecipientRawInput="",this.initialRecipientTokens=[],this.isContentNameFocused=!1,this.pendingMemberAction=r.Set(),this.recipientAccess=c.ACCESS_LEVEL.READER,this.recipientMessage="",this.recipientRawInput="",this.recipientTokens=[],this.shareAsConfidential=!1,this.uiMode=u.MODES.MEMBERSHIP,this.contentInfo=e,e.isFolder()&&(this.recipientAccess=c.ACCESS_LEVEL.WRITER)}return e})();t.SharingModalInfo=E}),define("modules/clean/sharing/stores/sharing_info_util",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContentIdsForMetadata=function(e){return[e.shared_folder_id,e.id,e.path_lower].filter(Boolean)},t.getContentIdsForContentInfo=function(e){var t=[];return e.isSharedFolder()?t.push(e.sharedFolderId()):(e.extras.fileId&&t.push(e.extras.fileId),e.extras.nsId&&e.extras.nsPath&&t.push("ns:"+e.nsId()+e.nsPath())),e.displayPath()&&t.push(e.displayPath()),t}}),define("modules/clean/sharing/strings",["require","exports","modules/clean/sharing/access_level","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s.i18n_default_project("sharing")._,a=(u={},u[n.ACCESS_LEVEL.OWNER]=i("Owner"),u[n.ACCESS_LEVEL.WRITER]=i("Can edit"),u[n.ACCESS_LEVEL.READER]=i("Can view"),u[n.ACCESS_LEVEL.READER_NO_COMMENT]=i("View-only"),u);t.ACCESS_NAME=a;var o=(m={},m[n.ACCESS_LEVEL.OWNER]=i("Owner"),m[n.ACCESS_LEVEL.WRITER]=i("Can edit"),m[n.ACCESS_LEVEL.READER]=i("Can comment"),m[n.ACCESS_LEVEL.READER_NO_COMMENT]=i("Can view"),m);t.ACCESS_NAME_NO_COMMENT=o;var l=(h={},h[r.MEMBER_ACTION.MAKE_EDITOR]=i("People can edit, delete, comment, and add the file to their Dropbox"),h[r.MEMBER_ACTION.MAKE_VIEWER]=i("People can view, download, and comment"),h[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("People can only view and download the files"),h);t.MEMBER_ACTION_FOLDER=l;var c=(_={},_[r.MEMBER_ACTION.MAKE_EDITOR]=i("People can edit, delete, comment, and add the files to their Dropbox"),_[r.MEMBER_ACTION.MAKE_VIEWER]=i("People can view, download, and comment"),_[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("People can only view and download the file"),_);t.MEMBER_ACTION_FILE=c;var d=(f={},f[r.MEMBER_ACTION.MAKE_EDITOR]=i("Lets them view, comment, and edit."),f[r.MEMBER_ACTION.MAKE_VIEWER]=i("Lets them view and comment, but not edit."),f[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("Lets them view only. They can’t see comments."),f);t.MEMBER_ACTION_FOLDER_NO_COMMENT=d;var p=(g={},g[r.MEMBER_ACTION.MAKE_EDITOR]=i("Lets them view, comment, and edit."),g[r.MEMBER_ACTION.MAKE_VIEWER]=i("Lets them view and comment, but not edit."),g[r.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]=i("Lets them view only. They can’t see comments."),g);t.MEMBER_ACTION_FILE_NO_COMMENT=p;var u,m,h,_,f,g}),define("modules/clean/sharing/views/constants",["require","exports","external/lodash","modules/core/i18n"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=r.i18n_default_project("sharing")._;(function(e){e[e.NO_MEMBERS=0]="NO_MEMBERS",e[e.INPUT_CONTENT_NAME=1]="INPUT_CONTENT_NAME"})(s=t.BANNERS||(t.BANNERS={}));var a;(function(e){e[e.INFO=0]="INFO",e[e.ERROR=1]="ERROR"})(a=t.CONTENT_NAME_MESSAGE_LEVELS||(t.CONTENT_NAME_MESSAGE_LEVELS={}));var o;(function(e){e.LINK_ONLY="link-only",e.LOADING="loading",e.MEMBERSHIP="membership",e.SHARE="share",e.SHARE_SENDING="share-sending"})(o=t.MODES||(t.MODES={}));(function(e){e.INSIDE_SHARED_FOLDER="inside_shared_folder",e.CONTAINS_SHARED_FOLDER="contains_shared_folder",e.LINKS_PAGE="links_page"})(t.LINK_ONLY_REASON||(t.LINK_ONLY_REASON={})),t.CONTENT_NAME_EMPTY_TOOLTIP=i("Name your shared folder"),t.MODE_VALUES=n.values(o),t.BANNER_VALUES=n.values(s),t.CONTENT_NAME_MESSAGE_LEVEL_VALUES=n.values(a)}),define("modules/clean/sharing/views/exp_showcase_share_interstitial",["require","exports","tslib","react","spectrum/modal","modules/clean/bem","modules/clean/growth/user_action/tracker","modules/clean/react/css","modules/clean/react/modal","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.CONTROL="CONTROL",e.V1="V1"})(t.ShowcaseInterstitialVariants||(t.ShowcaseInterstitialVariants={}));var p;(function(e){e.CLOSE="uj_showcase_share_interstitial__close",e.VIEW="uj_showcase_share_interstitial__view",e.CLICK_SHARE="uj_showcase_share_interstitial__click_share",e.CLICK_SHOWCASE="uj_showcase_share_interstitial__click_showcase"})(p=t.ShowcaseInterstitialEvents||(t.ShowcaseInterstitialEvents={}));var u=i.bem("showcase-share-interstitial");t.showShowcaseInterstitial=function(e){l.Modal.showInstance(r.createElement(t.ShowcaseShareInterstitial,n.__assign({},e)))};var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onRequestClose=function(){n.props.track(p.CLOSE),n.setState({open:!1})},n.onClickShare=function(e){e.preventDefault(),n.props.track(p.CLICK_SHARE),n.props.onClickShare()},n.onClickShowcase=function(e){e.preventDefault(),n.props.track(p.CLICK_SHOWCASE),n.props.onClickShowcase()},n.state={open:!0},n}return n.__extends(t,e),t.prototype.render=function(){var e=this.state.open;return r.createElement(s.Modal,{open:e,className:u(),ariaLabel:d._("Choose a way to share"),onRequestClose:this.onRequestClose,displayCloseButton:!0},r.createElement("div",{className:u("content")},r.createElement("span",{className:u("title")},r.createElement("div",null,d._("Find the best way to share.")),r.createElement("div",null,d._("What’s the main reason you’re sharing this file?"))),r.createElement("div",{className:u("options")},r.createElement("button",{className:u("option","sharing"),onClick:this.onClickShare},r.createElement("div",{className:u("option-img-wrapper")},r.createElement("img",{className:u("option-img"),src:c.static_url("/static/images/growth/showcase_upsell/create_and_collaborate@2x-vfljEt8Rt.png"),alt:""})),r.createElement("span",{className:u("option-name")},d._("To collaborate")),r.createElement("span",{className:u("option-desc")},d._("Work on this file with other people. Swap ideas,\n                get feedback, and keep everyone in sync."))),r.createElement("button",{className:u("option","showcase"),onClick:this.onClickShowcase},r.createElement("div",{className:u("option-img-wrapper")},r.createElement("img",{className:u("option-img"),src:c.static_url("/static/images/growth/showcase_upsell/try_showcase@2x-vfle_w-WK.png"),alt:""})),r.createElement("span",{className:u("option-name")},d._("To display or present work")),r.createElement("span",{className:u("option-desc")},d._("Share in a visual layout. Present work with your logo\n                and branding, and let people comment on it."))))))},t})(r.Component);t.ShowcaseShareInterstitialComponent=m,t.ShowcaseShareInterstitial=a.withGrowthTracking("uj_showcase_upsell",{mount:p.VIEW})(o.withCss(["/static/css/growth/showcase_upsell/showcase_share_interstitial-vfli-2had.css"])(m))}),define("modules/clean/sharing/views/inherited_members",["require","exports","tslib","external/classnames","external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/views/inherited_members_helpers","modules/clean/web_user_action_logger","modules/clean/web_user_action_events","modules/core/i18n","spectrum/icon_content","modules/constants/sharing"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=s.createElement,E=(function(e){function t(t){var n=e.call(this,t)||this;return n.onToggleShowMemberList=function(){0!==n.props.members.length&&n.setState({areMembersExpanded:!n.state.areMembersExpanded})},n.state={areMembersExpanded:!1},n}return n.__extends(t,e),t.prototype.renderMembersList=function(){return this.state.areMembersExpanded?s.createElement("div",null,s.createElement("div",{className:"u-mar-top-xs u-mar-horizontal-xs u-pad-top-xs inherited-member-list__divider"}),s.createElement("div",null,s.createElement("ul",{className:"u-pad-horizontal-s u-pad-vertical-xs inherited-member-list__member"},this.props.children))):void 0},t.prototype.renderRemoveButton=function(){return this.props.canUpdateConfidentiality?s.createElement("button",{className:"inherited-member-list__remove-button button-as-link",onClick:this.props.onToggleInheritanceClick},_._("Remove",{comment:"Shown on button that can be clicked to remove access to subfolder"})):void 0},t.prototype.renderTriangle=function(){return 0===this.props.members.length?s.createElement("div",{className:"u-pad-horizontal-xs"}):s.createElement("a",{href:"#",className:"u-pad-horizontal-xxs o-flag__fix inherited-member-list__triangle",onClick:this.onToggleShowMemberList},S(c.Sprite,{alt:_._("Toggle whether inherited members are displayed or hidden"),group:"web",name:this.state.areMembersExpanded?"triangle_open_1x":"triangle_closed_1x"}))},t.prototype.render=function(){var e,t=a.parent_dir(this.props.contentInfo.displayPath());if("/"===t)e=_._("Members of %(team_name)s shared workspace").format({team_name:i.Emstring.em_snippet(this.props.teamName,p.SNIPPET_SIZES.DISPLAY_NAME)});else{var n=a.filename(t);e=_._("Members of “%(folder_name)s” folder").format({folder_name:i.Emstring.em_snippet(n,p.SNIPPET_SIZES.FILENAME)})}var o=0,l=null;null!=this.props.memberCounts&&(l=this.props.contentInfo.isSharedFolder()?this.props.memberCounts.total_unique_inherited_members:this.props.memberCounts.total_unique_users),null!=l?o=l:this.props.members.forEach(function(e){e instanceof d.GroupMembershipInfo?o+=e.member_count:o++});var c=_.ungettext("%(members_count)s member","%(members_count)s members",o).format({members_count:o}),u=r([{"u-mar-bottom-xs":!0,"inherited-member-list__outer-expanded":this.state.areMembersExpanded,"inherited-member-list__outer-closed":!this.state.areMembersExpanded,"inherited-member-list__outer-spectrum":g.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL}]),m=r([{"inherited-member-list__inner":!this.state.areMembersExpanded}]);return s.createElement("div",{className:u},s.createElement("div",{className:m},s.createElement("div",{className:"o-flag inherited-member-list__toggle-show-member",onClick:this.onToggleShowMemberList},this.renderTriangle(),s.createElement("div",{className:"o-flag__flex u-pad-vertical-xs u-pad-right-s"},s.createElement("div",{className:"o-flag"},s.createElement("div",{className:"o-flag__fix"},s.createElement(f.IconContent,{name:"folder_shared-small"})),s.createElement("div",{className:"o-flag__flex u-pad-left-s"},s.createElement("div",{className:"inherited-member-list__member-str u-font-strong"},e),s.createElement("div",{className:"inherited-member-list__member-count-str u-font-meta"},c)),s.createElement("div",{className:"o-flag__fix u-pad-right-xxs"},this.renderRemoveButton())))),s.createElement("div",null,this.renderMembersList())))},t})(s.Component);t.InheritedMembers=E;var b=(function(e){function t(t){var n=e.call(this,t)||this;n.state={isAccepting:!1};var r=t.contentInfo.displayPath();return n.contentGenerator=new u.SetInheritedMembersUIConfidentialModalContentGenerator(t.initialIsConfidentialFolder,r,t.teamName,t.contentInfo.parentFolderName()),n}return n.__extends(t,e),t.prototype.renderButtons=function(){var e=this;return s.createElement("div",{className:"u-l-fr"},s.createElement("button",{className:"c-btn c-btn--primary confirmation-modal__action",disabled:this.state.isAccepting,onClick:function(){return e._onToggleConfidentialFolder(!1)}},this.contentGenerator.getActionString()),s.createElement("button",{className:"c-btn c-btn--secondary u-mar-left-xs confirmation-modal__cancel",onClick:this.props.onCancel},_._("Cancel")))},t.prototype._onToggleConfidentialFolder=function(e){var t=this,n=!e,r=e===this.props.initialIsConfidentialFolder;e||this.setState({isAccepting:!0});var i=this.props,a=i.actionHandler,o=i.contentInfo;l.Snackbar.sync(this.contentGenerator.syncSnackMessage(r),!0);var c=o.isSharedFolder();return a.handleSetConfidential(r).then(function(e){a.fetchDataAndShowShareModal(),r&&m.WebUserActionLog.log(t.props.userId,n?h.WebUserActionLogEvent.CONF_BY_MANAGE_ACCESS:h.WebUserActionLogEvent.CONF_BY_UNDO_AFTER_RESTORE_ACCESS,{ns_id:e.shared_folder_id,original_folder_type:c?h.WebUserActionLogExtraValue.SHARED_FOLDER:h.WebUserActionLogExtraValue.FILE_FOLDER})}).then(function(){var e=t.contentGenerator.completeSnackMessage(r);if(!n)return void l.Snackbar.complete(e);l.Snackbar.show(s.createElement(l.Snackbar,{title:e,timeoutDelayMs:1e4,actionButtonText:_._("Undo"),onActionClick:function(){return t._onToggleConfidentialFolder(!0)},closeButtonText:_._("Close"),variant:"complete"}))}).catch(function(e){return u.handleApiError(e,t.contentGenerator.failSnackMessage(r),function(){return t.setState({isAccepting:!1})})})},t.prototype.render=function(){return s.createElement(o.Modal,{autoClose:!1,buttonComponent:s.createElement("span",null),onDismissCompleted:this.props.onCancel,title:this.contentGenerator.getTitleContent()},this.contentGenerator.getBodyContent(),this.renderButtons())},t})(s.Component);t.SetInheritedMembersUIConfidentialModal=b;var y=(function(e){function t(t){var n=e.call(this,t)||this;n.actionCompleteCallback=function(){var e=n.props.actionHandler;l.Snackbar.complete(n.contentGenerator.getSnackBarCompleteString()),n.setState({removing:!1}),e.fetchDataAndShowShareModal()},n.removeTheSelectedMember=function(){var e=n.props,t=e.member,r=e.actionHandler,s=e.isUserSelf,i=r.getContentInfo().id;return s?r.relinquishMembershipSimple(i,!1):r.removeMemberSimple(i,t.memberId(),!1)},n.changeAccessOfSelectedMember=function(){var e=n.props,t=e.newAccessLevel,r=e.actionHandler,s=e.member,i=t;return r.changeMemberAccessSimple(r.getContentInfo().id,s.memberId(),i)},n.changeConfidentialAccess=function(){var e=n.props,t=e.actionHandler,r=e.userId,s=e.isSharedFolder,i=e.isDowngrading;n.setState({removing:!0});var a=function(){return i?n.changeAccessOfSelectedMember():n.removeTheSelectedMember()};return t.shareIfFileFolder(n.contentGenerator.getSnackBarRemovingString()).then(function(){return t.handleSetConfidential(!0,!0).then(function(){return n.logWebUserAction(r,i,t.getContentInfo().id,s)})}).then(a).then(n.actionCompleteCallback).catch(function(e){return u.handleApiError(e,n.contentGenerator.getSnackBarFailString(),function(){return n.setState({removing:!1})})})},n.state={removing:!1};var r=n.props,s=r.member,i=r.teamName,a=r.parentFolderName,o=r.currentFolderName,c=r.isDowngrading,p=r.isUserSelf;return n.contentGenerator=new u.SingleInheritedUserAccessChangeModalContentGenerator(c,i,a,o,s.displayName()||"",s instanceof d.GroupMembershipInfo,p),n}return n.__extends(t,e),t.prototype.render=function(){return s.createElement(o.Modal,{autoClose:!1,buttonComponent:s.createElement("span",null),title:this.renderTitle()},this.renderBody(),this.renderButtons())},t.prototype.renderTitle=function(){return this.contentGenerator.getConfirmModalTitle()},t.prototype.renderBody=function(){return s.createElement("div",null,s.createElement("div",{className:"confirmation-modal__content"},this.contentGenerator.getConfirmModalContent()),s.createElement("br",null))},t.prototype.renderButtons=function(){return s.createElement("div",{className:"u-l-fr"},s.createElement("button",{className:"c-btn c-btn--primary confirmation-modal__action",disabled:this.state.removing,onClick:this.changeConfidentialAccess},this.contentGenerator.getButtonText()),s.createElement("button",{className:"c-btn c-btn--secondary u-mar-left-xs confirmation-modal__cancel",onClick:this.props.actionHandler.openShareModal},_._("Cancel")))},t.prototype.logWebUserAction=function(e,t,n,r){m.WebUserActionLog.log(e,t?h.WebUserActionLogEvent.CONF_BY_DOWNGRADE_MEMBER:h.WebUserActionLogEvent.CONF_BY_REMOVE_MEMBER,{ns_id:n,original_folder_type:r?h.WebUserActionLogExtraValue.SHARED_FOLDER:h.WebUserActionLogExtraValue.FILE_FOLDER})},t})(s.Component);t.SingleInheritedUserAccessChangeModal=y}),define("modules/clean/sharing/views/inherited_members_helpers",["require","exports","external/react","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/filepath","modules/clean/react_format","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/sharing/constants","modules/core/i18n","modules/core/notify"],function(e,t,n,r,s,i,a,o,l,c,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.handleApiError=function(e,t,n){r.catchApiError(function(){return n&&n(),l.Snackbar.close(),e instanceof r.ServerError?l.Snackbar.fail(t):o.Modal.close(),p.Notify.error(e.message||d._("We were unable to complete your request.")),e})(e)};var u=(function(){function e(e,t,n,r){this.initialIsConfidentialFolder=e,this.teamName=n;var a=i.parent_dir(t);this.folderName=i.filename(t),this.topMostLevelFolder="/"===a,this.parentFolderName=r,this.folderSnippet=s.Emstring.em_snippet(this.folderName,15),this.parentFolderSnippet=s.Emstring.em_snippet(this.parentFolderName,15),this.teamSnippet=s.Emstring.em_snippet(this.teamName,c.SNIPPET_SIZES.DISPLAY_NAME)}return e.prototype.getActionString=function(){var e=s.Emstring.em_snippet(this.teamName,c.SNIPPET_SIZES.DISPLAY_NAME),t=this.topMostLevelFolder?d._("Share with %(team_name)s").format({team_name:e}):d._("Share");return this.initialIsConfidentialFolder?t:d._("Remove")},e.prototype.getTitleContent=function(){return this.initialIsConfidentialFolder?this.topMostLevelFolder?d._("Share “%(folder_name)s” with everyone at %(team_name)s?").format({folder_name:this.folderSnippet,team_name:this.teamSnippet}):d._("Share “%(folder_name)s” with everyone who can access “%(parent_folder_name)s”?").format({folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet}):this.topMostLevelFolder?d._("Remove members of %(team_name)s?").format({team_name:this.teamSnippet}):d._("Remove members of “%(folder_name)s” folder?").format({folder_name:this.parentFolderSnippet})},e.prototype.getBodyContent=function(){var e;return e=this.initialIsConfidentialFolder?this.topMostLevelFolder?a.reactFormat(d._("<strong>%(folder_name)s</strong> won’t be shared privately any more.\n             Everyone at %(team_name)s will have access to this folder.").format({team_name:this.teamSnippet,folder_name:this.folderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}):a.reactFormat(d._("Everyone who can access <strong>%(parent_folder_name)s</strong> will be able to access this folder.").format({parent_folder_name:this.parentFolderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}):this.topMostLevelFolder?a.reactFormat(d._("Members of %(team_name)s won’t be able to access <strong>%(folder_name)s</strong>.").format({team_name:this.teamSnippet,folder_name:this.folderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}):a.reactFormat(d._("Members of <strong>%(parent_folder_name)s</strong> folder won’t be able to access\n             <strong>%(folder_name)s</strong>.").format({parent_folder_name:this.parentFolderSnippet,folder_name:this.folderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}),n.createElement("div",null,n.createElement("div",{className:"confirmation-modal__content"},e),n.createElement("br",null))},e.prototype.syncSnackMessage=function(e){return e?a.reactFormat(d._("Removing members from <strong>%(folder_name)s</strong>…").format({folder_name:this.folderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}):this.topMostLevelFolder?a.reactFormat(d._("Sharing <strong>%(folder_name)s</strong> with everyone…").format({folder_name:this.folderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}):a.reactFormat(d._("Sharing <strong>%(folder_name)s</strong> with members of <strong>%(parent_folder_name)s</strong>…").format({folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})})},e.prototype.completeSnackMessage=function(e){return e?a.reactFormat(d._("Members removed from <strong>%(folder_name)s</strong>.").format({folder_name:this.folderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}):this.topMostLevelFolder?a.reactFormat(d._("<strong>%(folder_name)s</strong> shared with everyone.").format({folder_name:this.folderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})}):a.reactFormat(d._("<strong>%(folder_name)s</strong> shared with members of <strong>%(parent_folder_name)s</strong>.").format({folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet}),{strong:n.createElement("strong",{style:{fontWeight:500}})})},e.prototype.failSnackMessage=function(e){return e?d._("Couldn’t remove members. Try removing them again."):d._("Couldn’t share folder. Try sharing again.")},e})();t.SetInheritedMembersUIConfidentialModalContentGenerator=u;var m=(function(){function e(e,t,r,s,i,o,l){var c=this;this.getButtonText=function(){return c.isDowngrading?d._("Change access"):c.isTsdPlusOne?d._("Remove everyone"):d._("Remove")},this.getConfirmModalTitle=function(){var e={current_folder:c.currentFolderName,parent_folder:c.parentFolderName,team_name:c.teamName,b:n.createElement("b",{style:{fontWeight:500}})},t="";return t=c.isRelinquishment?d._("<b>Remove yourself from “%(parent_folder)s”?</b>"):c.isDowngrading?d._("<b>Change how members can access “%(current_folder)s”?</b>"):c.isTsdPlusOne?d._("<b>Remove everyone at %(team_name)s?</b>"):d._("<b>Remove a member of “%(parent_folder)s”?</b>"),a.reactFormat(t,e)},this.getConfirmModalContent=function(){var e={member_name:c.memberName,parent_folder:c.parentFolderName,current_folder:c.currentFolderName,team_name:c.teamName,b:n.createElement("b",{style:{fontWeight:500}}),br:n.createElement("br",null)},t="";return t=c.isRelinquishment?d._("You won’t be able to see future changes to this shared folder, and new members of <b>%(parent_folder)s</b> won’t have access to this folder automatically."):c.isTsdPlusOne?c.isDowngrading?d._("%(member_name)s will only be able to view this folder, and new %(team_name)s members won’t be able to access it automatically.<br/>To add more people to this folder in the future, you’ll need to invite them directly."):d._("%(team_name)s members won’t be able to see future changes to <b>%(current_folder)s</b> automatically.<br/>To give people access to this folder in the future, you’ll need to invite them directly."):c.isDowngrading?d._("%(member_name)s will only be able to view this folder, and new members of <b>%(parent_folder)s</b> won’t be able to access it automatically.<br/>To add more people to this folder in the future, you’ll need to invite them directly."):d._("%(member_name)s and new members of the <b>%(parent_folder)s</b> folder, won’t be able to see future changes to this shared folder.<br/>To add more people to this folder in the future, you’ll need to invite them directly."),a.reactFormat(t,e)},this.getSnackBarRemovingString=function(){var e={b:n.createElement("b",{style:{fontWeight:500}}),current_folder:c.currentFolderName},t=c.isDowngrading?d._("Changing access for <b>%(current_folder)s</b>…"):c.memberIsGroup?d._("Removing members from <b>%(current_folder)s</b>…"):d._("Removing member from <b>%(current_folder)s</b>…");return a.reactFormat(t,e)},this.getSnackBarCompleteString=function(){var e={b:n.createElement("b",{style:{fontWeight:500}}),current_folder:c.currentFolderName},t=c.isDowngrading?d._("Access changed for <b>%(current_folder)s</b>."):c.memberIsGroup?d._("Members removed from <b>%(current_folder)s</b>."):d._("Member removed from <b>%(current_folder)s</b>.");return a.reactFormat(t,e)},this.getSnackBarFailString=function(){return c.isDowngrading?d._("Couldn’t change access. Try changing access again."):c.memberIsGroup?d._("Couldn’t remove members. Try removing them again."):d._("Couldn’t remove member. Try removing them again.")},this.isDowngrading=e,this.teamName=t,this.parentFolderName=r,this.currentFolderName=s,this.memberName=i,this.isTsdPlusOne=""===r,this.memberIsGroup=o,this.isRelinquishment=l}return e})();t.SingleInheritedUserAccessChangeModalContentGenerator=m}),define("modules/clean/sharing/views/member_list",["require","exports","tslib","external/immutable","external/classnames","external/react","modules/clean/filepath","modules/clean/sharing/access_level","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/views/inherited_members","modules/clean/sharing/views/member_list_item","modules/clean/sharing/views/viewer_info","modules/clean/sharing/ui_util","modules/clean/viewer","modules/core/i18n","modules/clean/sharing/views/wrapped_group_viewers_maker","modules/clean/react/pass/store","modules/constants/sharing"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=_.i18n_default_project("sharing")._,b=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderMembersListItem=function(e,n,r,s){var a=e.memberKey(),l=t.props.groupSeenStateInfo[e.memberId()]?t.renderWrappedGroupViewersElement(e):void 0,d=t.props.canUpdateConfidentiality&&e.is_inherited,u=!!d||t.props.canRelinquishMembership,m=function(n){var s=n===c.MEMBER_ACTION.REMOVE,i=!s&&o.isLowerAccess(e.access_type,n),a=s||i&&e.inherited_access_type&&o.isLowerAccess(e.inherited_access_type,n);if(d&&a){var l=t.props.teamName;return t.props.actionHandler.handleInheritedMemberAccessChange(e,r,l,i,i?n:void 0)}return t.props.actionHandler.handleMemberAccessChange(e,n)};return i.createElement(p.SharingMemberListItem,{canInviteMembers:t.props.canInviteMembers,canMakeViewerNoComment:t.props.canMakeViewerNoComment,canRelinquishMembership:u,contentInfo:t.props.contentInfo,disabled:t.props.disabled,wrappedGroupViewersElement:l,isInheritedMember:s,isMemberActionPending:t.props.pendingMemberAction.has(a),isPresent:t.props.shouldShowPassUI&&t.isMemberCurrentlyViewing(e),key:a,member:e,user:t.props.user,onAccessChangeInBubbleMenu:m,showLinkViewerDisclosure:t.isLinkMember(e,n)})},t}return n.__extends(t,e),t.prototype.render=function(){var e=m.makeMemberSortCmp(this.props.user,this.props.presentAccountIds||r.Set(),this.shouldSortUsingPassRules()),t=this.membersByInheritance(),n=t.get(!1);n&&(n=n.sort(e));var s=t.get(!0);s&&(s=s.sort(e));var a=null;return this.props.areMembersFullyLoaded||(a=i.createElement("div",{className:"sharing-member-list__loading c-loader u-mar-horizontal-auto u-l-b"},E("Loading more members..."))),i.createElement("div",{className:"sharing-member-list"},this.renderInheritedUI(n,s),a)},t.prototype.shouldSortUsingPassRules=function(){var e=g.passStore.getPassPermissions(this.props.contentInfo.extras.fileId);return null!=e&&(e.canReadPresence||e.canReadSeenState)},t.prototype.renderInheritedUI=function(e,t){var n=this,o=null,l=this.props,c=l.actionHandler,p=l.user,u=l.isConfidentialFolder,m=l.linkMembers,h=l.teamName,_=r.Set(m);!p.is_cdm_member||u||a.inSubDirectory(this.props.user.cdm_tmf_path,this.props.contentInfo.displayPath())||(o=i.createElement(d.InheritedMembers,{canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,memberCounts:this.props.memberCounts,members:t?t.toArray():[],onToggleInheritanceClick:function(){return c.handleSetConfidentialClick(u,h)},teamName:h},t?t.map(function(e){return n.renderMembersListItem(e,_,t,!0)}):null));var f=s({"u-pad-horizontal-s":!S.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL}),g=null;e&&e.count()>0&&(g=i.createElement("div",{className:f
},e.map(function(e){return n.renderMembersListItem(e,_)}).toArray()));var E=s({"o-list-ui":!0,"u-trim-margin":!S.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL,"u-pad-horizontal-xs":!S.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL});return i.createElement("ul",{className:E},o,g)},t.prototype.isLinkMember=function(e,t){return e instanceof l.UserMembershipInfo&&t.contains(e)},t.prototype.isMemberCurrentlyViewing=function(e){return!this.memberIsAssumed(e)&&(e instanceof l.UserMembershipInfo&&this.props.presentAccountIds&&this.props.presentAccountIds.has(e.account_id))},t.prototype.memberIsAssumed=function(e){return e instanceof l.UserMembershipInfo&&e.account_id===this.props.user.account_id&&h.Viewer.get_viewer().is_assume_user_session},t.prototype.membersByInheritance=function(){var e=this,t=function(t){return e.shouldSortByInherited()&&t.is_inherited},n=this.props,s=n.membership,i=n.linkMembers,a=n.guestMembers;if(!s)return i.length>0||a.length>0?r.List(i).concat(a).groupBy(t):r.Map();var o=s.groups,l=s.invitees,c=s.users;return o.valueSeq().concat(l.valueSeq(),c.valueSeq(),i,a).groupBy(t)},t.prototype.shouldSortByInherited=function(){return this.props.user.is_cdm_member&&!a.inSubDirectory(this.props.user.cdm_tmf_path,this.props.contentInfo.displayPath())},t.prototype.extractGroupSeenStateAndViewers=function(e){var t=this,n=this.props.groupSeenStateInfo[e.memberId()],r=[];return this.props.presentAccountIds&&(r=n.map(function(e){return new u.ViewerInfo(e)}).filter(function(e){return null!=e.time_last_seen||t.props.presentAccountIds.has(e.account_id)})),{singleGroupSeenStateInfo:n,viewers:r}},t.prototype.renderWrappedGroupViewersElement=function(e){var t=this.extractGroupSeenStateAndViewers(e).viewers;return t.length?f.WrappedGroupViewersMaker.make(t,this.props.presentAccountIds):{element:null,elementText:""}},t.displayName="SharingMemberList",t.defaultProps={disabled:!1,groupSeenStateInfo:{},guestMembers:[],linkMembers:[]},t})(i.Component);t.SharingMemberList=b}),define("modules/clean/sharing/views/member_list_item",["require","exports","tslib","external/classnames","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/size","modules/clean/datetime","modules/clean/em_string","modules/clean/previews/util","modules/clean/react/pass/utils","modules/clean/react/title_bubble","modules/clean/sharing/share_modal_dropdown_util","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/sharing/views/viewer_info","modules/clean/static_urls","modules/core/i18n","modules/core/user_i18n","modules/constants/sharing","spectrum-sharing/member_row","modules/clean/sharing/strings","modules/clean/sharing/constants"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var M=E.i18n_default_project("sharing"),N=M._,T=M.ungettext,A=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMemberRowChange=function(e,n){t.props.onAccessChangeInBubbleMenu(n)},t}return n.__extends(t,e),t.prototype.shouldLinkToGroup=function(){return this.props.member instanceof h.GroupMembershipInfo&&(!!this.props.member.same_team&&(!!this.props.user.is_team_admin||!!this.props.member.is_member&&this.props.member.group_management_type!==h.GroupManagementType.system_managed))},t.prototype.linkToGroup=function(e,t,n){var i="/team#groups/%(id)s".format({id:e.group_id}),a=r({"u-font-meta":!n,"sharing-member-info__group-name-link":!0,"sharing-member-info__display-name-title":n});return s.createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:a,title:e.group_name},t)},t.prototype.renderAvatar=function(e,t){var n=this.props.member.displayName()||"",r=this.getAvatarInitials(),l=t?"SQUARE":"CIRCLE",c=p.AnonymousViewerUtils.isAnonymousUserId(this.props.member.memberId())?this.props.member.memberId():n;return s.createElement("div",{className:"o-flag__fix"},s.createElement(i,{dimension:o.AVATAR_DIMENSION_BY_SIZE.MEDIUM,photoUrl:e,shape:l,defaultAvatar:s.createElement(a.InitialsAvatarWithColorDerivedFromName,{dimension:o.AVATAR_DIMENSION_BY_SIZE.MEDIUM,shape:l,initials:r,name:c,alt:""})}))},t.prototype.renderNameTitleAndText=function(e,t,n){return e?this.shouldLinkToGroup()&&!this.shouldRenderGroupCount()?this.linkToGroup(this.props.member,n,!0):s.createElement("span",{className:"sharing-member-info__display-name-title",title:t},n):null},t.prototype.renderDisabledMessage=function(e){return e?[s.createElement("span",{className:"u-font-meta dot"},"·"),s.createElement("span",{className:"u-font-danger"}," ",e)]:null},t.prototype.renderSeenState=function(e){if(e){var t=r({"u-font-meta":!0,"sharing-member-info__last-seen-text":!0,"sharing-member-info__last-seen-text--not-present":!this.props.isPresent});return[s.createElement("span",{className:"u-font-meta dot"},"·"),s.createElement("span",{className:t},e)]}return null},t.prototype.renderOffTeamMessage=function(e){return e?s.createElement("span",{className:"u-font-meta"},e):null},t.prototype.getDisplayName=function(){var e;return this.props.member.displayName()&&(e=this.props.member.displayName()),e=void 0!==e?e:""},t.prototype.getAvatarInitials=function(){var e,t=this.props.member.displayName()||"";return this.props.member instanceof g.ViewerInfo||(e=this.props.member.initials),e=e||b.getInitials(t)},t.prototype.getPresentText=function(){return N("Viewing now")},t.prototype.getLastSeenText=function(e){var t="";return e&&(t=N("Viewed %(time_str)s").format({time_str:l.ago(e,!1,!0,!0)})),t},t.prototype.getDisabledMessage=function(e){var t="";return e&&e.disabled&&(t=N("Deleted")),t},t.prototype.getOffTeamMessage=function(e){var t="",n=e&&!e.email;return!this.props.user.is_team||this.props.member.same_team||n||(t=N("Outside your Dropbox team")),t},t.prototype.getMemberDetails=function(e,t){var n="";return e?n=e:t&&t.email&&t.email_verified&&(n=t.email),n},t.prototype.isAllowedToRelinquishMembership=function(){return this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership},t.prototype.getOptionGroup=function(){if(!(this.props.member instanceof g.ViewerInfo)){for(var e=[],t="",n=I.ACCESS_NAME[this.props.member.access_type],r=m.getMemberActionInfo(this.isAllowedToRelinquishMembership(),this.props.canMakeViewerNoComment),s=0,i=r;s<i.length;s++){var a=i[s],o=a[0],l=a[1];this.props.member.access_type===l.value&&(t=l.value);var c=this.getOptionGroupOption(o,l);c&&e.push(c)}return{id:"optionGroup%s".format(this.props.member.memberId()),label:n,options:e,selectedApiId:t,enabled:!this.props.isMemberActionPending}}},t.prototype.getOptionGroupOption=function(e,t){if(!(this.props.member instanceof g.ViewerInfo)&&m.shouldShowMemberAction(e,t.value,this.props.member.access_type,this.props.member.permissions,this.isAllowedToRelinquishMembership())){var n="";return n=this.props.contentInfo&&this.props.contentInfo.isFolder()?t.folder_description?t.folder_description:"":t.file_description?t.file_description:"",t.value===C.MEMBER_ACTION.REMOVE?{apiId:t.value,label:t.title,tooltip:n,variant:"red"}:{apiId:t.value,label:t.title,tooltip:n}}},t.prototype.renderDisplayName=function(e,t,n){var i=this.props.member.displayName(),a="",o=null;if(this.props.wrappedGroupViewersElement)a=this.props.wrappedGroupViewersElement.elementText,o=this.props.wrappedGroupViewersElement.element;else if(this.props.isPresent)a=o=this.getPresentText();else if(t){a=this.getLastSeenText(t);var l=void 0,m=void 0;d.shouldShowPlatformInfo()?(l=t.toLocaleString(void 0,{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"}),m=p.getOnPlatformText(n)):(l=t.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"}),m=t.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"})),o=s.createElement(u.TitleBubble,{content:s.createElement("div",null,l,m&&s.createElement("br",null),m),className:"timestamp-tooltip",children:s.createElement("span",null,a),position:u.TitleBubble.POSITIONS.BOTTOM,isTargetPositionFixed:!0})}var h="";e&&e.disabled&&(h=N("Deleted"));var f=0,g=0;if(i){a&&(f=new c.Emstring("  ·  %s".format(a)).length),h&&(g=new c.Emstring("  ·  %s".format(h)).length);var S=_.SNIPPET_SIZES.DISPLAY_NAME-f-g,E=c.Emstring.em_snippet(i,S),b="";E!==i&&(b=i);var y=r({"u-font-meta":this.props.isMemberActionPending,"u-font-strong":!0,"u-ellip":!0,"sharing-member-info__display-name":!0});return s.createElement("div",{className:y},this.renderNameTitleAndText(i,b,E),this.renderDisabledMessage(h),this.renderSeenState(o))}},t.prototype.renderMemberDetails=function(e,t){var n=this.getOffTeamMessage(t),r=0;""!==n&&(r=new c.Emstring("  ·  %s".format(n)).length);var i;if(e)i=this.shouldLinkToGroup()?this.linkToGroup(this.props.member,e,!1):e;else if(t&&t.email&&t.email_verified){var a=_.SNIPPET_SIZES.EMAIL-r,o=c.Emstring.em_snippet(t.email,a),l="";o!==t.email&&(l=t.email),i=s.createElement("span",{title:l},o)}var d;return n&&i&&(d=s.createElement("span",{className:"u-font-meta dot"},"·")),s.createElement("div",{className:"u-font-meta u-ellip sharing-member-info__details"},i,d,this.renderOffTeamMessage(n))},t.prototype.renderSharingBubbleMenu=function(){var e;if(this.props.isMemberActionPending)e=s.createElement("img",{src:S.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:N("Changing access")});else if(this.props.isViewOnly||this.props.member instanceof g.ViewerInfo)e=s.createElement("span",null);else{var t=this.props.member.permissions.get("make_viewer_no_comment"),n=t&&t.allow&&this.props.canMakeViewerNoComment,r=this.props.member.permissions.set("make_viewer_no_comment",new h.PermissionSetting({allow:n})),i=this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership;e=s.createElement(f.SharingBubbleMenu,{allowRelinquishMembership:i,canInviteMembers:this.props.canInviteMembers,canMakeViewerNoComment:n,contentInfo:this.props.contentInfo,currentAccess:this.props.member.access_type,disabled:this.props.disabled,isInherited:this.props.member.is_inherited,memberPermissions:r,onAccessChange:this.props.onAccessChangeInBubbleMenu,pendingAccessChange:this.props.pendingAccessChange,showLinkViewerDisclosure:this.props.showLinkViewerDisclosure,memberDisplayName:this.props.member.displayName()})}return s.createElement("div",{className:"o-flag__fix"},e)},t.prototype.shouldRenderGroupCount=function(){return this.props.member instanceof h.GroupMembershipInfo&&this.props.member.member_count},t.prototype.render=function(){var e,t,n=void 0,i=!1,a=null,o=void 0,l="",c=this.props.member;if(c instanceof h.UserMembershipInfo){if(l=c.account_id,n=c.account,!n)return null;a=n.profile_photo_url||null,t=c.platform_type,e=c.time_last_seen}else c instanceof h.GroupMembershipInfo?(l=c.group_id,i=!0,"team"===c.group_type&&(a=S.static_url("/static/images/icons/team_24@2x-vflR8kGKs.png")),this.shouldRenderGroupCount()&&(o=T("%(member_num)s member","%(member_num)s members",c.member_count).format({member_num:c.member_count}))):c instanceof g.ViewerInfo&&(l=c.account_id,n={email:c.email,email_verified:!!c.email},a=c.photo_circle_url,e=c.time_last_seen);var d=r({"sharing-member-info":!0,"o-flag":!0,"u-pad-right-m":!this.props.isViewOnly});return y.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL?s.createElement(v.MemberRow,{id:l,avatarUrl:null!=a?a:"",avatarElement:this.renderAvatar(a,i),initialAvatarShape:i?"square":"circle",displayName:this.getDisplayName(),disabledMessage:this.getDisabledMessage(n),description:this.getMemberDetails(o,n),passString:this.props.isPresent?this.getPresentText():this.getLastSeenText(e),offTeamMessage:this.getOffTeamMessage(n),present:this.props.isPresent,initials:this.getAvatarInitials(),loadingSpinnerVisible:this.props.isMemberActionPending,optionGroup:this.getOptionGroup(),onChange:this.onMemberRowChange,variant:this.props.isInheritedMember?"borderless":"default"}):s.createElement("li",{className:"sharing-member-list__item o-flag"},s.createElement("div",{className:"o-flag__flex"},s.createElement("div",{className:d},this.renderAvatar(a,i),s.createElement("div",{className:"sharing-member-info__contact o-flag__flex"},this.renderDisplayName(n,e,t),this.renderMemberDetails(o,n)))),this.renderSharingBubbleMenu())},t.displayName="SharingMemberListItem",t.defaultProps={canInviteMembers:!1,canMakeViewerNoComment:!1,canRelinquishMembership:!1,disabled:!1,isPresent:!1,isViewOnly:!1},t})(s.Component);t.SharingMemberListItem=A}),define("modules/clean/sharing/views/modal_content",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/contacts/util","modules/clean/em_string","modules/clean/filepath","modules/clean/react/bubble","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/icon/folder_icon","modules/clean/react/image","modules/clean/react/pass/constants","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/share_modal_icon","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/hover_close_button","modules/clean/sharing/views/member_list","modules/clean/sharing/views/modal_link_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/sharing/views/share_modal_banner_section","modules/clean/static_urls","modules/clean/web_timing_logger","modules/constants/sharing","modules/core/i18n","modules/clean/react/async/loadable"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I,C,M,N,T,A,w,k,L,P,F,R,O,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MODES=N.MODES;var D=x.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/sharing/views/exp_showcase_share_link_upsell"],t,n)}).then(function(e){return e.ShowcaseShareLinkUpsell})}}),U=s.createElement,B=O.i18n_default_project("sharing"),H=B._,V=B.ungettext,G=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handleContentNameChange=function(e){t.props.actionHandler.handleContentNameChange(e.currentTarget.value)},t._handleContentNameFocus=function(){t.props.actionHandler.handleContentNameFocusChange(!0)},t._handleContentNameBlur=function(){t.props.actionHandler.handleContentNameFocusChange(!1)},t._handleContentNameInputKeyUp=function(e){if(13===e.keyCode&&null!=t.contactsTokenizer&&null!=t.contactsTokenizer.refs.tokenizer){var n=t.contactsTokenizer.refs.tokenizer;n.refs.input&&i.findDOMNode(n).focus()}},t._renderIcon=function(){if(t.props.contentInfo.isFolder()){if(!t.props.contentInfo.extras.exists)return U(_.SharedFolderIcon,{});if(!t.props.isMetadataLoaded)return U(_.SimpleFolderIcon,{})}return U(C.ShareModalIcon,{alt:"",className:"unified-share-modal__title-icon",isTeamSharedFolder:t.props.isTeamSharedFolder,isFolder:t.props.contentInfo.isFolder(),isSharedFolder:t.props.contentInfo.isSharedFolder(),pathExists:t.props.contentInfo.pathExists(),filename:t.props.contentInfo.name(),isFolderInsideTeamFolderTree:t.props.isFolderInsideTeamFolderTree,isViewOnly:!t.props.canEdit,isConfidentialFolder:t.props.isInContentManager&&t.props.isConfidentialFolder,isCdm:t.props.user.is_cdm_member})},t._onShareButtonClick=function(){t.props.actionHandler.handleShareClick(t.contactsTokenizer).catch(function(){return i.findDOMNode(t.refs.contentNameInput).select()})},t._addEveryoneGroup=function(){return null!=t.contactsTokenizer?t.contactsTokenizer.addExternalContacts([c.teamGroupInfoToContact(t.props.teamGroupInfo)]):void 0},t._setContactsTokenizerRef=function(e){t.contactsTokenizer=e},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(this.logTTI(),this.refs.contentNameInput)return i.findDOMNode(this.refs.contentNameInput).focus()},t.prototype.componentDidUpdate=function(e,t){return this.logTTI()},t.prototype.logTTI=function(){return"GRANT_ACCESS"===this.props.contentInfo.extras.origin&&this.props.isMetadataLoaded&&F.mark_time_to_interactive(),this.props.mode===N.MODES.LINK_ONLY&&this.props.isLinkMetadataLoaded?this.props.actionHandler.logIfHaventBefore("VIEW_LINK_ONLY_MODAL"):this.props.isMetadataLoaded&&(this.props.actionHandler.logIfHaventBefore("VIEW_SHARE_MODAL"),!this._shouldRenderMainLoading())?this.props.actionHandler.logIfHaventBefore("MEMBER_LIST_LOADED",{member_count:this._getMemberNum()}):void 0},t.prototype.render=function(){return a.div({className:"unified-share-modal unified-share-modal--"+this.props.mode},this._renderHeaderSection(),this._renderToSection(),this._renderErrorMessageSection(),this._renderConfidentialFolderSection(),this._renderMainSection(),this._renderFooterSection())},t.prototype._renderHeaderSection=function(){var e=this,t=this._getMemberNum(),n=this.props.user.is_team&&(null!=this.props.memberCounts?this.props.memberCounts.users_outside_team:0)>0&&null!=this.props.ownerTeam?V("%(outside_team_count)s outside your Dropbox team","%(outside_team_count)s outside your Dropbox team",this.props.memberCounts.users_outside_team).format({outside_team_count:this.props.memberCounts.users_outside_team}):void 0,s=t?n?V("%(member_num)s member (%(outside_team_string)s)","%(member_num)s members (%(outside_team_string)s)",t,{comment:'Description of the count of total folder members and count of outside-of-team folder members, like "10 members (3 outside of your Dropbox team)"'}):V("%(member_num)s member","%(member_num)s members",t):"";s=s.format({member_num:t+((null!=this.props.memberCounts?this.props.memberCounts.exceeds_count:void 0)?"+":""),outside_team_string:n});var i=this._renderIcon();return a.div({className:"unified-share-modal__section unified-share-modal__section--header"},i,a.div({className:r("unified-share-modal__title",t?"unified-share-modal__title--member-count":void 0)},this.props.contentInfo.pathExists()?a.h3({className:"u-font-strong",id:this.props.headerId},d.Emstring.em_snippet(this.props.contentInfo.name(),I.SNIPPET_SIZES.FILENAME)):this._renderContentNameInput(),t?a.h4({className:"u-trim-margin u-font-meta"},s):void 0),R.TRUELINK.TRUELINK_UI[this.props.user.id]?this._renderContentSettings():void 0,a.div({className:"unified-share-modal__close"},U(T,{className:"u-mar-left-s",onClick:function(){return e.props.actionHandler.onClickX(e.contactsTokenizer)}})))},t.prototype._renderContentNameInput=function(){return s.createElement("div",{className:"unified-share-modal__content-name"},null==this.props.contentNameMessage||!this.props.isContentNameFocused&&this.props.contentNameMessageLevel!==N.CONTENT_NAME_MESSAGE_LEVELS.ERROR?void 0:s.createElement(u,{arrow:u.ARROW.TOP,className:r({"unified-share-modal__content-name__tooltip":!0,"unified-share-modal__content-name__tooltip-error":this.props.contentNameMessageLevel===N.CONTENT_NAME_MESSAGE_LEVELS.ERROR,"u-font-strong":!0})},s.createElement("div",{className:r(["u-pad-top-xxs","u-pad-bottom-xxs","u-pad-left-xs","u-pad-right-xs"])},this.props.contentNameMessage)),s.createElement("input",{className:r(["u-trim-padding","u-trim-margin","u-l-ib","u-font-strong"]),id:this.props.headerId,ref:"contentNameInput",onChange:this._handleContentNameChange,onFocus:this._handleContentNameFocus,onBlur:this._handleContentNameBlur,onKeyUp:this._handleContentNameInputKeyUp,placeholder:this.props.isContentNameFocused?void 0:H("Folder name"),defaultValue:this.props.initialContentName,"aria-label":this.props.contentNameMessage?this.props.contentNameMessage:H("Folder name")}))},t.prototype._renderToSection=function(){var e=this;if(this.props.linkOnlyReason===N.LINK_ONLY_REASON.LINKS_PAGE)return null;if(this.props.mode===N.MODES.LINK_ONLY)return this._renderNoPermissionSection();if(!this.props.isMetadataLoaded)return a.div({className:"unified-share-modal__section unified-share-modal__section--to"},a.div({className:"unified-share-modal__to-placeholder"}," "));if(this.props.showContentManagerBridge)return this._renderContentManagerBridge();if(!this.props.canInviteEditor&&!this.props.canInviteViewer)return this._renderNoPermissionSection();if(M.shouldEnforceMemberLimits(this.props.user,this.props.isTeamSharedFolder,this.props.isFolderInsideTeamFolderTree)&&(null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:0)>=M.GoldenGate.SHARING_TOTAL_LIMIT)return this._renderOverLimitSection();var t=this.props.contentInfo.isFile()&&!this.props.canInviteEditor&&!this.props.canInviteViewerNoComment;return a.div({className:"unified-share-modal__section unified-share-modal__section--to"},a.div({className:"o-flag"},a.label({className:"o-flag__fix u-font-strong",htmlFor:"unified-share-modal-contacts-tokenizer"},this.props.isTeamSharedFolder?H("Add groups:",{comment:"Label for with whom to share"}):H("To:",{comment:"Label for with whom to share"})),a.div({className:"unified-share-modal__to-input-box o-flag__flex"},U(o.ContactsTokenizer,{ref:this._setContactsTokenizerRef,context:"tiburon",excludeDomainContacts:!1,customContactFilter:this.props.isTeamSharedFolder?function(e){return e.type!==l.FB&&e.group_id}:this.props.isInContentManager?function(e){return e.type!==l.FB}:function(t){return t.type!==l.FB&&t.email!==e.props.user.email},focusOnMount:this.props.contentInfo.pathExists(),id:"unified-share-modal-contacts-tokenizer",onContentsChange:this.props.actionHandler.recipientsChange,populatedInputData:{tokens:this.props.initialRecipientTokens,value:this.props.initialRecipientRawInput},customContactValidator:function(t){return M.validateContact(t,e.props.user,e.props.ownerTeam,e.props.folderPolicy,e.props.isTeamSharedFolder,e.props.isFolderInsideTeamFolderTree,e.props.memberCountWithRecipients)},placeholder:H(this.props.isTeamSharedFolder?"Group names":this.props.user.is_team?"Email, name, or group":"Email or name"),shouldLogContactSearch:!0,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.isTeamSharedFolder?this.props.teamGroupInfo:null,user:this.props.user})),a.div({className:r({"o-flag__fix":!0})},t?U(b.Tooltip,{position:b.TooltipPosition.BOTTOM,tooltip_contents:H("Only folders can be shared with edit access"),tooltip_classname:"sharing-access-menu__tooltip"},a.span({className:"ax-visually-hidden"},H("Only folders can be shared with edit access")),this._renderToSectionAccessDropdown()):this._renderToSectionAccessDropdown())))},t.prototype._renderToSectionAccessDropdown=function(){return U(k.SharingBubbleMenu,{asButton:!0,canMakeViewerNoComment:this.props.canMakeViewerNoComment,contentInfo:this.props.contentInfo,currentAccess:this.props.recipientAccess,disabled:this.props.showContentManagerBridge,memberPermissions:new v.MemberPermissions({make_editor:new v.PermissionSetting({allow:this.props.canInviteEditor}),make_viewer:new v.PermissionSetting({allow:this.props.canInviteViewer}),make_viewer_no_comment:new v.PermissionSetting({allow:this.props.canInviteViewerNoComment})}),onAccessChange:this.props.actionHandler.changeRecipientAccess,showLinkViewerDisclosure:!1})},t.prototype._shouldRenderContentSettingsShareButton=function(){return this.props.isMetadataLoaded&&this.props.mode!==N.MODES.LINK_ONLY&&(this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||[N.MODES.SHARE,N.MODES.SHARE_SENDING].includes(this.props.mode)||this.props.isInContentManager)},t.prototype._shouldRenderFooterSection=function(){return this._renderLinkRowInFooter()?this.props.canShareLink:this._shouldRenderContentSettingsShareButton()},t.prototype._renderFooterSection=function(){if(this._shouldRenderFooterSection())return a.div({className:"unified-share-modal__section unified-share-modal__section--footer clearfix"},this._renderLinkRowInFooter()?this._renderLinkRowContent():this._renderContentSettingsShareButton())},t.prototype._renderContentSettingsShareButton=function(){var e=this;if(this._shouldRenderContentSettingsShareButton())return a.div({},R.TRUELINK.TRUELINK_UI[this.props.user.id]?void 0:a.div({className:"u-l-fl"},this._renderContentSettings()),a.div({className:"u-l-fr"},(function(){var t;switch(e.props.mode){case N.MODES.SHARE:t=H(e.props.isTeamSharedFolder?"Add":"Share");var n=e.props.isTokenizerEmpty||e.props.contactsError.level===M.ContactsErrorLevel.Error||null!=e.props.contentNameMessage;return e._renderShareButton(n,t);case N.MODES.SHARE_SENDING:return t=H(e.props.isTeamSharedFolder?"Adding...":"Sharing..."),e._renderShareButton(!0,t);case N.MODES.MEMBERSHIP:return e.props.isInContentManager&&!e.props.contentInfo.pathExists()?(t=H(e.props.isTeamSharedFolder?"Add":"Share"),e._renderShareButton(!1,t)):null;default:return null}})()))},t.prototype._renderShareButton=function(e,t){return s.createElement("button",{className:"unified-share-modal__share-send c-btn c-btn--primary",disabled:e,onClick:this._onShareButtonClick},t)},t.prototype._renderContentSettings=function(){var e=this;if(this.props.isMetadataLoaded)return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings?a.button({"aria-label":H("Settings"),className:"unified-share-modal__settings u-font-meta c-borderless-button",disabled:this.props.mode===N.MODES.SHARE_SENDING,onClick:function(){return e.props.onSettingsClick()}},U(E.Sprite,{alt:"",className:"u-mar-right-xs u-l-ib u-l-ib--m",group:"web",name:"settings"}),R.TRUELINK.TRUELINK_UI[this.props.user.id]?void 0:H(this.props.contentInfo.isFile()?"File settings":"Folder settings")):void 0},t.prototype._renderErrorMessageSection=function(){var e=this.props.contactsError,t=e.level,n=e.message;if(!n)return null;var r=t===M.ContactsErrorLevel.Error?"error":"default";return s.createElement(L.ShareModalBannerSection,{type:r,message:n})},t.prototype._shouldRenderMainLoading=function(){var e=this.props.isMetadataLoaded,t=this.props.hasNonOwnerMembers||this.props.areMembersFullyLoaded,n=!this.props.isPassEnabled||this._isPassInfoLoaded(),r=this.props.shouldBlockMemberListOnPassLoad&&!n;return!e||!t||r},t.prototype._renderMainSection=function(){if(this.props.mode===N.MODES.LINK_ONLY)return this._renderMainLinkOnly();if(this._shouldRenderMainLoading())return this._renderMainLoading();switch(this.props.mode){case N.MODES.MEMBERSHIP:return this._renderMainMembership();case N.MODES.SHARE:case N.MODES.SHARE_SENDING:return this._renderMainShare();default:return null}},t.prototype._renderNoPermissionSection=function(){var e=this.props.mode===N.MODES.LINK_ONLY?this.props.contentInfo.isOSXPackage()?H(R.TRUELINK.TRUELINK_UI[this.props.user.id]?"Package files can’t be shared.":"This package file can only be shared as a link."):this.props.linkOnlyReason===N.LINK_ONLY_REASON.INSIDE_SHARED_FOLDER?R.TRUELINK.TRUELINK_UI[this.props.user.id]?H("You don’t have permission to share this folder."):a.span({},H("This folder can only be shared as a link because it’s in a shared folder.")+" ",a.a({href:"/help/1931",target:"_blank"},H("Learn more"))):R.TRUELINK.TRUELINK_UI[this.props.user.id]?H("This folder can’t be shared"):this.props.linkOnlyReason===N.LINK_ONLY_REASON.CONTAINS_SHARED_FOLDER?a.span({},H("This folder can only be shared as a link because it contains a shared folder.")+" ",a.a({href:"/help/1931",target:"_blank"},H("Learn more"))):H("This folder can only be shared as a link."):this.props.isTeamSharedFolder&&this._shouldRenderTeamFolderNoPermissionMessage(this.props.members)?H("This folder is automatically shared with all members of %(team_name)s").format({team_name:this.props.ownerTeam.name}):this.props.isTeamSharedFolder?y.reactFormat(H("Only <admin_link>admins</admin_link> and <group_link>group managers</group_link> can change team folder membership."),{admin_link:a.a({href:"/team?_tk=left_nav_team",target:"_blank"}),group_link:a.a({href:"/help/7232#transfer",target:"_blank"})}):H(this.props.contentInfo.isFolder()?R.TRUELINK.TRUELINK_UI[this.props.user.id]&&(null!=this.props.permissions?this.props.permissions.change_options.allow:void 0)?"To add new members, you’ll need to add them to the parent folder.":"You don’t have permission to manage membership of this folder":"You don’t have permission to manage membership of this file");return s.createElement(L.ShareModalBannerSection,{message:e})},t.prototype._renderConfidentialFolderSection=function(){var e=this.props,t=e.ownerTeam,n=e.isConfidentialFolder,r=e.actionHandler,i=e.canUpdateConfidentiality;if(n&&i){var o=t?t.name:"",l=a.div({},y.reactFormat(H("<b>Invite only.</b> Members of parent folders can’t access."),{b:a.b()}),this.props.contentInfo.pathExists()?[" ",a.a({onClick:function(){return r.handleSetConfidentialClick(Boolean(n),o)}},H("Restore access"))]:void 0);return s.createElement(L.ShareModalBannerSection,{type:"dark",message:l})}},t.prototype._renderContentManagerBridge=function(){var e=p.parent_dir(this.props.contentInfo.displayPath()),t=this.props.contentInfo.name(),n=M.genContentManagerBridgeUri({containingFolder:e,filenameToSelect:t}),r=s.createElement("span",null,H("You can manage folder membership in the Admin Console.")," ",s.createElement("a",{href:n.toString(),target:"_blank",rel:"noopener"},H("Open in a new tab.")));return s.createElement(L.ShareModalBannerSection,{message:r})},t.prototype._renderOverLimitSection=function(){var e=H("This folder is over its %(member_limit)s-member limit.",{comment:"member limit is a number greater than 200"}).format({member_limit:M.GoldenGate.SHARING_TOTAL_LIMIT}),t=s.createElement("div",null,s.createElement("div",null,e),s.createElement("div",null,H("Please remove some members.")," ",s.createElement("a",{href:"/help/9292",target:"_blank",rel:"noopener"},H("Learn more."))));return s.createElement(L.ShareModalBannerSection,{message:t})},t.prototype._shouldRenderTeamFolderNoPermissionMessage=function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return"team"===e.group_type&&(null!=e.permissions.make_editor?e.permissions.make_editor.allow:void 0)&&(null!=e.permissions.make_viewer?e.permissions.make_viewer.allow:void 0)})},t.prototype._isOwnerOfAtLeastOneGroup=function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return e.is_owner})},t.prototype._renderMainLoading=function(){return a.div({className:r(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),a.div({className:"u-font-center u-font-meta u-pad-top-xl"},a.div({className:"c-loader"},H("Loading..."))))},t.prototype._renderMainLinkOnly=function(){return R.TRUELINK.TRUELINK_UI[this.props.user.id]&&this.props.linkOnlyReason!==N.LINK_ONLY_REASON.LINKS_PAGE?null:a.div({className:r(["unified-share-modal__main","unified-share-modal__main--link-only","unified-share-modal__section",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow())},t.prototype._showSharingMemberList=function(){return!!this.props.hasNonOwnerMembers||(this.props.isFolderInsideTeamFolderTree?1===this.props.members.users.size||!this.props.isConfidentialFolder&&this.props.user.is_cdm_member:this.props.guestMembers.length>0||this.props.linkMembers.length>0)},t.prototype._canShowShowcaseUpsell=function(){return!this._showSharingMemberList()&&(this.props.hasCreatedShareLink||!!this.props.linkMetadata)},t.prototype._renderMainMembership=function(){var e=this;return a.div({className:r(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow(),this._showSharingMemberList()?U(A.SharingMemberList,{actionHandler:this.props.actionHandler,areMembersFullyLoaded:this.props.areMembersFullyLoaded,
canInviteMembers:this.props.canInviteEditor||this.props.canInviteViewer,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,disabled:this.props.showContentManagerBridge,guestMembers:this.props.guestMembers,groupSeenStateInfo:this.props.groupSeenStateInfo,isConfidentialFolder:this.props.isConfidentialFolder,linkMembers:this.props.linkMembers,memberCounts:this.props.memberCounts,membership:this.props.members,pendingMemberAction:this.props.pendingMemberAction,presentAccountIds:this.props.presentAccountIds,shouldShowPassUI:this.props.isPassEnabled&&g.fetchingStatusIsSuccessful(this.props.passFetchingStatus),teamName:null!=this.props.ownerTeam?this.props.ownerTeam.name:void 0,user:this.props.user,viewer:this.props.viewer}):this.props.banner===N.BANNERS.INPUT_CONTENT_NAME?a.div({className:r(["unified-share-modal__input-content-name-banner","u-font-center","u-font-meta","u-mar-top-xs"])},U(f.Image,{src:P.static_url("/static/images/sharing/illo-name-folder-vfl38PzAv.png"),srcHiRes:P.static_url("/static/images/sharing/illo-name-folder@2x-vflzK0uJv.png")}),a.h3({className:r(["u-font-strong","u-mar-top-xs"])},H("Name your shared folder")),a.p({className:r(["u-pad-left-xxl","u-pad-right-xxl"])},H("Shared folders are for collaborting on projects, client works, and organizing departments"))):a.div({className:r({"unified-share-modal__no-members-banner":!this._canShowShowcaseUpsell()},["u-font-center","u-font-meta"])},(function(){return e.props.isTeamSharedFolder?null!=e.props.teamGroupInfo?[a.p({className:"u-mar-top-xxl"},a.a({onClick:e._addEveryoneGroup},H("Add everyone at %(team_name)s").format({team_name:e.props.ownerTeam.name}))),a.p({},H("Or, add groups to this team folder.")+" ",a.a({href:"/team#groups/newgroup"},H("Create a group")))]:a.p({className:"u-mar-top-xxl"},H("Add groups to this team folder.")+" ",a.a({href:"/team#groups/newgroup"},H("Create a group"))):R.TRUELINK.TRUELINK_UI[e.props.user.id]?a.div({},U(f.Image,{className:"unified-share-modal__illo",src:P.static_url("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:P.static_url("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),a.p({className:"u-mar-top-s"},H("Add people you want to share with"))):e._canShowShowcaseUpsell()?s.createElement(D,{user:e.props.user,hasFooter:e._shouldRenderFooterSection()}):a.div({})})()))},t.prototype._renderMainShare=function(){var e=this;return a.div({className:"unified-share-modal__main unified-share-modal__section u-pad-horizontal-m"},this.props.isTeamSharedFolder?void 0:a.textarea({placeholder:H("Add a message (optional)"),onChange:function(t){return e.props.actionHandler.changeRecipientMessage(t.target.value)},value:this.props.recipientMessage}))},t.prototype._renderLinkRow=function(){return this._renderLinkRowInFooter()?void 0:this._renderLinkRowContent()},t.prototype._renderLinkRowContent=function(){if(!this.props.isInContentManager||R.TRUELINK.TRUELINK_UI[this.props.user.id]){return!this.props.contentInfo.isMounted()&&this.props.isPassEnabled&&this._isPassInfoLoaded()&&this.props.isMetadataLoaded||this.props.isLinkMetadataLoaded&&(this.props.isMetadataLoaded||this.props.mode===N.MODES.LINK_ONLY)?a.div({className:"unified-share-modal__link-info"},U(w.ModalLinkInfo,{actionHandler:this.props.actionHandler,linkabilityState:this.props.isTeamSharedFolder?w.LinkabilityStates.CANT_LINK_TEAM_FOLDER:this.props.canShareLink||this.props.mode===N.MODES.LINK_ONLY?w.LinkabilityStates.CAN_LINK:this.props.canInviteEditor||this.props.canInviteViewer?w.LinkabilityStates.INVITE_NO_LINK:w.LinkabilityStates.NO_INVITE_NO_LINK,contentInfo:this.props.contentInfo,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isLimitedTeam:this.props.isLimitedTeam,linkMetadata:this.props.linkMetadata,mode:this.props.mode,shareFolderPromise:this.props.shareFolderPromise,teamName:null!=this.props.ownerTeam?this.props.ownerTeam.name:void 0,presentAccountIds:this.props.presentAccountIds,user:this.props.user})):this.props.mode===N.MODES.LINK_ONLY?a.div({className:"unified-share-modal__link-info--loading"},a.div({className:"c-loader c-loader--spinner--blue u-l-b u-mar-horizontal-auto"},H("Loading…"))):this.props.contentInfo.isTeamSharedFolder()?void 0:a.div({className:"unified-share-modal__link-info--filler"})}},t.prototype._getMemberNum=function(){return null!=this.props.memberCounts&&void 0!==this.props.memberCounts.total_unique_users?this.props.memberCounts.total_unique_users:null!=this.props.members?this.props.members.getMemberCount():void 0},t.prototype._isPassInfoLoaded=function(){return g.fetchingStatusIsComplete(this.props.passFetchingStatus)},t.prototype._renderLinkRowInFooter=function(){return this.props.mode!==N.MODES.LINK_ONLY&&(this.props.mode!==N.MODES.SHARE&&this.props.mode!==N.MODES.SHARE_SENDING&&(!!this.props.isMetadataLoaded&&R.TRUELINK.TRUELINK_UI[this.props.user.id]))},t.displayName="ShareModalContent",t.defaultProps={headerId:"unified-share-modal-title",initialRecipientRawInput:"",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:N.MODES.MEMBERSHIP,onFolderSettingsClick:null,guestMembers:[],linkMembers:[]},t})(s.Component),q=h(G,["/static/js/spectrum-sharing/index.web-vfl4sPYVH.css","/static/css/react/contacts_tokenizer-vflQsfYaG.css","/static/css/scooter/scooter-scoped-vflrM1SRf.css","/static/css/sharing/share_modal-vflFs4QGO.css","/static/css/modal-vflI292PU.css"],[m.BubbleDropdown,S.Snackbar]);t.ShareModalContent=q}),define("modules/clean/sharing/views/modal_content_spectrum",["require","exports","tslib","external/classnames","external/react","external/react-dom-factories","spectrum-sharing/sharing_modal_message_field","modules/clean/contacts/util","modules/clean/filepath","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/image","modules/clean/keycode","modules/clean/react/pass/constants","modules/clean/react/snackbar","modules/clean/react_format","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/share_modal_header_section","modules/clean/sharing/views/member_list","modules/clean/sharing/views/modal_link_info","modules/clean/sharing/views/share_modal_banner_section","modules/clean/sharing/views/share_modal_contacts_section","modules/clean/sharing/views/share_modal_footer_section","modules/clean/static_urls","modules/clean/web_timing_logger","modules/constants/sharing","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I,C,M,N,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MODES=g.MODES;var A=s.createElement,w=T.i18n_default_project("sharing")._,k=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._addEveryoneGroup=function(){return t.contactsSection.addExternalContacts([o.teamGroupInfoToContact(t.props.teamGroupInfo)])},t.handleModalCloseClick=function(){t.props.actionHandler.onClickX(t.contactsSection)},t.handleContentNameInputChange=function(e){t.props.actionHandler.handleContentNameChange(e.currentTarget.value)},t.handleContentNameInputKeyUp=function(e){e.keyCode===u.KeyCode.ENTER&&t.contactsSection.focusTypeaheadInput()},t.handleShareButtonClick=function(){var e=t.props.actionHandler;t.isCreatingNewFolder()?e.setContentNameAndSendShare(t.contactsSection).catch(function(){t.headerSection.selectContentNameInput()}):e.sendShare(t.contactsSection)},t.setContactsSectionRef=function(e){t.contactsSection=e},t.setHeaderSectionRef=function(e){t.headerSection=e},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.logTTI(),this.isCreatingNewFolder()&&this.headerSection.focusContentNameInput()},t.prototype.componentDidUpdate=function(e,t){return this.logTTI()},t.prototype.logTTI=function(){return"GRANT_ACCESS"===this.props.contentInfo.extras.origin&&this.props.isMetadataLoaded&&M.mark_time_to_interactive(),this.props.mode===g.MODES.LINK_ONLY&&this.props.isLinkMetadataLoaded?this.props.actionHandler.logIfHaventBefore("VIEW_LINK_ONLY_MODAL"):this.props.isMetadataLoaded&&(this.props.actionHandler.logIfHaventBefore("VIEW_SHARE_MODAL"),!this._shouldRenderMainLoading())?this.props.actionHandler.logIfHaventBefore("MEMBER_LIST_LOADED",{member_count:this.props.actionHandler.getSharingInfo().memberNum()}):void 0},t.prototype.render=function(){var e="unified-share-modal unified-share-modal--"+this.props.mode;return s.createElement("div",{className:e},this.renderHeaderSection(),this._renderToSection(),this._renderErrorMessageSection(),this._renderConfidentialFolderSection(),this._renderMainSection(),this._renderFooterSection())},t.prototype._renderToSection=function(){return this.props.linkOnlyReason===g.LINK_ONLY_REASON.LINKS_PAGE?null:this.props.mode===g.MODES.LINK_ONLY?this._renderNoPermissionSection():this.props.isMetadataLoaded?this.props.showContentManagerBridge?this._renderContentManagerBridge():this.props.canInviteEditor||this.props.canInviteViewer?f.shouldEnforceMemberLimits(this.props.user,this.props.isTeamSharedFolder,this.props.isFolderInsideTeamFolderTree)&&(null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:0)>=f.GoldenGate.SHARING_TOTAL_LIMIT?this._renderOverLimitSection():this.renderContactsSection():this._renderNoPermissionSection():i.div({className:"unified-share-modal__section unified-share-modal__section--to"},i.div({className:"unified-share-modal__to-placeholder"}," "))},t.prototype._shouldRenderContentSettingsShareButton=function(){return this.props.isMetadataLoaded&&this.props.mode!==g.MODES.LINK_ONLY&&(this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||[g.MODES.SHARE,g.MODES.SHARE_SENDING].includes(this.props.mode)||this.props.isInContentManager)},t.prototype._shouldRenderFooterSection=function(){return this._renderLinkRowInFooter()||this._shouldRenderContentSettingsShareButton()},t.prototype._renderFooterSection=function(){if(this._shouldRenderFooterSection())return i.div({className:r(["unified-share-modal__section","unified-share-modal__section--no-border","unified-share-modal__section--footer","unified-share-modal__section--footer-no-padding","clearfix"])},this._renderLinkRowInFooter()?this._renderLinkRowContent():this._renderContentSettingsShareButton())},t.prototype._renderContentSettingsShareButton=function(){if(this._shouldRenderContentSettingsShareButton())return s.createElement(I.ShareModalFooterSection,{mode:this.props.mode,contentInfo:this.props.contentInfo,contactsError:this.props.contactsError,contentNameMessage:this.props.contentNameMessage,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,onShareButtonClick:this.handleShareButtonClick})},t.prototype._renderErrorMessageSection=function(){var e=this.props.contactsError,t=e.level,n=e.message;if(!n)return null;var r;switch(t){case f.ContactsErrorLevel.Error:r="error";break;case f.ContactsErrorLevel.Warn:r="warn";break;default:r="default"}return s.createElement(y.ShareModalBannerSection,{type:r,message:n})},t.prototype._shouldRenderMainLoading=function(){var e=this.props.isMetadataLoaded,t=this.props.hasNonOwnerMembers||this.props.areMembersFullyLoaded,n=!this.props.isPassEnabled||this._isPassInfoLoaded(),r=this.props.shouldBlockMemberListOnPassLoad&&!n;return!e||!t||r},t.prototype._renderMainSection=function(){if(this.props.mode===g.MODES.LINK_ONLY)return this._renderMainLinkOnly();if(this._shouldRenderMainLoading())return this._renderMainLoading();switch(this.props.mode){case g.MODES.MEMBERSHIP:return this._renderMainMembership();case g.MODES.SHARE:case g.MODES.SHARE_SENDING:return this._renderMainShare();default:return null}},t.prototype._renderNoPermissionSection=function(){var e=this.props.mode===g.MODES.LINK_ONLY?this.props.contentInfo.isOSXPackage()?w(N.TRUELINK.TRUELINK_UI[this.props.user.id]?"Package files can’t be shared.":"This package file can only be shared as a link."):this.props.linkOnlyReason===g.LINK_ONLY_REASON.INSIDE_SHARED_FOLDER?N.TRUELINK.TRUELINK_UI[this.props.user.id]?w("You don’t have permission to share this folder."):i.span({},w("This folder can only be shared as a link because it’s in a shared folder.")+" ",i.a({href:"/help/1931",target:"_blank"},w("Learn more"))):N.TRUELINK.TRUELINK_UI[this.props.user.id]?w("This folder can’t be shared"):this.props.linkOnlyReason===g.LINK_ONLY_REASON.CONTAINS_SHARED_FOLDER?i.span({},w("This folder can only be shared as a link because it contains a shared folder.")+" ",i.a({href:"/help/1931",target:"_blank"},w("Learn more"))):w("This folder can only be shared as a link."):this.props.isTeamSharedFolder&&this._shouldRenderTeamFolderNoPermissionMessage(this.props.members)?w("This folder is automatically shared with all members of %(team_name)s").format({team_name:this.props.ownerTeam.name}):this.props.isTeamSharedFolder?_.reactFormat(w("Only <admin_link>admins</admin_link> and <group_link>group managers</group_link> can change team folder membership."),{admin_link:i.a({href:"/team?_tk=left_nav_team",target:"_blank"}),group_link:i.a({href:"/help/7232#transfer",target:"_blank"})}):w(this.props.contentInfo.isFolder()?N.TRUELINK.TRUELINK_UI[this.props.user.id]&&(null!=this.props.permissions?this.props.permissions.change_options.allow:void 0)?"To add new members, you’ll need to add them to the parent folder.":"You don’t have permission to manage membership of this folder":"You don’t have permission to manage membership of this file");return s.createElement(y.ShareModalBannerSection,{message:e})},t.prototype._renderConfidentialFolderSection=function(){var e=this.props,t=e.ownerTeam,n=e.isConfidentialFolder,r=e.actionHandler,a=e.canUpdateConfidentiality;if(n&&a){var o=t?t.name:"",l=i.div({},_.reactFormat(w("<b>Invite only.</b> Members of parent folders can’t access."),{b:i.b()}),this.props.contentInfo.pathExists()?[" ",i.a({onClick:function(){return r.handleSetConfidentialClick(Boolean(n),o)}},w("Restore access"))]:void 0);return s.createElement(y.ShareModalBannerSection,{type:"dark",message:l})}},t.prototype._renderContentManagerBridge=function(){var e=l.parent_dir(this.props.contentInfo.displayPath()),t=this.props.contentInfo.name(),n=f.genContentManagerBridgeUri({containingFolder:e,filenameToSelect:t}),r=s.createElement("span",null,w("You can manage folder membership in the Admin Console.")," ",s.createElement("a",{href:n.toString(),target:"_blank",rel:"noopener"},w("Open in a new tab.")));return s.createElement(y.ShareModalBannerSection,{message:r})},t.prototype._renderOverLimitSection=function(){var e=w("This folder is over its %(member_limit)s-member limit.",{comment:"member limit is a number greater than 200"}).format({member_limit:f.GoldenGate.SHARING_TOTAL_LIMIT}),t=s.createElement("div",null,s.createElement("div",null,e),s.createElement("div",null,w("Please remove some members.")," ",s.createElement("a",{href:"/help/9292",target:"_blank",rel:"noopener"},w("Learn more."))));return s.createElement(y.ShareModalBannerSection,{message:t})},t.prototype._shouldRenderTeamFolderNoPermissionMessage=function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return"team"===e.group_type&&(null!=e.permissions.make_editor?e.permissions.make_editor.allow:void 0)&&(null!=e.permissions.make_viewer?e.permissions.make_viewer.allow:void 0)})},t.prototype._renderMainLoading=function(){return i.div({className:r(["unified-share-modal__main","unified-share-modal__section","unified-share-modal__section--no-border",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},i.div({className:"u-font-center u-font-meta u-pad-top-xl"},i.div({className:"c-loader"},w("Loading..."))))},t.prototype._renderMainLinkOnly=function(){return N.TRUELINK.TRUELINK_UI[this.props.user.id]&&this.props.linkOnlyReason!==g.LINK_ONLY_REASON.LINKS_PAGE?null:i.div({className:r(["unified-share-modal__main","unified-share-modal__main--link-only","unified-share-modal__section","unified-share-modal__section--no-border",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRowContent())},t.prototype._showSharingMemberList=function(){return!!this.props.hasNonOwnerMembers||(this.props.isFolderInsideTeamFolderTree?1===this.props.members.users.size||!this.props.isConfidentialFolder&&this.props.user.is_cdm_member:this.props.guestMembers.length>0||this.props.linkMembers.length>0)},t.prototype._renderMemberList=function(){return i.div({className:r(["unified-share-modal__section","unified-share-modal__section--no-padding","unified-share-modal__section--no-border"])},A(E.SharingMemberList,{actionHandler:this.props.actionHandler,areMembersFullyLoaded:this.props.areMembersFullyLoaded,canInviteMembers:this.props.canInviteEditor||this.props.canInviteViewer,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,disabled:this.props.showContentManagerBridge,guestMembers:this.props.guestMembers,groupSeenStateInfo:this.props.groupSeenStateInfo,isConfidentialFolder:this.props.isConfidentialFolder,linkMembers:this.props.linkMembers,membership:this.props.members,pendingMemberAction:this.props.pendingMemberAction,presentAccountIds:this.props.presentAccountIds,memberCounts:this.props.memberCounts,shouldShowPassUI:this.props.isPassEnabled&&m.fetchingStatusIsSuccessful(this.props.passFetchingStatus),teamName:null!=this.props.ownerTeam?this.props.ownerTeam.name:void 0,user:this.props.user,viewer:this.props.viewer}))},t.prototype._renderInputBanner=function(){return i.div({className:r(["unified-share-modal__section","unified-share-modal__section--no-padding","unified-share-modal__section--no-border"])},i.div({className:r(["unified-share-modal__input-content-name-banner","u-font-center","u-font-meta","u-mar-top-xs"])},A(p.Image,{src:C.static_url("/static/images/sharing/illo-name-folder-vfl38PzAv.png"),srcHiRes:C.static_url("/static/images/sharing/illo-name-folder@2x-vflzK0uJv.png")}),i.h3({className:r(["u-font-strong","u-mar-top-xs"])},w("Name your shared folder")),i.p({className:r(["u-pad-left-xxl","u-pad-right-xxl"])},w("Shared folders are for collaborting on projects, client works, and organizing departments"))))},t.prototype._renderTeamSharedFolderBanner=function(){var e;return e=null!=this.props.teamGroupInfo?[i.p({className:"u-mar-top-xxl"},i.a({onClick:this._addEveryoneGroup},w("Add everyone at %(team_name)s").format({team_name:this.props.ownerTeam.name}))),i.p({},w("Or, add groups to this team folder.")+" ",i.a({href:"/team#groups/newgroup"},w("Create a group")))]:i.p({className:"u-mar-top-xxl"},w("Add groups to this team folder.")+" ",i.a({href:"/team#groups/newgroup"},w("Create a group"))),i.div({className:r(["unified-share-modal__section","unified-share-modal__section--no-border"])},i.div({className:r(["unified-share-modal__no-members-banner","u-font-center","u-font-meta","u-font-center","u-font-meta"])},e))},t.prototype._renderMainMembership=function(){return i.div({className:r(["unified-share-modal__main",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._showSharingMemberList()?this._renderMemberList():this.props.banner===g.BANNERS.INPUT_CONTENT_NAME?this._renderInputBanner():this.props.isTeamSharedFolder?this._renderTeamSharedFolderBanner():this._renderMessageField())},t.prototype._renderMessageField=function(){var e=this;return s.createElement(a.SharingModalMessageField,{placeholder:w("Add a message (optional)"),onChange:function(t){return e.props.actionHandler.changeRecipientMessage(t.target.value)},value:this.props.recipientMessage})},t.prototype._renderMainShare=function(){return s.createElement("div",{className:"unified-share-modal__main"},this.props.isTeamSharedFolder?void 0:this._renderMessageField())},t.prototype._renderLinkRowContent=function(){if(!this.props.isInContentManager||N.TRUELINK.TRUELINK_UI[this.props.user.id]){return!this.props.contentInfo.isMounted()&&this.props.isPassEnabled&&this._isPassInfoLoaded()&&this.props.isMetadataLoaded||this.props.isLinkMetadataLoaded&&(this.props.isMetadataLoaded||this.props.mode===g.MODES.LINK_ONLY)?i.div({className:"unified-share-modal__link-info"},A(b.ModalLinkInfo,{actionHandler:this.props.actionHandler,linkabilityState:this.props.isTeamSharedFolder?b.LinkabilityStates.CANT_LINK_TEAM_FOLDER:this.props.canShareLink||this.props.mode===g.MODES.LINK_ONLY?b.LinkabilityStates.CAN_LINK:this.props.canInviteEditor||this.props.canInviteViewer?b.LinkabilityStates.INVITE_NO_LINK:b.LinkabilityStates.NO_INVITE_NO_LINK,contentInfo:this.props.contentInfo,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isLimitedTeam:this.props.isLimitedTeam,linkMetadata:this.props.linkMetadata,mode:this.props.mode,shareFolderPromise:this.props.shareFolderPromise,teamName:null!=this.props.ownerTeam?this.props.ownerTeam.name:void 0,presentAccountIds:this.props.presentAccountIds,user:this.props.user})):this.props.mode===g.MODES.LINK_ONLY?i.div({className:"unified-share-modal__link-info--loading"},i.div({className:"c-loader c-loader--spinner--blue u-l-b u-mar-horizontal-auto"},w("Loading…"))):this.props.contentInfo.isTeamSharedFolder()?void 0:i.div({className:"unified-share-modal__link-info--filler"})}},t.prototype._isPassInfoLoaded=function(){return m.fetchingStatusIsComplete(this.props.passFetchingStatus)},t.prototype._renderLinkRowInFooter=function(){return this.props.mode!==g.MODES.LINK_ONLY&&(this.props.mode!==g.MODES.SHARE&&this.props.mode!==g.MODES.SHARE_SENDING&&(!!this.props.isMetadataLoaded&&!this.props.isInContentManager))},t.prototype.renderHeaderSection=function(){return s.createElement(S.ShareModalHeaderSection,{ref:this.setHeaderSectionRef,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,contentNameMessage:this.props.contentNameMessage,contentNameMessageLevel:this.props.contentNameMessageLevel,canEdit:this.props.canEdit,initialContentName:this.props.initialContentName,isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isConfidentialFolder:this.props.isConfidentialFolder,isContentNameFocused:this.props.isContentNameFocused,isCreatingNewFolder:this.isCreatingNewFolder(),isMetadataLoaded:this.props.isMetadataLoaded,onModalCloseClick:this.handleModalCloseClick,onSettingsButtonClick:this.props.onSettingsClick,onContentNameInputChange:this.handleContentNameInputChange,onContentNameInputKeyUp:this.handleContentNameInputKeyUp,ownerTeam:this.props.ownerTeam,sharingInfo:this.props.actionHandler.getSharingInfo(),showPassFileSettings:this.props.showPassFileSettings,user:this.props.user})},t.prototype.renderContactsSection=function(){var e=w(this.props.isTeamSharedFolder?"Group names":this.props.user.is_team?"Email, name, or group":"Email or name");return s.createElement(v.ShareModalContactsSection,{ref:this.setContactsSectionRef,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,canInviteEditor:this.props.canInviteEditor,canInviteViewer:this.props.canInviteViewer,initialAccessLevel:this.props.recipientAccess,initialTypeaheadTokens:this.props.initialRecipientTokens,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,memberCountWithRecipients:this.props.memberCountWithRecipients,ownerTeam:this.props.ownerTeam,typeaheadPlaceholder:e,user:this.props.user})},t.prototype.isCreatingNewFolder=function(){var e=this.props.contentInfo;return e.isFolder()&&!e.extras.exists},t.displayName="ShareModalContentSpectrum",t.defaultProps={headerId:"unified-share-modal-title",initialRecipientRawInput:"",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:g.MODES.MEMBERSHIP,onFolderSettingsClick:null,guestMembers:[],linkMembers:[]},t})(s.Component),L=d(k,["/static/js/spectrum-sharing/index.web-vfl4sPYVH.css","/static/css/react/contacts_tokenizer-vflQsfYaG.css","/static/css/scooter/scooter-scoped-vflrM1SRf.css","/static/css/sharing/share_modal-vflFs4QGO.css","/static/css/modal-vflI292PU.css"],[c.BubbleDropdown,h.Snackbar]);t.ShareModalContentSpectrum=L}),define("modules/clean/sharing/views/modal_link_info",["require","exports","tslib","jquery","external/classnames","external/react","external/react-dom-factories","modules/clean/clipboard_v2","modules/clean/em_string","modules/clean/react_format","modules/clean/react/snackbar","modules/clean/react/sprite","modules/clean/react/util","modules/clean/sharing/api/types/metadata","modules/clean/sharing/link_description","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_util","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/views/constants","modules/constants/sharing","modules/core/i18n","spectrum-sharing/sharing_modal_footer_link","modules/constants/sharing"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g,S,E,b,y,v,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var C=y.i18n_default_project("sharing")._;C("Link not available. To share, invite specific people."),C("Link not available");var M;(function(e){e.CAN_LINK="CAN_LINK",e.INVITE_NO_LINK="INVITE_NO_LINK",e.NO_INVITE_NO_LINK="NO_INVITE_NO_LINK",e.CANT_LINK_TEAM_FOLDER="CANT_LINK_TEAM_FOLDER"})(M=t.LinkabilityStates||(t.LinkabilityStates={}));var N=(function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.onClickButtonLinkSettings=function(){r.props.actionHandler&&r.props.actionHandler.handleLinkSettingsClick()},r.setTextInputRef=function(e){return r.urlField=e,e},r.onClickButtonCreateLink=function(){r.setState({creatingLink:!0}),r.handleCreateLinkClicked()},r.handleCreateLinkClicked=function(){if(r.isSharedContentLink())throw Error("Should not display this for shared content link");if(r.props.actionHandler)return r.props.actionHandler.createSharedLink()},r.handleCopyLinkClicked=function(){if(!r.state.showingUrl){var e={};r.props.linkMetadata instanceof m.SharedContentLinkMetadata?(e.type="scl",e.password_protected=r.props.linkMetadata.password_protected,e.audience=r.props.linkMetadata.current_audience,e.expiration=r.props.linkMetadata.expiry):r.props.linkMetadata instanceof m.LinkMetadata?(e.type="shmodel",e.visibility=r.props.linkMetadata.link_permissions.resolved_visibility,e.expiration=r.props.linkMetadata.expires):r.isSharedContentLink()&&(e.type="scl"),r.props.contentInfo&&g.logTiburonEvent(r.props.contentInfo,r.props.user.id,"CLICK_TIB_COPY_LINK",e),r.props.actionHandler&&r.props.actionHandler.turnLinkOnIfQualified()}return u.setStatePromise(r,{showingUrl:!r.state.showingUrl,creatingLink:!1}).then(function(){if(r.urlField){var e=r.urlField;e.focus(),e.select(),r.clipboard.do_copy()}})},r.state={showingUrl:!1,creatingLink:!1},r.clipboard=null,r}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.clipboard=new o(this.props.linkMetadata&&this.props.linkMetadata.url,function(){return S.sharingNotificationSuccess(C("Link copied to clipboard"))},function(){S.sharingNotificationError(C("Unable to copy the link, please copy manually"))},this.handleCopyLinkClicked)},t.prototype.componentDidMount=function(){this.setupCopy()},t.prototype.componentDidUpdate=function(){this.setupCopy()},t.prototype.setupCopy=function(){var e=r(".copy-link-button");e.length&&this.clipboard.setupCopy(e,r(".copy-link-container"))},t.prototype.renderSpectrum=function(){return this.props.linkabilityState===M.NO_INVITE_NO_LINK?this.renderSpectrumCantLinkOrShare():this.props.linkabilityState===M.INVITE_NO_LINK?this.renderSpectrumCantLinkCDM():this.props.linkabilityState===M.CANT_LINK_TEAM_FOLDER?this.renderSpectrumCantLinkTeamFolder():this.props.linkMetadata||this.isSharedContentLink()?this.state.showingUrl?this.renderSpectrumCopyLink():this.renderSpectrumLink():this.state.creatingLink?this.renderSpectrumLoading():this.props.linkabilityState===M.CAN_LINK?this.renderSpectrumNoLink():null},t.prototype.renderNonSpectrum=function(){return this.props.linkabilityState===M.NO_INVITE_NO_LINK?this.renderCantLinkOrShare():this.props.linkabilityState===M.INVITE_NO_LINK?this.renderCantLinkCDM():this.props.linkabilityState===M.CANT_LINK_TEAM_FOLDER?this.renderCantLinkTeamFolder():this.props.linkMetadata||this.isSharedContentLink()?this.renderLink():this.props.linkabilityState===M.CAN_LINK?this.renderNoLink():null},t.prototype.render=function(){return I.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL?this.renderSpectrum():this.renderNonSpectrum()},t.prototype.spectrumClassNames=function(){return s({"scl-sharing-modal-footer-link--no-border":this.props.mode===E.MODES.LINK_ONLY,"scl-sharing-modal-footer-link--no-spacing":this.props.mode===E.MODES.LINK_ONLY})},t.prototype.renderSpectrumCantLinkOrShare=function(){return i.createElement(v.SharingModalFooterLink,{body:C("Link not available")})},t.prototype.renderSpectrumCantLinkCDM=function(){var e=i.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},C("Learn more"));return i.createElement(v.SharingModalFooterLink,{className:this.spectrumClassNames(),body:C("Link not available"),actions:e})},t.prototype.renderSpectrumCantLinkTeamFolder=function(){var e=i.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},C("Learn more"));return i.createElement(v.SharingModalFooterLink,{className:this.spectrumClassNames(),body:C("Link not available"),actions:e})},t.prototype.renderSpectrumLink=function(){var e;return e=o.is_supported()?i.createElement("span",{className:"copy-link-button"},C("Copy link")):C("Show link"),i.createElement(v.SharingModalFooterLinkOptions,{className:this.spectrumClassNames(),statusLinkCreated:this.renderLinkDescription(),textButtonLinkSettings:C("Link settings"),textButtonCopyLink:e,buttonCopyClassName:"button-as-link copy-link-container",onClickButtonLinkSettings:this.onClickButtonLinkSettings,onClickButtonCopyLink:this.handleCopyLinkClicked})},t.prototype.renderSpectrumCopyLink=function(){var e=null!=this.props.linkMetadata?this.props.linkMetadata.url:"";return i.createElement(v.SharingModalFooterLinkCopy,{className:this.spectrumClassNames(),sharedLinkUrl:e,labelSharedLinkUrl:C("Shared link URL"),textButtonHideLink:C("Hide link"),textInputRef:this.setTextInputRef,onClickButtonHideLink:this.handleCopyLinkClicked})},t.prototype.renderSpectrumNoLink=function(){return i.createElement(v.SharingModalFooterLinkCreate,{className:this.spectrumClassNames(),statusNoLinkCreated:C("No link created yet"),textButtonCreateLink:C("Create a link"),onClickButtonCreateLink:this.onClickButtonCreateLink})},t.prototype.renderSpectrumLoading=function(){return i.createElement(v.SharingModalFooterLinkLoading,{className:this.spectrumClassNames(),statusCreatingLink:C("Creating link")})},t.prototype.renderLink=function(){return i.createElement("div",{className:"unified-share-modal-link-info o-flag"},i.createElement("div",{className:"o-flag__fix"},this.renderLinkIcon()),i.createElement("div",{className:this.detailsClassName()},this.renderLinkDetails()),i.createElement("ul",{className:"unified-share-modal-link-info__actions o-flag__fix"},this.renderLinkActions()))},t.prototype.renderLinkDetails=function(){var e=this;if(!this.props.linkMetadata)return null;var t=null;this.props.linkMetadata instanceof m.SharedContentLinkMetadata&&(t=this.renderSharedContentLinkInfo());return this.state.showingUrl?i.createElement("span",null,t,i.createElement("span",null,i.createElement("label",{className:"ax-visually-hidden",htmlFor:"unified-share-modal-link-url",key:"link-label"},C("Shared link URL")),i.createElement("input",{
className:"unified-share-modal-link-info__url",id:"unified-share-modal-link-url",key:"link-url-input",onClick:this.handleUrlClick,readOnly:!0,ref:function(t){return e.urlField=t},type:"text",value:this.props.linkMetadata.url}))):this.renderLinkDescription()},t.prototype.renderLinkDescription=function(){var e=null;this.props.linkMetadata instanceof m.LinkMetadata?e=h.formatLinkDescription(this.props.linkMetadata):this.props.linkMetadata instanceof m.SharedContentLinkMetadata&&(e=this.renderSharedContentLinkInfo());var t=null;return null!==e&&(t=i.createElement("span",{className:s({"unified-share-modal-link-info__description":!0,"unified-share-modal-link-info__description--content-link":this.isSharedContentLink()})},e)),i.createElement("span",null,t)},t.prototype.renderLinkActions=function(){var e=null;return this.isSharedContentLink()?this.props.linkMetadata&&this.props.linkMetadata.url?e=this.renderCopyLink():this.isSharingFolder()||(e=this.renderGetLink()):e=i.createElement("span",null,this.renderLinkSettings(),this.renderDivider(),this.renderCopyLink()),e},t.prototype.renderLinkSettings=function(){return!this.state.showingUrl&&this.props.actionHandler?i.createElement("li",{className:"u-l-ib"},i.createElement("button",{className:"button-as-link",onClick:this.props.actionHandler.handleLinkSettingsClick},C("Link settings"))):null},t.prototype.renderDivider=function(){return this.state.showingUrl?null:i.createElement("span",{className:"u-l-ib u-mar-left-xs u-mar-right-xs"},"•")},t.prototype.renderCopyLink=function(){var e;return e=this.state.showingUrl?C("Hide link"):o.is_supported()?i.createElement("span",{className:"copy-link-button"},C("Copy link")):C("Show link"),i.createElement("li",{className:"u-l-ib"},i.createElement("button",{className:"button-as-link copy-link-container",onClick:this.handleCopyLinkClicked},e))},t.prototype.renderGetLink=function(){var e=this,t=function(){e.props.actionHandler&&e.props.actionHandler.turnLinkOnIfQualified().then(function(){if(e.props.actionHandler){var t=void 0;t=e.props.contentInfo?c.reactFormat(C("Creating shared link for <st>%(folder_name)s</st>..."),{st:i.createElement("strong",null),folder_name:e.props.contentInfo.name()}):C("Creating shared link..."),e.props.actionHandler.shareIfFileFolder(t).then(function(){var t;t=e.props.contentInfo?c.reactFormat(C("Created shared link for <st>%(folder_name)s</st>."),{st:i.createElement("strong",null),folder_name:e.props.contentInfo.name()}):C("Created shared link."),d.Snackbar.complete(t)}).catch(function(t){e.props.actionHandler&&e.props.actionHandler.reportShareFailure(t)})}})};return i.createElement("li",{className:"u-l-ib"},i.createElement("button",{className:"button-as-link",onClick:t},C("Get link")))},t.prototype.detailsClassName=function(){return"unified-share-modal-link-info__details o-flag__flex"},t.prototype.renderNoLink=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--no-link o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(p.Sprite,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},C("No link created yet")),i.createElement("div",{className:"unified-share-modal-link-info__actions o-flag__fix"},i.createElement("button",{className:"button-as-link",onClick:this.handleCreateLinkClicked},C("Create a link"))))},t.prototype.renderCantLinkOrShare=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--cant-share o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(p.Sprite,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},C("Link not available")))},t.prototype.renderCantLinkTeamFolder=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--cant-share o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(p.Sprite,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},C("Link not available")),i.createElement("div",{className:"unified-share-modal-link-info__actions o-flag__fix"},i.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},C("Learn more"))))},t.prototype.renderCantLinkCDM=function(){return i.createElement("div",{className:"unified-share-modal-link-info unified-share-modal-link-info--cant-link o-flag"},i.createElement("div",{className:"o-flag__fix"},i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(p.Sprite,{alt:"",group:"web",name:"shared_link_gray"}))),i.createElement("div",{className:this.detailsClassName()},C("Link not available. To share, invite specific people.")),i.createElement("div",{className:"unified-share-modal-link-info__actions o-flag__fix"},i.createElement("a",{href:"/help/business/team-space-overview#share",target:"_blank",rel:"noopener noreferrer"},C("Learn more"))))},t.prototype.handleUrlClick=function(e){e.target.select()},t.prototype.isSharedContentLink=function(){return b.TRUELINK.TRUELINK_UI[this.props.user.id]},t.prototype.renderLinkIcon=function(){return i.createElement("div",{className:"unified-share-modal-link-info__icon"},i.createElement(p.Sprite,{alt:"",group:"web",name:"shared_link_white"}))},t.prototype.isSharingFolder=function(){return Boolean(this.props.shareFolderPromise)},t.prototype.renderSharedContentLinkInfo=function(){if(!(this.props.actionHandler&&this.props.linkMetadata&&this.props.linkMetadata instanceof m.SharedContentLinkMetadata))return null;if(this.isSharingFolder()||this.props.linkMetadata instanceof m.SharedContentLinkMetadata&&this.props.linkMetadata.current_audience===m.LinkAudience.default_on)return i.createElement("div",null,C("Updating link"),i.createElement("div",{className:"c-loader"}));var e,t=this.props.linkMetadata.audience_options.size>1;this.props.linkMetadata.current_audience===m.LinkAudience.members?e=this.props.hasDisplayableMembers&&!this.props.hasNonOwnerMembers?c.reactFormat(C("<strong>Only you</strong> can use the link"),{strong:a.strong()}):c.reactFormat(C("<strong>Invited members</strong> with the link can view"),{strong:a.strong()}):this.props.linkMetadata.current_audience===m.LinkAudience.team?e=c.reactFormat(C("<strong>Members of %(team_name)s</strong> with the link can view"),{strong:a.strong(),team_name:l.Emstring.em_snippet(this.props.teamName||"",10)}):this.props.linkMetadata.current_audience===m.LinkAudience.public&&(e=c.reactFormat(C("<strong>Anyone</strong> with the link can view"),{strong:a.strong()}));var n;if(t){var r=i.createElement("button",{className:"c-borderless-button change-audience-button"},e,i.createElement(p.Sprite,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"}));n=i.createElement(_.SettingDropdown,{currentValue:this.props.linkMetadata.current_audience,valuesList:this.props.linkMetadata.audience_options.valueSeq().toArray(),optionsDict:f.getAudienceOptionsDict(this.props.contentInfo&&this.props.contentInfo.isFolder()||!1,this.props.teamName||"",this.props.hasNonOwnerMembers||!1,this.props.hasDisplayableMembers||!1),onValueSelected:this.props.actionHandler.handleSelectLinkAudience,customButton:r,openUp:this.props.mode!==E.MODES.LINK_ONLY})}else n=e;var s=[];this.props.linkMetadata.expiry&&s.push(h.formatSharedContentLinkExpiry(this.props.linkMetadata,!0)),this.props.linkMetadata.password_protected&&this.props.linkMetadata.expiry&&s.push(this.renderDivider()),this.props.linkMetadata.password_protected&&s.push(C("Password protected"));var o;if(this.props.linkMetadata.audience_restricting_shared_folder&&this.props.linkMetadata.audience_restricting_shared_folder.audience===this.props.linkMetadata.current_audience){var d=this.props.linkMetadata.audience_restricting_shared_folder.name;o=c.reactFormat(C("Applied via <strong>%(folder_name)s</strong>"),{strong:a.strong(),folder_name:d})}else this.props.contentInfo&&this.props.contentInfo.isFolder()&&this.props.linkMetadata.current_audience!==m.LinkAudience.members&&(o=C("Applies to all items in this folder"));return i.createElement("div",null,i.createElement("div",null,n),i.createElement("div",null,s),o)},t.displayName="ModalLinkInfo",t})(i.Component);t.ModalLinkInfo=N}),define("modules/clean/sharing/views/share_modal_banner_section",["require","exports","tslib","external/classnames","external/react","modules/constants/sharing","spectrum-sharing/sharing_modal_banner"],function(e,t,n,r,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.typeClassName=function(){return"unified-share-modal__banner--"+this.props.type},t.prototype.render=function(){var e=this.props,t=e.className,n=e.type,o=e.message;if(i.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL)return s.createElement(a.SharingModalBanner,{type:n,message:o});var l=r("unified-share-modal__section","unified-share-modal__banner",this.typeClassName(),"u-font-center",t);return s.createElement("div",{className:l},o)},t.defaultProps={type:"default"},t})(s.PureComponent);t.ShareModalBannerSection=o}),define("modules/clean/sharing/views/share_modal_contacts_section",["require","exports","tslib","external/react","spectrum/typeahead","spectrum-sharing/sharing_contact_token","spectrum-sharing/sharing_modal_contacts_field","spectrum-sharing/member_row","modules/clean/sharing/access_level","modules/clean/contacts/contact","modules/clean/contacts/data_v2","modules/clean/contacts/types","modules/clean/sharing/constants","modules/clean/sharing/strings","modules/clean/sharing/ui_util","modules/core/i18n","external/react-dom","modules/core/user_i18n"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=_.i18n_default_project("sharing")._,E=(function(e){function t(t){var n=e.call(this,t)||this;return n.filterContacts=function(e){return n.props.isSendingForSignature?e.type!==p.FB&&!!e.email&&e.email!==n.props.user.email:n.props.isTeamSharedFolder?e.type!==p.FB&&!!e.group_id:n.props.isInContentManager?e.type!==p.FB:e.type!==p.FB&&e.email!==n.props.user.email},n.handleAccessTypeChange=function(e){n.setState({selectedAccessType:e}),n.props.actionHandler.changeRecipientAccess(e)},n.handleTypeaheadOnChange=function(e){var t=n.tokenizeRawInput(e),r=t.tokens,s=t.remainingInputValue;e!==s&&n.typeahead.setState({inputValue:s}),n.validateAndAddTokens(r),n.showSuggestions(s)},n.handleTypeaheadSelect=function(e,t,r){(e||r)&&(n.validateAndAddTokens([e?e:c.Contact.buildFromRawEmail(r)]),n.setState({typeaheadSuggestions:[]}))},n.handleTypeaheadRemoveToken=function(e){var t=n.state.typeaheadTokens.filter(function(t){return t!==e});n.setState({typeaheadTokens:t})},n.renderTypeaheadSuggestion=function(e){var t=e.name||e.email,n=g.getInitials(t);return r.createElement(o.MemberRow,{id:e.getKey(),initials:n,avatarUrl:e.photo_url,description:e.email,displayName:t,tag:"div",variant:"narrow"})},n.renderTypeaheadTokenContent=function(e){var t=e.name||e.email,s=h.validateContact(e,n.props.user,n.props.ownerTeam,n.props.actionHandler.getSharingInfo().folderPolicy(),n.props.isTeamSharedFolder,n.props.isFolderInsideTeamFolderTree,n.props.memberCountWithRecipients),a={state:s.state,msg:s.msg};return r.createElement(i.SharingContactToken,{avatarUrl:e.photo_url,displayName:t,validation:a})},n.setTypeaheadRef=function(e){n.typeahead=e},n.setTypeaheadInputRef=function(e){n.typeaheadInput=e},n.finishLogging=function(e){},n.state={selectedAccessType:t.initialAccessLevel,typeaheadTokens:t.initialTypeaheadTokens,typeaheadSuggestions:[]},t.initialTypeaheadTokens.length>0&&n.props.actionHandler.recipientsChange(t.initialTypeaheadTokens),n}return n.__extends(t,e),t.prototype.getContacts=function(){var e=this.typeaheadInput.value,t=this.state.typeaheadTokens;if(""!==e){var n=this.tokenizeRawInput(e,!0).tokens;t=t.concat(n)}return t},t.prototype.focusTypeaheadInput=function(){f.findDOMNode(this.typeaheadInput).focus()},t.prototype.addExternalContacts=function(e){this.validateAndAddTokens(e)},t.prototype.componentDidMount=function(){this.contactsDataSource=this.initContactsDataSource(this.props.user,this.filterContacts)},t.prototype.componentDidUpdate=function(e,t){this.contactsDataSource=this.initContactsDataSource(this.props.user,this.filterContacts),t.typeaheadTokens!==this.state.typeaheadTokens&&this.props.actionHandler.recipientsChange(this.state.typeaheadTokens,this.typeaheadInput.value)},t.prototype.render=function(){var e=this.props.isTeamSharedFolder?S("Add groups:",{comment:"Label for with whom to share"}):S("To:",{comment:"Label for with whom to share"}),t=this.props.isSendingForSignature?"Recipient will not be able to edit the contents of this PDF":S("Only folders can be shared with edit access");return r.createElement(a.SharingModalContactsField,{contactsField:this.renderContactsField(),labelledAccessTypes:this.getAccessTypes(),onAccessTypeChange:this.handleAccessTypeChange,selectedAccessType:this.getSelectedAccessType(),toLabel:e,showNoEditTooltip:this.props.contentInfo.isFile()&&!this.props.canInviteEditor,noEditText:t})},t.prototype.initContactsDataSource=function(e,t){return new d.ContactsDataSourceV2(e,t,!1)},t.prototype.getAccessTypes=function(){var e=[],t=function(e){return S("change permission for users to %(label)s").format({label:e})},n=m.ACCESS_NAME,r=this.props.contentInfo&&this.props.contentInfo.isFolder()?m.MEMBER_ACTION_FOLDER:m.MEMBER_ACTION_FILE;return this.props.canInviteEditor&&e.push({apiId:l.ACCESS_LEVEL.WRITER,ariaLabel:t(l.ACCESS_LEVEL.WRITER),label:n[l.ACCESS_LEVEL.WRITER],details:r[u.MEMBER_ACTION.MAKE_EDITOR]}),this.props.canInviteViewer&&e.push({apiId:l.ACCESS_LEVEL.READER,ariaLabel:t(l.ACCESS_LEVEL.READER),label:n[l.ACCESS_LEVEL.READER],details:r[u.MEMBER_ACTION.MAKE_VIEWER]}),this.props.isSendingForSignature&&e.push({apiId:l.ACCESS_LEVEL.SIGNER,ariaLabel:t(l.ACCESS_LEVEL.SIGNER),label:S("Can view and complete form"),details:"Recipient can only view and complete the form"}),e},t.prototype.getSelectedAccessType=function(){for(var e,t=this.getAccessTypes(),n=0,r=t;n<r.length;n++){var s=r[n];s.apiId===this.state.selectedAccessType&&(e=s)}return e},t.prototype.shouldDisallowInput=function(){return this.props.isSendingForSignature&&this.state.typeaheadTokens.length>0},t.prototype.renderContactsField=function(){return r.createElement(s.Typeahead,{ref:this.setTypeaheadRef,className:this.shouldDisallowInput()?"esignature-typeahead-no-placeholder":"",height:160,inputProps:{ref:this.setTypeaheadInputRef,placeholder:this.shouldDisallowInput()?"":this.props.typeaheadPlaceholder},listItemHeight:48,onChange:this.handleTypeaheadOnChange,onRemoveToken:this.handleTypeaheadRemoveToken,onSelect:this.handleTypeaheadSelect,renderSuggestion:this.renderTypeaheadSuggestion,renderTokenContent:this.renderTypeaheadTokenContent,suggestions:this.state.typeaheadSuggestions,suggestionsBuffer:0,tokens:this.createTypeaheadTokenObjects()})},t.prototype.createTypeaheadTokenObjects=function(){var e=this,t=this.state.typeaheadTokens,n=[];return t.forEach(function(t){var r,s=t.getKey(),i=t,a=h.validateContact(t,e.props.user,e.props.ownerTeam,e.props.actionHandler.getSharingInfo().folderPolicy(),e.props.isTeamSharedFolder,e.props.isFolderInsideTeamFolderTree,e.props.memberCountWithRecipients);r="invalid"===a.state?"error":"warn"===a.state?"warning":"default",n.push({key:s,variant:r,content:i})}),n},t.prototype.showSuggestions=function(e){var t=this,n=function(e){if(!e)return[];var n=t.state.typeaheadTokens.map(function(e){return e.getKey()});return e.filter(function(e){return!n.includes(e.getKey())})},r=function(e){t.setState({typeaheadSuggestions:n(e)})},s=function(n){e===t.typeaheadInput.value&&n.length>0&&t.setState({typeaheadSuggestions:t.state.typeaheadSuggestions.concat(n)})};this.contactsDataSource.search(e,r,s)},t.prototype.tokenizeRawInput=function(e,t){void 0===t&&(t=!1);var n="",r=[],s=e.split(/[,|;\s]+/);if(!t){var i=s.pop();n=i?i:""}for(var a=0,o=s;a<o.length;a++){var l=o[a],d=l.trim();""!==d&&r.push(c.Contact.buildFromRawEmail(d))}return{tokens:r,remainingInputValue:n}},t.prototype.validateAndAddTokens=function(e){var t=this,n=e.reduce(function(e,t){return t.pending&&t.query&&e.push(t.query),e},[]),r=function(n){for(var r=[],s=t.state.typeaheadTokens.map(function(e){return e.getKey()}),i=0,a=e;i<a.length;i++){var o=a[i],l=o;if(l.pending&&l.query){var c=t.contactsDataSource.normalizeQuery(l.query),d=t.determineQueryMatch(c,n[c]);d&&(l=d)}var p=l.getKey();s.includes(p)||(s.push(p),r.push(l))}t.setState({typeaheadTokens:t.state.typeaheadTokens.concat(r)})};return this.contactsDataSource.searchBatch(n,r,r)},t.prototype.determineQueryMatch=function(e,t){if(!t||!e)return null;for(var n={email:[],name:[]},r=0,s=t;r<s.length;r++){var i=s[r],a=i.email?this.contactsDataSource.normalizeQuery(i.email):null,o=i.name?this.contactsDataSource.normalizeQuery(i.name):null;e===a?n.email.push(i):e===o&&n.name.push(i)}for(var l=0,c=["email","name"];l<c.length;l++){var d=c[l];if(1===n[d].length)return n[d][0]}return null},t.defaultProps={initialAccessLevel:l.ACCESS_LEVEL.WRITER},t})(r.PureComponent);t.ShareModalContactsSection=E}),define("modules/clean/sharing/views/share_modal_footer_section",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","spectrum-sharing/sharing_modal_footer_inband"],function(e,t,n,r,s,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=s.i18n_default_project("sharing")._,c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.isInbandFooterDisabled=function(){return this.props.isTokenizerEmpty||this.props.contactsError&&this.props.contactsError.level===i.ContactsErrorLevel.Error||null!=this.props.contentNameMessage},t.prototype.renderModalFooterInband=function(){switch(this.props.mode){case a.MODES.SHARE:return r.createElement(o.SharingModalFooterInband,{isButtonShareDisabled:this.isInbandFooterDisabled(),textButtonShare:l(this.props.isTeamSharedFolder?"Add":"Share"),onClickButtonShare:this.props.onShareButtonClick});case a.MODES.SHARE_SENDING:return r.createElement(o.SharingModalFooterInband,{isButtonShareDisabled:!0,textButtonShare:l(this.props.isTeamSharedFolder?"Adding...":"Sharing..."),onClickButtonShare:this.props.onShareButtonClick});case a.MODES.MEMBERSHIP:return this.props.isInContentManager&&!this.props.contentInfo.pathExists()?r.createElement(o.SharingModalFooterInband,{isButtonShareDisabled:!1,textButtonShare:l(this.props.isTeamSharedFolder?"Add":"Share"),onClickButtonShare:this.props.onShareButtonClick}):null;default:return null}},t.prototype.render=function(){return this.renderModalFooterInband()},t})(r.PureComponent);t.ShareModalFooterSection=c}),define("modules/clean/sharing/views/share_modal_header_section",["require","exports","tslib","external/classnames","external/react","react-dom","spectrum-sharing/sharing_modal_header","modules/clean/react/bubble","modules/clean/sharing/views/constants","modules/clean/em_string","modules/core/i18n","modules/clean/react/icon/folder_icon","modules/clean/sharing/share_modal_icon","modules/clean/sharing/constants"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=d.i18n_default_project("sharing"),_=h._,f=h.ungettext,g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleContentNameFocus=function(){t.props.actionHandler.handleContentNameFocusChange(!0)},t.handleContentNameBlur=function(){t.props.actionHandler.handleContentNameFocusChange(!1)},t.setHeaderInputRef=function(e){t.headerInput=e},t}return n.__extends(t,e),t.prototype.focusContentNameInput=function(){this.headerInput&&i.findDOMNode(this.headerInput.input).focus()},t.prototype.selectContentNameInput=function(){this.headerInput&&i.findDOMNode(this.headerInput.input).select()},t.prototype.render=function(){return this.props.isCreatingNewFolder?s.createElement(a.SharingModalHeaderInput,{ref:this.setHeaderInputRef,icon:s.createElement(p.SharedFolderIcon,null),inputAriaLabel:this.props.contentNameMessage,inputPlaceholder:this.props.isContentNameFocused?void 0:_("Folder name"),onClickCloseButton:this.props.onModalCloseClick,onInputChange:this.props.onContentNameInputChange,onInputFocus:this.handleContentNameFocus,onInputBlur:this.handleContentNameBlur,onInputKeyUp:this.props.onContentNameInputKeyUp},this.shouldShowContentNameBubble()&&this.renderContentNameBubble()):s.createElement(a.SharingModalHeaderTitle,{closeButtonVisible:!0,icon:this.getIcon(),subTitle:this.getMemberCountsString(),onClickCloseButton:this.props.onModalCloseClick,onClickSettingsButton:this.props.onSettingsButtonClick,settingsButtonVisible:this.props.isMetadataLoaded&&this.isContentSettingsEnabled(),title:this.getContentNameString()})},t.prototype.isContentNameInputError=function(){return this.props.contentNameMessageLevel===l.CONTENT_NAME_MESSAGE_LEVELS.ERROR},t.prototype.shouldShowContentNameBubble=function(){return this.props.contentNameMessage&&(this.props.isContentNameFocused||this.isContentNameInputError())},t.prototype.renderContentNameBubble=function(){return s.createElement(o,{arrow:o.ARROW.TOP,className:r("unified-share-modal__content-name__tooltip","u-pad-xs","u-font-strong",{"unified-share-modal__content-name__tooltip-error":this.isContentNameInputError()})},this.props.contentNameMessage)},t.prototype.getIcon=function(){var e=this.props.contentInfo;if(e.isFolder()){if(!e.extras.exists)return s.createElement(p.SharedFolderIcon,null);if(!this.props.isMetadataLoaded)return s.createElement(p.SimpleFolderIcon,null)}return s.createElement(u.ShareModalIcon,{alt:"",className:"unified-share-modal__title-icon",filename:e.name(),isSharedFolder:e.isSharedFolder(),isFolder:e.isFolder(),isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree===!0,isViewOnly:!this.props.canEdit,isConfidentialFolder:this.props.isConfidentialFolder,isCdm:this.props.user.is_cdm_member,pathExists:e.pathExists()})},t.prototype.getContentNameString=function(){return c.Emstring.em_snippet(this.props.contentInfo.name(),m.SNIPPET_SIZES.FILENAME)},t.prototype.getOutsideTeamString=function(){var e=this.props.sharingInfo,t=e.memberCounts();if(e.hasOutsideTeamMembers())return f("%(outside_team_count)s outside your Dropbox team","%(outside_team_count)s outside your Dropbox team",t.users_outside_team).format({outside_team_count:t.users_outside_team})},t.prototype.getMemberCountsString=function(){var e=this.props.sharingInfo.memberNum();if(e&&!this.props.isSendingForSignature){var t=this.props.sharingInfo.memberCounts(),n=this.getOutsideTeamString(),r=t?t.exceeds_count:void 0;return(n?f("%(member_num)s member (%(outside_team_string)s)","%(member_num)s members (%(outside_team_string)s)",e,{comment:'Description of the count of total folder members and count of outside-of-team folder members, like "10 members (3 outside of your Dropbox team)"'}):f("%(member_num)s member","%(member_num)s members",e)).format({member_num:e+(r?"+":""),outside_team_string:n})}},t.prototype.isContentSettingsEnabled=function(){return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings},t})(s.PureComponent);t.ShareModalHeaderSection=g}),define("modules/clean/sharing/views/sharing_bubble_menu",["require","exports","tslib","external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/sharing/constants","modules/clean/sharing/share_modal_dropdown_util","modules/clean/sharing/strings","modules/core/i18n"],function(e,t,n,r,s,i,a,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=d.i18n_default_project("sharing")._,u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderMenuItem=function(e){var t=this,n=e.value,r=e.title,l=e.file_description,c=e.folder_description,d=null;d=this.props.contentInfo&&this.props.contentInfo.isFolder()?c:l;var u=void 0;n!==this.props.currentAccess&&(u=function(){return t.props.onAccessChange(n)});var m=null;n===this.props.currentAccess&&(m=s.createElement(a.Sprite,{alt:"",group:"web",name:"check_gray"}));var h=this.props.memberDisplayName?this.props.memberDisplayName:"user",_=p("change permission for %(display_name)s to %(perm_title)s").format({display_name:h,perm_title:r}),f=function(e,t){return e===o.MEMBER_ACTION.REMOVE?s.createElement("div",{className:"u-font-danger"},t):t};return s.createElement(i.BubbleMenuItem,{className:"sharing-access-menu-item sharing-access-menu-item__with_hover",key:n,onClick:u},s.createElement("div",{className:"sharing-access-menu-item__left-margin u-l-ib u-l-ib--t"},m),s.createElement("div",{className:"sharing-access-menu-item__label u-l-ib u-l-ib--t"},s.createElement("div",{className:"u-font-nowrap u-font-black sharing-access-menu-item__title","aria-label":_},f(n,r)),s.createElement("div",{className:"u-font-wrap u-font-meta sharing-access-menu-item__description"},d)))},t.prototype.renderLinkViewerDisclosure=function(){return s.createElement(i.BubbleMenuItem,{className:"sharing-access-menu-item",key:"link-viewer-disclosure",disabled:"true"},s.createElement("div",{className:"sharing-access-menu-item__left-margin u-l-ib u-l-ib--t"}),s.createElement("div",{className:"sharing-access-menu-item__label u-l-ib u-l-ib--t"},s.createElement("div",{className:"u-font-nowrap sharing-access-menu-item__title"},p("Remove")),s.createElement("div",{className:"u-font-wrap sharing-access-menu-item__description"},p("People who viewed via link can’t be removed from files"))))},t.prototype.renderCurrentAccessText=function(e){var t=r({"sharing-access-menu__current-access":!0,"u-font-nowrap":!0,"c-btn--disabled":e,"sharing-access-menu__current-access--button":this.props.asButton,"c-btn":this.props.asButton,"c-btn--secondary":this.props.asButton,"u-trim-margin":this.props.asButton,"c-borderless-button":!this.props.asButton,"change-access-button":!this.props.asButton&&!e}),n=c.ACCESS_NAME[this.props.currentAccess];this.props.canMakeViewerNoComment&&(n=c.ACCESS_NAME_NO_COMMENT[this.props.currentAccess]);var i=null;e||(i=[s.createElement("div",{className:"gray-arrow",key:"gray"},s.createElement(a.Sprite,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"})),s.createElement("div",{className:"blue-arrow",key:"blue"},s.createElement(a.Sprite,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-blue"}))]);var o=(this.props.memberDisplayName?this.props.memberDisplayName+" ":"")+n;return s.createElement("button",{className:t,"aria-label":o},n,i)},t.prototype.render=function(){for(var e=[],t=0,n=l.getMemberActionInfo(this.props.allowRelinquishMembership,this.props.canMakeViewerNoComment);t<n.length;t++){var r=n[t],a=r[0],o=r[1];l.shouldShowMemberAction(a,o.value,this.props.currentAccess,this.props.memberPermissions,this.props.allowRelinquishMembership)&&e.push(this.renderMenuItem(o))}if(this.props.showLinkViewerDisclosure&&e.push(this.renderLinkViewerDisclosure()),e.length<=1||this.props.pendingAccessChange)return this.renderCurrentAccessText(!0);var c=0;return this.props.asButton&&(c=-5),s.createElement(i.BubbleMenu,{targetButton:this.renderCurrentAccessText(this.props.disabled||!1),targetFixed:!0,position:i.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-access-menu o-list-ui o-list-ui--dividers",items:e,shouldShowArrow:!1,disabled:this.props.disabled,verticalDisplacement:c})},t.displayName="SharingBubbleMenu",t.defaultProps={allowRelinquishMembership:!1,asButton:!1,canInviteMembers:!1,canMakeViewerNoComment:!1,disabled:!1,pendingAccessChange:void 0,showLinkViewerDisclosure:!1},t})(s.Component);t.SharingBubbleMenu=u}),define("modules/clean/sharing/views/viewer_info",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){e.when_last_seen&&(this.time_last_seen=new Date(1e3*e.when_last_seen));var t=e.seen_state_user;this.account_id=t.user_id,this.display_name=t.display_name,this.email=t.email,this.photo_circle_url=t.photo_circle_url,this.same_team=!0}return e.prototype.displayName=function(){return this.display_name},e.prototype.memberId=function(){return this.account_id},e})();t.ViewerInfo=n}),define("modules/clean/sharing/views/wrapped_group_viewers_maker",["require","exports","external/react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/title_bubble","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,r,s,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o.i18n_default_project("sharing"),c=l._,d=l.ungettext;(function(e){function t(e,t){for(var r=d("%(num_viewers)d viewer","%(num_viewers)d viewers",e.length).format({num_viewers:e.length}),s=e.length<=10,a=s?e.length:9,l=o(e[0],t),c=1;c<a;c++)l=l.concat(o(e[c],t));if(!s){var p=e.length-a,u=d("and %(num_others)d other","and %(num_others)d others",p).format({num_others:p});l=l.concat(n.createElement("tr",null,n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},u)))}return{element:n.createElement(i.TitleBubble,{content:n.createElement("table",{className:"group-tooltip__viewers-table"},n.createElement("tbody",null,l)),className:"group-tooltip",children:n.createElement("span",{className:"u-font-meta sharing-member-info__viewer-count-text"},r),position:i.TitleBubble.POSITIONS.BOTTOM,isTargetPositionFixed:!0}),elementText:r}}function o(e,t){var i=t.has(e.account_id)?c("Viewing now"):r.ago(e.time_last_seen,!1,!0);return[n.createElement("tr",null,n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},s.Emstring.em_snippet(e.displayName(),a.SNIPPET_SIZES.DISPLAY_NAME)),n.createElement("td",{className:"group-tooltip__viewers-table-cell dot"},"·"),n.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__seen-string"},i))]}e.make=t})(t.WrappedGroupViewersMaker||(t.WrappedGroupViewersMaker={}))}),define("modules/clean/teams/membership_discovery_util",["require","exports","external/lodash","modules/clean/ajax","modules/clean/growth/gating","modules/clean/loggers/growth_features_events_logger","modules/clean/react/modal","modules/clean/stormcrow/experiment","modules/constants/teams","modules/constants/trademark","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.INVITE_MODAL_CLOSED="magnet-invite-modal-closed"})(t.MembershipDiscoveryEvents||(t.MembershipDiscoveryEvents={})),t.getDiscoverableTeamForFolder=function(e,t){return r.WebRequest({url:"/team/discover/get_discoverable_team_for_folder",type:"POST",data:{ns_id:e},success:function(e){return e=JSON.parse(e),t(null!=e?e.team:void 0)},error:function(){return t()}})},t.sendTeamRequest=function(e,t){return r.WebRequest({url:"/team/discover/join_ajax",data:{team_id:e,cont:"#"},success:function(e){switch(e=JSON.parse(e),null!=e?e.result:void 0){case"request_sent":u.Notify.success(p._("Request to join sent."));break;case"can_join":d.redirect(e.url);break;case"max_team_size_achieved":
u.Notify.error(p._("This team has reached the maximum size. Please ask the admins of this team to upgrade to %(trademark_business)s, which allows teams to add as many members as possible.").format({trademark_business:c.TRADEMARK_BUSINESS}));break;case"pending_approval":u.Notify.success(p._("Your request to join is pending."));break;default:u.Notify.error(p._("Invalid request"))}return"function"==typeof t?t(e):void 0},error:function(){return u.Notify.error(p._("Error sending request.")),"function"==typeof t?t():void 0}})},t.sendLimitedTeamInvitations=function(e,t,n,s){return r.WebRequest({url:"/account/team/add_users",subject_user:t,data:{emails:e,team_id:n},success:function(e){if(e=JSON.parse(e),e.num_invited){var t=p.ungettext("Invitation sent.","Invitations sent.",e.num_invited);u.Notify.success(t)}s()},error:function(){var t=p.ungettext("Error sending invitation.","Error sending invitations.",e.length);u.Notify.error(t),s()}})},t.sendAdminTeamInvitations=function(e,n,s,o,l){return r.WebRequest({url:"/account/team/add_users",subject_user:n,data:{emails:e,team_id:s},success:function(t){var r={subject_user_id:n.id,team_id:s,num_suggested_users:e.length};if(i.logMagnetEvent("send_admin_invite_ajax_success",r),t=JSON.parse(t),t.num_invited){var a=p.ungettext("Invitation sent.","Invitations sent.",t.num_invited);u.Notify.success(a)}l()},error:function(r){var c={subject_user_id:n.id,team_id:s,num_suggested_users:e.length,response_text:r.responseText};return i.logMagnetEvent("send_admin_invite_ajax_fail",c),r.responseText.includes("You need an additional license to invite this user.")||r.responseText.includes("You need more licenses to invite these users.")?a.SimpleModal.show({title_text:p._("No available licenses"),body_html:p._("You don’t have enough available licenses to invite additional members. Please visit the admin console to purchase more licenses."),confirm_text:p._("Go to admin console"),confirm_callback:function(){return c={team_id:s,ui_object:"not_enough_licenses_modal"},i.logMagnetEvent("go_to_admin_console_clicked",c),d.redirect(new m.URI({path:"/team/admin/members",query:{invite_emails:btoa(e.join(","))}}))},cancel_text:p._("Not now"),cancel_callback:function(){c={team_id:s,ui_object:"not_enough_licenses_modal"},i.logMagnetEvent("not_now_clicked",c),l()}}):t.sendTeamSuggestions(e,o,function(){return d.redirect(new m.URI({path:"/team/admin/requests",query:{invite_emails:e}}))})}})},t.sendTeamSuggestions=function(e,t,n,s){return r.WebRequest({url:"/team/discover/suggest_ajax",data:{emails:JSON.stringify(e),ns_id:JSON.stringify(t)},success:function(t){var r=p.ungettext("Suggestion sent.","Suggestions sent.",e.length);return u.Notify.success(r),"function"==typeof n?n(t):void 0},error:function(){var t=p.ungettext("Error sending suggestion.","Error sending suggestions.",e.length);return u.Notify.error(t),"function"==typeof s?s():void 0}})},t.isLoggedExpUjMagnet2018=function(e){return e&&(i.EXP_UJ_MAGNET2018_LOGGED_VARIANTS.includes(l.UJ_MAGNET2018_ADMIN)||i.EXP_UJ_MAGNET2018_LOGGED_VARIANTS.includes(l.UJ_MAGNET2018_MEMBER))},t.isOnExpUjMagnet2018=function(e){return e&&(i.EXP_UJ_MAGNET2018_ON_VARIANTS.includes(l.UJ_MAGNET2018_ADMIN)||i.EXP_UJ_MAGNET2018_ON_VARIANTS.includes(l.UJ_MAGNET2018_MEMBER))},t.shouldShowMembershipSuggestionModal=function(e){return e&&(o.Experiment(l.UJ_MAGNET2018_ADMIN).variantIn("V1","V2")||o.Experiment(l.UJ_MAGNET2018_MEMBER).variantIn("V1","V2"))},t.shouldShowMembershipSuggestionBanner=function(){return o.Experiment(l.UJ_MAGNET2018_ADMIN).variantIs("V3")},t.filterSuggestableUsers=function(e,t,s){var a=t.reduce(function(t,n){return n.invalid||!n.email||n.dbx_team_id===e.team_dbtid||n.group_id||t.push(n.email),t},[]);if(a.length>0&&!n.isEqual(a,s)){return{emails:a,promise:new Promise(function(e,t){r.WebRequest({url:"/team/discover/filter_suggestable_ajax",type:"POST",data:{emails:JSON.stringify(a)},success:function(t){var n=JSON.parse(t);n.contacts&&n.contacts.length>0&&i.logMagnetEvent("share_modal_entered_out_of_team",{recipients:n.contacts.map(function(e){return e.id})}),e(n)},error:function(){t()}})}),ts:(new Date).getTime()}}return{}},t.showExpUjMagnet2018PostShare=function(e,t,n){if(t&&t.contacts&&t.contacts.length>0){var r=t.contacts,s=t.experiments,i=t.is_admin,a=t.team_size;o.Experiment(s.immExperiments.expSubgrowthBizTeamsImmParity).variantIs("V1")?e(i,r,a,s,n):n&&d.redirect(n.toString())}else n&&d.redirect(n.toString())},t.showExpUjMagnet2018PostShareIfQualified=function(e,n,r,s,i){t.shouldShowMembershipSuggestionModal(e)&&(r?r.then(function(e){t.showExpUjMagnet2018PostShare(n,e,i)}):s?t.showExpUjMagnet2018PostShare(n,s,i):i&&d.redirect(i.toString()))},t.maybeLogExpUjMagnet2018Exposure=function(e,t,n){if(e&&t&&t.contacts&&t.contacts.length>0){var r=t.is_admin?"uj_magnet2018_admin":"uj_magnet2018_member";return s.growthCheckGating(n,r),!0}return!1}}),define("modules/clean/teams/modals/create_team_prompt_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/react/button","modules/clean/react/image","modules/clean/react/modal","modules/clean/static_urls","modules/clean/stormcrow/experiment","modules/clean/stormcrow/stormcrow_exposure_logger","modules/constants/teams","modules/constants/trademark","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g;(function(e){e[e.CLICK_CREATE=0]="CLICK_CREATE",e[e.DISMISS=1]="DISMISS",e[e.CLICK_NEXT_TIME=2]="CLICK_NEXT_TIME"})(g||(g={}));var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickCreate=function(){var e;if(t.isNbgWebClientFolderShareModal.variantIs("V1"))e=new f.URI({path:"/business/try"});else{var n=t.props.invitedMembers.map(function(e){return e.email}).filter(function(e){return"string"==typeof e&&""!==e});e=new f.URI({path:"/team",query:{tk:"tib_upsell",invite_members:n.join(",")}})}h.redirect(e.toString()),t.logClick(g.CLICK_CREATE)},t.onClickNextTime=function(){l.Modal.close(),t.logClick(g.CLICK_NEXT_TIME)},t.onDismiss=function(){s.WebRequest({url:"/team/stop_show_create_team_modal"}),t.logClick(g.DISMISS)},t}return n.__extends(t,e),Object.defineProperty(t.prototype,"isNbgWebClientFolderShareModal",{get:function(){return d.Experiment(u.NBG_WEB_CLIENT_FOLDER_SHARE_MODAL)},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){p.logVariantExposure("nbg_web_client_folder_share_modal",u.NBG_WEB_CLIENT_FOLDER_SHARE_MODAL)},t.prototype.logClick=function(e){i.TeamsWebActionsLogger.log("share_crt_team_modal",{num_shared:this.props.invitedMembers.length,clicked_create:e===g.CLICK_CREATE,clicked_nxt_time:e===g.CLICK_NEXT_TIME,dismissed:e===g.DISMISS})},t.prototype.renderButtons=function(){return r.createElement("div",{className:"db-modal-buttons"},r.createElement(a.Button,{className:"dbmodal-button",importance:"primary",onClick:this.onClickCreate},this.isNbgWebClientFolderShareModal.variantIs("V1")?_._("Try %(trademark_business)s free").format({trademark_business:m.TRADEMARK_BUSINESS}):_._("Create free work Dropbox")),r.createElement(a.Button,{className:"dbmodal-button",importance:"tertiary",onClick:this.onClickNextTime},_._("Ask me next time")))},t.prototype.render=function(){for(var e=[],t=0,n=this.props.invitedMembers;t<n.length;t++){var s=n[t];s.name&&s.name!==s.email&&e.push(s.name)}var i=_._("Work with these people often?");return 2===e.length&&2===this.props.invitedMembers.length?i=_._("Work with %(firstname_1)s and %(firstname_2)s often?").format({firstname_1:e[0],firstname_2:e[1]}):3===e.length&&3===this.props.invitedMembers.length&&(i=_._("Work with %(firstname_1)s, %(firstname_2)s, and %(firstname_3)s often?").format({firstname_1:e[0],firstname_2:e[1],firstname_3:e[2]})),r.createElement(l.Modal,{style:"clean",className:"create-team-modal-after-sharing",buttonComponent:this.renderButtons(),onDismiss:this.onDismiss,clickOutToClose:!1,showX:!0,width:500},r.createElement("div",null,this.isNbgWebClientFolderShareModal.variantIs("V1")?r.createElement(o.Image,{className:"create-team-modal__team-illo u-mar-top-l",alt:_._("Try %(trademark_business)s").format({trademark_business:m.TRADEMARK_BUSINESS}),src:c.static_url("/static/images/teams/modals/illo_create_team-vfloYU16I.png"),srcHiRes:c.static_url("/static/images/teams/modals/illo_create_team-vfloYU16I.png")}):r.createElement(o.Image,{className:"create-team-modal__team-illo u-mar-top-l",alt:_._("Work together"),src:c.static_url("/static/images/teams/modals/illo_how-create-vflQTQkfN.png"),srcHiRes:c.static_url("/static/images/teams/modals/illo_how-create@2x-vfld7opTv.png")}),r.createElement("h1",{className:"create-team-modal__header u-mar-top-m u-mar-bottom-s"},i),this.isNbgWebClientFolderShareModal.variantIs("V1")?r.createElement("div",{className:"create-team-modal__subheader create-team-modal__subheader--nbg-web-client-folder-share-modal"},_._("Join %(trademark_business)s to make collaborating easier, with more space to share files,                 more control, and dedicated support to help your team thrive.").format({trademark_business:m.TRADEMARK_BUSINESS})):r.createElement("div",{className:"create-team-modal__subheader"},_._("Get a free 2 GB work Dropbox to organize projects in one place,                 collaborate from anywhere, and stay in sync."))))},t})(r.Component);t.CreateTeamPromptModal=S}),define("modules/clean/zendesk_feedback",["require","exports","tslib","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/ajax","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/select","modules/clean/sharing/views/hover_close_button","modules/core/i18n","modules/core/notify"],function(e,t,n,r,s,i,a,o,l,c,d,p,u,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=r.createElement,f=m.i18n_default_project("sharing")._,g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){return s.findDOMNode(this.refs.textbox).focus()},t.prototype.render=function(){var e=this;return _(d.Modal,{className:"zendesk-feedback-form",title:f("Send us your feedback"),acceptButtonDisabled:!this.state.message||this.state.isSending,acceptButtonText:f("Send feedback"),autoClose:!1,dismissButtonText:f("Cancel"),onAccept:function(){e.setState({isSending:!0});return I("truelink_feedback",{categoryTag:e.state.message},function(){return e.setState({isSending:!1})})}},i.label({htmlFor:"feedback-category"},f("Category")),_(p.input,{ref:"category",className:"u-mar-bottom-m feedback-category",id:"feedback-category",defaultValue:this.props.defaultCategory},_(p.option,{value:"sender"},f("I have feedback about sharing links with others")),_(p.option,{value:"receiver"},f("I have feedback about accessing links shared with me")),_(p.option,{value:"settings"},f("I have feedback about changing sharing settings")),_(p.option,{value:"general"},f("I have general feedback")),_(p.option,{value:"bug"},f("I found a bug"))),i.label({htmlFor:"feedback-content"},f("What is your feedback?")),i.textarea({className:"zendesk-feedback-form__textbox",id:"feedback-content",onChange:function(t){return e.setState({message:t.target.value})},ref:"textbox"}))},t.displayName="OpenFeedbackForm",t.propTypes={defaultCategory:a.string},t})(r.Component),S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){return s.findDOMNode(this.refs.mainButton).focus()},t.prototype.render=function(){var e=this;return i.div({className:"zendesk-flyout"},i.div({className:"zendesk-flyout__header u-pad-left-l u-pad-bottom-m u-pad-top-m"},f("Have a moment?"),_(u,{className:"zendesk-flyout__x u-mar-right-m",onClick:function(){return"function"==typeof e.props.onCloseClick&&e.props.onCloseClick(),v()}})),i.div({className:"u-pad-left-l u-mar-bottom-m u-pad-top-m u-mar-right-m"},f("Help us make your Dropbox experience even better by sending us your feedback."),i.button({className:"c-btn c-btn--primary u-mar-top-m zendesk-flyout__main_button",onClick:function(){return v(),d.Modal.showInstance(_(b,e.props))},ref:"mainButton"},f("Give feedback"))))},t.displayName="FeedbackFlyout",t.propTypes={defaultCategory:a.string,onCloseClick:a.func},t})(r.Component),E=c(S,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),b=c(g,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),y=function(e){var t=function(){return l.BackgroundRequest({url:"/sharing/show_feedback_flyout",data:{dont_show_again:!0}})};return l.WebRequest({url:"/sharing/show_feedback_flyout",success:function(n){if(JSON.parse(n)){var r=o("<div />").attr({class:"zendesk-flyout-container"}).prependTo("body")[0];return s.render(_(E,{onCloseClick:t,defaultCategory:e}),r)}}})};t.showFeedbackFlyoutIfAllowed=y;var v=function(){return o(".zendesk-flyout-container").remove()},I=function(e,t,n){return l.WebRequest({url:"/log/file_collab_feedback",data:{feedback_tag:e,user_feedback:JSON.stringify(t)},success:function(){return h.Notify.success(f("Thanks for helping make Dropbox better!")),d.Modal.close()},error:n})}}),define("spectrum-sharing/icons/icon_dropdown_caret",["require","exports","react"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconDropdownCaretOsx=function(e){var t=e.className,r=e.variant,s=void 0===r?"default":r;return n.createElement("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",viewBox:"0 0 9 5"},n.createElement("path",{fill:"none",fillRule:"evenodd",stroke:"highlighted"===s?"#0269D9":"#3E3E3E",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 1L4.5 4 1 1"}))},t.IconDropdownCaretWin=function(e){var t=e.className,r=e.variant,s=void 0===r?"default":r;return n.createElement("svg",{className:t,width:"12px",height:"6px",viewBox:"0 0 12 6",xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{stroke:"highlighted"===s?"#0269D9":"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",fillOpacity:"0.8"},n.createElement("g",{fill:"#000000"},n.createElement("polygon",{points:"6 5.01369863 11.4626866 0 12 0.493150685 6 6 0 0.493150685 0.537313433 0"}))))},t.IconDropdownCaretWeb=function(e){var t=e.className;return n.createElement("svg",{className:t,width:"7px",height:"4px",viewBox:"0 0 7 4",xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.createElement("g",{transform:"translate(-509.000000, -24.000000)",fill:"#637282"},n.createElement("g",{transform:"translate(444.000000, 16.000000)"},n.createElement("polygon",{points:"65 8 72 8 68.5 12"})))))},t.IconDropdownCaretOsx.displayName="IconDropdownCaretOsx",t.IconDropdownCaretWin.displayName="IconDropdownCaretWin",t.IconDropdownCaretWeb.displayName="IconDropdownCaretWeb"}),define("spectrum-sharing/icons/icon_dropdown_selected",["require","exports","react"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconDropdownSelected=function(e){var t=e.className;return n.createElement("svg",{className:t,width:"12px",height:"12px",viewBox:"0 0 12 12",xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.createElement("g",{fill:"#3E3E3E",fillRule:"nonzero"},n.createElement("path",{d:"M2.25927473,6.3493149 C1.89985258,5.92998906 1.2685526,5.88142752 0.849226756,6.24084967\n                  C0.429900914,6.60027182 0.381339377,7.2315718 0.740761528,7.65089765 L3.65485393,11.0506721\n                  C3.75823486,11.1606625 3.75823486,11.1606625 3.87986598,11.2500569 C4.38534754,11.5870446\n                  5.06830382,11.4504534 5.40529152,10.9449718 L11.3320684,2.05480647 C11.6384209,1.59527778\n                  11.514247,0.974408438 11.0547183,0.668055979 C10.5951896,0.36170352 9.97432029,0.485877389\n                  9.66796784,0.945406077 L4.40019879,8.84705964 L2.25927473,6.3493149 Z"}))))},t.IconDropdownSelected.displayName="IconDropdownSelected"}),define("spectrum-sharing/icons/icon_link",["require","exports","react"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={default:"transparent",active:"#D0D4D9"},s=function(e){var t=e.className,s=e.variant;return n.createElement("svg",{className:t,width:"32px",height:"32px",viewBox:"0 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.createElement("circle",{stroke:"#D0D4D9",strokeWidth:"1.32",cx:"16",cy:"16",r:"15.34",fill:r[s||"default"]}),n.createElement("g",{fill:"#6A7C8F",transform:"translate(16.071068, 16.071068) rotate(-315.000000)\n                    translate(-16.071068, -16.071068) translate(13.071068, 9.071068)"},n.createElement("path",{d:"M5.98487348,4.76239943 L4.58487348,4.76239943 L4.58487348,3.36107038\n                        C4.58487348,2.58309388 3.95807213,1.96239943 3.18487348,1.96239943\n                        C2.40628423,1.96239943 1.78487348,2.58860575 1.78487348,3.36107038\n                        L1.78487348,6.16372849 C1.78487348,6.94170499 2.41167483,7.56239943\n                        3.18487348,7.56239943 L3.18487348,8.96239943 C1.63847618,8.96239943\n                        0.384873479,7.70483456 0.384873479,6.16532106 L0.384873479,3.3594778\n                        C0.384873479,1.81469408 1.64162279,0.562399434 3.18487348,0.562399434\n                        C4.73127078,0.562399434 5.98487348,1.81996431 5.98487348,3.3594778\n                        L5.98487348,4.76239943 Z"}),n.createElement("path",{d:"M0.384873479,9.66239943 L1.78487348,9.66239943 L1.78487348,11.0637285\n                        C1.78487348,11.841705 2.41167483,12.4623994 3.18487348,12.4623994\n                        C3.96346273,12.4623994 4.58487348,11.8361931 4.58487348,11.0637285\n                        L4.58487348,8.26107038 C4.58487348,7.48309388 3.95807213,6.86239943\n                        3.18487348,6.86239943 L3.18487348,5.46239943 C4.73127078,5.46239943\n                        5.98487348,6.71996431 5.98487348,8.2594778 L5.98487348,11.0653211\n                        C5.98487348,12.6101048 4.72812417,13.8623994 3.18487348,13.8623994\n                        C1.63847618,13.8623994 0.384873479,12.6048346 0.384873479,11.0653211\n                        L0.384873479,9.66239943 Z"}))))};t.IconLink=s}),define("spectrum-sharing/icons/icon_settings_gear",["require","exports","react"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return n.createElement("svg",{width:"24",height:"24",viewBox:"-4 -4 24 24"},n.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.createElement("g",{transform:"translate(-8.000000, -8.000000)",fill:"#6A7C8F"},n.createElement("path",{d:"M24,15.2 L24,17.1428571 L21.4857143,17.1428571 C21.2888229,17.8170566 21.0206419,\n            18.4683533 20.6857143,19.0857143 L22.0571429,21.0285714 L20.6857143,22.4 L18.8571429,\n            21.0285714 C18.2754139,21.325336 17.6619932,21.5553687 17.0285714,21.7142857 L16.8,24\n            L14.8571429,24 L14.5142857,21.8285714 C13.8530915,21.7734369 13.2201272,21.5360752\n            12.6857143,21.1428571 L10.8571429,22.5142857 L9.6,21.1428571 L10.9714286,19.0857143\n            C10.6251458,18.4858566 10.3926725,17.8271824 10.2857143,17.1428571 L8,17.0285714\n            L8,14.9714286 L10.2857143,14.7428571 C10.4547526,14.0951222 10.7247251,13.4780422\n            11.0857143,12.9142857 L9.6,11.0857143 L10.9714286,9.6 L12.8,10.9714286 C13.3973396,\n            10.711597 14.0076729,10.4827221 14.6285714,10.2857143 L14.9714286,8 L16.9142857,8\n            17.2571429,10.2857143 C17.9212591,10.4043389 18.5478652,10.678479 19.0857143,11.0857143\n            L20.9142857,9.6 L22.2857143,10.9714286 L20.9142857,12.9142857 C21.3270172,13.533851\n            21.5999981,14.2358018 21.7142857,14.9714286 L24,15.2 Z M16,19.4285714 C17.8935477,\n            19.4285714 19.4285714,17.8935477 19.4285714,16 C19.4285714,14.1064523 17.8935477,\n            12.5714286 16,12.5714286 C14.1064523,12.5714286 12.5714286,14.1064523 12.5714286,16\n            C12.5714286,17.8935477 14.1064523,19.4285714 16,19.4285714 Z"}))))};t.IconSettingsGear=r}),define("spectrum-sharing/input",["require","exports","tslib","spectrum-sharing/input/input"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/input/input",["require","exports","tslib","classnames","react","spectrum/input"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,a=e.variant,o=n.__rest(e,["className","variant"]),l=r("scl-input",t,"scl-input--"+a),c="borderless"===a?"default":a;return s.createElement(i.Input,n.__assign({className:l,variant:c},o))},t.displayName="Input",t})(s.PureComponent);t.Input=a}),define("spectrum-sharing/member_row",["require","exports","tslib","spectrum-sharing/member_row/member_row"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/member_row/member_row",["require","exports","tslib","classnames","react","spectrum/avatar","spectrum-sharing/scooter_loader","spectrum-sharing/sharing_avatar_initials","spectrum-sharing/sharing_portal_dropdown"],function(e,t,n,r,s,i,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDropdownChange=function(e){var n=t.props,r=n.id,s=n.onChange;s&&s(r,e)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.variant,i=void 0===n?"default":n,a=e.position,o=void 0===a?"default":a,l=(e.initialAvatarShape,e.tag),c=l||"li",d=r(t,{"scl-member-row":!0,"scl-member-row-borderless":"borderless"===i,"scl-member-row-default":"default"===i,"scl-member-row-narrow":"narrow"===i},{"scl-member-row-positioned":"bottom"===o||"middle"===o,"scl-member-row-bottom":"bottom"===o});return s.createElement(c,{className:d},s.createElement("div",{className:"scl-member-row-outer"},this.renderAvatar(),s.createElement("div",{className:"scl-member-row-info"},this.renderDisplayName(),this.renderMemberDetails())),this.renderRightSideElement())},t.prototype.renderAvatar=function(){var e=this.props,t=e.avatarHidden,n=e.avatarUrl,r=e.avatarElement,a=(e.className,e.displayName),l=e.id,c=e.initials,d=e.initialAvatarShape;return t?s.createElement("div",{className:"scl-member-row-avatar-empty"}):r?r:n?s.createElement(i.Avatar,{src:n,className:"scl-member-row-avatar"}):s.createElement(o.SharingAvatarInitials,{avatarSize:32,backgroundColor:i.avatarColorForUserIdentifier(a||l),className:"scl-member-row-avatar",shape:d},c)},t.prototype.renderRightSideElement=function(){var e=this.props,t=e.id,n=e.loadingSpinnerVisible,r=e.optionGroup;return n?s.createElement(a.ScooterLoader,null):r&&1===r.options.length?s.createElement("div",null," ",r.label," "):r?s.createElement(l.SharingPortalDropdown,{id:t,optionGroup:r,onSelection:this.handleDropdownChange}):null},t.prototype.renderDisabledMessage=function(){return this.props.disabledMessage?[s.createElement("span",{className:"u-font-meta dot"},"·"),s.createElement("span",{className:"u-font-danger"}," ",this.props.disabledMessage)]:null},t.prototype.renderNameTitleAndText=function(){return s.createElement("span",{className:"scl-member-row-info-display-name-title",title:this.props.displayName},this.props.truncatedDisplayName||this.props.displayName)},t.prototype.renderPASSDot=function(){return this.props.passString?s.createElement("span",{className:"scl-member-row-dot"},"·"):null},t.prototype.renderOffTeamDot=function(){return this.props.offTeamMessage?s.createElement("span",{className:"u-font-meta"},"·"):null},t.prototype.renderPASS=function(){var e=this.props,t=e.present,n=e.passString;if(n){var i=r({"scl-member-row-last-seen":!0,"scl-member-row-last-seen-not-present":!t});return s.createElement("span",{className:i},n)}return null},t.prototype.renderDisplayName=function(){return s.createElement("div",{className:"scl-member-row-display-name"},this.renderNameTitleAndText(),this.renderDisabledMessage(),this.renderPASSDot(),this.renderPASS())},t.prototype.renderOffTeamMessage=function(e){return e?s.createElement("span",{className:"u-font-meta"},e):null},t.prototype.renderMemberDetails=function(){var e=this.props,t=e.description,n=e.offTeamMessage,r=e.truncatedDescription;return s.createElement("div",{className:"scl-member-row-details"},s.createElement("span",{className:"scl-member-row-details-span",title:t},r||t),this.renderOffTeamDot(),this.renderOffTeamMessage(n))},t.displayName="MemberRow",t})(s.PureComponent);t.MemberRow=c}),define("spectrum-sharing/scooter_loader",["require","exports","tslib","spectrum-sharing/scooter_loader/scooter_loader"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/scooter_loader/scooter_loader",["require","exports","tslib","classnames","react"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScooterLoader=function(e){var t=e.className,i=n.__rest(e,["className"]);return s.createElement("div",n.__assign({className:r("scl-scooter-loader",t)},i),s.createElement("div",{className:"scl-scooter-loader-animation"}))},t.ScooterLoader.displayName="ScooterLoader"}),define("spectrum-sharing/sharing_avatar_initials",["require","exports","tslib","spectrum-sharing/sharing_avatar_initials/sharing_avatar_initials"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/sharing_avatar_initials/sharing_avatar_initials",["require","exports","tslib","classnames","react"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingAvatarInitials=function(e){var t=e.children,i=e.className,a=e.backgroundColor,o=e.avatarSize,l=void 0===o?32:o,c=e.variant,d=e.shape,p=n.__rest(e,["children","className","backgroundColor","avatarSize","variant","shape"]),u=r("scl-sharing-avatar-initials-"+l+"-"+d,{"scl-avatar-text-inactive":"inactive"===c,"scl-sharing-avatar-text":!0},i),m={background:""+a,border:"1px solid "+a,borderRadius:"square"===d?"12%":"50%",height:l+"px",width:l+"px"};return s.createElement("div",n.__assign({className:u,style:m},p),t)},t.SharingAvatarInitials.displayName="SharingAvatarInitials"}),define("spectrum-sharing/sharing_contact_token",["require","exports","tslib","spectrum-sharing/sharing_contact_token/sharing_contact_token"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/sharing_contact_token/sharing_contact_token",["require","exports","tslib","react","spectrum/avatar","spectrum/tooltip"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.avatarUrl,n=e.displayName,a=e.validation,o=r.createElement("div",{style:{display:"flex",maxWidth:"200px"}},t&&r.createElement(s.Avatar,{size:16,src:t}),r.createElement("div",{style:{flex:"auto",marginLeft:"5px",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},n));return a&&"invalid"==a.state?r.createElement(i.Tooltip,{tooltipContent:a.msg?a.msg:""},o):o},t.displayName="SharingContactToken",t})(r.PureComponent);t.SharingContactToken=a}),define("spectrum-sharing/sharing_dropdown_menu",["require","exports","tslib","spectrum-sharing/sharing_dropdown_menu/sharing_dropdown_menu","spectrum-sharing/sharing_dropdown_menu/sharing_dropdown_menu_button","spectrum-sharing/sharing_dropdown_menu/sharing_dropdown_menu_item"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t),n.__exportStar(s,t),n.__exportStar(i,t)}),define("spectrum-sharing/sharing_dropdown_menu/sharing_dropdown_menu",["require","exports","tslib","classnames","react","spectrum/dropdown_menu"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseClassName="scl-sharing-dropdown-menu",t.SharingDropdownMenu=function(e){var a=n.__rest(e,[]),o=a.position,l=n.__rest(a,["position"]),c=r(t.baseClassName,(d={},d[t.baseClassName+"--right"]="right"===o,d));return s.createElement(i.DropdownMenu,n.__assign({className:c},l));var d},t.SharingDropdownMenu.displayName="SharingDropdownMenu"}),define("spectrum-sharing/sharing_dropdown_menu/sharing_dropdown_menu_button",["require","exports","tslib","classnames","react","spectrum/dropdown_menu","spectrum-sharing/icons/icon_dropdown_caret"],function(e,t,n,r,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="scl-sharing-dropdown-menu-button",l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.children,l=e.className,c=n.__rest(e,["children","className"]),d=r(o,l);return s.createElement(i.DropdownMenuButton,n.__assign({className:d},c),t,s.createElement(a.IconDropdownCaretOsx,{className:o+"__icon "+o+"__icon--osx"}),s.createElement(a.IconDropdownCaretWin,{className:o+"__icon "+o+"__icon--win"}))},t.displayName="SharingDropdownMenuButton",t})(s.PureComponent);t.SharingDropdownMenuButton=l}),define("spectrum-sharing/sharing_dropdown_menu/sharing_dropdown_menu_item",["require","exports","tslib","classnames","react","spectrum/dropdown_menu","spectrum-sharing/icons/icon_dropdown_selected"],function(e,t,n,r,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="scl-sharing-dropdown-menu-item";t.SharingDropdownMenuItem=function(e){var t=e.description,l=e.label,c=e.selected,d=e.value,p=n.__rest(e,["description","label","selected","value"]);return s.createElement(i.MenuItem,n.__assign({className:o,key:d,value:d,text:l,selected:c},p),c&&s.createElement(a.IconDropdownSelected,{className:o+"__selected-icon"}),s.createElement("div",{className:r(o+"__wrapper",(u={},u[o+"__wrapper-selected"]=c,u))},s.createElement("div",{className:o+"__label"},l),s.createElement("div",{className:o+"__description"},t)));var u},t.SharingDropdownMenuItem.displayName="SharingDropdownMenuItem"}),define("spectrum-sharing/sharing_menu",["require","exports","tslib","spectrum-sharing/sharing_menu/sharing_menu","spectrum-sharing/sharing_menu/sharing_menu_item"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t),n.__exportStar(s,t)}),define("spectrum-sharing/sharing_menu/sharing_menu",["require","exports","tslib","react","classnames","spectrum/dropdown_menu"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingMenu=function(e){var t=e.className,a=n.__rest(e,["className"]),o=s(t,"scl-sharing-menu");return r.createElement(i.Menu,n.__assign({className:o},a))},t.SharingMenu.displayName="SharingMenu"}),define("spectrum-sharing/sharing_menu/sharing_menu_item",["require","exports","tslib","classnames","react","spectrum/dropdown_menu","spectrum-sharing/icons/icon_dropdown_selected"],function(e,t,n,r,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){var t=e.value,o=e.label,l=e.description,c=e.selected,d=e.variant,p=void 0===d?"default":d;n.__rest(e,["value","label","description","selected","variant"]);return s.createElement(i.MenuItem,{key:t,value:t,text:o,selected:c},c&&s.createElement(a.IconDropdownSelected,{className:"scl-sharing-menu-item-selected-icon"}),s.createElement("div",{className:r("scl-sharing-menu-item-wrapper",{
"scl-sharing-menu-item-wrapper-selected":c})},s.createElement("div",{className:r("scl-sharing-menu-item-label",{"scl-sharing-menu-item-label-default":"default"===p,"scl-sharing-menu-item-label-red":"red"===p})},o),s.createElement("div",{className:"scl-sharing-menu-item-description"},l)))};t.SharingMenuItem=o}),define("spectrum-sharing/sharing_modal_banner",["require","exports","tslib","spectrum-sharing/sharing_modal_banner/sharing_modal_banner"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/sharing_modal_banner/sharing_modal_banner",["require","exports","tslib","classnames","react"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.typeClassName=function(){return"scl-sharing-modal-banner--"+this.props.type},t.prototype.render=function(){var e=this.props,t=e.borderHidden,n=e.className,i=e.message,a=r("scl-sharing-modal-banner",this.typeClassName(),n,(o={},o["scl-sharing-modal-banner--bottom-border"]=!t,o));return s.createElement("div",{className:a},i);var o},t.defaultProps={type:"default"},t})(s.PureComponent);t.SharingModalBanner=i}),define("spectrum-sharing/sharing_modal_contacts_field",["require","exports","tslib","spectrum-sharing/sharing_modal_contacts_field/sharing_modal_contacts_field"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/sharing_modal_contacts_field/sharing_modal_contacts_field",["require","exports","tslib","classnames","react","spectrum/dropdown_menu","spectrum/tooltip","spectrum-sharing/sharing_dropdown_menu"],function(e,t,n,r,s,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseClassName="scl-sharing-modal-contacts-field";var l=(function(e){function l(t){var n=e.call(this,t)||this;return n.renderDropdown=function(){var e=n.props,t=(e.className,e.labelledAccessTypes),r=e.selectedAccessType,l=e.showNoEditTooltip,c=e.noEditText,d=r?r.label:void 0,p=s.createElement(o.SharingDropdownMenu,{position:"right",onSelection:n.handleChange},s.createElement(o.SharingDropdownMenuButton,{disabled:l},d),s.createElement(i.Menu,null,t.map(function(e){return s.createElement(o.SharingDropdownMenuItem,{"aria-label":e.ariaLabel,description:e.details,key:e.apiId,label:e.label,selected:r&&r.apiId===e.apiId,value:e.apiId})})));return l?s.createElement(a.Tooltip,{positioning:"below",tooltipContent:c},p):p},n.handleChange=function(e){n.props.onAccessTypeChange&&n.props.onAccessTypeChange(e)},n}return n.__extends(l,e),l.prototype.render=function(){var e=this.props,n=e.className,i=e.toLabel,a=r(t.baseClassName,n);return s.createElement("div",{className:a},s.createElement("div",{className:t.baseClassName+"__left"},s.createElement("div",{className:t.baseClassName+"__to-label"},i),s.createElement("div",{className:t.baseClassName+"__input"},this.props.contactsField)),s.createElement("div",{className:t.baseClassName+"__right"},this.renderDropdown()))},l})(s.PureComponent);t.SharingModalContactsField=l}),define("spectrum-sharing/sharing_modal_footer_inband",["require","exports","tslib","spectrum-sharing/sharing_modal_footer_inband/sharing_modal_footer_inband"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/sharing_modal_footer_inband/sharing_modal_footer_inband",["require","exports","tslib","classnames","react","spectrum/button"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.textButtonShare,a=e.isButtonShareDisabled,o=e.onClickButtonShare,l=r("scl-sharing-modal-footer-inband",t),c=s.createElement(i.Button,{variant:"primary","aria-label":n,onClick:o,disabled:a},n);return s.createElement("div",{className:l},c)},t.defaultProps={shareButtonDisabled:!1},t})(s.PureComponent);t.SharingModalFooterInband=a}),define("spectrum-sharing/sharing_modal_footer_link",["require","exports","tslib","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_create","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_disabled","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_loading","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_options","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_copy"],function(e,t,n,r,s,i,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t),n.__exportStar(s,t),n.__exportStar(i,t),n.__exportStar(a,t),n.__exportStar(o,t),n.__exportStar(l,t)}),define("spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link",["require","exports","tslib","classnames","react","spectrum-sharing/icons/icon_link"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseClassName="scl-sharing-modal-footer-link";var a=(function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(a,e),a.prototype.render=function(){var e=r(t.baseClassName,this.props.className);return s.createElement("div",{className:e},s.createElement(i.IconLink,{className:t.baseClassName+"__icon",variant:this.props.iconVariant}),s.createElement("div",{className:t.baseClassName+"__body"},this.props.body),s.createElement("div",{className:t.baseClassName+"__actions"},this.props.actions))},a})(s.PureComponent);t.SharingModalFooterLink=a}),define("spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_copy",["require","exports","react","classnames","spectrum/button","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){var t=r(i.baseClassName,i.baseClassName+"--copy",e.className);return n.createElement(i.SharingModalFooterLink,{className:t,iconVariant:"active",body:n.createElement("input",{readOnly:!0,autoFocus:!0,value:e.sharedLinkUrl,onClick:o,onFocus:o,"aria-label":e.labelSharedLinkUrl,ref:e.textInputRef}),actions:n.createElement(s.Button,{variant:"borderless",onClick:e.onClickButtonHideLink},e.textButtonHideLink)})};t.SharingModalFooterLinkCopy=a;var o=function(e){e.currentTarget.select()}}),define("spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_create",["require","exports","react","spectrum/button","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.createElement(s.SharingModalFooterLink,{className:e.className,body:e.statusNoLinkCreated,actions:n.createElement(r.Button,{variant:"borderless",onClick:e.onClickButtonCreateLink},e.textButtonCreateLink)})};t.SharingModalFooterLinkCreate=i}),define("spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_disabled",["require","exports","react","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){return n.createElement(r.SharingModalFooterLink,{className:e.className,body:n.createElement("div",null,e.statusDisabledLink)})};t.SharingModalFooterLinkDisabled=s}),define("spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_loading",["require","exports","classnames","react","spectrum-sharing/scooter_loader","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){var t=n(i.baseClassName,i.baseClassName+"--loading",e.className);return r.createElement(i.SharingModalFooterLink,{className:t,iconVariant:e.iconVariant,body:r.createElement("div",null,e.statusCreatingLink,r.createElement(s.ScooterLoader,null))})};t.SharingModalFooterLinkLoading=a}),define("spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link_options",["require","exports","react","spectrum/button","spectrum-sharing/sharing_modal_footer_link/sharing_modal_footer_link"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.createElement(s.SharingModalFooterLink,{className:e.className,iconVariant:"active",body:e.statusLinkCreated,actions:n.createElement("div",null,n.createElement(r.Button,{key:"settings",variant:"borderless",onClick:e.onClickButtonLinkSettings},e.textButtonLinkSettings),n.createElement("span",{key:"separator",className:"scl-sharing-modal-footer-link__sep"},"•"),n.createElement(r.Button,{className:e.buttonCopyClassName,key:"copy",variant:"borderless",onClick:e.onClickButtonCopyLink},e.textButtonCopyLink))})};t.SharingModalFooterLinkOptions=i}),define("spectrum-sharing/sharing_modal_header",["require","exports","tslib","spectrum-sharing/sharing_modal_header/sharing_modal_header","spectrum-sharing/sharing_modal_header/sharing_modal_header_title","spectrum-sharing/sharing_modal_header/sharing_modal_header_input"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t),n.__exportStar(s,t),n.__exportStar(i,t)}),define("spectrum-sharing/sharing_modal_header/sharing_modal_header",["require","exports","tslib","classnames","react","spectrum/button","spectrum/icon_form","spectrum-sharing/icons/icon_settings_gear"],function(e,t,n,r,s,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseClassName="scl-sharing-modal-header";var l=(function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(l,e),l.prototype.render=function(){var e=this.props,n=e.children,i=e.className,a=e.closeButtonVisible,o=e.icon,l=e.settingsButtonVisible,c=r(t.baseClassName,i);return s.createElement("div",{className:c},s.createElement("div",{className:t.baseClassName+"__icon"},o),s.createElement("div",{className:t.baseClassName+"__children"},n),l&&this.renderSettingsButton(),a&&this.renderCloseButton())},l.prototype.renderSettingsButton=function(){return s.createElement(i.Button,{"aria-label":"settings",className:t.baseClassName+"__settings",onClick:this.props.onClickSettingsButton,variant:"styleless"},s.createElement(o.IconSettingsGear,null))},l.prototype.renderCloseButton=function(){return s.createElement(i.Button,{"aria-label":"close",className:t.baseClassName+"__close",onClick:this.props.onClickCloseButton,variant:"styleless"},s.createElement(a.IconForm,{name:"cancel"}))},l.defaultProps={closeButtonVisible:!1,settingsButtonVisible:!1},l})(s.PureComponent);t.SharingModalHeader=l}),define("spectrum-sharing/sharing_modal_header/sharing_modal_header_input",["require","exports","tslib","react","spectrum-sharing/input","spectrum-sharing/sharing_modal_header/sharing_modal_header"],function(e,t,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setInputRef=function(e){t.input=e},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.inputAriaLabel,a=e.inputAutoFocus,o=e.inputPlaceholder,l=e.onInputBlur,c=e.onInputChange,d=e.onInputFocus,p=e.onInputKeyUp,u=n.__rest(e,["inputAriaLabel","inputAutoFocus","inputPlaceholder","onInputBlur","onInputChange","onInputFocus","onInputKeyUp"]);return r.createElement(i.SharingModalHeader,n.__assign({closeButtonVisible:!0},u),r.createElement(s.Input,{ref:this.setInputRef,className:i.baseClassName+"__input",variant:"borderless","aria-label":t,autoFocus:a,onChange:c,onFocus:d,onBlur:l,onKeyUp:p,placeholder:o}),this.props.children)},t.displayName="SharingModalHeaderInput",t})(r.PureComponent);t.SharingModalHeaderInput=a}),define("spectrum-sharing/sharing_modal_header/sharing_modal_header_title",["require","exports","tslib","react","spectrum-sharing/sharing_modal_header/sharing_modal_header"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.title,i=e.subTitle,a=n.__rest(e,["title","subTitle"]);return r.createElement(s.SharingModalHeader,n.__assign({},a),r.createElement("div",{className:s.baseClassName+"__title"},t),i&&r.createElement("div",{className:s.baseClassName+"__sub-title"},i))},t.displayName="SharingModalHeaderTitle",t})(r.PureComponent);t.SharingModalHeaderTitle=i}),define("spectrum-sharing/sharing_modal_message_field",["require","exports","tslib","spectrum-sharing/sharing_modal_message_field/sharing_modal_message_field"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/sharing_modal_message_field/sharing_modal_message_field",["require","exports","tslib","classnames","react"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,i=e.onChange,a=e.value,o=e.placeholder,l=n.__rest(e,["className","onChange","value","placeholder"]),c=r("scl-sharing-modal-message-field",t);return s.createElement("div",n.__assign({className:c},l),s.createElement("textarea",{"aria-label":o,className:"scl-textarea",placeholder:o,onChange:i,value:a}))},t.displayName="SharingModalMessageField",t})(s.PureComponent);t.SharingModalMessageField=i}),define("spectrum-sharing/sharing_portal_dropdown",["require","exports","tslib","spectrum-sharing/sharing_portal_dropdown/sharing_portal_dropdown"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum-sharing/sharing_portal_dropdown/sharing_portal_dropdown",["require","exports","tslib","react","react-aria-menubutton","spectrum/util/uuid_generator","spectrum/positioned_portal","spectrum/button","spectrum-sharing/icons/icon_dropdown_caret","spectrum-sharing/sharing_menu"],function(e,t,n,r,s,i,a,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var n=e.call(this,t)||this;return n.dropdownId=i.generateUUID("portalDropdown"),n.onMenuToggle=function(e){e.isOpen||n.positionedPortalEl.hidePortal()},n.handlePortalDidShow=function(){s.openMenu(n.dropdownId,{focusMenu:!1})},n.state={isOpen:!1},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.optionGroup,i=t.onSelection,d=(t.id,n.options.filter(function(e){return n.selectedApiId===e.apiId})[0]),p=function(){return r.createElement(s.Wrapper,{id:e.dropdownId,onSelection:i,onMenuToggle:e.onMenuToggle},r.createElement(s.Button,{className:"scl-sharing-portal-dropdown-button-invisible"},d.label),r.createElement(c.SharingMenu,null,n.options.map(function(e){return r.createElement(c.SharingMenuItem,{description:e.tooltip,key:e.apiId,label:e.label,selected:n.selectedApiId===e.apiId,value:e.apiId,variant:e.variant})})))};return r.createElement(a.PositionedPortal,{closeOnBlur:!1,ref:function(t){return e.positionedPortalEl=t},renderContent:p,role:"sharing-dropdown",showOnMouseMove:!1,showOnClick:!0,positioning:"below",onDidShow:this.handlePortalDidShow},r.createElement(o.Button,{className:"scl-sharing-portal-dropdown-button",variant:"styleless"},d.label,r.createElement(l.IconDropdownCaretWeb,{className:"scl-sharing-portal-dropdown-icon scl-sharing-portal-dropdown-icon-web"})))},t})(r.PureComponent);t.SharingPortalDropdown=d}),define("spectrum/positioned_portal",["require","exports","tslib","spectrum/positioned_portal/index"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum/toggle",["require","exports","tslib","spectrum/toggle/index"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum/toggle/index",["require","exports","tslib","spectrum/toggle/toggle"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t)}),define("spectrum/toggle/toggle",["require","exports","tslib","classnames","react"],function(e,t,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleChange=function(e){t.props.onCheckedChange&&t.props.onCheckedChange(e.currentTarget.checked,e)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.disabled,i=e.interactive,a=e.checked,o=e.className,l=e.ariaLabel,c=e.labelContent,d=(e.onCheckedChange,e.inputProps),p=n.__rest(e,["disabled","interactive","checked","className","ariaLabel","labelContent","onCheckedChange","inputProps"]),u=r(o,"mc-toggle",{"mc-toggle-checked":a,"mc-toggle-disabled":t}),m=r(d?d.className:"","mc-toggle-input",{"mc-toggle-input-interactive":!!i});return s.createElement("label",n.__assign({className:u,"aria-label":l},p),c,s.createElement("span",{className:"mc-toggle-input-wrapper"},s.createElement("input",n.__assign({type:"checkbox"},d,{className:m,checked:a,disabled:t,onChange:this.handleChange})),s.createElement("i",{className:"mc-toggle-track"})))},t.defaultProps={interactive:!0},t})(s.Component);t.Toggle=i,i.displayName="Toggle"});
//# sourceMappingURL=pkg-sharing.min.js-vfl01d_jt.map