define("esignature_prototype/components/create_signature_modal",["require","exports","tslib","esignature_prototype/constants","external/react","modules/clean/react/modal","spectrum_signatures/signature_creation_modal"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setCanvasRef=function(e){t.canvas=e},t.handleSubmitSignature=function(e){r.Modal.close();var n=t.canvas.getContext("2d");if(n){n.font=o.SIGNATURE_FONT,t.canvas.width=n.measureText(e).width,t.canvas.height=o.SIGNATURE_HEIGHT,n.font=o.SIGNATURE_FONT,n.fillText(e,0,30);var i=t.canvas.toDataURL();i&&t.props.onSubmit(i)}},t.handleDismissSignatureModal=function(){r.Modal.close()},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){!this.props.open&&e.open&&this.showSignatureCreationModal()},t.prototype.showSignatureCreationModal=function(){r.Modal.showInstance(i.createElement(a.SignatureCreationModal,{open:!0,onSubmit:this.handleSubmitSignature,onClose:this.handleDismissSignatureModal}))},t.prototype.render=function(){return i.createElement("canvas",{className:"signature-canvas",ref:this.setCanvasRef})},t})(i.PureComponent);t.CreateSignatureModal=s}),define("esignature_prototype/components/esignature_field",["require","exports","tslib","esignature_prototype/data/types","external/classnames","external/react"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleChange=function(e){n.setState({text:e.currentTarget.value}),n.props.onInputChange&&n.props.onInputChange(e.currentTarget.value)},n.state={text:n.props.field.text||""},n}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.field,a=e.onClick,s=e.color,l={left:t.rect.left,bottom:t.rect.bottom,width:t.rect.width,height:t.rect.height};return t[".tag"]===o.FieldType.Text?r.createElement("input",{className:i({"esignature-field":!0,"esignature-field-for-other-user":!t.isForCurrentUser}),type:"text",style:n.__assign({backgroundColor:s},l),placeholder:"Enter text",value:this.state.text,onChange:this.handleChange,disabled:!t.isForCurrentUser}):r.createElement("button",{className:i({"esignature-field":!0,"esignature-field-for-other-user":!t.isForCurrentUser}),style:n.__assign({backgroundColor:s},l),onClick:a},r.createElement("img",{className:"esignature-field-image",src:t.signatureImage,alt:""}))},t})(r.PureComponent);t.EsignatureField=a}),define("esignature_prototype/components/esignature_field_creation_layer",["require","exports","tslib","esignature_prototype/components/esignature_field","esignature_prototype/constants","esignature_prototype/utils","external/lodash","external/react","spectrum_signatures/field_placer"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={creatingField:!1,mouseDownPosition:{x:0,y:0},currentMousePosition:{x:0,y:0}},t.handleFieldCreationMouseDown=function(e){e.preventDefault(),t.setState({creatingField:!0,mouseDownPosition:t.getPositionRelativeToPage(e),currentMousePosition:t.getPositionRelativeToPage(e)})},t.handleFieldCreationMouseMove=function(e){e.preventDefault(),t.state.creatingField&&t.setState({currentMousePosition:t.getPositionRelativeToPage(e)})},t.handleFieldCreationMouseUp=function(e){e.preventDefault(),t.setState({creatingField:!1,currentMousePosition:t.getPositionRelativeToPage(e)}),t.props.createField&&t.props.createField(t.getField())},t.handleDrag=function(e,n,o){if(t.props.updateField){var i=t.props.fields.find(function(t){return t.id===e}),a=t.props.height*t.props.scaleFactor,s=r.updateFieldPosition(i,a,t.props.scaleFactor,n,o);t.props.updateField(s)}},t.handleResize=function(e,n,o,i,a){if(t.props.updateField){var s=t.props.fields.find(function(t){return t.id===e}),l=t.props.height*t.props.scaleFactor,c=r.updateFieldPosition(s,l,t.props.scaleFactor,i,a,n,o);t.props.updateField(c)}},t}return n.__extends(t,e),t.prototype.getPositionRelativeToPage=function(e){return{x:e.pageX-this.props.offset.left,y:e.pageY-this.props.offset.top}},t.prototype.getField=function(){return r.transformPositionsToField(this.state.mouseDownPosition,this.state.currentMousePosition,this.props.height*this.props.scaleFactor,this.props.scaleFactor,this.props.pageNumber)},t.prototype.render=function(){var e=this,t=this.props,c=t.fields,u=t.width,d=t.height,p=t.scaleFactor,f=t.isFieldCreationMode,h=t.isCreatingFieldForRecipient,m=d*p,v=c.map(function(t){return s.createElement(l.FieldPlacer,n.__assign({color:t.isForCurrentUser?i.CURRENT_USER_FIELD_COLOR:i.OTHER_USER_FIELD_COLOR,onDrag:a.partial(e.handleDrag,t.id),onResize:a.partial(e.handleResize,t.id)},r.transformFieldToCoords(t,m,p)))}),g={width:u,height:d,transform:"scale("+p+")",transformOrigin:"top left"},_=f?{onMouseDown:this.handleFieldCreationMouseDown,onMouseMove:this.handleFieldCreationMouseMove,onMouseUp:this.handleFieldCreationMouseUp}:null;return s.createElement("div",{className:"esignature-field-view-layer",style:{width:u*p,height:d*p}},v,f?s.createElement("div",n.__assign({className:"esignature-field-creation-layer",style:g},_),this.state.creatingField?s.createElement(o.EsignatureField,{field:this.getField(),color:h?i.OTHER_USER_FIELD_COLOR:i.CURRENT_USER_FIELD_COLOR}):null):null)},t.defaultProps={offset:{left:0,top:0,right:0,bottom:0}},t})(s.PureComponent);t.EsignatureFieldCreationLayer=c}),define("esignature_prototype/components/esignature_field_view_layer",["require","exports","tslib","esignature_prototype/components/create_signature_modal","esignature_prototype/components/esignature_field","esignature_prototype/constants","esignature_prototype/data/types","external/lodash","external/react"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={modalOpen:!1,clickedFieldId:0},t.handleSubmit=function(e){t.props.createSignature&&t.props.signField&&(t.props.createSignature(e),t.props.signField(t.state.clickedFieldId,e))},t.handleClickSignatureField=function(e){t.props.signatureImage?t.props.signField&&t.props.signField(e,t.props.signatureImage):t.setState({modalOpen:!0,clickedFieldId:e})},t.handleClickDateField=function(e){t.props.selectFieldDate&&t.props.selectFieldDate(e,{year:1999,month:12,day:30})},t}return n.__extends(t,e),t.prototype.getOnClick=function(e){if(e.isForCurrentUser)switch(e[".tag"]){case a.FieldType.Signature:return s.partial(this.handleClickSignatureField,e.id);case a.FieldType.Date:return s.partial(this.handleClickDateField,e.id)}},t.prototype.render=function(){var e=this,t=this.props,n=t.width,c=t.height,u=t.scaleFactor,d=t.fields;if(!d)return null;var p=d.map(function(t){return l.createElement(i.EsignatureField,{key:t.id,field:t,color:t.isForCurrentUser?r.CURRENT_USER_FIELD_COLOR:r.OTHER_USER_FIELD_COLOR,onClick:e.getOnClick(t),onInputChange:t[".tag"]===a.FieldType.Text?s.partial(e.props.enterFieldText,t.id):void 0})}),f={width:n,height:c,transform:"scale("+u+")",transformOrigin:"top left"};return l.createElement("div",{className:"esignature-field-view-layer",style:f},p,l.createElement(o.CreateSignatureModal,{open:this.state.modalOpen,onSubmit:this.handleSubmit}))},t})(l.PureComponent);t.EsignatureFieldViewLayer=c}),define("modules/clean/activity/activity_user",["require","exports","tslib","external/deep-freeze","modules/clean/comments/lib/type_check","modules/clean/immutability_helper","modules/core/types","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,o,i,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.id,i=void 0===n?null:n,r=t.fname,a=void 0===r?null:r,s=t.lname,l=void 0===s?null:s,c=t.display_name,u=void 0===c?null:c,d=t.email,p=void 0===d?null:d,f=t.photo_url,h=void 0===f?null:f,m=t.photo_circle_url,v=void 0===m?null:m,g=t.initials,_=void 0===g?null:g,y=t.is_email_verified,b=void 0!==y&&y,w=t.is_signed_in,C=void 0!==w&&w;this.id=i,this.fname=a,this.lname=l,this.display_name=u,this.email=p,this.photo_url=h,this.photo_circle_url=v,this.initials=_,this.is_email_verified=b,this.is_signed_in=C,o(this)}return e.fromDict=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!!t.id}))},e.fromUser=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!0}))},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){return null!=this.display_name?c.Emstring.em_snippet(this.display_name,22):null!=this.email?c.Emstring.em_snippet(this.email,22):s._("Anonymous user")},e.__anonymous=new e,n.__decorate([i.takes({id:Number,fname:String,lname:String,display_name:String,email:String,photo_url:a.Maybe(String),photo_circle_url:a.Maybe(String)})],e,"fromDict",null),e})();t.ActivityUser=u}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"})(t.ActivityContext||(t.ActivityContext={}))}),define("modules/clean/annotations/annotation",["require","exports"],function(e,t){"use strict";function n(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var o={MARKER:0,HIGHLIGHT:1,REGION:2};t.AnnotationTypes=o;var i={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}};t.AnnotationSubtypes=i;var r=(function(){function e(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n=new e;return n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=t.viewportCoordinates?t.viewportCoordinates:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e={type:this.type,subtype:this.subtype};return this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===o.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){switch(this.type){case o.MARKER:var e=this.getFirstViewportCoordinates();return{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case o.HIGHLIGHT:return this._getViewportBoundingRectangle();case o.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=0);var i=this.getBoundingBox();return i.left=i.left-n,i.right=i.right-n,i.top=i.top-o,i.bottom=i.bottom-o,i.top=Math.min(Math.max(i.top,0),t-1),i.right=Math.min(Math.max(i.right,0),e-1),i.bottom=Math.min(Math.max(i.bottom,0),t-1),i.left=Math.min(Math.max(i.left,0),e-1),i},e.prototype._getViewportBoundingRectangle=function(){for(var e,t,n=e=this.getFirstViewportCoordinates().x,o=t=this.getFirstViewportCoordinates().y,i=0,r=Array.from(this.viewportCoordinates);i<r.length;i++)for(var a=r[i],s=0,l=Array.from(a);s<l.length;s++){var c=l[s];n=Math.min(n,c.x),e=Math.max(e,c.x),o=Math.min(o,c.y),t=Math.max(t,c.y)}return{top:o,right:e,bottom:t,left:n}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){return n(null!=this.image_coordinates?this.image_coordinates[0].coordinates:void 0,function(e){return e[0]})},e.prototype.getFirstPdfCoordinates=function(){return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=this.pdf_coordinates[0].coordinates?this.pdf_coordinates[0].coordinates[0]:void 0},e.prototype.getFirstPdfPage=function(){return this.isOldCoordinatesFormat()?null!=this.pdf_coordinates?this.pdf_coordinates.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===o.MARKER?this.annotationSize:null},e})();t.Annotation=r}),define("modules/clean/annotations/annotation_controller",["require","exports","external/create-react-class","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_region"],function(e,t,n,o,i,r,a,s,l,c,u,d){"use strict";function p(e,t,n){return void 0!==e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}return n({displayName:"AnnotationController",propTypes:{controllerEventHandlers:a.object,onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,isAnnotationMarkerEnabled:a.bool,isAnnotationHighlightEnabled:a.bool,isAnnotationRegionEnabled:a.bool,isAnnotationCreationEnabled:a.bool,parentContainerOffset:a.object,draftAnnotationVersion:a.number},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){return null!=this.refs.activeAnnotation},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){return null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onHideAnnotation=this.onHideAnnotation),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseMoveCallback=this.onMouseMoveCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseDownCallback=this.onMouseDownCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseUpCallback=this.onMouseUpCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onScrollCallback=this.onScrollCallback),null!=this.props.controllerEventHandlers?this.props.controllerEventHandlers.onScaleChangeCallback=this.onScaleChangeCallback:void 0},componentDidUpdate:function(e,t){if(this.props.draftAnnotationVersion>e.draftAnnotationVersion)return this._allowAnnotationTypeSwitch(),this.setState(this.getInitialState())},_getViewerX:function(){return(null!=this.state.currentMouseEvent?this.state.currentMouseEvent.pageX:void 0)||0},_getViewerY:function(){return(null!=this.state.currentMouseEvent?this.state.currentMouseEvent.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},function(){return"function"==typeof t?t():void 0}),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var t=i.findDOMNode(this.refs.activeAnnotation);return null!=t&&(e.target===t||s.contains(t,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case l.AnnotationTypes.MARKER:return this.props.isAnnotationMarkerEnabled;case l.AnnotationTypes.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case l.AnnotationTypes.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n=s(e.target),o=n.contents(),i=(null!=(t=n.css("cursor"))?t:"").split(",");if(i=i[i.length-1].trim(),"text"===i||"vertical-text"===i||n.is("a")&&0===o.length)return!0;if("auto"!==i)return!1;for(var r=!1,a=0,l=Array.from(o);a<l.length;a++){l[a].nodeType===Node.TEXT_NODE&&(r=!0)}return r},_deselectAllText:function(){return p(window.getSelection(),"removeAllRanges",function(e){return e.removeAllRanges()})},onHideAnnotation:function(){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.hideAnnotation():void 0},onMouseDownCallback:function(e){var t=this;if(!this.isMouseDown){if(this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},!this.allowAnnotationTypeSwitch)return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseDownCallback(e):void 0;var n=this.state.activeAnnotationType;return!this._isOnRegion(e)&&this._isOnText(e)?(n=l.AnnotationTypes.HIGHLIGHT,this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseDownCallback(e):void 0})):void 0}},onMouseMoveCallback:function(e){var t=this;if(this.isMouseDown){if(null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch){var n=this.state.activeAnnotationType;return this.isMouseDown&&null===n&&(n=l.AnnotationTypes.REGION),this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseMoveCallback(e):void 0})}return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseMoveCallback(e):void 0}},onMouseUpCallback:function(e){var t=this;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){var n=this.state.activeAnnotationType;if(null===n){if(this._isAnnotationTypeCreationEnabled(l.AnnotationTypes.MARKER))n=l.AnnotationTypes.MARKER;else if(this._isAnnotationTypeCreationEnabled(l.AnnotationTypes.REGION))return void this._trySetActiveAnnotationType(l.AnnotationTypes.REGION,function(){return p(t.refs.activeAnnotation,"createDefaultRegion",function(t){return t.createDefaultRegion(e)})})}else if(n===l.AnnotationTypes.REGION&&this._isAnnotationTypeCreationEnabled(l.AnnotationTypes.MARKER)){var o={x:e.pageX,y:e.pageY},i=o.x-this.positionAtLastMouseDown.x,r=o.y-this.positionAtLastMouseDown.y,a=Math.sqrt(i*i+r*r);a<=34&&(n=l.AnnotationTypes.MARKER)}return this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseUpCallback(e):void 0})}return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof this.props.onAnnotationHiddenCallback?this.props.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){return this._disallowAnnotationTypeSwitch(),"function"==typeof this.props.onAnnotationPlacedCallback?this.props.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){return"function"==typeof this.props.onAnnotationStartDragCallback?this.props.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){return"function"==typeof this.props.onAnnotationEndDragCallback?this.props.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){return"function"==typeof this.props.onAnnotationScrollCallback?this.props.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){return"function"==typeof this.props.onAnnotationScaleChangeCallback?this.props.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){return"function"==typeof this.props.onAnnotationEnterCallback?this.props.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){return"function"==typeof this.props.onAnnotationLeaveCallback?this.props.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case l.AnnotationTypes.MARKER:return o.createElement(u,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case l.AnnotationTypes.HIGHLIGHT:return o.createElement(c,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case l.AnnotationTypes.REGION:return o.createElement(d,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback})}return""},render:function(){return r.div({className:"ephemeral-annotation-container"},this._renderActiveAnnotation())}})}),define("modules/clean/annotations/annotation_highlight",["require","exports","tslib","external/react","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s){"use strict";return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isShown:!1},t.hideAnnotation=function(){return t._hideAnnotation()},t._updateViewportBoundaries=function(){var e=window.getSelection();if(e.rangeCount>0){var n=void 0;n=t._isBrowserIE()?t._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):t._extractViewportClientRectangles(e.getRangeAt(0));var o=t._consolidateClientRectangles(n);return t._setViewportCoordinatesFromRectangles(o)}},t._extractViewportClientRectangles=function(e){for(var t=[],n=e.endContainer,o=e.endOffset,i=e.cloneRange();n!==e.commonAncestorContainer;)i.setStart(n,0),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),o=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return i=e.cloneRange(),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),t},t._extractViewportClientRectanglesIEHack=function(e){if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();var t=[],n=e.cloneRange();n.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,n.getClientRects());for(var o=e.startContainer.parentNode.nextSibling;o!==e.endContainer.parentNode;)Array.prototype.push.apply(t,o.getClientRects()),o=o.nextSibling;return n.setStart(e.endContainer,0),n.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,n.getClientRects()),t},t._isBrowserIE=function(){var e=window.navigator.userAgent,t=e.indexOf("Trident/"),n=e.indexOf("Edge/");return t>0||n>0},t._consolidateClientRectangles=function(e){for(var n=[],o=0,i=Array.from(e);o<i.length;o++){var r=i[o];if(0!==r.width&&0!==r.height){if(n.length>0){var a=n[n.length-1];if(t._isWithinConsolidationVerticalBuffer(a,r)&&t._isWithinConsolidationHorizontalBuffer(a,r)){var s=t._calculateBoundingBox(a,r);a.top=s.top,a.right=s.right,a.bottom=s.bottom,a.left=s.left;continue}}n.push({top:r.top,right:r.right,bottom:r.bottom,left:r.left})}}return n},t._isWithinConsolidationVerticalBuffer=function(e,n){return Math.abs(e.top-n.top)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-n.bottom)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},t._isWithinConsolidationHorizontalBuffer=function(e,n){var o=t._calculateBoundingBox(e,n);return o.right-o.left-(n.width+(e.right-e.left))<t.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},t._calculateBoundingBox=function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},t._setViewportCoordinatesFromRectangles=function(e){var n=t.annotation.viewportCoordinates,o=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(e=Array.from(e),0!==e.length){var r=e.map(function(e){return[{x:e.left+o,y:e.top+i},{x:e.right+o,y:e.bottom+i}]});n.splice.apply(n,[0,n.length].concat(r))}},t._getPositionRelativeToParentContainer=function(e){return{x:e.x-t.props.parentContainerOffset.left,y:e.y-t.props.parentContainerOffset.top}},t._updateHighlightedText=function(){return t.annotation.text_highlight={snippet_before:t._getTextBeforeHighlight(),text:t._getHighlightedText(),snippet_after:t._getTextAfterHighlight()}},t._generateAnnotation=function(){return t.annotation=new s.Annotation(t.type,t.subtype),t._updateViewportBoundaries(),t._updateHighlightedText()},t._hideAnnotation=function(){return t._isBrowserIE()&&t.state.isShown&&t.setState({isShown:!1,viewportCoordinates:null}),t.annotation=null,t.props.onAnnotationHiddenCallback()},t._updateViewportCoordinatesFromUI=function(){if(t.state.isShown){for(var e=[],n=t.annotation.viewportCoordinates,o=0,i=Array.from(a(".annotation-highlight"));o<i.length;o++){var r=i[o],s=[],l=a(r),c=l.offset();s.push({x:c.left,y:c.top}),s.push({x:c.left+l.width(),y:c.top+l.height()}),e.push(s)}n.splice.apply(n,[0,n.length].concat(e))}},t._getHighlightedText=function(){var e=window.getSelection().toString().trim();return e=e.replace(/\s+/g," ")},t._getTextBeforeHighlight=function(){return""},t._getTextAfterHighlight=function(){return""},t._isTextSelected=function(){return""!==t._getHighlightedText()},t.onMouseDownCallback=function(e){return{}},t.onMouseMoveCallback=function(e){return{}},t.onMouseUpCallback=function(e){return setTimeout(function(){if(!t._isTextSelected())return t._hideAnnotation();if(t._generateAnnotation(),t.props.onAnnotationPlacedCallback(t.annotation),t._isBrowserIE()){for(var e=[],n=0,o=Array.from(t.annotation.viewportCoordinates);n<o.length;n++){var i=o[n],r=[],a=t._getPositionRelativeToParentContainer(i[0]),s=t._getPositionRelativeToParentContainer(i[1]);r.push({x:a.x,y:a.y}),r.push({x:s.x,y:s.y}),e.push(r)}return t.setState({isShown:!0,viewportCoordinates:e})}},0)},t.onScrollCallback=function(){if(null!=t.annotation)return t._isBrowserIE()?t._updateViewportCoordinatesFromUI():t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScrollCallback?t.props.onAnnotationScrollCallback(t.annotation):void 0},t.onScaleChangeCallback=function(){if(null!=t.annotation)return t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScaleChangeCallback?t.props.onAnnotationScaleChangeCallback(t.annotation):void 0},t._onMarkerMouseDown=function(e){return{}},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseUp=function(e){return{}},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.type=s.AnnotationTypes.HIGHLIGHT,this.subtype=s.AnnotationSubtypes.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},t.prototype.render=function(){var e=this;return i.div({className:"annotation-highlight-container",ref:"highlightContainer"},(function(){if(e.state.isShown){for(var t=[],n=0,o=Array.from(e.state.viewportCoordinates);n<o.length;n++){var r=o[n],a=r[0].x,s=r[0].y,l=r[1].x,c=r[1].y,u={left:a,top:s,width:l-a,height:c-s};t.push(i.div({className:"annotation-highlight",style:u}))}return t}})())},t.displayName="AnnotationHighlight",t.propTypes={onAnnotationPlacedCallback:r.func,onAnnotationHiddenCallback:r.func,onAnnotationStartDragCallback:r.func,onAnnotationEndDragCallback:r.func,onAnnotationOverCallback:r.func,onAnnotationScrollCallback:r.func,onAnnotationScaleChangeCallback:r.func,onAnnotationEnterCallback:r.func,onAnnotationLeaveCallback:r.func,parentContainerOffset:r.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(o.Component)}),define("modules/clean/annotations/annotation_highlight_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s,l,c){"use strict";function u(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHover:!1},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onHighlightClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity}):void 0},t._onHighlightMouseEnter=function(e){return t.setState({isHover:!0}),clearTimeout(t.mouseLeaveTimeout),t._updateViewportCoordinates(),"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:t.annotation,commentActivity:t.props.commentActivity}):void 0},t._onHighlightMouseOver=function(e){return{}},t._onHighlightMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback&&t.props.onAnnotationLeaveCallback({annotation:t.annotation,commentActivity:t.props.commentActivity}),t.mouseLeaveTimeout=setTimeout(function(){return t.setState({isHover:!1})},100)},t._updateViewportCoordinates=function(){for(var e=l(r.findDOMNode(t.refs.highlightContainer)),n=[],o=e.children(),i=0,a=Array.from(o);i<a.length;i++){var s=a[i],c=[],u=l(s).offset();c.push({x:u.left,y:u.top}),c.push({x:u.left+l(s).width(),y:u.top+l(s).height()}),n.push(c)}return t.annotation.viewportCoordinates=n},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=c.Annotation.createAnnotationFromDict(this.props.annotation)},t.prototype.render=function(){
for(var e,t,n,i=this,r=[],s=u(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),l=o({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":s,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()}),c=-1,d=0,p=Array.from(this.initialViewport);d<p.length;d++){var f=p[d];t=f[0].x,n=f[0].y;var h=f[1].x,m=f[1].y;(c===-1||n<c)&&(e=t,c=n);var v={left:t*this.props.scaleFactor,top:n*this.props.scaleFactor,width:h-t,height:m-n,transform:"scale("+this.props.scaleFactor+")",transformOrigin:"top left"};r.push(a.div({className:l,style:v,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}))}return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},r,(function(){if(i.props.options.isAnnotationNumberingEnabled){var t={left:e*i.props.scaleFactor-9,top:c*i.props.scaleFactor-9},n=o({"annotation-number":!0,"annotation-number--resolved":s,"annotation-number--hover":i.state.isHover});return a.div({className:n,style:t},i.props.options.annotationNumber)}})())},t.displayName="AnnotationHighlightUI",t.propTypes={annotation:s.object,commentActivity:s.object,scaleFactor:s.number,options:s.shape({isGhostAnnotation:s.bool,isAnnotationNumberingEnabled:s.bool,annotationNumber:s.number}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={scaleFactor:1},t})(i.Component)}),define("modules/clean/annotations/annotation_marker",["require","exports","tslib","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.hideAnnotation=function(){return o._hideAnnotation()},o._getSelectionText=function(){var e="";return window.getSelection&&(e=window.getSelection().toString()),e},o._hasSelectedText=function(){return""!==o._getSelectionText()},o._resetPositionDelta=function(){return o.positionDelta={x:0,y:0}},o._getOffsetPosition=function(e){var t=e.offsetX||(null!=e.nativeEvent?e.nativeEvent.offsetX:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerX}),n=e.offsetY||(null!=e.nativeEvent?e.nativeEvent.offsetY:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerY});return{x:t-o.annotation.getSize()/2,y:n-o.annotation.getSize()/2}},o._getPositionRelativeToParentContainer=function(e){return{x:e.pageX-o.props.parentContainerOffset.left,y:e.pageY-o.props.parentContainerOffset.top}},o._calculateMarkerPos=function(e){var t=o._getPositionRelativeToParentContainer(e),n=o.size/2;return{x:t.x-n-o.positionDelta.x,y:t.y-n-o.positionDelta.y}},o._generateAnnotation=function(e){return o.annotation=new l.Annotation(o.type,o.subtype,o.size),o._updateViewportCoordinatesFromEvent(e),o.annotation},o._updateViewportCoordinatesFromEvent=function(e){var t={x:e.clientX-o.positionDelta.x,y:e.clientY-o.positionDelta.y};return o.annotation.viewportCoordinates[0]=[t]},o._hideAnnotation=function(e){return o.annotation=null,o.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof o.props.onAnnotationHiddenCallback?o.props.onAnnotationHiddenCallback():void 0},o._placeAnnotation=function(e){return o.setState({isToolVisible:!0,viewerX:o._calculateMarkerPos(e).x,viewerY:o._calculateMarkerPos(e).y},function(){return o._generateAnnotation(e),"function"==typeof o.props.onAnnotationPlacedCallback?o.props.onAnnotationPlacedCallback(o.annotation):void 0})},o.updateViewportCoordinatesFromMarker=function(){if(o.state.isToolVisible){var e=i.findDOMNode(o.refs.annotationMarker);if(e){var t=s(e),n=t.offset(),r={x:n.left+o.annotation.getSize()/2,y:n.top+o.annotation.getSize()/2};o.annotation.viewportCoordinates[0]=[r]}}return null},o._startAnnotationDrag=function(e){return e.preventDefault(),o.isInDragMode=!0,o.positionDelta=o._getOffsetPosition(e),o._updateViewportCoordinatesFromEvent(e),"function"==typeof o.props.onAnnotationStartDragCallback?o.props.onAnnotationStartDragCallback(o.annotation):void 0},o._endAnnotationDrag=function(e){return e.preventDefault(),o.isInDragMode=!1,o._updateViewportCoordinatesFromEvent(e),o._resetPositionDelta(),"function"==typeof o.props.onAnnotationEndDragCallback?o.props.onAnnotationEndDragCallback(o.annotation):void 0},o._isOnMarker=function(e){if(o.state.isToolVisible){var t=i.findDOMNode(o.refs.annotationMarker);return null!=t&&(e.target===t||s.contains(t,e.target))}},o.onMouseDownCallback=function(e){if(o.state.isToolVisible&&o._isOnMarker(e))return o._startAnnotationDrag(e),e.preventDefault()},o.onMouseMoveCallback=function(e){if(o.isInDragMode&&o.state.isToolVisible)return o.setState({viewerX:o._calculateMarkerPos(e).x,viewerY:o._calculateMarkerPos(e).y}),e.preventDefault()},o.onMouseUpCallback=function(e){return o.state.isToolVisible?o.isInDragMode?o._endAnnotationDrag(e):o._hideAnnotation(e):o._hasSelectedText()?void 0:(o._placeAnnotation(e),e.preventDefault())},o.onScrollCallback=function(){if(o.state.isToolVisible)return o.updateViewportCoordinatesFromMarker(),"function"==typeof o.props.onAnnotationScrollCallback?o.props.onAnnotationScrollCallback(o.annotation):void 0},o.onScaleChangeCallback=function(){return o.updateViewportCoordinatesFromMarker(),"function"==typeof o.props.onAnnotationScaleChangeCallback?o.props.onAnnotationScaleChangeCallback(o.annotation):void 0},o._onMarkerMouseDown=function(e){return{}},o._onMarkerMouseOver=function(e){return"function"==typeof o.props.onAnnotationOverCallback?o.props.onAnnotationOverCallback(o.annotation):void 0},o._onMarkerMouseUp=function(e){return{}},o._onMarkerMouseEnter=function(e){return"function"==typeof o.props.onAnnotationEnterCallback?o.props.onAnnotationEnterCallback(o.annotation):void 0},o._onMarkerMouseLeave=function(e){return"function"==typeof o.props.onAnnotationLeaveCallback?o.props.onAnnotationLeaveCallback(o.annotation):void 0},o.type=l.AnnotationTypes.MARKER,o.subtype=l.AnnotationSubtypes.MARKER.CIRCLE,o.size=28,o.isInDragMode=!1,o._resetPositionDelta(),o.state={isToolVisible:!1,viewerX:0,viewerY:0},o}return n.__extends(t,e),t.prototype.componentWillMount=function(){return{}},t.prototype.render=function(){var e=[];return this.state.isToolVisible&&(e=[r.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},r.div({className:"annotation-maker-inner"}))]),r.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)},t.displayName="AnnotationMarker",t.propTypes={onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationOverCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,parentContainerOffset:a.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(o.Component)}),define("modules/clean/annotations/annotation_marker_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onMarkerClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseEnter=function(e){var n=l(r.findDOMNode(t.refs.annotationMarker)),o=t.props.annotation;return null==o.viewportCoordinates&&(o.viewportCoordinates=[]),o.viewportCoordinates[0]=[{x:n.offset().left+o.annotationSize/2,y:n.offset().top+o.annotationSize/2}],"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:o,commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback?t.props.onAnnotationLeaveCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},t.prototype.render=function(){var e=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),t=o({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!e,"annotation-marker--resolved":e,"annotation-marker--ghost":this._isGhostAnnotation()});return a.div({className:"annotation-marker-container",ref:"markerContainer"},a.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:t,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},a.div({className:"annotation-maker-inner"})))},t.displayName="AnnotationMarkerUI",t.propTypes={annotation:s.object,commentActivity:s.object,options:s.shape({isGhostAnnotation:s.bool}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={options:{}},t})(i.Component)}),define("modules/clean/annotations/annotation_region",["require","exports","external/classnames","external/create-react-class","external/react-dom","external/react-dom-factories","external/prop-types","external/lodash","jquery","modules/clean/annotations/annotation"],function(e,t,n,o,i,r,a,s,l,c){"use strict";return o({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationOverCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,parentContainerOffset:a.object},TYPE:c.AnnotationTypes.REGION,SUBTYPE:c.AnnotationSubtypes.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},isResizing:!1,getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e=this.state.rectangle.top+this.props.parentContainerOffset.top,t=this.state.rectangle.right+this.props.parentContainerOffset.left,n=this.state.rectangle.bottom+this.props.parentContainerOffset.top,o=this.state.rectangle.left+this.props.parentContainerOffset.left;return this.annotation.viewportCoordinates[0]=[{x:o,y:e},{x:o,y:n},{x:t,y:n},{x:t,y:e}]},_isOnRegion:function(e){if(this.state.isToolVisible){var t=i.findDOMNode(this.refs.annotationRegion);if(null!=t)return e.target===t||l.contains(t,e.target)}return!1},_isModifying:function(){return this.state.isInDragMode||this.isResizing},_showNewRectangle:function(e){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.isResizing=!1,this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:s.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:s.clone(t),anchorRectangle:s.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new c.Annotation(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof this.props.onAnnotationHiddenCallback?this.props.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t=this;e.preventDefault();var n=this._getPositionRelativeToParentContainer(e),o=n.x,i=n.y,r=this.DEFAULT_REGION_SIZE/2;return this.isResizing=!1,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:i-r,right:o+r,bottom:i+r,left:o-r}},function(){return t._updateAnnotationFromState(),"function"==typeof t.props.onAnnotationPlacedCallback?t.props.onAnnotationPlacedCallback(t.annotation):void 0})},onMouseDownCallback:function(e){e.preventDefault();var t=this._getPositionRelativeToParentContainer(e);return this.state.isToolVisible?this._isOnRegion(e)&&!this.isResizing?(this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startDragging(t)):void 0:this._showNewRectangle(t)},onMouseMoveCallback:function(e){var t;if(e.preventDefault(),!this.state.isToolVisible)return t=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(t);if(this._isModifying()){t=this._getPositionRelativeToParentContainer(e);var n={x:t.x-this.state.anchorMouse.x,y:t.y-this.state.anchorMouse.y},o=s.clone(this.state.anchorRectangle);return this.state.isInDragMode?o={top:this.state.anchorRectangle.top+n.y,right:this.state.anchorRectangle.right+n.x,bottom:this.state.anchorRectangle.bottom+n.y,left:this.state.anchorRectangle.left+n.x}:this.isResizing&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?o.top=this.state.anchorRectangle.top+n.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(o.bottom=this.state.anchorRectangle.bottom+n.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?o.left=this.state.anchorRectangle.left+n.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(o.right=this.state.anchorRectangle.right+n.x)),o={top:Math.min(o.top,o.bottom),right:Math.max(o.left,o.right),bottom:Math.max(o.top,o.bottom),left:Math.min(o.left,o.right)},this.setState({rectangle:o})}},onMouseUpCallback:function(e){if(e.preventDefault(),this.state.isToolVisible)return this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof this.props.onAnnotationPlacedCallback&&this.props.onAnnotationPlacedCallback(this.annotation):"function"==typeof this.props.onAnnotationEndDragCallback&&this.props.onAnnotationEndDragCallback(this.annotation),this.isResizing=!1,this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e)},onScrollCallback:function(){if(this.state.isToolVisible)return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationScrollCallback?this.props.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationScaleChangeCallback?this.props.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){return"function"==typeof this.props.onAnnotationOverCallback?this.props.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){return this.setState({isHovering:!0}),"function"==typeof this.props.onAnnotationEnterCallback?this.props.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){return this.setState({isHovering:!1}),"function"==typeof this.props.onAnnotationLeaveCallback?this.props.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){e.preventDefault(),this.isResizing=!0;var n=this._getPositionRelativeToParentContainer(e);return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startResizing(n,t)},_renderSideHandles:function(){var e=this;return r.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},Array.from(s.values(this.Directions)).map(function(t){return(function(t){return r.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})})(t)}))},_renderCornerHandles:function(){var e=this;return[this.Directions.TOP,this.Directions.BOTTOM].map(function(t){return[e.Directions.LEFT,e.Directions.RIGHT].map(function(n){return(function(t,n){return r.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(o){return e._onHandleMouseDown(o,[t,n])}},r.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))})(t,n)})})},render:function(){var e=[];if(this.state.isToolVisible){var t={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering};e=[r.div({key:"annotationRegion",ref:"annotationRegion",className:n(t),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]}return r.div({className:"annotation-region-container"},this.state.isToolVisible?e:void 0)}})}),define("modules/clean/annotations/annotation_region_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onRegionClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t._onRegionMouseEnter=function(e){var n=l(r.findDOMNode(t.refs.annotationRegion)),o=t.props.annotation;null==o.viewportCoordinates&&(o.viewportCoordinates=[]);var i=n.offset().top,a=n.offset().left,s=i+n.height(),c=a+n.width();return o.viewportCoordinates[0]=[{x:a,y:i},{x:a,y:s},{x:c,y:s},{x:c,y:i}],"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:o,commentActivity:t.props.commentActivity}):void 0},t._onRegionMouseOver=function(e){return{}},t._onRegionMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback?t.props.onAnnotationLeaveCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),n=this.props.annotation.getBoundingBox(),i=o({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":t,"annotation-region--ui--resolved":t,"annotation-region--ghost":this._isGhostAnnotation()});return a.div({className:"annotation-region-container"},a.div({key:"annotationRegion",ref:"annotationRegion",className:i,onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:n.left*this.props.scaleFactor,top:n.top*this.props.scaleFactor,width:(n.right-n.left)*this.props.scaleFactor,height:(n.bottom-n.top)*this.props.scaleFactor}},a.div({className:"annotation-region-inner"}),(function(){if(e.props.options.isAnnotationNumberingEnabled){var n=o({"annotation-number":!0,"annotation-number--resolved":t});return a.div({className:n},e.props.options.annotationNumber)}})()))},t.displayName="AnnotationRegionUI",t.propTypes={annotation:s.object,scaleFactor:s.number,commentActivity:s.object,options:s.shape({isGhostAnnotation:s.bool,isAnnotationNumberingEnabled:s.bool,annotationNumber:s.number}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={scaleFactor:1},t})(i.Component)}),define("modules/clean/annotations/annotation_renderer_utils",["require","exports","external/lodash","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","external/react","jquery"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){if((null!=e.annotations?e.annotations.length:void 0)!==s(Object.keys(t),function(e){return e.length}))return!0;for(var o=0,i=Array.from(e.annotations);o<i.length;o++){var r=i[o],a=r.commentActivity.activity_key;if(!n.isEqual(t[a],r))return!0}return!1},e.prototype.renderAnnotation=function(e,t,n){if(null==e.annotation||null==e.commentActivity)return null;var s=o.Annotation.createAnnotationFromDict(e.annotation),l=e.commentActivity;if(null==(null!=s?s.type:void 0)||t(l.activity_key))return null;var c=null;switch(s.type){case o.AnnotationTypes.MARKER:c=r;break;case o.AnnotationTypes.HIGHLIGHT:c=i;break;case o.AnnotationTypes.REGION:c=a}return null==c?null:n(c,s,l,null!=e.options?e.options:{})},e})()}),define("modules/clean/annotations/preview_image_annotations_toolbar",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/lodash","jquery","modules/clean/keycode","modules/clean/react/css_timing","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/dom","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isToolbarVisible:!0},t.onMouseMove=function(e){if(t.state.isToolbarVisible||t.setState({isToolbarVisible:!0}),t.state.isToolbarVisible)return clearTimeout(t.hideToolbarTimeout),t.hideToolbarTimeout=setTimeout(function(){return t.maybeHideToolbar(e)},3e3)},t.onKeydown=function(e){var n;if(m.focus_in_input()||m.is_input(e.target))return!0;var o=e.keyCode;return[l.KeyCode.EQUALS,l.KeyCode.PLUS_EQUALS_FF,l.KeyCode.PLUS_CHROME,l.KeyCode.PLUS_EQUALS_FF_GERMAN].includes(o)?("function"==typeof t.props.onZoomIn&&t.props.onZoomIn(),n=!0):[l.KeyCode.MINUS_FF_MAC,l.KeyCode.MINUS_FF,l.KeyCode.MINUS_CHROME].includes(o)?("function"==typeof t.props.onZoomOut&&t.props.onZoomOut(),n=!0):o===l.KeyCode.P?(t.props.onPrint&&t.onPrint(d.UserActionContext.Keyboard)(),n=!0):t.props.onKeyPress&&(n=t.props.onKeyPress(e)),n&&null!=e.preventDefault&&e.preventDefault(),!n},t.maybeHideToolbar=function(e){if(0===s(e.target).closest(r.findDOMNode(t.refs.previewToolbar)).length)return t.setState({isToolbarVisible:!1})},t.flipLabelText=function(){return v._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:t.props.index+1,num_total_files:t.props.count})},t.zoomToolTipText=function(){return 1===t.props.zoomPercent?v._("Zoom to fit"):v._("View actual size")},t.getZoomLabel=function(){return t.props.zoomPercent?v.format_percent(Math.round(100*t.props.zoomPercent)):""},t.onZoomMouseDown=function(e,n){return t.isZooming||u.logUserAction(n.action,n.context),t.isZooming=!0,t.keepZooming(e,400)},t.keepZooming=function(e,n){if(t.isZooming)return e(),setTimeout(function(){return t.keepZooming(e,75)},n)},t.onZoomMouseUp=function(){return t.isZooming=!1},t.onZoomMouseLeave=function(){return t.isZooming=!1},t.onClickPrevious=function(){return t.props.onPrevious(),u.logUserAction(d.UserAction.FlipPrevious,d.UserActionContext.Toolbar)},t.onClickNext=function(){return t.props.onNext(),u.logUserAction(d.UserAction.FlipNext,d.UserActionContext.Toolbar)},t.onClickFullscreen=function(){return t.props.onFullscreen(),u.logUserAction(d.UserAction.ToggleFullscreenOn,d.UserActionContext.Toolbar)},t.onPrint=function(e){return function(){return t.props.onPrint(),u.logUserAction(d.UserAction.Print,e)}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){return window.addEventListener("mousemove",this.onMouseMove)},t.prototype.componentWillUnmount=function(){return window.removeEventListener("mousemove",this.onMouseMove),clearTimeout(this.hideToolbarTimeout)},t.prototype.showFlipButtons=function(){return this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext},t.prototype.showZoomButtons=function(){return null!=this.props.onZoomOut||null!=this.props.onZoomIn},t.prototype.canPrint=function(){return!(this.props.sharePermission&&this.props.sharePermission.canPrintRoles&&0===this.props.sharePermission.canPrintRoles.length)},t.prototype.render=function(){if(!this.state.isToolbarVisible)return null;if(this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen)return null;var e={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&null!=this.props.zoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},t={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&null!=this.props.zoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},n={"enable-region-creation":!0,"image-toolbar__item":!0,"item-w-label":!0,disabled:!this.props.canEnableRegionCreation};return i.createElement("div",{className:"preview-toolbar-overlay-container"},i.createElement(p.KeyboardBindingConnector,{allKeyCallback:this.onKeydown}),i.createElement("div",{className:"preview-toolbar-overlay",ref:"previewToolbar"},i.createElement("div",{className:"preview-toolbar-content image-toolbar"},this.showFlipButtons()?i.createElement("span",{className:"flip-buttons image-toolbar__item"},i.createElement(h.TitleBubble,{content:v._("Previous"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:"flip-button flip-button--previous",onClick:this.onClickPrevious},i.createElement(f.Sprite,{group:"web",name:"s_flip_left",alt:v._("Previous")}))),i.createElement("div",{className:"nav-text"},this.flipLabelText()),i.createElement(h.TitleBubble,{content:v._("Next"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:"flip-button flip-button--next",onClick:this.onClickNext},i.createElement(f.Sprite,{group:"web",name:"s_flip_right",alt:v._("Next")})))):null,this.showZoomButtons()?i.createElement("span",{className:"flip-buttons image-toolbar__item"},null!=this.props.onZoomOut?i.createElement(h.TitleBubble,{content:v._("Zoom out"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:o(e),onMouseDown:a.partial(this.onZoomMouseDown,this.props.onZoomOut,{action:d.UserAction.ZoomOut,context:d.UserActionContext.Toolbar}),onMouseUp:this.onZoomMouseUp,onMouseLeave:this.onZoomMouseLeave},i.createElement(f.Sprite,{group:"web",name:"zoomout",alt:v._("Zoom out")}))):null,null!=this.props.onZoomOriginalOrFit?i.createElement(h.TitleBubble,{content:this.zoomToolTipText(),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this.getZoomLabel())):null,null!=this.props.onZoomIn?i.createElement(h.TitleBubble,{content:v._("Zoom in"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:o(t),onMouseDown:a.partial(this.onZoomMouseDown,this.props.onZoomIn,{action:d.UserAction.ZoomIn,context:d.UserActionContext.Toolbar}),onMouseUp:this.onZoomMouseUp,onMouseLeave:this.onZoomMouseLeave},i.createElement(f.Sprite,{group:"web",name:"zoom",alt:v._("Zoom in")}))):null):null,null!=this.props.onFullscreen?i.createElement(h.TitleBubble,{content:v._("Fullscreen"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:"fullscreen image-toolbar__item item-w-label",onClick:this.onClickFullscreen},i.createElement(f.Sprite,{group:"web",name:"fullscreen",alt:v._("Fullscreen")}))):null,this.props.onPrint&&this.canPrint()?i.createElement(h.TitleBubble,{content:v._("Print"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:"print-button",onClick:this.onPrint(d.UserActionContext.Toolbar)},i.createElement(f.Sprite,{group:"web",name:"print",alt:v._("Print")}))):null,i.createElement(h.TitleBubble,{content:v._("Comment"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},i.createElement("button",{className:o(n),onClick:this.props.canEnableRegionCreation?this.props.onRegionCreationClick:void 0},i.createElement(f.Sprite,{group:"web",name:"ic_comment_area_large",alt:v._("Comment")}))))))},t})(i.Component),_=c.requireCssWithComponent(g,["/static/css/preview_toolbar-vfltiivAw.css"]);t.PreviewImageAnnotationsToolbar=_}),define("modules/clean/average_counter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce(function(e,t){return e+t}),n=this.count+e.length;this.average=(this.average*this.count+t)/n,this.count=n},e})();t.AverageCounter=n}),define("modules/clean/callback_chain/callback_chain",["require","exports"],function(e,t){"use strict";function n(e){return void 0!==e.abortCallbackChain}function o(e){var t=e,n=!1;return t.abortCallbackChain=function(){n=!0},Object.defineProperty(t,"callbackChainAborted",{get:function(){return n}}),t}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){this.callbacks=e}return e.prototype.run=function(e){for(var t=n(e)?e:o(e),i=0,r=this.callbacks;i<r.length;i++){var a=r[i];if(t.callbackChainAborted)break;a(t)}},e})();t.CallbackChain=i}),define("modules/clean/comments/actions",["require","exports","external/reflux","external/lodash"],function(e,t,n,o){"use strict"
;var i=["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment","receiveRevisions"];return n.createActions(o.zipObject(i,i.map(function(e){return{sync:!0}})))}),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsEvents=new n,t.CommentsEventsMixin={onCommentsEvent:function(e,n,o){this.__commentsEvents.push([e,n,o]),t.CommentsEvents.on(e,n,o)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],o=e[1],i=e[2];t.CommentsEvents.off(n,o,i)}),this.__commentsEvents=null}}}),define("modules/clean/comments/legacy_redux_integration",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions"],function(e,t,n,o){"use strict";function i(e){s.dispatch(o.switchRevisionAction(e))}function r(){s.dispatch(o.restoreRevisionAction())}function a(e,t){s.dispatch(o.saveForwardRevision(e,t))}Object.defineProperty(t,"__esModule",{value:!0});var s=n.getStoreForFileViewer();t.reduxSwitchRevision=i,t.reduxRestoreRevision=r,t.reduxSaveForwardRevision=a}),define("modules/clean/comments/lib/type_check",["require","exports","modules/core/types"],function(e,t,n){"use strict";function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,o,i){i.value=n.takes.apply(void 0,e.concat([i.value]))}}function i(e){return function(t,o,i){i.value=n.returns(e,i.value)}}Object.defineProperty(t,"__esModule",{value:!0}),t.takes=o,t.returns=i}),define("modules/clean/comments/models/comment",["require","exports","tslib","external/lodash","external/deep-freeze","modules/core/types","modules/clean/immutability_helper","modules/clean/comments/lib/type_check","modules/clean/activity/activity_user"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){var t=void 0===e?{}:e,n=t.revision,o=void 0===n?null:n,r=t.annotation,a=void 0===r?null:r,s=t.sticker_id,l=void 0===s?null:s,c=t.thumbnail_url,u=void 0===c?null:c;this.revision=o,this.annotation=a,this.sticker_id=l,this.thumbnail_url=u,i(this)}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return o.pickBy({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},n.__decorate([s.takes({revision:r.Any,annotation:r.Any,stickers:r.Maybe({id:Number}),thumbnail_url:r.Maybe(String)})],e,"fromDict",null),e})();t.CommentMetadata=c;var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,o=void 0===n?"":n,r=t.commenter,a=void 0===r?l.ActivityUser.anonymous:r,s=t.comment_text,c=void 0===s?"":s,u=t.raw_comment_text,d=void 0===u?"":u,p=t.when_mses,f=void 0===p?0:p,h=t.resolved,m=void 0!==h&&h,v=t.comment_metadata,g=void 0===v?null:v;this.comment_gid=o,this.commenter=a,this.comment_text=c,this.raw_comment_text=d,this.when_mses=f,this.resolved=m,this.comment_metadata=g,i(this)}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:l.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?c.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return a.set(this,"resolved",!0)},e.prototype.unresolve=function(){return a.set(this,"resolved",!1)},n.__decorate([s.takes({comment_gid:String,commenter_dict:r.Any,comment_text:String,raw_comment_text:String,when_mses:Number,resolved:Boolean,comment_meta_json:r.Maybe(Object)})],e,"fromDict",null),e})();t.Comment=u}),define("modules/clean/comments/models/comment_activity",["require","exports","tslib","external/deep-freeze","external/lodash","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment"],function(e,t,n,o,i,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,n=void 0===t?[]:t;this.user_ids_who_can_delete=n,o(this)}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!i.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},n.__decorate([l.takes({user_ids_who_can_delete:Array})],e,"fromDict",null),e})();t.CommentActivityPermissions=u;var d=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,i=void 0===n?"":n,r=t.comment_activities,a=void 0===r?[]:r,s=t.users_to_notify,l=void 0===s?[]:s,d=t.is_seen,p=void 0!==d&&d,f=t.highlight_as_unread,h=void 0!==f&&f,m=t.comment,v=void 0===m?new c.Comment:m,g=t.permissions,_=void 0===g?new u:g,y=t.status,b=void 0===y?"POSTED":y;this.activity_key=i,this.comment_activities=a,this.users_to_notify=l,this.is_seen=p,this.highlight_as_unread=h,this.comment=v,this.permissions=_,this.status=b,o(this)}return e.createLocalInstance=function(t){var n=t.activityKey,o=void 0===n?i.uniqueId("local-comment-activity-"):n,r=t.commenter,a=t.rawCommentText,s=t.metadata,l=void 0===s?null:s,u=t.status,d=void 0===u?"POSTING":u;return new e({activity_key:o,comment:new c.Comment({comment_gid:i.uniqueId("pending-comment-gid-"),commenter:r,comment_text:a,raw_comment_text:a,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:l}),is_seen:!0,highlight_as_unread:!1,status:d})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(s.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:c.Comment.fromDict(t.comment),permissions:u.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){return!!this.highlight_as_unread||this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return a.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return a.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return a.set(this,"status",e)},e.prototype.markSeen=function(){return a.merge(this,{is_seen:!0,highlight_as_unread:!1})},n.__decorate([l.takes({activity_key:String,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),is_seen:Boolean,highlight_as_unread:Boolean,comment:Object,permissions:Object})],e,"fromDict",null),e})();t.CommentActivity=d}),define("modules/clean/comments/models/loading_spinner",["require","exports"],function(e,t){"use strict";return function(e,t){return(null==t||t.comment_activities.length>0)&&e}}),define("modules/clean/comments/revisions",["require","exports","tslib","external/lodash"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){var i=o.pick(t,"direct_blockserver_link","preview_ssr_image_url_tmpl","preview_ssr_text_url_tmpl","preview_ssr_refresh_url");return i.preview_url=t.preview_link,null!=e.set?n.__assign({},e,i):o.assignIn({},e,i)};t.getFileWithRevision=i;var r=function(e,t){return t.when-e.when};t.compareRevision=r;var a=function(e,t){return r(e,t)>0};t.isRevisionOlderThan=a;var s=function(e,t){return r(e,t)<0};t.isRevisionNewerThan=s;var l=function(e,t){return 0===r(e,t)};t.isRevisionEqual=l}),define("modules/clean/comments/store",["require","exports","external/reflux","external/lodash","modules/clean/comments/actions","modules/clean/comments/components/ui_constants","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/react/file_comments/logger","modules/constants/comments_panel","modules/core/exception","modules/clean/comments/legacy_redux_integration","modules/clean/annotations/annotation","modules/clean/annotations/annotation","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p){"use strict";function f(e,t){return void 0!==e&&null!==e?t(e):void 0}return n.createStore({listenables:i,init:function(){return this.state=this.getInitialState()},getInitialState:function(){return{actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:u.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:r.TUTORIAL_INITIATOR,showCommentsPref:u.SHOW_COMMENTS_PANEL,revisions:null}},setState:function(e){return o.assignIn(this.state,e),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){if(null!=this.state.activity?this.state.activity.users_to_notify:void 0)for(var t=0,n=Array.from(this.state.activity.users_to_notify);t<n.length;t++){var o=n[t];if(o.id===e)return!0}return!1},isCommentingEnabled:function(){return!this.state.activity||!this.state.activity.feedback_off},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){return null!=this.state.activity?this.state.activity.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){return!!(null!=this.state.activity?this.state.activity.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){if(null==this.state.activity)return null;var e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)};return this.state.activity.comment_activities.reduce(t,0)},isTutorialShown:function(){return null!=this.state.viewing.showTutorialOverride?this.state.viewing.showTutorialOverride:this.state.showTutorial},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n=e.actorId,o=e.context,i=e.contextData,r=e.oref,a=e.file,l=(e.previewSelector,e.showCommentsOverride),c=e.showTutorialOverride;return t=null===this.state.contextData||s(this.state.showLoadingSpinner,this.state.activity),this.setState({actorId:n,viewing:{context:o,contextData:i,file:a,revision:null,showCommentsOverride:l,showTutorialOverride:c},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:t,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null,showTutorialOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,annotationText:null,annotationReplyTextByKey:{},revisions:null})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){if(this.setState({isPreviewReady:!0}),null!=this.state.activity)return a.CommentsEvents.emit("preview-and-comments-ready")},onUpdateAnnotationConversationHover:function(e){if(null!=this.state.viewAnnotation){var t=o.assignIn({},this.state.viewAnnotation,{conversationHover:e});return this.setState({viewAnnotation:t})}},onUpdateAnnotationUiHover:function(e){if(null!=this.state.viewAnnotation){var t=o.assignIn({},this.state.viewAnnotation,{annotationHover:e});return this.setState({viewAnnotation:t})}},onShowAnnotationConversation:function(e){var t=e.annotation,n=e.activityKey;return d.assert(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),d.assert(null!=t,"Invalid annotation to show"),d.assert(null!=this.state.activity.findConversationByKey(n),"Invalid inline comment to show: "+n),this.setState({viewAnnotation:{annotation:t,activityKey:n,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(e){if(null!=this.state.viewAnnotation){var t=o.assignIn({},this.state.viewAnnotation,{replyFocused:e});return this.setState({viewAnnotation:t})}},onStartAnnotationCreation:function(e){var t=e.annotation;return this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(e){var t,n=e.activityKey,i=e.text;return n in this.state.annotationReplyTextByKey&&!i?(t=o.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:t})):(t=o.assignIn({},this.state.annotationReplyTextByKey,(r={},r[n]=i,r)),this.setState({annotationReplyTextByKey:t}));var r},onShowAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}})},onHideAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}})},onSwitchRevision:function(e){var t,n=e.revision,i=e.commentActivity;if(d.assert(null!=n,"Revision to switch to must not be null!"),d.assert(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),!l.isRevisionEqual(n,this.state.viewing.revision)){if(l.isRevisionEqual(n,this.state.activity.latest_revision))t=u.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,p.reduxRestoreRevision();else{t=u.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION;var r=l.getFileWithRevision(this.state.viewing.file,n);p.reduxSwitchRevision(r)}return this.setState({viewing:o.assignIn({},this.state.viewing,{revision:n}),isPreviewReady:!1}),a.CommentsEvents.emit("revision-did-change"),c.log_annotation_event(t,this.state.activity.activity_key,null!=i?i.activity_key:void 0,this.state.actorId,this.state.viewing.context,f(null!=i?i.comment.comment_metadata:void 0,function(e){return e.annotation}))}},onShowComments:function(){return this.setState({viewing:o.assignIn(this.state.viewing,{showCommentsOverride:!0}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:o.assignIn(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){if(null!=this.state.createAnnotation)return this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null);if(null!=this.state.viewAnnotation){var e=this.state.viewAnnotation.activityKey;return this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})}},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(e){return u.SHOW_COMMENTS_TUTORIAL=e,this.setState({showTutorial:e,viewing:o.assignIn(this.state.viewing,{showTutorialOverride:null})})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===r.TUTORIAL_CREATE_ANNOTATION&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:r.TUTORIAL_CREATE_ANNOTATION_SUCCESS}):this.state.currentTutorialStep===r.TUTORIAL_REPLY&&this.state.expandedComment?this.setState({currentTutorialStep:r.TUTORIAL_REPLY_SUCCESS}):this.state.currentTutorialStep===r.TUTORIAL_MENTION&&this.state.mentionedContact?this.setState({currentTutorialStep:r.TUTORIAL_MENTION_SUCCESS}):void 0},onReceiveRevisions:function(e){return this.setState({revisions:e})}})}),define("modules/clean/file_activity/api",["require","exports","external/lodash","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity","modules/core/types"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={actorId:a.Maybe(Number),oref:a.Maybe(String),isBackgroundRequest:a.Maybe(Boolean)},l=function(e){var t=e.url,i=e.type,r=e.data,a=e.actorId,s=e.oref,l=e.isBackgroundRequest,c=l?o.SilentBackgroundRequestOref:o.WebRequestOref;return new Promise(function(e,o){return c({url:t,type:i,data:n.assignIn({oref:s},r),subject_user:a,success:e,error:function(e,t,n){if("abort"!==t)return o(Error(n))}})}).then(JSON.parse)},c=function(e){if("error"===e.status){var t=null!=e.payload?e.payload.error_text:void 0,n=Error(t);throw n.payload=e.payload,n.error_text=t,n}return e.payload},u=function(e){return[c(e),e.bolt_data]},d=function(e){return r.FileActivity.fromDict(e)},p=n.assignIn({commentActivityKey:a.Maybe(String),context:Number,contextData:String,text:String,metadata:a.Maybe(Object)},s),f=a.takes(p,a.returns(Promise,function(e){var t=e.actorId,n=e.commentActivityKey,o=e.context,r=e.contextData,a=e.text,s=e.metadata,u=e.oref,d=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:o,activity_context_data:r,comment_text:a,comment_metadata_json:JSON.stringify(s),target_comment_activity_key:n},oref:u,isBackgroundRequest:d}).then(c).then(i.CommentActivity.fromDict)}));t.addComment=f;var h=n.assignIn({commentActivityKey:String,context:Number,contextData:String},s),m=a.takes(h,a.returns(Promise,function(e){return l({actorId:e.actorId,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.deleteComment=m;var v=n.assignIn({enableComment:Boolean,context:Number,contextData:String},s),g=a.takes(v,a.returns(Promise,function(e){var t=e.actorId,n=e.enableComment;return l({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_off:!n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.updateCommentSetting=g;var _=n.assignIn({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},s),y=a.takes(_,a.returns(Promise,function(e){var t=e.actorId,n=e.resolved;return l({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData,resolved:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.updateResolveComment=y;var b=n.assignIn({commentActivityKeys:Array,context:Number,contextData:String},s),w=a.takes(b,a.returns(Promise,function(e){var t=e.actorId,n=e.commentActivityKeys,o=e.context,i=e.contextData,r=e.oref,a=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:o,activity_context_data:i},oref:r,isBackgroundRequest:a}).then(c)}));t.markCommentSeenBatch=w;var C=n.assignIn({context:Number,contextData:String},s),S=function(e){return l({actorId:e.actorId,url:"/file_activity/file_activity",type:"GET",data:{activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest})},E=a.takes(C,a.returns(Promise,function(e){return S(e).then(c).then(d)}));t.fetchFileActivity=E;var A=a.takes(C,a.returns(Promise,function(e){return S(e).then(u).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Array.from(e[0]),o=n[0],i=n[1];return[d(o),i]})}));t.fetchFileActivityWithBoltData=A;var T=n.assignIn({context:Number,contextDataList:Array},s),P=a.takes(T,a.returns(Promise,function(e){var t=e.actorId,o=e.context,i=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:o,activity_context_data_batch:JSON.stringify(i)},oref:r,isBackgroundRequest:a}).then(function(e){return n.mapValues(e,d)})}));t.fetchFileActivities=P;var x=n.assignIn({subscribed:Boolean,context:Number,contextData:String},s),k=a.takes(x,a.returns(Promise,function(e){var t=e.actorId,n=e.subscribed;return l({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,subscribed:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.updateFileActivitySubscription=k;var R=n.assignIn({context:Number,contextDataList:Array},s),O=a.takes(R,a.returns(Promise,function(e){var t=e.actorId,o=e.context,i=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:o,activity_context_data_batch:JSON.stringify(i)},oref:r,isBackgroundRequest:a}).then(c).then(function(e){return n.mapValues(e,function(e){return{feedback_off:e.feedback_off,comment_count:e.comment_count,unresolved_comment_count:e.unresolved_comment_count}})})}));t.fetchCommentStatusBatch=O;var I=n.assignIn({feedbackText:String,context:Number,contextData:String},s),M=a.takes(I,a.returns(Promise,function(e){var t=e.actorId,n=e.feedbackText;return l({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_text:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.submitProductFeedback=M;var F=a.takes({actorId:Number},a.returns(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return o.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(c)}));t.markCommentingOnboardingSeen=F;var D=a.takes({actorId:Number},a.returns(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return o.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(c)}));t.shouldShowCommentingOnboarding=D;var N=a.takes({actorId:Number,shouldShow:Boolean},a.returns(Promise,function(e){return l({actorId:e.actorId,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(c)}));t.setCommentingPaneVisibility=N;var L=a.takes({shouldShow:Boolean},a.returns(Promise,function(e){return l({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(c)}));t.setSessionCommentingPaneVisibility=L;var U=a.takes({actorId:Number,shouldShow:Boolean},a.returns(Promise,function(e){return l({actorId:e.actorId,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:e.shouldShow}}).then(c)}));t.setShowCommentsTutorial=U}),define("modules/clean/file_activity/clients/file_activity_bolt_client",["require","exports","tslib","external/eventemitter3","modules/clean/analytics","modules/clean/bolt","modules/clean/file_activity/api","modules/clean/optimistic_update","modules/clean/storage","modules/core/exception","modules/core/types"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";var d=function(e,t){return new r.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},p=function(e){return{revision:e.revision,token:e.token}},f=void 0,h=(function(e){function t(){var t=e.call(this)||this;return t._onBoltUpdate=t._onBoltUpdate.bind(t),t._onBoltRefresh=t._onBoltRefresh.bind(t),f.apply(t,arguments)}return n.__extends(t,e),t.initClass=function(){f=u.takes({actorId:u.Maybe(Number),context:Number,contextData:String,oref:u.Maybe(String)},function(e){var t=e.actorId,n=e.context,o=e.contextData,i=e.oref;return this.__requestOptions={actorId:t,context:n,contextData:o,oref:i,isBackgroundRequest:!0},this.__optimist=new s.Optimist(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0})},t.prototype.getFileActivity=function(){return this.__optimist.getValue()},t.prototype.isReady=function(){return this.__isReady},t.prototype.isLive=function(){return this.__isLive},t.prototype.rebase=function(e){c.assert(this.__isReady,"Cannot rebase when server data is not ready");var t=this.getFileActivity();return this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),t)},t.prototype.commitOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready");var t=this.getFileActivity(),n=this.__optimist.commit(e);return this.emit("updated",this.getFileActivity(),t),n},t.prototype.rollbackOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready");var t=this.getFileActivity();if(this.__optimist.rollback(e))return this.emit("updated",this.getFileActivity(),t)},t.prototype.init=function(){var e=this;c.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then(function(){if(i.CommentsVortexLogger.log("load-comments-success"),e.__isLive)return e._doStartLiveUpdate()}).catch(function(){return e.__canInit=!0})},t.prototype.startLiveUpdate=function(){return c.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},t.prototype.stopLiveUpdate=function(){return this.__isLive=!1,null!=this.__boltClient?this.__boltClient.unsubscribe():void 0},t.prototype._doStartLiveUpdate=function(){var e=d(this.getFileActivity(),this.__boltData);return this.__boltClient=new r.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},t.prototype._pullFromServer=function(){var e=this;l.SessionStorage.set("reload-timestamp",(new Date).getTime());var t=a.fetchFileActivityWithBoltData(this.__requestOptions);return t.then(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=Array.from(t[0]),i=o[0],r=o[1];e.__boltData=r;var a=e.__optimist.getValue();return e.__optimist.rebase(function(){return i}),i=e.__optimist.getValue(),e.__isReady?e.emit("updated",i,a):(e.__isReady=!0,e.emit("ready",i))}),t.catch(function(t){return e.emit("error",t)}),t},t.prototype._onBoltUpdate=function(e){var t=this;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key){var n=e[0];return this.__boltData=p(n),this._pullFromServer().then(function(){if(t.__isLive)return n=d(t.getFileActivity(),t.__boltData),t.__boltClient.update_states([n])})}},t.prototype._onBoltRefresh=function(e){var t=this;return this._pullFromServer().then(function(){if(t.__isLive)return t.stopLiveUpdate(),t.startLiveUpdate()})},t})(o);return h.initClass(),h}),define("modules/clean/file_activity/clients/file_activity_data_source",["require","exports","external/lru","external/lodash","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","modules/core/exception"],function(e,t,n,o,i,r,a,s){"use strict";var l=function(e,t,n,o){return void 0===o&&(o=""),e=null!=e?e:"",e+":"+t+":"+n+":"+o};return(function(){function e(e){var t=e._cache,n=e._unsubscribeStore,o=e._sendFileActivity,i=e._state;this.onStoreUpdate=this.onStoreUpdate.bind(this),this.onClientUpdated=this.onClientUpdated.bind(this),this._cache=t,this._unsubscribeStore=n,this._sendFileActivity=o,this._state=i}return e.initInstance=function(){var t=e;if(null==t.__instance)return t.__instance=t.create(r,function(e){return i.CommentsEvents.emit("file-activity-updated",e)})},e.getInstance=function(){var t=e;return s.assert(null!=t.__instance,"expected singleton to have been initialized"),t.__instance},e.create=function(t,o,i){void 0===i&&(i=10);var r=new n(i);r.shift=function(){var e=n.prototype.shift.call(this),t=e.value;return null!=t&&t.removeAllListeners(),null!=t&&t.stopLiveUpdate(),e};var a=new e({_cache:r,_state:{},_sendFileActivity:o});return a._unsubscribeStore=t.listen(a.onStoreUpdate),a.onStoreUpdate(t.state),a},e.prototype.dispose=function(){return this._unsubscribeStore()},e.prototype.resetCache=function(){return this._cache.removeAll()},e.prototype.replaceState=function(e){if(this.shouldUpdate(e)){this.willUpdate(e);var t=this._state;return this._state=e,this.didUpdate(t)}},e.prototype.getState=function(){return this._state},e.prototype.onStoreUpdate=function(e){var t=e.actorId,n=e.oref,o=e.viewing,i=o.context,r=o.contextData,a={oref:n,actorId:t,context:i,contextData:r};return this.replaceState(a)},e.prototype.shouldUpdate=function(e){return!o.isEqual(this._state,e)},e.prototype.willUpdate=function(e){var t=this.getCurrentClient();if(null!=t)return this.deactivateClient(t)},e.prototype.didUpdate=function(e){var t=this.getCurrentFetchKey();if(!this.isFetching(t)&&(this.sendActivity(null),!this.isNullState(this._state)))return this.fetchAndSend(this._state)},e.prototype.getFetchKey=function(e){return l(e.actorId,e.context,e.contextData,e.oref)},e.prototype.getCurrentFetchKey=function(){
return this.getFetchKey(this._state)},e.prototype.getCurrentClient=function(){var e=this.getCurrentFetchKey();return this._cache.get(e)},e.prototype.isFetching=function(e){var t=this._cache.find(this.getFetchKey(e));return null!=t&&!t.isReady()},e.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},e.prototype.activateClient=function(e){if(e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady())return this.onClientUpdated(e.getFileActivity())},e.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},e.prototype.deactivateCurrentClient=function(){var e=this.getCurrentClient();if(null!=e)return this.deactivateClient(e)},e.prototype.fetchAndSend=function(e){var t=e.actorId,n=e.context,o=e.contextData,i=e.oref,r=l(t,n,o,i),a=this._cache.get(r);if(null!=a)return this.activateClient(a);var s=this.createFileActivityBoltClient({actorId:t,context:n,contextData:o,oref:i});return s.init(),this._cache.set(r,s),this.activateClient(s)},e.prototype.onClientUpdated=function(e){return this.sendActivity(e)},e.prototype.onClientError=function(e){throw e},e.prototype.sendActivity=function(e){return this._sendFileActivity(e)},e.prototype.createFileActivityBoltClient=function(e){return new a(e)},e.prototype.rebase=function(e){var t=this.getCurrentClient();return null!=t&&t.rebase(e)},e.prototype.commitOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t?t.commitOptimisticUpdate(e):null},e.prototype.rollbackOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t&&t.rollbackOptimisticUpdate(e)},e})()}),define("modules/clean/file_activity/models/file_activity",["require","exports","tslib","external/deep-freeze","external/lodash","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,i=void 0===n?"":n,r=t.feedback_off,a=void 0!==r&&r,s=t.can_edit_feedback,l=void 0===s||s,c=t.comment_activities,u=void 0===c?[]:c,d=t.users_to_notify,p=void 0===d?[]:d,f=t.latest_revision,h=void 0===f?null:f;this.activity_key=i,this.feedback_off=a,this.can_edit_feedback=l,this.comment_activities=u,this.users_to_notify=p,this.latest_revision=h,o(this)}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(c.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(s.ActivityUser.fromDict),latest_revision:t.latest_revision})},e.prototype.enableCommenting=function(){return a.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return a.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=a.thaw(this),n=this.comment_activities.map(a.thaw);return t.comment_activities=n,t.comment_activities.forEach(function(e){e.comment_activities=e.comment_activities.map(a.thaw)}),e(t),o(t)},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=function(t){return t.activity_key===e},o=0;o<this.comment_activities.length;o++){var i=this.comment_activities[o];if(n(i))return["comment_activities",o];if(!t)for(var r=0;r<i.comment_activities.length;r++)if(n(i.comment_activities[r]))return["comment_activities",o,"comment_activities",r]}return null},e.prototype._updateComment=function(e,t){return e?a.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return a.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),a.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=function(t){return t.activity_key===e},n=0;n<this.comment_activities.length;n++){var o=this.comment_activities[n];if(t(o))return o;for(var i=0;i<o.comment_activities.length;i++){var r=o.comment_activities[i];if(t(r))return r}}return null},e.prototype.findConversationByKey=function(e){return i.find(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return a.updateIn(this,t,function(e){return a.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return a.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){t._reapComments(function(t){return e.includes(t.activity_key)}).forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},n.__decorate([l.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),latest_revision:u.RevisionShape})],e,"fromDict",null),e})();t.FileActivity=d}),define("modules/clean/file_activity/models/revision",["require","exports","modules/core/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:n.Maybe(String),direct_blockserver_link:n.Maybe(String)})}),define("modules/clean/frame_messenger/frame_messenger_base",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){var t=this;this._window=window,this.handleUntrustedMessage=function(e){if(t.isOriginAllowed(e.origin)){var n;try{n=JSON.parse(e.data)}catch(e){return}n.action&&t.dispatchMessage(e,n)}},this.allowedOrigins=e}return e.prototype.getWindow=function(){return this._window},e.prototype.setWindow=function(e){this._window=e},e.prototype.startListening=function(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)},e.prototype.stopListening=function(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)},e.prototype.regexIn=function(e,t){if(t.indexOf(e)>-1)return!0;for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i instanceof RegExp&&e.match(i))return!0}return!1},e.stripStandardPort=function(e){return"http://"===e.substr(0,7)?e.replace(/:80/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e},e.prototype.isOriginAllowed=function(t){return this.regexIn(e.stripStandardPort(t),this.allowedOrigins)},e.prototype.packagePostMessage=function(e,t){var n={action:e,parameters:t};return JSON.stringify(n)},e})();t.FrameMessengerBase=n}),define("modules/clean/frame_messenger/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,o){"use strict";function i(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedChildOriginForPosting=null,t._validActionsFromChild=[],t.getChildIframes=function(){return[]},t}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){if("string"==typeof e){var o=e;this.getChildIframes=function(){return[].slice.call(document.querySelectorAll(o),0)}}else this.getChildIframes=e;this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.postMessageToChildren("parent-ready")},t.prototype.getTrustedChildOriginForPosting=function(){if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(var e=this.getChildIframes(),t=0,n=e;t<n.length;t++){var o=n[t],i=""+o.getAttribute("src"),r=this.getOriginFromUrl(i);if(this.isOriginAllowed(r)){this.updateChildOrigin(r);break}}return this._trustedChildOriginForPosting},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._isNumber=function(e){return!isNaN(parseInt(e,10))},t.prototype.getOriginFromUrl=function(e){var t=document.createElement("a");t.href=e;var n=t.origin;if(n)return"null"===n?"*":n;var o=this._isNumber(t.port)?":"+t.port:"";return t.protocol+"//"+t.hostname+o},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={});var n=this.getChildIframes();this.postMessageToChildElements(n,e,t)},t.prototype.resetOriginsForPosting=function(){this._trustedChildOriginForPosting=null},t.prototype.updateChildOrigin=function(e){"null"===e&&(e="*"),this._trustedChildOriginForPosting=e},t.prototype.dispatchMessage=function(e,t){this.updateChildOrigin(e.origin),"child-requesting-parent-origin"===t.action&&this.postMessageToChildren("parent-ready"),i(t.action,this._validActionsFromChild)&&null!=this._trustedMessageFromChildHandler&&this._trustedMessageFromChildHandler(t)},t.prototype.postMessageToChildElements=function(e,t,n){void 0===n&&(n={});var o=this.getTrustedChildOriginForPosting();if(null!==o){var i=this.packagePostMessage(t,n);e.forEach(function(e){e.contentWindow&&e.contentWindow.postMessage(i,o)})}},t})(o.FrameMessengerBase);t.FrameMessengerHost=r}),define("modules/clean/growth/showcase_upsell/preview_loader",["require","exports","tslib","external/react","modules/clean/react/size_class/constants","modules/clean/react/async/loadable"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/preview_gate"],t,n)}).then(function(e){return e.ShowcaseUpsellPreviewGate})}}),s=[".jpg",".jpeg",".pdf",".ppt",".pptx",".png",".tif"],l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.shouldRender=function(){var e=this.props,t=e.user,n=e.currentFile,o=e.sharedLinkInfo,r=e.variant,a=e.sizeClass,l=e.isFullscreen,c=e.hidePageChrome,u="V1"===r||"CONTROL"===r,d=t&&!t.is_team&&!t.paid,p=!o,f=n.fq_path,h=n.ext?n.ext:f?"."+f.substr(f.lastIndexOf(".")+1):"",m=s.indexOf(h)>=0,v=a===i.SizeClass.Large;return u&&d&&p&&m&&!l&&!c&&v},t.prototype.render=function(){var e=this.props,t=e.user,n=e.currentFile,i=e.variant;return t&&n&&"OFF"!==i&&this.shouldRender()?o.createElement(a,{user:t,currentFile:n,variant:i}):null},t})(o.Component);t.ShowcaseUpsellPreviewLoader=l}),define("modules/clean/image_annotations",["require","exports","jquery","modules/clean/image_preview_util","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer"],function(e,t,n,o,i,r){"use strict";function a(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){var e=this;this.onTransitionEnd=function(){e.forceResizeAndUpdateOffsets()},this.forceResizeAndUpdateOffsets=function(){e._resizeAnnotationContainer(),null!=e.annotationInterface&&e.annotationInterface.onScaleChangeCallback()},this._handleMessage=this._handleMessage.bind(this),this._onScroll=this._onScroll.bind(this),this.onResize=this.onResize.bind(this)}return e.prototype.onImageLoad=function(e){return void 0===e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},e.prototype._prepareAnnotations=function(){return this._prepareAnnotationInterface(),this.annotationRenderer=new r,window.addEventListener("resize",this.onResize),o.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("transitionend",this.onTransitionEnd),window.addEventListener("message",this._handleMessage),this._postPageRendered()},e.prototype._prepareAnnotationInterface=function(){if(0===o.getAnnotationContainer().length){var e=o.getPreviewImageWrapper(),t=n("<div class='"+o.ANNOTATION_CONTAINER+"' />");this.$annotationContainer=t.appendTo(e)}return this._resizeAnnotationContainer(),this.annotationInterface=new i,o.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout(this.forceResizeAndUpdateOffsets,0)},e.prototype._handleMessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){return}switch(t.action){case"update-annotations":return this._resizeAnnotationContainer(),null!=this.annotationInterface&&this.annotationInterface._updateOffset(),null!=this.annotationRenderer?this.annotationRenderer.updateAnnotations(t.parameters):void 0;case"remove-annotation":var n=t.parameters.commentActivity;return null!=this.annotationRenderer?this.annotationRenderer.removeAnnotation(n):void 0;case"remove-all-annotations":return null!=this.annotationRenderer&&this.annotationRenderer.removeAllAnnotations(),this._resizeAnnotationContainer(),null!=this.annotationInterface?this.annotationInterface._updateOffset():void 0;case"enable-annotation-creation":return null!=this.annotationInterface?this.annotationInterface.enableAnnotationCreation():void 0;case"disable-annotation-creation":return null!=this.annotationInterface?this.annotationInterface.disableAnnotationCreation():void 0;case"enable-region-creation":return this._setRegionCreationEnabled(!0);case"disable-region-creation":return this._setRegionCreationEnabled(!1);case"hide-annotation":return null!=this.annotationInterface?this.annotationInterface.onHideAnnotation():void 0;case"scroll-to-annotation":return n=t.parameters.commentActivity,null!=this.annotationRenderer?this.annotationRenderer.highlightAnnotation(n):void 0;case"file-feedback-ui-ready":return this._postPageRendered()}},e.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},e.prototype._postMessage=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._setRegionCreationEnabled=function(e){return e?null!=this.annotationInterface&&this.annotationInterface.enableRegionCreation():null!=this.annotationInterface&&this.annotationInterface.disableRegionCreation(),this._resizeAnnotationContainer(),null!=this.annotationInterface?this.annotationInterface._updateOffset():void 0},e.prototype._onScroll=function(){return null!=this.annotationInterface?this.annotationInterface.onScrollCallback():void 0},e.prototype.onResize=function(e){var t=this;void 0===e&&(e=!0),null!=this.annotationRenderer&&this.annotationRenderer.removeAllAnnotations(),this._postMessage("scale-change");var n=function(){return t._resizeAnnotationContainer(),t._postPageRendered(),null!=t.annotationInterface&&t.annotationInterface.onScaleChangeCallback(),"function"==typeof t.resizeImageCallback?t.resizeImageCallback():void 0};return clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},e.prototype._resizeAnnotationContainer=function(){var e=o.getPreviewImage();if(null!=e&&null!=e.offset()&&null!=a(e.offsetParent(),function(e){return e.offset()})){var t=e.offset().top-e.offsetParent().offset().top,n=e.offset().left-e.offsetParent().offset().left;return t<0&&(t=0),n<0&&(n=0),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-top",t),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-bottom",t),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-left",n),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-right",n),(null!=this.annotationInterface?this.annotationInterface.isAnnotationRegionEnabled:void 0)?(null!=this.$annotationContainer&&this.$annotationContainer.height(e.height()),null!=this.$annotationContainer?this.$annotationContainer.width(e.width()):void 0):(null!=this.$annotationContainer&&this.$annotationContainer.height(0),null!=this.$annotationContainer?this.$annotationContainer.width(0):void 0)}},e.prototype.removeAnnotations=function(){return null!=this.annotationRenderer?this.annotationRenderer.removeAllAnnotations():void 0},e.prototype.reset=function(){return null!=this.annotationRenderer&&this.annotationRenderer.reset(),null!=this.annotationInterface&&this.annotationInterface.reset(),o.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),o.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),window.removeEventListener("transitionend",this.onTransitionEnd),this._postMessage("reset-file-feedback-ui")},e})();t.ImageAnnotations=s}),define("modules/clean/image_preview_util",["require","exports","jquery","modules/clean/react/size_class/constants","modules/clean/react/previews/image/constants","modules/clean/annotations/annotation"],function(e,t,n,o,i){"use strict";return{PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return n("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return n("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return n("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return n("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return n("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){for(var t=[],n=this.getPreviewImageElement(),o=n.clientWidth,i=n.clientHeight,r=0,a=Array.from(e.image_coordinates);r<a.length;r++){for(var s=a[r],l=[],c=0,u=Array.from(s.coordinates);c<u.length;c++){var d=u[c],p=d.x*o,f=d.y*i;l.push({x:p,y:f})}t.push(l)}return t},convertAnnotationViewportCoordinatesToImagePoints:function(e,t,n){for(var o=[],i=this.getPreviewImageElement(),r=i.clientWidth,a=i.clientHeight,s=0,l=Array.from(e.viewportCoordinates);s<l.length;s++){for(var c=l[s],u=[],d=0,p=Array.from(c);d<p.length;d++){var f=p[d],h=(f.x-t)/r,m=(f.y-n)/a;u.push({x:h,y:m})}o.push({coordinates:u})}return o},getImagePadding:function(e){return e===o.SizeClass.Large?{height:i.IMAGE_LARGE_PADDING_HEIGHT,width:i.IMAGE_LARGE_PADDING_WIDTH}:{height:i.IMAGE_PADDING_HEIGHT,width:i.IMAGE_PADDING_WIDTH}},getMinimumZoomPercent:function(e){var t=e.windowDimensions,n=e.imagePadding,o=e.imageDimensions,i=(t.height-n.height)/o.height,r=(t.width-n.width)/o.width;return Math.min(i,r,1)}}}),define("modules/clean/image_size",["require","exports"],function(e,t){"use strict";function n(e,t){for(var n=0,i=o;n<i.length;n++){var r=i[n],a=r[0],s=r[1],l=r[2];if(s>=e||l>=t)return a}return o[o.length-1][0]}Object.defineProperty(t,"__esModule",{value:!0});var o=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];t.imageBestFitSize=n}),define("modules/clean/image_viewer_annotation_interface",["require","exports","external/react","external/react-dom","jquery","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util"],function(e,t,n,o,i,r,a){"use strict";return(function(){function e(){this._prepareAnnotationController=this._prepareAnnotationController.bind(this),this._refreshAnnotationController=this._refreshAnnotationController.bind(this),this._prepareAnnotationCoords=this._prepareAnnotationCoords.bind(this),this.onHideAnnotation=this.onHideAnnotation.bind(this),this.onMouseDownCallback=this.onMouseDownCallback.bind(this),this.onMouseMoveCallback=this.onMouseMoveCallback.bind(this),this.onMouseUpCallback=this.onMouseUpCallback.bind(this),this.onKeyDownCallback=this.onKeyDownCallback.bind(this),this.onScrollCallback=this.onScrollCallback.bind(this),this.onScaleChangeCallback=this.onScaleChangeCallback.bind(this),this.onAnnotationHiddenCallback=this.onAnnotationHiddenCallback.bind(this),this.onAnnotationPlacedCallback=this.onAnnotationPlacedCallback.bind(this),this.onAnnotationStartDragCallback=this.onAnnotationStartDragCallback.bind(this),this.onAnnotationEndDragCallback=this.onAnnotationEndDragCallback.bind(this),this.onAnnotationScrollCallback=this.onAnnotationScrollCallback.bind(this),this.onAnnotationScaleChangeCallback=this.onAnnotationScaleChangeCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this.controllerEventHandlers={onMouseMoveCallback:i.noop,onMouseDownCallback:i.noop,onMouseUpCallback:i.noop,onHideAnnotation:i.noop,onScrollCallback:i.noop,onScaleChangeCallback:i.noop,onKeyDownCallback:i.noop},this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return e.prototype._sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._isOnAnnotationUI=function(e){return i(e.target).parents(".db-annotation-layer").length>0},e.prototype._isOnAnnotationOverlay=function(e){return i(e.target).parents("#annotation-overlay").length>0},e.prototype._destroyAnnotationController=function(){var e=a.getAnnotationLCanvasLayer();if((null!=e?e.length:void 0)>0)return o.unmountComponentAtNode(e[0]),e.remove()},e.prototype._prepareAnnotationController=function(){var e=a.getAnnotationContainer();if(0===e.find("."+a.ANNOTATION_CANVAS_LAYER_CSS).length){var t=i("<div class='"+a.ANNOTATION_CANVAS_LAYER_CSS+"' />");return this.$parentContainerEl=t.appendTo(e),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()}},e.prototype._refreshAnnotationController=function(e){if(null!=this.$parentContainerEl?this.$parentContainerEl.get(0):void 0)return this.annotationController=o.render(n.createElement(r,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:!1,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0),e)},e.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},e.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=a.convertAnnotationViewportCoordinatesToImagePoints(e,this.parentContainerOffset.left,this.parentContainerOffset.top),e},e.prototype._updateOffset=function(e){if(this.$parentContainerEl)return this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)},e.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},e.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},e.prototype.enableRegionCreation=function(){return i("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},e.prototype.disableRegionCreation=function(){return i("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},e.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),a.getAnnotationContainer().remove()},e.prototype.onHideAnnotation=function(){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation():void 0},e.prototype.onMouseDownCallback=function(e){if(!this._isOnAnnotationUI(e)&&!this._isOnAnnotationOverlay(e))return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseDownCallback(e):void 0},e.prototype.onMouseMoveCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseMoveCallback(e):void 0},e.prototype.onMouseUpCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseUpCallback(e):void 0},e.prototype.onKeyDownCallback=function(e){var t=e.keyCode||e.which||e.charCode;return this._sendToParent("on-keydown",{keyCode:t})},e.prototype.onScrollCallback=function(e){if(this._updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onScrollCallback():void 0),!(null!=this.annotationController?this.annotationController.hasVisibleActiveAnnotation():void 0))return this._sendToParent("scroll")},e.prototype.onScaleChangeCallback=function(e){return this._updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},e.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},e.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},e.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},e.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},e})()}),define("modules/clean/image_viewer_annotation_renderer",["require","exports","external/react","external/react-dom","jquery","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui"],function(e,t,n,o,i,r,a){"use strict";var s=new r;return(function(){function e(){this.removeAnnotation=this.removeAnnotation.bind(this),this.updateAnnotations=this.updateAnnotations.bind(this),this._renderAnnotation=this._renderAnnotation.bind(this),this.onAnnotationClickCallback=this.onAnnotationClickCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this._annotationsByActivityKey={}}return e.prototype._isAnnotationAlreadyRendered=function(e){return i("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},e.prototype.removeAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){var t=i("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0);return o.unmountComponentAtNode(t),t.remove()}},e.prototype.removeAllAnnotations=function(){return this.reset()},e.prototype.reset=function(){for(var e=a.getAnnotationLayers(),t=0,n=Array.from(e);t<n.length;t++){var i=n[t];o.unmountComponentAtNode(i)}return e.remove(),this._annotationsByActivityKey={}},e.prototype.highlightAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){var t=i("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']");return t.removeClass("start-highlight-animation"),t.width(t.width()),t.addClass("start-highlight-animation")}},e.prototype.updateAnnotations=function(e){var t=this;if(s.shouldUpdateAnnotations(e,this._annotationsByActivityKey))return this.removeAllAnnotations(),(function(){for(var n=[],o=0,i=Array.from(e.annotations);o<i.length;o++){var r=i[o];s.renderAnnotation(r,t._isAnnotationAlreadyRendered,t._renderAnnotation);var a=r.commentActivity.activity_key;n.push(t._annotationsByActivityKey[a]=r)}return n})()},e.prototype._renderAnnotation=function(e,t,r,s){var l=a.getAnnotationContainer();if((null!=l?l.length:void 0)>0){t.viewportCoordinates=a.convertAnnotationImagePointsToViewportCoordinates(t);var c=i("<div class='"+a.ANNOTATION_LAYER_CSS+"' />");c.attr({"data-comment-activity-key":r.activity_key});var u=c.appendTo(l).get(0);return o.render(n.createElement(e,{annotation:t,commentActivity:r,options:s,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),u)}},e.prototype._sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},e.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},e.prototype.onAnnotationOverCallback=function(e){return{}},e.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},e})()}),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(e,t,n,o,i,r,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p={};p[r.EventType.FilePreviewSessionEnded]="preview_session_ended",p[r.EventType.FilePreviewAttemptStarted]="preview_attempted",p[r.EventType.FilePreviewSupportConfirmed]="support_confirmed",p[r.EventType.FilePreviewSupportDenied]="support_denied",p[r.EventType.FilePreviewDownloadAttempted]="download_attempted",p[r.EventType.FilePreviewDownloadSucceeded]="download_succeeded",p[r.EventType.FilePreviewDownloadFailed]="download_failed",p[r.EventType.FilePreviewRenderSucceeded]="render_succeeded",p[r.EventType.FilePreviewRenderFailed]="render_failed",p[r.EventType.FilePreviewQualityPopupAsked]="quality_popup_asked",p[r.EventType.FilePreviewQualityPopupAnswered]="quality_popup_answered",p[r.EventType.FilePreviewQualityPopupDismissed]="quality_popup_dismissed",p[r.EventType.FilePreviewUserAction]="user_action",p[r.EventType.ArchivePreviewContentsScanned]="archive_contents_scanned";var f=(function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},
e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,o=e;n<o.length;n++){var i=o[n],r=i[0],a=i[1];this._eventHandlers[r]=a}},e.prototype._log=function(e,t,n){void 0===n&&(n={});var o=this._getSerializedTimeline(t),r={device_type:t.fileViewerSession.deviceType,event_name:p[e],extra:JSON.stringify(n),file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:o?JSON.stringify(o):null,file_preview_size:t.previewSize};i.SilentBackgroundBeaconRequest({url:"/log/file_preview",data:r})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.addListener(t,n)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.removeListener(t,n)}},e})(),h=(function(e){function t(){var t=e.call(this)||this;return t._logAnswers=function(e,n,o){void 0===o&&(o={}),Object.keys(n).forEach(function(e){var t=parseInt(e,10);o[l.getQuestionLoggerKey(t)]=n[t]}),t._log(r.EventType.FilePreviewQualityPopupAnswered,e,o)},t._logQuestion=function(e,n){for(var o={},i=0,a=n;i<a.length;i++){var s=a[i];o[l.getQuestionLoggerKey(s)]="1"}t._log(r.EventType.FilePreviewQualityPopupAsked,e,o)},t._logDismissed=function(e,n){var o={stage:s.getPopupStageLoggerKey(n)};t._log(r.EventType.FilePreviewQualityPopupDismissed,e,o)},t.addEventHandlers([r.EventType.FilePreviewQualityPopupAsked,t._logQuestion],[r.EventType.FilePreviewQualityPopupAnswered,t._logAnswers],[r.EventType.FilePreviewQualityPopupDismissed,t._logDismissed]),t}return n.__extends(t,e),t.prototype._log=function(t,n,o){void 0===o&&(o={}),o._client_time=+Date.now();var i=n.sourceContext,r=n.sourceAction;i&&(o._source_context=i),r&&(o._source_action=r),e.prototype._log.call(this,t,n,o)},t})(f);t.FilePreviewQualityPopupLogger=h;var m=(function(e){function t(t){var n=e.call(this)||this;return n._handleFilePreviewAttemptStarted=function(e,t){n._handleEvent(r.EventType.FilePreviewAttemptStarted,e,t)},n._handleFilePreviewSupportConfirmed=function(e,t){n._handleEvent(r.EventType.FilePreviewSupportConfirmed,e,t)},n._handleFilePreviewSupportDenied=function(e,t){n._handleEvent(r.EventType.FilePreviewSupportDenied,e,t)},n._handleFilePreviewDownloadAttempted=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadAttempted,e,t)},n._handleFilePreviewDownloadSucceeded=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadSucceeded,e,t)},n._handleFilePreviewDownloadFailed=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadFailed,e,t)},n._handleFilePreviewRenderSucceeded=function(e,t){n._handleEvent(r.EventType.FilePreviewRenderSucceeded,e,t)},n._handleFilePreviewRenderFailed=function(e,t){n._handleEvent(r.EventType.FilePreviewRenderFailed,e,t)},n._handleFilePreviewSessionEnded=function(e,t){n._handleEvent(r.EventType.FilePreviewSessionEnded,e,t)},n._filePreviewSessionId=t,n.addEventHandlers([r.EventType.FilePreviewAttemptStarted,n._handleFilePreviewAttemptStarted],[r.EventType.FilePreviewSupportConfirmed,n._handleFilePreviewSupportConfirmed],[r.EventType.FilePreviewSupportDenied,n._handleFilePreviewSupportDenied],[r.EventType.FilePreviewDownloadAttempted,n._handleFilePreviewDownloadAttempted],[r.EventType.FilePreviewDownloadSucceeded,n._handleFilePreviewDownloadSucceeded],[r.EventType.FilePreviewDownloadFailed,n._handleFilePreviewDownloadFailed],[r.EventType.FilePreviewRenderSucceeded,n._handleFilePreviewRenderSucceeded],[r.EventType.FilePreviewRenderFailed,n._handleFilePreviewRenderFailed],[r.EventType.FilePreviewSessionEnded,n._handleFilePreviewSessionEnded]),n}return n.__extends(t,e),t.prototype._handleEvent=function(e,t,n){if(void 0===n&&(n={}),this._filePreviewSessionId===t.id){n.preview_type=t.file.preview_type,n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=u.REQUEST_ID,n.source_context=t.sourceContext,n.source_action=t.sourceAction,n.is_mounted=t.isMounted,null!=t.primaryMarkTs&&(n.primary_mark_ts=t.primaryMarkTs,n.time_to_primary_mark=t.timeToPrimaryMark());var i=c.start_time();void 0!==i&&(n.navigation_start=i),null!=t.pageCount&&(n.page_count=t.pageCount),null!=t.firstPageRendered&&(n.first_page_rendered=t.firstPageRendered),null!=t.previewThumbnailInfo&&(n.preview_thumbnail_info=JSON.stringify(t.previewThumbnailInfo)),t.isSSR&&(n.is_ssr="1"),null!=t.lastEvent&&(n.last_event=p[t.lastEvent]),o.isEmpty(t.ssrTimestamps)||(n.ssr_timestamps=JSON.stringify(t.ssrTimestamps)),o.isEmpty(t.ssrTiming)||(n.ssr_timing=JSON.stringify(t.ssrTiming));var s=t.previewTimeline[r.EventType.FilePreviewRenderSucceeded];if(s&&(n.time_to_render=t.timeToMark(s.timestamp)),t.sourceAction===a.PreviewSourceAction.Visit){var l=c.time_since_start();if(null!=l&&(n.time_to_event=l),e===r.EventType.FilePreviewRenderSucceeded){var f=c.time_to_view();null!=f&&null!=i&&(n.ttv_ts=f);var h=c.time_to_interactive();null!=h&&null!=i&&(n.time_to_interactive=h-i);var m=d.performance();if(null!=m){var v=m.timing;null!=v&&null!=i&&(n.time_to_first_byte=v.responseStart-i,n.web_timing_data=JSON.stringify(v))}window._timingData&&window._timingData.img&&(delete window._timingData.img.dl_error_finish,n.img_timing_data=JSON.stringify(window._timingData.img))}}e===r.EventType.FilePreviewSessionEnded&&(n.pages_rendered=JSON.stringify(t.pagesRendered),n.images_fetched=JSON.stringify(t.fileViewerSession.imagesFetched),n.zoom_scales=JSON.stringify(t.zoomScales),n.password_needed=t.passwordNeeded),this._log(e,t,n)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var n in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(n)){var o=e.previewTimeline[n],i=this._timelineKey(n);t[i]=o.timestamp}return t},t.prototype._timelineKey=function(e){return p[e]+"_ts"},t})(f);t.FilePreviewTimelineLogger=m;var v=(function(e){function t(){var t=e.call(this)||this;return t.logContentsScanned=function(e,n){t._log(r.EventType.ArchivePreviewContentsScanned,e,n)},t.addEventHandlers([r.EventType.ArchivePreviewContentsScanned,t.logContentsScanned]),t}return n.__extends(t,e),t})(f);t.FilePreviewArchiveLogger=v;var g=(function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,n,o,i){i.action=n,i.context=o,t._log(r.EventType.FilePreviewUserAction,e,i)},t.addEventHandlers([r.EventType.FilePreviewUserAction,t._logUserAction]),t}return n.__extends(t,e),t})(f);t.FilePreviewUserActionLogger=g}),define("modules/clean/loggers/file_viewer_logger",["require","exports","tslib","modules/clean/analytics","modules/clean/file_store/utils","modules/constants/python"],function(e,t,n,o,i,r){"use strict";function a(){return o.UserActivityLogger.start("web","file_view_first_page_rendered"),o.PreviewActivityLogger.start("file_view_first_page_rendered"),o.FileViewLogger.start()}function s(e,t){e=e;for(var r=i.getExtension(e),a=n.__assign({},t.attributes,{total_time:-1,file_ext:r,source:"file-viewer",originalSize:null!=e.bytes?e.bytes:0}),s=0,l=t.stats;s<l.length;s++){var u=l[s];a[c[u.name]]=u.end-u.start}return o.UserActivityLogger.stop("web","file_view_first_page_rendered",a),o.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:r,extra:JSON.stringify(a)})}function l(e,t,n,a,s,l,c){void 0===c&&(c=!1);var u={user_id:null!=t?t.id:void 0,target:n,platform:r.FileViewPlatformType.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:a,action:s,shared_link_url:l,extra:{file_ext:i.getExtension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,time_taken:-1,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),is_ndsl:c}};return o.FileViewLogger.stop(u)}Object.defineProperty(t,"__esModule",{value:!0});var c={Overall:"viewer_overall_time","Page Request":"viewer_page_request_time",Rendering:"viewer_rendering_time"};t.start=a,t.logPageRendered=s,t.logView=l}),define("modules/clean/loggers/video_preview_logger",["require","exports","modules/clean/ajax","modules/clean/perf_tools/web_timing_utils"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e,t){this.videoTruncated=!1,this.filePreviewSessionId=t?t.id:"",this.videoFormat=e}return e.prototype.populateVideoDuration=function(e){this.videoDuration=Math.round(e)},e.prototype.setVideoTruncated=function(){this.videoTruncated=!0},e.prototype.logEvent=function(e,t){var i=o.WebTimingUtil.getNow(),r={event_name:e,client_timestamp_ms:i,file_preview_session_id:this.filePreviewSessionId,video_format:this.videoFormat,video_duration_seconds:this.videoDuration,video_truncated:this.videoTruncated,extra:t?JSON.stringify(t):void 0};n.SilentBackgroundBeaconRequest({url:"/log/video_preview",data:r})},e})();t.VideoPreviewLogger=i}),define("modules/clean/open_with",["require","exports","external/lodash","modules/clean/filepath","modules/core/uri"],function(e,t,n,o,i){"use strict";var r=void 0,a=void 0,s=void 0,l=(function(){function e(){}return e.initClass=function(){this.PRELOAD_URLS={},this.MAX_SUPPORTED_FILE_SIZE_B=157286400,r=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],a=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"google_dss_docs",ext:["gdoc"],icon:"google_dss_docs",name:"Google Docs Online Editor"},{id:"google_dss_sheets",ext:["gsheet"],icon:"google_dss_sheets",name:"Google Sheets Online Editor"},{id:"google_dss_slides",ext:["gslides"],icon:"google_dss_slides",name:"Google Slides Online Editor"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],s=function(e){var t=o.filename(e),i=o.file_extension(t);return n.find(a,function(e){return Array.from(e.ext).includes(i)})}},e.get_open_handler_for=function(t,n){var o=s(t.fq_path);if(!o||!e.is_app_supported_for_file(o.id,t))return null;var r=i.URI.encode_parts(t.fq_path),a=e.uri_path_base(o.id),l="personal"===n.role?"/personal":"/work";return{icon:o.icon,name:o.name,uri:""+a+l+r}},e.uri_path_base=function(e){switch(e){case"google_dss_docs":return"/google_dss/docs/edit/path";case"google_dss_sheets":return"/google_dss/sheets/edit/path";case"google_dss_slides":return"/google_dss/slides/edit/path";default:return"/ow/msft/edit"}},e.file_supported=function(e){return!!s(e.fq_path)},e.is_adobe_app=function(e){return Array.from(r).includes(e)},e.is_app_supported_for_file=function(e,t){switch(e){case"google_dss_docs":return t.is_cloud_doc;case"google_dss_sheets":return t.is_cloud_doc;case"google_dss_slides":return t.is_cloud_doc;case"word":case"excel":case"powerpoint":return!0;case"wopitest":return!1;case"wopitest-unsupported":return!1;default:return!1}},e})();return l.initClass(),l}),define("modules/clean/optimistic_update",["require","exports","external/lodash"],function(e,t,n){"use strict";function o(e){return n.isString(e)}Object.defineProperty(t,"__esModule",{value:!0});var i={},r=(function(){function e(e){this._base=e,this._journal=[],this._head=i}return e.prototype.getValue=function(){return this._head===i&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=n.uniqueId("optimist-patch-");return this._head=i,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(o(e)){var t=this._removeJournalEntry(e);return!!t&&(this._head=i,this._base=t.patch(this._base,e),!0)}return this._head=i,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=n.findIndex(this._journal,function(t){return t.id===e});return t<0?null:(this._head=i,this._journal.splice(t,1)[0])},e})();t.Optimist=r}),define("modules/clean/previews/actions",["require","exports","modules/clean/previews/file_view_rams_common","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){var o=n.getNativePrintUrl(e,t);return null!=o&&(window.open(o,"_blank"),!0)}function l(e,t,n,r){return!!(e&&null!=n?c(n,t):u(t))&&(o.logUserAction(i.UserAction.Print,r),!0)}function c(e,t){return s(a.URI.parse(e).setQuery({preview:"1"}),a.URI.parse(t).getAuthority())}function u(e){return s(a.URI.parse(e),a.URI.parse(e).getAuthority())}function d(e){var t=window.open("about:blank");if(!t)throw new Error(r._("Could not open new window"));window.setTimeout(function(){var n=t.document.createElement("style");n.innerHTML="\n      @page { margin: 0;}\n      img { max-width: 100%; max-height: 100%}\n    ",t.document.head.appendChild(n);var o=function(){t.print()},i=function(){t.close()},r=t.document.createElement("img");r.src=e,r.onload=o,r.onerror=i,t.document.body.appendChild(r)},50)}Object.defineProperty(t,"__esModule",{value:!0}),t.nativePrint=l,t.imagePrint=d}),define("modules/clean/previews/cookie_preview_tracer",["require","exports","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/core/cookies","modules/constants/file_viewer"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e,t){var a=this;this.sessionId=e,this.onPreviewAttempt=function(){i.Cookies.create(r.FILE_PREVIEW_SESSION_ID_COOKIE,a.sessionId,null,r.FILE_PREVIEW_SESSION_ID_COOKIE_DOMAIN)},this.onPreviewCompleted=function(){i.Cookies.delete(r.FILE_PREVIEW_SESSION_ID_COOKIE)},this.previewEventEmitter=t,t.addListener(n.EventType.FilePreviewAttemptStarted,this.onPreviewAttempt);for(var s=0,l=o.FilePreviewSessionEndEvents;s<l.length;s++){var c=l[s];t.addListener(c,this.onPreviewCompleted)}}return e.prototype.teardown=function(){this.previewEventEmitter.removeListener(n.EventType.FilePreviewAttemptStarted,this.onPreviewAttempt);for(var e=0,t=o.FilePreviewSessionEndEvents;e<t.length;e++){var i=t[e];this.previewEventEmitter.removeListener(i,this.onPreviewCompleted)}this.onPreviewCompleted()},e})();t.CookiePreviewTracer=a}),define("modules/clean/previews/file_view_rams_common",["require","exports","modules/core/browser","modules/core/uri"],function(e,t,n,o){"use strict";function i(e){return e=e.toLowerCase(),s.indexOf(e)>-1||e.endsWith("dl.dropboxusercontent.com")||e.endsWith("previews.dropboxusercontent.com")}function r(){return n.chrome||n.safari||n.edge}function a(e,t){if(!r())return null;if(!i(t))return null;var n=e.clone();n.updateQuery({disable_range:"1",from_native_print:"1"});var a=o.URI.parse("https://"+t+"/nativeprint");return a.updateQuery({file:n.toString()}),a.toString()}Object.defineProperty(t,"__esModule",{value:!0});var s=["dl-web.dropbox.com","previews.dropbox.com","previews.dropboxusercontent.com","dl.dropboxusercontent.com"];t.getNativePrintUrl=a}),define("modules/clean/previews/pending_upload_watcher",["require","exports","modules/clean/ajax","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e,t,n){void 0===n&&(n=""),this.pollUrl=new r.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);if(t.hasOwnProperty("upload_status")&&"complete"===t.upload_status)return void o.pendingFileUploaded();setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():i.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=a}),define("modules/clean/previews/util",["require","exports","modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/previews/constants","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/constants/file_viewer","modules/core/uri"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";function d(){return".react-file-viewer__preview iframe"}function p(){return c.PASS_PLATFORM_INFO}function f(e){return["xls","csv","ods"].indexOf(e.substring(0,3))>-1}function h(e){var t=r.file_extension(e);return c.LOGGING_WHITELISTED_EXTS.includes("."+t)?t:c.LOGGING_EXT_PLACEHOLDER}function m(e){if("indd"===e)return e;var t=e.substring(0,3);switch(t){case"rtf":case"odt":case"wpd":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}}function v(e,t){var n,o=m(e),i=u.URI.parse(t);return"xls"===o&&(n="xls/preview",i.setPath(i.getPath().replace("/pri/get/","/get/")),i.setPath(i.getPath().replace("/get/","/"+n+"/"))),i}function g(e){if(e.ts)return i.getActingTime(1e3*e.ts)}function _(e){return e=e.updateQuery({annotation_highlight:"1"}),e=e.updateQuery({annotation_region:"1"})}function y(e,t){var n={};return n._subject_uid=String(t),e.updateQuery(n)}function b(e,t){return y(new u.URI({path:"/history"+e.fq_path}),t.id)}function w(e,t){o.UserActivityLogger.log("web","view_version_history");var i=b(e,t);n.redirect(i.toString())}function C(e){return c.PRESENTATION_EXTS.map(function(e){return e.slice(1)}).includes(e)}function S(e){return["doc","docm","docx"].includes(e)}function E(e){return["odp","odt","rtf","wpd"].includes(e)}function A(e){return t.VALID_PREVIEW_TYPES.indexOf(e.preview_type)>-1}function T(e){var t=s.getExtension(e),n=e.bytes;if(void 0===n)return!0;var o=Number.MAX_VALUE;return"pdf"===t?o=Number(524288e3):S(t)||E(t)?o=a.MAX_WORD_DOC_FILE_SIZE_B:C(t)?o=a.MAX_PPT_FILE_SIZE_B:e.preview_type===a.PreviewType.Archive?o=a.MAX_ARCHIVE_FILE_SIZE_B:e.preview_type===a.PreviewType.Text?o=Number(8388608):e.preview_type===a.PreviewType.Linkfile?o=Number(10240):n=0,n<=o}function P(e){return 0===e.bytes}function x(e){return A(e)&&T(e)}function k(e){var t=s.getExtension(e);return x(e)&&R(t)}function R(e){var t=m(e);return["doc","ppt","xls","key","eps","ai"].indexOf(t)>-1}function O(e,t){return[a.PreviewType.Doc,a.PreviewType.Excel,a.PreviewType.Text].indexOf(e)>-1&&"epub"!==t}function I(e){var t=l.ErrorType.LoadError;return e===l.RivieraConvertResponseType.TooBig?t=l.ErrorType.FileSizeError:e===l.RivieraConvertResponseType.PasswordProtected&&(t=l.ErrorType.PasswordProtectedError),t}function M(){return{overflow:"auto","-webkit-overflow-scrolling":"touch"}}function F(e,t){return e&&t?u.URI.parse(e).updateQuery({psid:t.id}).toString():e}function D(e){return a.IworkExtensions.includes(s.getExtension(e))&&!e.is_dir}function N(e){return a.IworkExtensions.includes(s.getExtension(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.getIframeQuery=d,t.shouldShowPlatformInfo=p,t.is_excel2_file=f,t.getWhitelistedExtension=h,t.normalize_extension=m,t.get_progressive_url=v,t.getModifierString=g,t.update_url_for_annotation=_,t.update_url_with_user_id=y,t.getVersionHistoryUrl=b,t.redirectToVersionHistory=w,t.VALID_PREVIEW_TYPES=[a.PreviewType.Archive,a.PreviewType.Audio,a.PreviewType.CloudDoc,a.PreviewType.Doc,a.PreviewType.Excel,a.PreviewType.HTML,a.PreviewType.Linkfile,a.PreviewType.Photo,a.PreviewType.Text,a.PreviewType.Video],t.isPptExtension=C,t.isWordDocExtension=S,t.isLibreOfficeExtension=E,t.extensionSupported=A,t.filesizeSupported=T,t.isEmptyFile=P,t.isPreviewable=x,t.canGeneratePreview=k,t.extCanGeneratePreview=R,t.usesFrameMessenger=O,t.mapRivieraStatusToErrorType=I,t.generateDucId=function(e){var t,n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{t=(crypto||window.msCrypto).getRandomValues(new Uint8Array(e))}catch(e){t=[]}null==t&&(t=[]);for(var o="",i=0;i<e;++i){var r=void 0;r=e===t.length?t[i]%n.length:Math.floor(Math.random()*n.length),o+=n[r]}return o},t.iOSIframeScrollStyles=M,t.tagCriticalPathContentRequest=F,t.isLimitedPreview=D,t.isSupportedBundleFile=N}),define("modules/clean/react/comments2/components/mobile_web_comments",["require","exports","tslib","external/react","modules/clean/web_timing_logger","modules/clean/react/async/loadable","modules/clean/react/file_sidebar/base_comments_tab","modules/clean/react/comments2/util"],function(e,t,n,o,i,r,a,s){"use strict";function l(e){var i=e.currentFile,r=e.sharedLinkInfo,l=e.user;if(s.shouldUseComments2MobileWeb({previewType:i.preview_type||void 0,viewer:l})&&null!=i.ns_id){var c={currentFile:i,sharedLinkInfo:r,user:l,isMobile:!0};return o.createElement(a.BaseCommentsTab,n.__assign({},c,{commentsDisabledOnFile:!1,shouldInitiallyFocusInput:!0,content:function(){return o.createElement(t.AsyncMobileWebComments,n.__assign({},c))}}))}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncMobileWebComments=r.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/comments2/components/comments_pane"],t,n)}).then(function(e){return e.CommentsPane})})}}),t.MobileWebComments=l}),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib"],function(e,t,n){"use strict";function o(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}}function i(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}}function r(e,t,n){return{type:e.actionTypes.success,payload:n,meta:{args:t}}}function a(e,t,n){return{type:e.actionTypes.success,error:n,meta:{args:t}}}function s(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function l(e){return{actionTypes:s(e),name:e,type:"async"}}function c(e){return{actionType:e,name:e,type:"sync",zero:!1}}function u(e){return{actionType:e,name:e,type:"sync",zero:!0}}function d(e){return{asyncAction:function(t){return l(e+"/"+t)},syncAction:function(t){return c(e+"/"+t)},syncAction0:function(t){return u(e+"/"+t)}}}function p(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}}function f(){var e=this;return function(t,o){return n.__awaiter(e,void 0,void 0,function(){var e,i,r,a,s;return n.__generator(this,function(n){switch(n.label){case 0:e=o.action,i=o.args,r=o.dispatch,r({type:e.actionTypes.request,payload:i,meta:{args:i}}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t(o)];case 2:return a=n.sent(),r({type:e.actionTypes.success,payload:a,meta:{args:i}}),[2,a];case 3:throw s=n.sent(),r({type:e.actionTypes.error,error:s,meta:{args:i}}),s;case 4:return[2]}})})}}var h=this;Object.defineProperty(t,"__esModule",{value:!0}),t.syncReduxAction=o,t.requestReduxAction=i,t.successReduxAction=r,t.errorReduxAction=a,t.asyncActionConstants=s,t.asyncAction=l,t.syncAction=c,t.syncAction0=u,t.namespacedActions=d,t.syncHandler=p,t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,o){return function(i){return function(r,a){return n.__awaiter(h,void 0,void 0,function(){var s,l,c;return n.__generator(this,function(n){switch(n.label){case 0:s=0,l=function(t){var n=e[s++];return n?n(l,t):o(i,t)},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,l({action:t,args:i,dispatch:r,state:a()})];case 2:return[2,n.sent()];case 3:return c=n.sent(),[3,4];case 4:return[2]}})})}}}},t.dispatchMiddleware=f,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(f())}),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","external/lodash","modules/core/browser","modules/clean/redux/types","modules/clean/react/comments2/data/api","modules/clean/react/file_sidebar/store/instance","modules/clean/react/comments2/transforms","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/comments2/data/types","modules/clean/react/comments2/util","modules/clean/react/comments2/data/selectors","modules/clean/bolt","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_sidebar/store/sidebar/types"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v){"use strict";function g(e){var t=this,o=e.startAction,r=e.successAction,s=e.clientFn,l=e.errorAction,c=e.loggingFn,u=e.loggingData;return function(e,d){return n.__awaiter(t,void 0,void 0,function(){var t,f,h,m,v,g,_,y,b;return n.__generator(this,function(w){switch(w.label){case 0:if(t=p.getContext(d()),!t||!t.viewer)throw new Error;e(o()),f=new a.Comments2Api(t.viewer.id,t.stream),h=i.get_uri().getQuery().oref,w.label=1;case 1:return w.trys.push([1,3,,4]),[4,s(f,t)];case 2:return m=w.sent(),e(r(m)),c&&u&&(v=n.__assign({},c(t.viewer.id,u,m),{oref:h}),f.logEvent(u.event,v)),[3,4];case 3:return g=w.sent(),e(l(g)),u&&(_=u.event,y=u.threadId,b=u.commentId,f.logErrorEvent("error trying to execute client event "+_,{commentId:b,threadId:y,oref:h})),[3,4];case 4:return[2]}})})}}function _(e,t,n){return{commentId:n.id,threadId:t.threadId}}function y(e,t,n){return{threadId:n.id}}function b(){return{type:u.ActionType.ListCommentsRequest,payload:{}}}function w(){return{type:u.ActionType.ListCommentsError,payload:{}}}function C(e,t,n){return{type:u.ActionType.ListCommentsSuccess,payload:{threads:e,authors:t,activeCommentId:n}}}function S(e,t,n,o,i){return{type:u.ActionType.AddCommentRequest,payload:{author:e,content:t,annotation:o,threadId:i,guid:n}}}function E(e,t){return{type:u.ActionType.AddCommentError,payload:{guid:e,threadId:t}}}function A(e,t,n){return{type:u.ActionType.AddCommentSuccess,payload:{guid:e,id:t,threadId:n}}}function T(e,t,n){return{type:u.ActionType.EditCommentRequest,payload:{commentId:e,content:t,threadId:n}}}function P(e,t,n){return{type:u.ActionType.EditCommentError,payload:{commentId:e,error:t,threadId:n}}}function x(e,t){return{type:u.ActionType.EditCommentSuccess,payload:{commentId:e,threadId:t}}}function k(e){return{type:u.ActionType.ActivateThread,payload:{thread:e}}}function R(){return{type:u.ActionType.DeactivateAllThreads,payload:{}}}function O(e){return{type:u.ActionType.MarkThreadResolvedRequest,payload:{threadId:e}}}function I(e,t){return{type:u.ActionType.MarkThreadResolvedError,payload:{threadId:e,error:t}}}function M(e){return{type:u.ActionType.MarkThreadResolvedSuccess,payload:{threadId:e}}}function F(){return{type:u.ActionType.MarkThreadUnresolvedRequest,payload:{}}}function D(){return{type:u.ActionType.MarkThreadUnresolvedError,payload:{}}}function N(e){return{type:u.ActionType.MarkThreadUnresolvedSuccess,payload:{threadId:e}}}function L(e,t){return{type:u.ActionType.DeleteCommentRequest,payload:{commentId:e,threadId:t}}}function U(e,t,n){return{type:u.ActionType.DeleteCommentError,payload:{commentId:e,error:t,threadId:n}}}function z(e,t){return{type:u.ActionType.DeleteCommentSuccess,payload:{commentId:e,threadId:t}}}function H(e){var t=e.author,n=e.comment,o=e.content,i=e.annotation,r=e.threadId,a=e.guid;return g({startAction:function(){return S(t,o,a,i,r)},clientFn:function(e){return r?e.replyToThread(n,r):e.addComment(n)},successAction:function(e){return A(a,e.id,r)},errorAction:function(e){return E(a,r)},loggingFn:_,loggingData:{event:r?"reply_to_comment":"new_comment",threadId:r}})}function B(e,t){return g({startAction:function(){return L(e,t)},clientFn:function(t){return t.deleteComment(e)},successAction:function(n){return z(e,t)},errorAction:function(n){return U(e,n,t)},loggingFn:_,loggingData:{event:"delete_comment",commentId:e}})}function V(e,t,n){return g({startAction:function(){return T(e,n,t)},clientFn:function(t,o){var i=o.stream,r=l.iCommentContentToUserSubmittedComment({content:n,stream:i});return t.editComment(e,r)},successAction:function(n){return x(e,t)},errorAction:function(n){return P(e,n,t)},loggingFn:_,loggingData:{event:"edit_comment",commentId:e}})}function q(e){return g({startAction:function(){return O(e)},clientFn:function(t){return t.markThreadResolved(e)},successAction:function(e){return M(e.id)},errorAction:function(t){return I(e,t)},loggingFn:y,loggingData:{event:"resolve_thread",threadId:e}})}function j(e){return g({startAction:F,clientFn:function(t){return t.markThreadUnresolved(e)},successAction:function(e){return N(e.id)},errorAction:function(e){return D()},loggingFn:y,loggingData:{event:"unresolve_thread",threadId:e}})}function W(){var e=/comment_id=(.*)/.exec(i.get_uri().getFragment());return e?e[1]:void 0}function K(e){var t=this;return void 0===e&&(e=!0),function(o,i){return n.__awaiter(t,void 0,void 0,function(){var t,r,l,d,f,h,g,_,y,S,E,A;return n.__generator(this,function(n){switch(n.label){case 0:if(t=i(),r=p.getContext(t),!r)return[2];o(b()),l=r.stream,d=r.viewer,f=d?new a.Comments2Api(d.id,l):new a.Comments2LoggedOutApi(l),n.label=1;case 1:return n.trys.push([1,6,,7]),[4,f.listComments()];case 2:if(h=n.sent(),g=h.bolt_info,_=h.status,y=h.threads,S=h.users,E=p.getContextStatus(t),E===u.Comments2ContextStatus.Pending)switch(_[".tag"]){case"disabled":o(re(u.Comments2ContextStatus.Disabled)),s.store.dispatch(m.setComments2FetchStatus({status:v.PermissionStatus.DISABLED}));break;case"enabled":case"readonly":o(re(u.Comments2ContextStatus.Comments2)),s.store.dispatch(m.setComments2FetchStatus({status:v.PermissionStatus.RECEIVED})),y.filter(function(e){return!e.resolved}).length>0&&s.store.dispatch(c.open("comments2_unresolved_threads"));break;case"comments1":o(re(u.Comments2ContextStatus.Comments1)),s.store.dispatch(m.setComments2FetchStatus({status:v.PermissionStatus.DISABLED}))}return E!==u.Comments2ContextStatus.Comments2&&(E!==u.Comments2ContextStatus.Pending||"enabled"!==_[".tag"]&&"readonly"!==_[".tag"])?[3,5]:[4,o(G(g))];case 3:return n.sent(),[4,o(C(y,S,e?W():void 0))];case 4:n.sent(),n.label=5;case 5:return[3,7];case 6:return A=n.sent(),A instanceof a.Comments2Error&&("file_not_found"===A.code?o(re(u.Comments2ContextStatus.Disabled)):d&&f instanceof a.Comments2Api&&f.logErrorEvent((A.message,": "+A.message))),o(w()),[3,7];case 7:return[2]}})})}}function G(e){var n=e.revision,o=e.token;return function(e,i){var r=p.getContext(i());d.useBolt()&&r&&t.bolt.subscribe({id:r.stream.id,revision:n,token:o},function(){return e(K(!1))})}}function Y(e){var o=this;return function(i,r){return n.__awaiter(o,void 0,void 0,function(){var o,a;return n.__generator(this,function(n){switch(n.label){case 0:return o=r(),a=p.getContext(o),d.isContextSame(a,e)?[3,3]:(t.bolt.unsubscribe(),i(oe(e)),e?d.shouldUseComments2({previewType:e.stream.previewType,viewer:e.viewer})?(d.isUserSame(a&&a.viewer,e.viewer)||i(se(void 0)),[4,i(K())]):[3,2]:[3,3]);case 1:return n.sent(),[3,3];case 2:i(re(u.Comments2ContextStatus.Comments1)),n.label=3;case 3:return[2]}})})}}function Z(){return function(e,t){var n=p.getContext(t.state);if(!n||!n.viewer)throw new Error("Bad state");var i=new a.Comments2Api(n.viewer.id,n.stream);return e(o.merge({},t,{api:i,context:n}))}}function Q(e){var t=this;return function(i,a){return n.__awaiter(t,void 0,void 0,function(){var t,s;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,i(a)];case 1:return t=n.sent(),e(o.merge({},a,{payload:t,status:r.ApiClientStatus.Success})),[2,t];case 2:throw s=n.sent(),e(o.merge({},a,{error:s,status:r.ApiClientStatus.Error})),s;case 3:return[2]}})})}}function X(e,t){var o=this;return void 0===t&&(t={}),function(i,r){return n.__awaiter(o,void 0,void 0,function(){var o,i,s;return n.__generator(this,function(n){return o=r(),i=p.getContext(o),i&&i.viewer&&(s=new a.Comments2Api(i.viewer.id,i.stream),s.logEvent(e,t)),[2]})})}}Object.defineProperty(t,"__esModule",{value:!0});t.listCommentsRequest=b,t.listCommentsError=w,t.listCommentsSuccess=C,t.addCommentRequest=S,t.addCommentError=E,t.addCommentSuccess=A,t.editCommentRequest=T,t.editCommentError=P,t.editCommentSuccess=x,t.activateThread=k,t.deactivateAllThreads=R,t.markThreadResolvedRequest=O,
t.markThreadResolvedError=I,t.markThreadResolvedSuccess=M,t.markThreadUnresolvedRequest=F,t.markThreadUnresolvedError=D,t.markThreadUnresolvedSuccess=N,t.deleteCommentRequest=L,t.deleteCommentError=U,t.deleteCommentSuccess=z,t.addComment=H,t.deleteComment=B,t.editComment=V,t.markThreadResolved=q,t.markThreadUnresolved=j,t.listComments=K,t.bolt={client:null,subscribe:function(e,n){var o=e.id,i=e.revision,r=e.token;if(null===t.bolt.client){var a=new f.SignedChannelState("comments2",o,i,r),s=function(){t.bolt.client=new f.BoltClient([a],n,l),t.bolt.client.start()},l=function(e){t.bolt.unsubscribe(),s()};s()}},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}},t.setFileContext=Y;var J=h.namespacedActions("Comments2"),$=J.asyncAction,ee=J.syncAction,te=h.createAsyncHandler(h.dispatchMiddleware(),Z(),Q(function(e){var t=i.get_uri().getQuery().oref;if(e.status===r.ApiClientStatus.Error)e.api.logErrorEvent("encountered an error with async api call "+e.action.name,{oref:t});else if(e.status===r.ApiClientStatus.Success)switch(e.action.name){case ue.name:var n=e.args.origin===u.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";e.api.logEvent(n,{threadId:e.payload.id,oref:t});break;case pe.name:e.api.logEvent("mark_thread_as_unread",{threadId:e.payload.id,oref:t})}})),ne=ee("SetContext"),oe=h.syncHandler(ne),ie=ee("SetContextStatus"),re=h.syncHandler(ie),ae=$("CheckOnboardingStatus"),se=te(ae,function(e,t){return t.api.checkOnboardingStatus()}),le=$("MarkOnboarded"),ce=te(le,function(e,t){return t.api.markHasOnboarded(e)}),ue=$("MarkThreadRead"),de=te(ue,function(e,t){var n=(e.origin,e.threadId);return t.api.markThreadRead(n)}),pe=$("MarkThreadUnread"),fe=te(pe,function(e,t){return t.api.markThreadUnread(e)}),he=ee("SetSoftHideCommentsPaneOnboarding"),me=h.syncHandler(he),ve=ee("SuppressOnboardingForSession"),ge=h.syncHandler(ve),_e=function(){return ge("video_first_paused")},ye=h.syncAction0("ToggleShowResolved"),be=h.syncHandler(ye),we=ee("UpdatePlayerCurrentTime"),Ce=h.syncHandler(we),Se=ee("VideoPlayerStateChanged"),Ee=h.syncHandler(Se),Ae=ee("ResetStore"),Te=h.syncHandler(Ae);t.ActionTypes={SetContext:ne,SetContextStatus:ie,CheckOnboardingStatus:ae,MarkOnboarded:le,MarkThreadRead:ue,MarkThreadUnread:pe,SetSoftHideCommentsPaneOnboarding:he,SuppressOnboardingForSession:ve,ToggleShowResolved:ye,UpdatePlayerCurrentTime:we,VideoPlayerStateChanged:Se,ResetStore:Ae},t.Actions={setFileContext:Y,checkOnboardingStatus:se,markOnboarded:ce,markThreadRead:de,markThreadUnread:fe,setSoftHideCommentsPaneOnboarding:me,suppressOnboardingForSession:ge,suppressVideoOnboardingForSession:_e,toggleShowResolved:be,updatePlayerCurrentTime:Ce,videoPlayerStateChanged:Ee,logEvent:X,resetStore:Te}}),define("modules/clean/react/comments2/data/api",["require","exports","tslib","modules/clean/api_v2/error","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/core/exception"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){if(e instanceof o.ApiError){var n=t;return e.message&&(n+=". Detailed message: "+e.message.toString()),new c(e.error[".tag"],n,e)}return e}function l(e){var t={".tag":e.type};return e.linkUrl?{type:t,identifier:{".tag":"shared_link_details",url:e.linkUrl}}:{type:t,identifier:{".tag":"file_path_or_id",file_path_or_id:e.id}}}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e,t,n){this.code=e,this.message=t,this.apiError=n}return e})();t.Comments2Error=c;var u=(function(){function e(e){this.routes=(new i.ApiV2Client).ns("comments2"),this.params={subjectUserId:null},this.stream=l(e)}return e.prototype.listComments=function(){return this.routes.rpc("logged_out/list_comments",{stream:this.stream},this.params).catch(function(e){throw s(e,"/logged_out/list_comments did not complete successfully")})},e})();t.Comments2LoggedOutApi=u;var d=(function(){function e(e){this.routes=(new r.ApiV2RootAwareClient).ns("comments2"),this.params={subjectUserId:e}}return e.prototype.enrollInBeta=function(){return this.routes.rpc("enroll_in_beta",void 0,this.params).catch(function(e){throw s(e,"/enroll_in_beta did not complete successfully")})},e})();t.Comments2NonStreamApi=d;var p=(function(){function e(e,t){this.routes=(new r.ApiV2RootAwareClient).ns("comments2"),this.params={subjectUserId:e},this.stream=l(t)}return e.prototype.addComment=function(e){return this.routes.rpc("add_comment",{stream:this.stream,comment:e},this.params).catch(function(e){throw s(e,"/add_comment (new comment) did not complete successfully")})},e.prototype.checkOnboardingStatus=function(){return this.routes.rpc("check_onboarding_status",void 0,this.params).catch(function(e){throw s(e,"/check_onboarding_status did not complete successfully")})},e.prototype.deleteComment=function(e){return this.routes.rpc("delete_comment",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/delete_comment did not complete successfully")})},e.prototype.editComment=function(e,t){return this.routes.rpc("edit_comment",{stream:this.stream,id:e,comment:t},this.params).catch(function(e){throw s(e,"/edit_comment did not complete successfully")})},e.prototype.listComments=function(){return this.routes.rpc("list_comments",{stream:this.stream},this.params).catch(function(e){throw s(e,"/list_comments did not complete successfully")})},e.prototype.logEvent=function(e,t){return void 0===t&&(t={}),this.logEventImpl(e,t)},e.prototype.logErrorEvent=function(e,t){return void 0===t&&(t={}),this.logEventImpl("comment_error",n.__assign({},t,{errorMessage:e}))},e.prototype.logEventImpl=function(e,t){var n=t.threadId,o=t.commentId,i=t.oref,r=t.errorMessage,l={event:{".tag":e},stream:this.stream,thread_id:n,comment_id:o,error_message:r,oref:i};return this.routes.rpc("log_event",l,this.params).catch(function(e){throw a.reportStack("comments2 logging failed",{severity:a.SEVERITY.NONCRITICAL,tags:["comments2_logging"],exc_extra:l}),s(e,"/log_event did not complete successfully")})},e.prototype.markHasOnboarded=function(e){var t={".tag":e};return this.routes.rpc("mark_has_onboarded",{type:t},this.params).catch(function(e){throw s(e,"/mark_has_onboarded did not complete successfully")})},e.prototype.markThreadRead=function(e){return this.routes.rpc("mark_thread_read",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/mark_thread_read did not complete successfully")})},e.prototype.markThreadUnread=function(e){return this.routes.rpc("mark_thread_unread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/mark_thread_unread did not complete successfully")})},e.prototype.markThreadResolved=function(e){return this.routes.rpc("resolve_thread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/resolve_thread did not complete successfully")})},e.prototype.markThreadUnresolved=function(e){return this.routes.rpc("unresolve_thread",{stream:this.stream,id:e},this.params).catch(function(e){throw s(e,"/unresolve_thread did not complete successfully")})},e.prototype.replyToThread=function(e,t){return this.routes.rpc("add_comment",{stream:this.stream,comment:e,thread_id:t},this.params).catch(function(e){throw s(e,"/add_comment (reply comment) did not complete successfully")})},e})();t.Comments2Api=p}),define("modules/clean/react/comments2/data/initial_state",["require","exports","modules/clean/react/comments2/data/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={context:void 0,data:{threads:{},authors:{},activatedThreadId:void 0,onboardingInfo:{initial_video_land:n.OnboardingStatus.Unknown,video_first_paused:n.OnboardingStatus.Unknown},softHideCommentsPaneOnboarding:!1,playerCurrentTime:0,showResolved:!1,sort:n.SortType.VideoTimeCode,lastRequestStatuses:{},pauseCount:0},statuses:{}}}),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","external/lodash","modules/clean/redux/types","modules/clean/react/comments2/data/types","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/initial_state","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/reducer_helper"],function(e,t,n,o,i,r,a,s,l,c){"use strict";function u(e,t){var o,a=new Date,s=e.threadId&&t.threads[e.threadId],l={id:e.guid,threadId:s?s.id:e.guid,timestamp:a,author:e.author,content:e.content,userPermissions:{canDelete:!1,canEdit:!1}};o=s?n.__assign({},s,{comments:s.comments.concat([l])}):{id:e.guid,timestamp:a,read:!0,resolved:!1,comments:[l],annotation:e.annotation};var c=n.__assign({},o,{pending:{action:r.ActionType.AddCommentRequest,originalValue:s,pendingValue:o}});return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(u={},u[r.RequestType.AddComment]=i.ApiClientStatus.Fetch,u)),activatedThreadId:c.id,threads:n.__assign({},t.threads,(d={},d[c.id]=c,d))});var u,d}function d(e,t){var o=e.threadId||e.guid,a=t.threads,s=o,l=a[s],c=n.__rest(a,["symbol"==typeof s?s:s+""]),u=l.comments.map(function(t){return t.id===e.guid?n.__assign({},t,{id:e.id,userPermissions:{canDelete:!0,canEdit:!0}}):t}),d=n.__assign({},l,{pending:void 0,comments:u,id:e.threadId||e.id});return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(p={},p[r.RequestType.AddComment]=i.ApiClientStatus.Success,p)),activatedThreadId:d.id,threads:n.__assign({},c,(f={},f[d.id]=d,f))});var p,f}function p(e,t){var o,a=e.threadId||e.guid,s=t.threads,l=a,c=s[l],u=n.__rest(s,["symbol"==typeof l?l:l+""]);if(e.threadId){var d=c.comments.filter(function(t){return t.id!==e.guid});o=n.__assign({},u,(p={},p[e.threadId]=n.__assign({},c,{pending:void 0,comments:d}),p))}else o=u;return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(f={},f[r.RequestType.AddComment]=i.ApiClientStatus.Error,f)),threads:o});var p,f}function f(e){function t(e){return e?r.OnboardingStatus.HasCompletedOnboarding:r.OnboardingStatus.NotOnboarded}return{initial_video_land:t(e.initial_video_land),video_first_paused:t(e.video_first_paused)}}function h(e,t,n){return e.map(function(e){return e.id===t?n(e):e})}function m(e,t){switch(t.type){case r.ActionType.ActivateThread:return n.__assign({},e,{activatedThreadId:t.payload.thread.id});case r.ActionType.DeactivateAllThreads:return n.__assign({},e,{activatedThreadId:void 0});case r.ActionType.ListCommentsRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(O={},O[r.RequestType.ListComments]=i.ApiClientStatus.Fetch,O))});case r.ActionType.ListCommentsSuccess:var o=a.usersToIUserMap(t.payload.authors),s=a.threadsToIThreadMap(t.payload.threads,o),l=Object.keys(s).find(function(e){return s[e].comments.some(function(e){return e.id===t.payload.activeCommentId})}),c=e.playerCurrentTime;if(l)if(s[l]){var f=s[l].annotation;f&&(c=f.time)}else l=void 0;return n.__assign({},e,{threads:s,authors:o,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(I={},I[r.RequestType.ListComments]=i.ApiClientStatus.Success,I)),activatedThreadId:l||e.activatedThreadId,playerCurrentTime:c});case r.ActionType.ListCommentsError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(M={},M[r.RequestType.ListComments]=i.ApiClientStatus.Error,M))});case r.ActionType.AddCommentRequest:return u(t.payload,e);case r.ActionType.AddCommentSuccess:return d(t.payload,e);case r.ActionType.AddCommentError:return p(t.payload,e);case r.ActionType.EditCommentRequest:var m=t.payload,v=m.commentId,g=m.content,_=m.threadId,y=e.threads[_],b=h(y.comments,v,function(e){return n.__assign({},e,{content:g,pending:{action:r.ActionType.EditCommentRequest,originalValue:e.content,pendingValue:g}})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(F={},F[r.RequestType.EditComment]=i.ApiClientStatus.Fetch,F)),threads:n.__assign({},e.threads,(D={},D[y.id]=n.__assign({},y,{comments:b}),D))});case r.ActionType.EditCommentSuccess:var w=t.payload,v=w.commentId,_=w.threadId,y=e.threads[_],b=h(y.comments,v,function(e){return n.__assign({},e,{pending:void 0})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(N={},N[r.RequestType.EditComment]=i.ApiClientStatus.Success,N)),threads:n.__assign({},e.threads,(L={},L[y.id]=n.__assign({},y,{comments:b}),L))});case r.ActionType.EditCommentError:var C=t.payload,v=C.commentId,S=C.error,_=C.threadId,y=e.threads[_],b=h(y.comments,v,function(e){return n.__assign({},e,{content:e.pending.originalValue,pending:n.__assign({},e.pending,{error:S})})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(U={},U[r.RequestType.EditComment]=i.ApiClientStatus.Error,U)),threads:n.__assign({},e.threads,(z={},z[y.id]=n.__assign({},y,{comments:b}),z))});case r.ActionType.MarkThreadResolvedRequest:var _=t.payload.threadId,y=e.threads[_],E=n.__assign({},y,{resolved:!0,pending:{action:r.ActionType.MarkThreadResolvedRequest,originalValue:y.resolved,pendingValue:!0}});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(H={},H[r.RequestType.MarkThreadResolved]=i.ApiClientStatus.Fetch,H)),threads:n.__assign({},e.threads,(B={},B[y.id]=E,B))});case r.ActionType.MarkThreadResolvedSuccess:var _=t.payload.threadId,y=e.threads[_],E=n.__assign({},y,{pending:void 0});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(V={},V[r.RequestType.MarkThreadResolved]=i.ApiClientStatus.Success,V)),threads:n.__assign({},e.threads,(q={},q[y.id]=E,q))});case r.ActionType.MarkThreadResolvedError:var A=t.payload,T=A.error,_=A.threadId,y=e.threads[_],E=n.__assign({},y,{resolved:y.pending.originalValue,pending:n.__assign({},y.pending,{error:T})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(j={},j[r.RequestType.MarkThreadRead]=i.ApiClientStatus.Error,j)),threads:n.__assign({},e.threads,(W={},W[y.id]=E,W))});case r.ActionType.MarkThreadUnresolvedRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(K={},K[r.RequestType.MarkThreadUnresolved]=i.ApiClientStatus.Fetch,K))});case r.ActionType.MarkThreadUnresolvedSuccess:var _=t.payload.threadId,y=e.threads[_];return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(G={},G[r.RequestType.MarkThreadUnresolved]=i.ApiClientStatus.Success,G)),threads:n.__assign({},e.threads,(Y={},Y[y.id]=n.__assign({},y,{resolved:!1}),Y))});case r.ActionType.MarkThreadUnresolvedError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(Z={},Z[r.RequestType.MarkThreadUnresolved]=i.ApiClientStatus.Error,Z))});case r.ActionType.DeleteCommentRequest:var P=t.payload,v=P.commentId,_=P.threadId,y=e.threads[_],b=h(y.comments,v,function(e){return n.__assign({},e,{deleted:!0,pending:{action:r.ActionType.DeleteCommentRequest,originalValue:e.deleted,pendingValue:!0}})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(Q={},Q[r.RequestType.DeleteComment]=i.ApiClientStatus.Fetch,Q)),threads:n.__assign({},e.threads,(X={},X[y.id]=n.__assign({},y,{comments:b}),X))});case r.ActionType.DeleteCommentSuccess:var x=t.payload,v=x.commentId,_=x.threadId,y=e.threads[_],b=h(y.comments,v,function(e){return n.__assign({},e,{pending:void 0})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(J={},J[r.RequestType.DeleteComment]=i.ApiClientStatus.Success,J)),threads:n.__assign({},e.threads,($={},$[y.id]=n.__assign({},y,{comments:b}),$))});case r.ActionType.DeleteCommentError:var k=t.payload,v=k.commentId,R=k.error,_=k.threadId,y=e.threads[_],b=h(y.comments,v,function(e){return n.__assign({},e,{deleted:e.pending.originalValue,pending:n.__assign({},e.pending,{error:R})})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(ee={},ee[r.RequestType.MarkThreadUnread]=i.ApiClientStatus.Error,ee)),threads:n.__assign({},e.threads,(te={},te[y.id]=n.__assign({},y,{comments:b}),te))})}return e;var O,I,M,F,D,N,L,U,z,H,B,V,q,j,W,K,G,Y,Z,Q,X,J,$,ee,te}function v(e,t){return n.__assign({},e,{threads:n.__assign({},e.threads,(o={},o[t.id]=t,o))});var o}function g(e,t,n){var i=e.threads[t];return v(e,o.merge({},i,n))}function _(e,t){void 0===e&&(e=s.INITIAL_STATE);var n=w(e.context,t),o=S(m(e.data,t),t),i=y(e.statuses,t);return n!==e.context||o!==e.data||i!==e.statuses?{context:n,data:o,statuses:i}:e}Object.defineProperty(t,"__esModule",{value:!0});var y=c.createStatusReducer(l.ActionTypes),b=c.createActionReducer(),w=c.createReducerFrom(b(l.ActionTypes.SetContext,function(e,t){return t?n.__assign({},t,{status:r.Comments2ContextStatus.Pending}):void 0}),b(l.ActionTypes.SetContextStatus,function(e,t){return n.__assign({},e,{status:t})})),C=c.createActionReducer(),S=c.createReducerFrom(C(l.ActionTypes.CheckOnboardingStatus,function(e,t){return n.__assign({},e,{onboardingInfo:f(t)})}),C(l.ActionTypes.MarkOnboarded,function(e,t,o){return n.__assign({},e,{onboardingInfo:n.__assign({},e.onboardingInfo,(i={},i[o]=r.OnboardingStatus.HasCompletedOnboarding,i))});var i}),C(l.ActionTypes.MarkThreadRead,function(e,t,n){return g(e,t.id,{read:!0})}),C(l.ActionTypes.MarkThreadUnread,function(e,t,n){return g(e,t.id,{read:!1})}),C(l.ActionTypes.SetSoftHideCommentsPaneOnboarding,function(e,t){return n.__assign({},e,{softHideCommentsPaneOnboarding:t})}),C(l.ActionTypes.SuppressOnboardingForSession,function(e,t){return n.__assign({},e,{onboardingInfo:n.__assign({},e.onboardingInfo,(o={},o[t]=r.OnboardingStatus.SuppressOnboardingForSession,o))});var o}),C(l.ActionTypes.ToggleShowResolved,function(e){return n.__assign({},e,{showResolved:!e.showResolved})}),C(l.ActionTypes.UpdatePlayerCurrentTime,function(e,t){return n.__assign({},e,{playerCurrentTime:t})}),C(l.ActionTypes.VideoPlayerStateChanged,function(e,t){return n.__assign({},e,{isPaused:t.paused,pauseCount:e.pauseCount+(t.paused?1:0)})}),C(l.ActionTypes.ResetStore,function(e,t){return n.__assign({},s.INITIAL_STATE.data)}));t.reducer=_}),define("modules/clean/react/comments2/data/reducer_helper",["require","exports","tslib","modules/clean/redux/types"],function(e,t,n,o){"use strict";function i(e){for(var t={},i=0,r=Object.keys(e).map(function(t){return e[t]});i<r.length;i++){var a=r[i];"async"===a.type&&(t[a.actionTypes.request]={name:a.name,status:o.ApiClientStatus.Request},t[a.actionTypes.error]={name:a.name,status:o.ApiClientStatus.Error})}return function(e,o){var i=t[o.type];return i&&(e=n.__assign({},e,(r={},r[i.name]=i.status,r))),e;var r}}function r(){function e(e,t){switch(e.type){case"async":return"function"==typeof t?[[e.actionTypes.success,t]]:[t.Error&&[e.actionTypes.error,t.Error],t.Request&&[e.actionTypes.request,t.Request],t.Success&&[e.actionTypes.success,t.Success]].filter(function(e){return e});case"sync":if("function"==typeof t)return[[e.actionType,t]]}throw new Error}return e}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n={},o=0,i=e;o<i.length;o++)for(var r=i[o],a=0,s=r;a<s.length;a++){var l=s[a],c=l[0],u=l[1];n[c]||(n[c]=[]),n[c].push(u)}return function(e,t){for(var o=n[t.type],i=0,r=o||[];i<r.length;i++){e=(0,r[i])(e,t.payload,t.meta&&t.meta.args)}return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createStatusReducer=i,t.createActionReducer=r,t.createReducerFrom=a}),define("modules/clean/react/comments2/data/selectors",["require","exports","external/lodash","modules/clean/redux/selectors","modules/clean/redux/types","modules/constants/comments2","modules/clean/react/comments2/data/types","modules/clean/react/comments2/util"],function(e,t,n,o,i,r,a,s){"use strict";function l(){throw new Error("Missing an onboarding key from switch statement")}function c(e){for(var n=[],o=t.getData(e).onboardingInfo,i=0,r=Object.keys(o);i<r.length;i++){var s=r[i],c=o[s];switch(s){case"initial_video_land":case"video_first_paused":c!==a.OnboardingStatus.NotOnboarded&&c!==a.OnboardingStatus.SuppressOnboardingForSession||n.push(s);break;default:return l()}}return n}function u(e){var n=t.getData(e),o=n.isPaused,i=n.pauseCount,l=n.onboardingInfo;return!s.isComments2Mobile()&&!!o&&!d(e)&&l.video_first_paused===a.OnboardingStatus.NotOnboarded&&i%r.COMMENTS2_VIDEO_ONBOARDING_FREQUENCY===1&&i<r.COMMENTS2_VIDEO_ONBOARDING_FREQUENCY*r.COMMENTS2_VIDEO_ONBOARDING_COUNT}function d(e){var n=t.getData(e),o=n.onboardingInfo,i=n.softHideCommentsPaneOnboarding;return!s.isComments2Mobile()&&o.initial_video_land===a.OnboardingStatus.NotOnboarded&&!i}function p(e){return t.getData(e).activatedThreadId}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=function(e){return o.getStateAtNamespace(e,i.COMMENTS2_NAMESPACE_KEY)};var f=n.memoize(function(e,t){switch(t){case a.SortType.Chronological:return n.sortBy(e,[function(e){return e.timestamp.getTime()}]);case a.SortType.VideoTimeCode:var o=n.groupBy(e,function(e){return e.annotation?"video":"global"}),i=o.video,r=o.global;return n.sortBy(i,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]).concat(n.sortBy(r,[function(e){return e.timestamp.getTime()}]))}});t.getContext=function(e){var n=t.getState(e).context;return n?{stream:n.stream,viewer:n.viewer}:void 0},t.getContextStatus=function(e){var n=t.getState(e).context;return n?n.status:void 0},t.getData=function(e){return t.getState(e).data},t.getSort=function(e){return t.getData(e).sort},t.getThreads=function(e){return f(n.values(t.getData(e).threads)||[],t.getSort(e))},t.getOnboardingKeysNotYetMarked=c,t.getShowOnboardingOnVideo=u,t.getShowOnboardingOnCommentsPane=d,t.getActivatedThreadId=p,t.getShowResolved=function(e){return t.getData(e).showResolved},t.getPlayerCurrentTime=function(e){return t.getData(e).playerCurrentTime},t.getStatuses=function(e){return t.getState(e).statuses}}),define("modules/clean/react/comments2/data/store",["require","exports","external/lodash","modules/clean/redux/types","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForComments2=n.once(function(){return r.getStoreAndRegisterReducers((e={},e[o.COMMENTS2_NAMESPACE_KEY]=i.reducer,e));var e})}),define("modules/clean/react/comments2/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Disabled=0]="Disabled",e[e.Pending=1]="Pending",e[e.Comments1=2]="Comments1",e[e.Comments2=3]="Comments2"})(t.Comments2ContextStatus||(t.Comments2ContextStatus={}));(function(e){e.ListCommentsRequest="COMMENTS2__LIST_COMMENTS_REQUEST",e.ListCommentsSuccess="COMMENTS2__LIST_COMMENTS_RECEIVED",e.ListCommentsError="COMMENTS2__LIST_COMMENTS_ERROR",e.AddCommentRequest="COMMENTS2__ADD_COMMENT_REQUEST",e.AddCommentSuccess="COMMENTS2__ADD_COMMENT_SUCCESS",e.AddCommentError="COMMENTS2__ADD_COMMENT_ERROR",e.EditCommentRequest="COMMENTS2__EDIT_COMMENT_REQUEST",e.EditCommentSuccess="COMMENTS2__EDIT_COMMENT_SUCCESS",e.EditCommentError="COMMENTS2__EDIT_COMMENT_ERROR",e.ActivateThread="COMMENTS2__ACTIVATE_THREAD",e.DeactivateAllThreads="COMMENTS2__DEACTIVATE_ALL_THREADS",e.MarkThreadResolvedRequest="COMMENTS2__MARK_THREAD_RESOLVED_REQUEST",e.MarkThreadResolvedSuccess="COMMENTS2__MARK_THREAD_RESOLVED_SUCCESS",e.MarkThreadResolvedError="COMMENTS2__MARK_THREAD_RESOLVED_ERROR",e.MarkThreadUnresolvedRequest="COMMENTS2__MARK_THREAD_UNRESOLVED_REQUEST",e.MarkThreadUnresolvedSuccess="COMMENTS2__MARK_THREAD_UNRESOLVED_SUCCESS",e.MarkThreadUnresolvedError="COMMENTS2__MARK_THREAD_UNRESOLVED_ERROR",e.DeleteCommentRequest="COMMENTS2__DELETE_COMMENT_REQUEST",e.DeleteCommentSuccess="COMMENTS2__DELETE_COMMENT_SUCCESS",e.DeleteCommentError="COMMENTS2__DELETE_COMMENT_ERROR"})(t.ActionType||(t.ActionType={}));(function(e){e[e.Unknown=0]="Unknown",e[e.NotOnboarded=1]="NotOnboarded",e[e.SuppressOnboardingForSession=2]="SuppressOnboardingForSession",e[e.HasCompletedOnboarding=3]="HasCompletedOnboarding"})(t.OnboardingStatus||(t.OnboardingStatus={}));(function(e){e.ListComments="LIST_COMMENTS",e.AddComment="ADD_COMMENT",e.EditComment="EDIT_COMMENT",e.MarkThreadRead="MARK_THREAD_READ",e.MarkThreadUnread="MARK_THREAD_UNREAD",e.MarkThreadResolved="MARK_THREAD_RESOLVED",e.MarkThreadUnresolved="MARK_THREAD_UNRESOLVED",e.DeleteComment="DELETE_COMMENT"})(t.RequestType||(t.RequestType={}));(function(e){e.Chronological="NATURAL",e.VideoTimeCode="VIDEO_TIME_CODE"})(t.SortType||(t.SortType={}));(function(e){e[e.ThreadActivated=0]="ThreadActivated",e[e.UIButtonClicked=1]="UIButtonClicked"})(t.MarkThreadReadOrigin||(t.MarkThreadReadOrigin={}))}),define("modules/clean/react/comments2/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Comments2Event=new n}),define("modules/clean/react/comments2/transforms",["require","exports","external/lodash","modules/clean/react/comments2/util","modules/core/user_i18n"],function(e,t,n,o,i){"use strict";function r(e){return void 0!==e.time&&void 0!==e[".tag"]}function a(e){if(r(e)){var t=e.time;return"video"===e[".tag"]?{type:"video",time:t}:{type:"audio",time:t}}throw new Error("Attempted to convert an annotation type that does not yet exist.")}function s(e,t,n){return{author:n[e.author_id],content:{metadata:v(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}function l(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:i.getInitials(e.name),public:i.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}function c(e){return{id:e.account_id,name:{display:e.display_name,initials:i.getInitials(e.display_name),public:i.getShortName(e.display_name)},photoUrl:e.photo_circle_url}}function u(e){var t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function d(e){return"video"===e.type}function p(e){return d(e)?{".tag":"video",time:e.time}:{".tag":"audio",time:e.time}}function f(e){var t=e.annotation,n=e.content,o=e.stream;return{annotation_data:t?p(t):void 0,content:n.text,metadata:h(n.metadata),revision:_(o)}}function h(e){return{formatting:e.filter(function(e){return"style"===e.type}).map(function(e){return{format:{".tag":e.style},location:e.location}}),mentions:e.filter(function(e){return"mention"===e.type}).map(function(e){return{user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}})}}function m(e){var t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');var n={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:n}}function v(e){var t=e.formatting.map(u).concat(e.mentions.map(m));return e.sticker&&t.push(g(e.sticker)),t}function g(e){return{type:"sticker",url:o.getUrlForStickerId(e.id)}}function _(e){return"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function y(e,t){var n=e.comments.map(function(n){return s(n,e.id,t)});return{annotation:e.annotation_data?a(e.annotation_data):void 0,comments:n,id:e.id,read:e.read,resolved:e.resolved,timestamp:n[0].timestamp}}function b(e,t){var o=e.map(function(e){return y(e,t)});return n.keyBy(o,"id")}function w(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}function C(e){var t=e.map(w);return n.keyBy(t,"id")}Object.defineProperty(t,"__esModule",{value:!0}),t.annotationToIAnnotation=a,t.commentToIComment=s,t.contactToIMentionUser=l,t.dbxUserToIUser=c,t.iAnnotationToAnnotation=p,t.iCommentContentToUserSubmittedComment=f,t.iCommentMetadataToUserSubmittedMetadata=h,t.metadataToIMetadata=v,t.streamToRevision=_,t.threadToIThread=y,t.threadsToIThreadMap=b,t.userToIUser=w,t.usersToIUserMap=C}),define("modules/clean/react/comments2/util",["require","exports","external/lodash","modules/core/browser","modules/clean/previews/constants","modules/constants/comments2","modules/constants/stickers","modules/core/cookies"],function(e,t,n,o,i,r,a,s){"use strict";function l(e){var t=r.COMMENTS2_AUDIO_ANNOTATIONS.PERSONAL,n=r.COMMENTS2_AUDIO_ANNOTATIONS.WORK;return r.COMMENTS2_AUDIO_ANNOTATIONS.SESSION||e&&("personal"===e.role?t:n)}function c(e){var t=r.COMMENTS2_FRONTEND.PERSONAL,n=r.COMMENTS2_FRONTEND.WORK;return r.COMMENTS2_FRONTEND.SESSION||e&&("personal"===e.role?t:n)}function u(e){var t=r.COMMENTS2_READONLY_EDITOR.PERSONAL,n=r.COMMENTS2_READONLY_EDITOR.WORK;return r.COMMENTS2_READONLY_EDITOR.SESSION||e&&("personal"===e.role?t:n)}function d(e,t){return void 0!==e&&void 0!==t?e.id===t.id:e===t}function p(e,t){return e.type===t.type&&e.id===t.id}function f(e,t){return void 0!==e&&void 0!==t?p(e.stream,t.stream)&&d(e.viewer,t.viewer):e===t}function h(e){var t=e.previewType,n=e.viewer;return(t===i.PreviewType.Video||t===i.PreviewType.Audio&&l(n))&&c(n)}function m(e){var t=e.previewType,n=e.viewer;return v()&&h({previewType:t,viewer:n})}function v(){return o.is_mobile_or_tablet()}function g(e){return u(e)}function _(){return!r.COMMENTS2_DISABLE_BOLT}function y(){return null!==s.Cookies.read("comments2_onboarding_dismissed")}function b(){return s.Cookies.create("comments2_onboarding_dismissed","marked",30)}function w(e){var t=C(),n=t[e]&&t[e].live_sticker,o=n?"gif@2x":"png";return a.sticker_img_url+"/"+e+"?type="+o}Object.defineProperty(t,"__esModule",{value:!0}),t.isUserSame=d,t.isStreamSame=p,t.isContextSame=f,t.shouldUseComments2=h,t.shouldUseComments2MobileWeb=m,t.isComments2Mobile=v,t.isComments2ReadonlyEditor=g,t.useBolt=_;t.hasBrowserDismissedOnboardingPopup=y,t.markBrowserHasDismissedOnboardingPopup=b;var C=n.memoize(function(){return n.keyBy(a.stickers,"id")});t.getUrlForStickerId=w}),define("modules/clean/react/css_timing",["require","exports","modules/clean/react/css","modules/clean/js_client_stopwatch"],function(e,t,n,o){"use strict";function i(e,t,i){void 0===i&&(i=[]);var r=e.displayName||"UnnamedComponent";return n(e,t,i,{onWillLoadCss:function(){return o.JSStopwatch.startSpan("requireCssWithComponent_"+r)},onCssResponse:function(){return o.JSStopwatch.endSpan("requireCssWithComponent_"+r)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.requireCssWithComponent=i}),define("modules/clean/react/file_comments/logger",["require","exports","modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n,o,i){"use strict";return new((function(){function e(){this.disabled=!1}return e.prototype.set_disabled=function(e){return this.disabled=e},e.prototype.log_event=function(e,t,o,r,a,s,l,c,u){if(void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),!this.disabled)return i.assert(e,"event_type not provided"),i.assert(t,"file_activity_key not provided"),n.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:e,file_activity_key:t,comment_activity_key:o,client_origin_type:r,activity_context:s,annotation_type:l,annotation_subtype:c,annotation_page:u},subject_user:a})},e.prototype.log_annotation_event=function(e,t,n,i,r,a){void 0===a&&(a=null);var s,l,c;if(null!=a){var u=o.Annotation.createAnnotationFromDict(a);c=u.type,l=u.subtype,s=u.getFirstPdfPage()}return this.log_event(e,t,n,null,i,r,c,l,s)},e})())}),define("modules/clean/react/file_sidebar/base_comments_tab",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){var t=e.currentFile,n=t.file_id,o=t.ns_id,i=t.preview_type,r=t.sjid,a=e.sharedLinkInfo;return{id:n,linkUrl:a?a.url:void 0,ns_id:o,sjid:r,type:"file",previewType:i||void 0}},l=(function(e){function t(t){var n=e.call(this,t)||this;return n.clearContext=function(){n.store.dispatch(r.setFileContext())},n.setContext=function(e){
n.store.dispatch(r.setFileContext({stream:s(e),viewer:e.user}))},n.store=a.getStoreForComments2(),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setContext(this.props)},t.prototype.componentWillUnmount=function(){this.clearContext()},t.prototype.componentWillUpdate=function(e){this.setContext(e)},t.prototype.render=function(){return this.store?o.createElement(i.Provider,{store:this.store},this.props.content()):null},t})(o.Component);t.BaseCommentsTab=l}),define("modules/clean/react/file_sidebar/constants",["require","exports","external/prop-types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_KEY="fileSidebarStore",t.STORE_SHAPE=n.shape({dispatch:n.func.isRequired,getState:n.func.isRequired,subscribe:n.func.isRequired})}),define("modules/clean/react/file_sidebar/file_sidebar",["require","exports","external/react","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSidebar=o.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/file_sidebar/file_sidebar_component"],t,n)}).then(function(e){return e.FileSidebar})})},loading:n.createElement("div",{className:"file-sidebar"})})}),define("modules/clean/react/file_sidebar/file_sidebar_connect",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/file_sidebar/constants","external/hoist-non-react-statics"],function(e,t,n,o,i,r,a){"use strict";function s(e,t){var s=i.connect(e,t);return function(e){var t=s(e);return a((function(e){function a(t,n){var o=e.call(this,t,n)||this;return o.state={store:n.fileSidebarStore},o}return n.__extends(a,e),a.prototype.componentWillReceiveProps=function(e,t){this.setState({store:t.fileSidebarStore})},a.prototype.render=function(){if(!this.state.store)return null;var e=n.__assign({},this.props,{store:this.state.store});return o.createElement(t,n.__assign({},e))},a.displayName="FileSidebar"+t.displayName,a.WrappedComponent=t,a.contextTypes=(i={},i[r.STORE_KEY]=r.STORE_SHAPE,i),a})(o.Component),t);var i}}Object.defineProperty(t,"__esModule",{value:!0}),t.fileSidebarConnect=s}),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","modules/clean/ajax","modules/clean/viewer","modules/clean/api_v2/client","modules/clean/react/file_viewer/models"],function(e,t,n,o,i,r){"use strict";function a(e,t){var o=r.FileViewerSession.currentSession,i=r.FilePreviewSession.currentSession;if(i&&o){var a={event_name:e,file_viewer_session_id:o.id,file_preview_session_id:i.id,file_ns_id:i.file.ns_id,file_sjid:i.file.sjid,extra:JSON.stringify(t)};n.SilentBackgroundRequest({url:"/log/file_sidebar",data:a})}}function s(e){a("sidebar_tab_selected",e)}function l(e){a("sidebar_opened",e)}function c(e){a("sidebar_closed",e)}function u(e){a("file_view_activity_expanded",e)}function d(e,t){f({event:"get_stream_timing",int_value:e,bool_value:t})}function p(e){f({event:"load_sidebar_timing",int_value:e})}function f(e){var t=o.Viewer.get_viewer().get_user_ids(),n=t.length?t[0]:null,r=new i.ApiV2Client;n?r.ns("file_activity_stream").rpc("log_event",e,{subjectUserId:n}):r.ns("file_activity_stream").rpc("logged_out/log_event",e,{subjectUserId:n})}Object.defineProperty(t,"__esModule",{value:!0}),t.logSidebarTabSelected=s,t.logSidebarOpened=l,t.logSidebarClosed=c,t.logFileViewActivityCardExpanded=u,t.logGetActivityStreamTiming=d,t.logLoadSidebarTiming=p}),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","external/react","external/prop-types","modules/clean/react/file_sidebar/constants","modules/constants/file_activity_stream"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(t){function s(n){var o=t.call(this,n)||this,i=e.defined("modules/clean/react/file_sidebar/store/instance"),r=i?e("modules/clean/react/file_sidebar/store/instance").store:void 0;return o.state={loaded:i,store:r},o}return n.__extends(s,t),s.prototype.getChildContext=function(){return e={},e[r.STORE_KEY]=this.state.store,e;var e},s.prototype.componentWillMount=function(){var t=this;a.IS_ON&&!this.state.loaded&&e(["modules/clean/react/file_sidebar/store/instance"],function(e){var n=e.store;t.setState({loaded:!0,store:n})})},s.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},s.prototype.render=function(){return o.Children.only(this.props.children)},s.propTypes={children:i.element.isRequired},s.childContextTypes=(l={},l[r.STORE_KEY]=r.STORE_SHAPE,l),s})(o.Component);t.FileSidebarProvider=s;var l}),define("modules/clean/react/file_sidebar/store/app/reducer",["require","exports","tslib"],function(e,t,n){"use strict";function o(e,o){switch(void 0===e&&(e=t.INITIAL_STATE),o.type){case"APP_SET_STATE":var i=o.hideComments,r=o.hidePageChrome;return n.__assign({},e,{hideComments:i,hidePageChrome:r})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={hideComments:!1,hidePageChrome:!1},t.reducer=o}),define("modules/clean/react/file_sidebar/store/comments_adapter",["require","exports","modules/clean/comments/store"],function(e,t,n){"use strict";function o(){var e=n.state;return{enabled:n.isCommentingEnabled(),canEnable:n.canEnableComments(),commentCount:e.activity&&e.activity.comment_activities&&e.activity.comment_activities.length||0,initialized:n.isStoreInitialized(),ready:n.isFileActivityReady(),unreadCommentCount:n.unreadCommentCount()}}Object.defineProperty(t,"__esModule",{value:!0}),t.getCommentingState=o}),define("modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/sorted_set"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(n){return void 0===n&&(n=[]),e.call(this,n,t.compare,t.equals)||this}return n.__extends(t,e),t.compare=function(e,t){return e.id===t.id?0:t.timestamp.getTime()-e.timestamp.getTime()},t.equals=function(e,t){return e.id===t.id},t})(o.SortedSet);t.ActivitySortedSet=i}),define("modules/clean/react/file_sidebar/store/file_activity/reducer",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set","modules/constants/file_activity_stream"],function(e,t,n,o,i){"use strict";function r(e){return e.filter(function(e){switch(e.type){case"file_settings_change":return i.IS_FILE_SETTINGS_CHANGE_CARD_ON;case"shared_link_change":return i.IS_SHARED_LINK_CHANGE_CARD_ON;case"view":return i.IS_VIEW_CARD_ON;default:return!0}})}function a(e){return r(e).map(function(e){return e.isGroup?n.__assign({},e,{groupActivities:r(e.groupActivities)}):e})}function s(e){return e.map(function(e){return e.isGroup&&1===e.groupActivities.length?e.groupActivities[0]:e})}function l(e,i){switch(void 0===e&&(e=t.INITIAL_STATE),i.type){case"FILE_ACTIVITY|RESET":return n.__assign({},t.INITIAL_STATE,{feedback:e.feedback});case"FILE_ACTIVITY|RESET_FILE_STATE":return n.__assign({},e,{activities:t.INITIAL_STATE.activities});case"FILE_ACTIVITY|LOADING_START":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:void 0,loading:!0}),userId:i.userId,file:i.file});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{activities:n.__assign({},e.activities,{loaded:!0,loading:!1}),feedback:n.__assign({},e.feedback,{shouldShow:e.activities.value.length>0&&!e.feedback.responded&&Math.random()<.1})});case"FILE_ACTIVITY|RECEIVE_FILE_ACTIVITY":var r=a(i.activities);r=s(r);var l=i.enabled,c=l?new o.ActivitySortedSet(e.activities.value.concat(r)).toArray():[];return n.__assign({},e,{activities:n.__assign({},e.activities,{value:c}),enabled:i.enabled});case"FILE_ACTIVITY|RECEIVE_STREAM_ERROR":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:i.error})});case"FILE_ACTIVITY|FEEDBACK_SENT":return n.__assign({},e,{feedback:n.__assign({},e.feedback,{responded:!0})});case"FILE_ACTIVITY|HIDE_FEEDBACK":return n.__assign({},e,{feedback:n.__assign({},e.feedback,{shouldShow:!1})})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={activities:{error:void 0,loaded:!1,loading:!1,value:[]},enabled:!1,userId:-1,feedback:{shouldShow:!1,responded:i.FEEDBACK_RECEIVED}},t.filterActivitiesBasedOnStormcrows=r,t.filterGroupActivitiesBasedOnStormcrows=a,t.ungroupSingleActivityGroups=s,t.reducer=l}),define("modules/clean/react/file_sidebar/store/file_activity/selectors",["require","exports"],function(e,t){"use strict";function n(e){return e.fileActivity}function o(e){return n(e).activities.value}function i(e){return n(e).activities}function r(e){return n(e).feedback}function a(e){return r(e).responded}function s(e){return o(e).length}function l(e){return n(e).file}function c(e){return n(e).userId}function u(e){return{file:l(e),userId:c(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=n,t.getActivities=o,t.getActivitiesMetadata=i,t.getFeedbackState=r,t.didRespondToFeedback=a,t.getVisibleActivityCount=s,t.getFile=l,t.getUserId=c,t.getContext=u}),define("modules/clean/react/file_sidebar/store/file_activity/sorted_set",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n){void 0===e&&(e=[]),this.items=[],this.compare=t,this.equals=n,this.add(e)}return e.prototype.add=function(e){var t=this;Array.isArray(e)||(e=[e]);var n=this.items.concat(e);return n.sort(this.compare),this.items=n.filter(function(e,n,o){return 0===n||!t.equals(e,o[n-1])}),this},e.prototype.toArray=function(){return Array.prototype.slice.call(this.items)},e})();t.SortedSet=n}),define("modules/clean/react/file_sidebar/store/instance",["require","exports","external/redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/comments/events","modules/clean/comments/store","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/react/comments2/events"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";function h(e,t){return"::RESET"===t.type&&(e=void 0),g(e,t)}function m(){return n.createStore(h,n.applyMiddleware(u.thunk(),d.reactor(p.reactors)))}function v(){t.store.dispatch(l.setCommentingState(c.getCommentingState()))}Object.defineProperty(t,"__esModule",{value:!0});var g=n.combineReducers({app:o.reducer,fileActivity:i.reducer,sidebar:r.reducer});t.store=m(),s.listen(v),v(),a.CommentsEvents.on("reveal-comment-in-pane",function(){t.store.dispatch(l.open("annotation_select")),t.store.dispatch(l.selectTab("comments"))}),f.Comments2Event.on("reveal-comments2-in-pane",function(){t.store.dispatch(l.setComments2State({shouldShow:!0}))})}),define("modules/clean/react/file_sidebar/store/middleware/reactor",["require","exports","modules/clean/shallow_equal"],function(e,t,n){"use strict";function o(e){return"function"==typeof e.changes}function i(e){return"function"==typeof e.changesIn}function r(e){return"function"==typeof e.changesFrom&&"function"==typeof e.changesTo}function a(){function e(e,t,n){void 0===n&&(n=s);var l;if(o(e))l=function(t,n){return{changed:e.changes(t,n)}};else if(i(e))l=function(t,o){var i=e.changesIn(t),r=e.changesIn(o);return{prevValue:i,nextValue:r,changed:!n(i,r)}};else{if(!r(e))throw new Error;l=function(t,n){var o=e.changesFrom(t),i=e.changesTo(n);return{changed:o&&i}}}a.push({checkForChange:l,onChange:t})}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var a=[],l=0,c=t;l<c.length;l++){(0,c[l])(e)}return function(e){var t=e.getState;return function(e){return function(n){for(var o=t(),i=e(n),r=t(),s=0,l=a;s<l.length;s++){var c=l[s],u=c.checkForChange(o,r),d=u.prevValue,p=u.nextValue;u.changed&&c.onChange({nextValue:p,prevValue:d,nextState:r,prevState:o})}return i}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){return n.shallowEqual(e,t)};t.reactor=a}),define("modules/clean/react/file_sidebar/store/middleware/thunk",["require","exports"],function(e,t){"use strict";function n(){return function(e){var t=e.dispatch,n=e.getState;return function(e){return function(o){return"function"==typeof o?o(t,n):e(o)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.thunk=n}),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/file_activity/api","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/comments/store","modules/clean/react/comments2/util"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";function d(){return{type:l.ActionType.SidebarReset}}function p(e){return function(n,i){var r=i(),a=o.getSidebarContext(r),s=a.file,c=a.user,d=s&&u.shouldUseComments2({previewType:s.preview_type,viewer:c});o.getSidebarState(r).open||d||t.LegacyCommentsStoreAction.setStickyOpen(!0,c?c.id:null),n({type:l.ActionType.SidebarOpen,payload:{reason:e}})}}function f(){return function(e,n){var r=n(),a=o.getSidebarContext(r),c=a.file,d=a.user,p=c&&u.shouldUseComments2({previewType:c.preview_type,viewer:d});o.getSidebarState(r).open&&(p||t.LegacyCommentsStoreAction.setStickyOpen(!1,d?d.id:null),e({type:l.ActionType.SidebarClose}),s.logSidebarClosed({num_comments:o.getTabState(r,"comments").extra.commentCount,num_events:i.getVisibleActivityCount(r),viewing_user_id:d?d.id:null}))}}function h(){return function(e,t){var n=t();e(o.getSidebarState(n).open?f():p("toggle_button"))}}function m(){return function(e){e(p("toggle_button_after_transition"))}}function v(e){return{type:l.ActionType.SidebarSelectTab,payload:{tabName:e}}}function g(e){return function(t,i){var r=i(),s=o.getSidebarContext(r);n.isContextChanged(s,e)&&(t({type:l.ActionType.SidebarOpenFile,payload:e}),t(_(a.getCommentingState())))}}function _(e){return{type:l.ActionType.SidebarSetCommentState,payload:e}}function y(e){return{type:l.ActionType.SidebarSetComments2State,payload:e}}function b(e){return{type:l.ActionType.SidebarSetComments2FetchStatus,payload:e}}function w(e,t){t?r.setCommentingPaneVisibility({actorId:t,shouldShow:e}):r.setSessionCommentingPaneVisibility({shouldShow:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.reset=d,t.open=p,t.close=f,t.toggle=h,t.completeToggleOpen=m,t.selectTab=v,t.openFile=g,t.setCommentingState=_,t.setComments2State=y,t.setComments2FetchStatus=b,t.LegacyCommentsStoreAction={showComments:function(){setTimeout(function(){c.onShowComments()})},hideComments:function(){setTimeout(function(){c.onHideComments()})},setStickyOpen:function(e,t){w(e,t)}}}),define("modules/clean/react/file_sidebar/store/sidebar/helpers",["require","exports","modules/clean/file_store/utils"],function(e,t,n){"use strict";function o(e,t){return!e&&!t||!!e&&!!t&&n.areFilesEqual(e,t)}function i(e,t){return!e&&!t||!!e&&!!t&&e.id===t.id}function r(e,t){return!o(e.file,t.file)||!i(e.user,t.user)}Object.defineProperty(t,"__esModule",{value:!0}),t.isFileSame=o,t.isUserSame=i,t.isContextChanged=r}),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","external/lodash","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],function(e,t,n,o,i,r){"use strict";function a(e){var t=i.getSidebarState(e),n=t.open,o=t.ready;return n&&o}function s(e){return!a(e)}function l(e){return n.values(i.getTabsState(e)).every(function(e){return e.ready})}function c(e){return!l(e)}function u(e){var t=i.getSidebarContext(e);return(t.file?t.file.file_id:-1)+":"+(t.user?t.user.id:-1)}function d(e){var t=i.getSidebarContext(e).user;o.logSidebarOpened({reason:i.getOpenReason(e),num_comments:i.getTabState(e,"comments").extra.commentCount,num_events:r.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}function p(e){e({changesFrom:s,changesTo:a},function(e){d(e.nextState)}),e({changes:function(e,t){if(a(e)&&a(t)){var n=t.sidebar.tabs,o=e.sidebar.tabs;return!(o.activity.ready&&o.comments.ready)&&n.activity.ready&&n.comments.ready}return!1}},function(e){d(e.nextState)});var t=-1,n="";e({changes:function(e,t){return u(e)!==u(t)}},function(e){var o=e.nextState;t=Date.now(),n=u(o)}),e({changesFrom:c,changesTo:l},function(e){n===u(e.prevState)&&o.logLoadSidebarTiming(Date.now()-t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.reactors=p}),define("modules/clean/react/file_sidebar/store/sidebar/reducer",["require","exports","tslib","modules/constants/comments_panel","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/react/file_sidebar/store/sidebar/actions"],function(e,t,n,o,i,r){"use strict";function a(e,o){switch(o.type){case i.ActionType.SidebarReset:return n.__assign({},t.INITIAL_STATE,{open:e.open});case i.ActionType.SidebarOpen:return n.__assign({},e,{open:!0,openReason:o.payload.reason});case i.ActionType.SidebarClose:return n.__assign({},e,{open:!1,openReason:void 0});case i.ActionType.SidebarSelectTab:return n.__assign({},e,{activeTab:o.payload.tabName});case i.ActionType.SidebarOpenFile:var r=o.payload,a=r.file,s=r.isVersionHistoryMode,l=r.user;return n.__assign({},e,{openReason:void 0,context:{file:a,isVersionHistoryMode:s,user:l},tabs:{activity:{ready:!l,show:s===!1&&e.tabs.activity.show,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0,comments2PermissionStatus:e.tabs.comments.extra.comments2PermissionStatus}}}});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{tabs:n.__assign({},e.tabs,{activity:{ready:!0,show:e.context.isVersionHistoryMode===!1&&o.state.enabled,count:0}})});case i.ActionType.SidebarSetCommentState:var c=o.payload,u=c.enabled,d=c.canEnable,p=c.commentCount,f=c.initialized,h=c.ready,m=c.unreadCommentCount,v=e.tabs.comments.ready,g=e.tabs.comments.show,_=v||f&&h,y=!_||!v&&_&&(u||d)||g;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:_,show:y,count:m,extra:{commentCount:p,comments2PermissionStatus:e.tabs.comments.extra.comments2PermissionStatus}}})});case i.ActionType.SidebarSetComments2State:var b=o.payload.shouldShow;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:b,show:b,count:0,extra:{commentCount:0,comments2PermissionStatus:e.tabs.comments.extra.comments2PermissionStatus}}})});case i.ActionType.SidebarSetComments2FetchStatus:var w=o.payload.status;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:n.__assign({},e.tabs.comments,{ready:!0,extra:{commentCount:0,comments2PermissionStatus:w}})})})}return e}function s(e,n){void 0===e&&(e=t.INITIAL_STATE);var o=a(e,n);return o.ready=e.ready||o.tabs.activity.ready&&o.tabs.comments.ready,!e.ready&&o.ready&&(o.tabs.comments.show&&!o.tabs.activity.show?o.activeTab="comments":!o.tabs.comments.show&&o.tabs.activity.show&&(o.activeTab="activity"),o.tabs.comments.show&&o.tabs.comments.count>0&&(o.open=!0,o.openReason=o.openReason||"unread_comments",o.activeTab="comments"),"comments"===o.activeTab?r.LegacyCommentsStoreAction.showComments():r.LegacyCommentsStoreAction.hideComments()),o.ready&&o.open&&!o.openReason&&(o.openReason="sticky_state"),!o.open||"comments"!==o.activeTab||"toggle_button"===o.openReason||e.open&&"toggle_button"!==e.openReason&&"comments"===e.activeTab?!e.open||"comments"!==e.activeTab||o.open&&"comments"===o.activeTab||r.LegacyCommentsStoreAction.hideComments():r.LegacyCommentsStoreAction.showComments(),o}Object.defineProperty(t,"__esModule",{value:!0});var l=o.SHOW_COMMENTS_PANEL||!1;t.INITIAL_STATE={activeTab:"comments",open:l,openReason:void 0,ready:!1,context:{file:void 0,isVersionHistoryMode:void 0,user:void 0},tabs:{activity:{ready:!1,show:!1,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0,comments2PermissionStatus:i.PermissionStatus.NOT_YET_RECEIVED}}}},t.reducer=s}),define("modules/clean/react/file_sidebar/store/sidebar/selectors",["require","exports","modules/clean/react/file_sidebar/store/sidebar/types"],function(e,t,n){"use strict";function o(e){return e.sidebar}function i(e){var t=o(e);return{activeTab:t.activeTab,open:t.open,ready:t.ready}}function r(e){return o(e).openReason}function a(e){return o(e).context}function s(e,t){return o(e).tabs[t]}function l(e){return o(e).tabs}function c(e){return o(e).tabs.comments.extra.comments2PermissionStatus===n.PermissionStatus.RECEIVED}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=o,t.getSidebarState=i,t.getOpenReason=r,t.getSidebarContext=a,t.getTabState=s,t.getTabsState=l,t.getIsComments2Received=c}),define("modules/clean/react/file_sidebar/store/sidebar/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.NOT_YET_RECEIVED=0]="NOT_YET_RECEIVED",e[e.RECEIVED=1]="RECEIVED",e[e.DISABLED=2]="DISABLED"})(t.PermissionStatus||(t.PermissionStatus={}));(function(e){e.SidebarOpen="SIDEBAR|OPEN",e.SidebarReset="SIDEBAR|RESET",e.SidebarClose="SIDEBAR|CLOSE",e.SidebarSelectTab="SIDEBAR|SELECT_TAB",e.SidebarOpenFile="SIDEBAR|OPEN_FILE",e.SidebarToggle="SIDEBAR|TOGGLE",e.SidebarSetCommentState="SIDEBAR|SET_COMMENTING_STATE",e.SidebarSetComments2State="SIDEBAR|SET_COMMENTS2_STATE",e.SidebarSetComments2FetchStatus="SIDEBAR|SET_COMMENTS2_FETCH_STATUS"})(t.ActionType||(t.ActionType={}))}),define("modules/clean/react/file_viewer/actionable",["require","exports","external/react","modules/clean/file_store/utils","modules/clean/react/file_viewer/open_button/open_button","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actionable=function(e){var t,s=e.allowOpenInApp,l=e.variant,c=e.location,u=e.user,d=e.userActionContext;return o.isSharedFile(e.file)?(t=e.file,s&&t.open_in_app_data?n.createElement(r.OpenInAppButton,{urls:t.open_in_app_data,userActionContext:d}):n.createElement(a.ShareDownloadButton,{copyable:t,importance:l,location:c,sharedLinkInfo:e.sharedLinkInfo,shareToken:e.shareToken,sharePermission:e.sharePermission,user:u})):(t=e.file,n.createElement(i.OpenButton,{file:t,user:u,justifyRight:!1,location:c,buttonVariant:l}))}}),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],function(e,t,n,o,i,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onContinue=function(){t.log(r.UserAction.AppDownloadInterstitialContinue),"function"==typeof t.props.onContinue&&t.props.onContinue()},t.onClose=function(){t.log(r.UserAction.AppDownloadInterstitialClose),"function"==typeof t.props.onClose&&t.props.onClose()},t.onAppDownload=function(){t.log(r.UserAction.AppDownloadInterstitialInstall)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){c.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(r.UserAction.AppDownloadInterstitialView)},t.prototype.componentWillReceiveProps=function(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)},t.prototype.setupLogger=function(e){void 0===e&&(e=this.props);var t=this.props,n=t.file,o=t.fileViewerSession,i=t.previewSourceAction,r=void 0===i?l.PreviewSourceAction.Visit:i,a=t.previewSourceContext,c=void 0===a?l.PreviewSourceContext.SharedLinkFile:a;o&&(this.filePreviewSession=new s.FilePreviewSession({file:n,isMounted:!1,fileViewerSession:o,sourceAction:r,sourceContext:c}))},t.prototype.log=function(e){var t=this.props,n=t.fileViewerSession,o=t.file;this.filePreviewSession&&n&&o.ns_id&&o.sjid&&i.MobileFilePreviewLogger.log(e,n.id,this.filePreviewSession.id,o.ns_id,o.sjid,{context:r.UserActionContext.AppDownloadInterstitial})},t.prototype.render=function(){var e=this.props,t=e.file,i=e.sharedLinkInfo,r=n.__rest(e,["file","sharedLinkInfo"]);return o.createElement(u.AppDownloadInterstitial,n.__assign({fileOrFolderName:a.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:i.ownerName,ownerTeamName:i.ownerTeamName,onClose:this.onClose},r))},t})(o.PureComponent);t.FilePreviewAppDownloadInterstitial=d}),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","external/react","modules/clean/react/css","modules/constants/payments","modules/core/i18n","modules/clean/react_format"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=r.OUT_OF_SPACE_URL+"?oqa=oq_fp";return o.createElement("div",{className:"fileviewer-upsell-banner"},s.reactFormat(a._("Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"),{a:o.createElement("a",{href:e})}))},t})(o.Component);t.ExpFileViewerUpsellBannerV2=i(l,["/static/css/exp_file_preview_upsell-vflhhQSQ0.css"])}),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/previews/constants","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/file_store/utils","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/clean/react/previews/error/preview_error","modules/clean/react/previews/audio/preview_audio","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/archive/preview_archive_loadable","modules/core/i18n","modules/core/browser","modules/core/exception","modules/clean/react/file_viewer/file_preview_logging_manager","modules/clean/react/previews/video/utils"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v,g,_,y,b,w,C,S,E){"use strict";function A(e){var t=e.file,o=e.sharedLinkUrl,r=e.sourceAction,a=e.sourceContext;return i.createElement(S.FilePreviewSessionManager,{file:t,isMounted:!!o,sourceAction:r,sourceContext:a,render:function(t){return i.createElement(I,n.__assign({},e,{filePreviewSession:t}))}})}Object.defineProperty(t,"__esModule",{value:!0});var T=l.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)}).then(function(e){return e.PreviewImageZoom})}}),P=l.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/limited_preview_message"],t,n)}).then(function(e){return e.LimitedPreviewMessage})}}),x=w.get_uri().getQuery(),k=x.forceRivieraException,R=x.forceTestPdf,O=x.forceTestExcelHtml,I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={hasError:!1},t.onContextMenu=function(e){t.props.sharePermission&&0===t.props.sharePermission.canViewContextMenuRoles.length&&e.preventDefault()},t.onCopy=function(e){t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},t.handleErrorWithRetry=function(e,n){u.shouldFetchRivieraStatusCode(t.props.file)?t.activeRequest=u.fetchRivieraStatusCode(e,function(e){t.activeRequest=void 0,t.setState({hasError:!0,errorType:n,rivieraStatusCode:e})},function(){t.activeRequest=void 0,t.triggerError(n)}):t.triggerError(n)},t.getErrorMessage=function(e,t,n){if(n&&"sketch"===c.getExtension(n)&&e===d.ErrorType.LoadError&&t===d.RivieraConvertResponseType.UnsupportedFormat)return b._("This file can’t be previewed. Previews are               only available for files created in Sketch v43 and up.")},t.triggerError=function(e){t.setState({hasError:!0,errorType:e})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){r.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})},t.prototype.componentDidMount=function(){window.setTimeout(u.cleanupPrerenderPreview)},t.prototype.componentWillUnmount=function(){this.activeRequest&&this.activeRequest.readyState!==XMLHttpRequest.DONE&&this.activeRequest.abort()},t.prototype.renderImagePreview=function(){var e=this,t=this.props.file,o=c.getExtension(t),r=t.preview_url||t.thumbnail_url_tmpl;if(null==r)return this.renderUnsupportedErrorPreview();if(this.props.isFullscreen)return i.createElement(T,{thumbnailUrlTmpl:r,fileExtension:o,fileCount:this.props.count,fileIndex:this.props.index,onFlipNext:this.props.onNext,onFlipPrevious:this.props.onPrevious,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,fileName:c.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});var a={"preview-url":r,"file-extension":c.getExtension(t),isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!s.isLimitedPreview(t),shouldDisableAnnotations:c.isArchiveFile(t),index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:function(){return e.handleErrorWithRetry(r,d.ErrorType.LoadError)},onNext:this.props.onNext,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:c.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess};return i.createElement(m.PreviewImage,n.__assign({},a))},Object.defineProperty(t.prototype,"shouldShowActionables",{get:function(){return this.props.areActionablesEnabled&&!c.isArchiveFile(this.props.file)},enumerable:!0,configurable:!0}),t.prototype.renderVideoPreview=function(){var e=this.props.file;return i.createElement(g.PreviewVideo,{title:c.getFilenameWithoutExtension(e),fileExtension:c.getExtension(e),previewUrl:e.video_transcode_url,thumbnailUrlTmpl:e.thumbnail_url_tmpl,videoMetadataUrl:e.video_metadata_url,videoContainer:e.video_container,isFullscreen:this.props.isFullscreen,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.video_thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.renderLinkfilePreview=function(){var e=this.props.file;return i.createElement(v.PreviewLinkfile,{filename:c.getFilename(e),data:e.linkfile_data,source:e.linkfile_data.authenticated?"browse":"sharedlink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.renderPDFPreview=function(){var e=this.props.file;return e.preview_ssr_image_url_tmpl&&e.preview_ssr_text_url_tmpl?i.createElement(_.PreviewPDFLoadable,{fileExtension:c.getExtension(e),fileHref:e.href,filePreviewSession:this.props.filePreviewSession,imageUrl:e.preview_ssr_image_url_tmpl,isArchiveFile:c.isArchiveFile(e),isFullscreen:this.props.isFullscreen,
isSidebarOpen:this.props.isSidebarOpen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:this.triggerError,forceTestPdf:!!R,previewThumbnailUrl:e.preview_thumbnail_url,refreshUrl:e.preview_ssr_refresh_url||void 0,src:e.preview_url,sharePermission:this.props.sharePermission,shouldDisableAnnotations:c.isArchiveFile(e),sizeClass:this.props.sizeClass,textUrl:e.preview_ssr_text_url_tmpl,invalidateFrameMessenger:this.props.invalidateFrameMessenger,setRenderStatusSuccess:this.props.setRenderStatusSuccess}):this.renderUnsupportedErrorPreview()},t.prototype.renderHTMLPreview=function(){var e=this.props.file,t=e.preview_type,n=c.getExtension(e),o=e.direct_blockserver_link;if(t===a.PreviewType.Excel&&o){var r=s.normalize_extension(n);o=s.get_progressive_url(r,o).toString()}else o=e.htmlified_link||o;if(!o)return this.renderUnsupportedErrorPreview();var l=s.usesFrameMessenger(t,n);return i.createElement(h.PreviewHTML,{src:o,filename:c.getFilename(this.props.file),previewType:t,forceRivieraException:Array.isArray(k)?k[0]:"",forceTestExcelHtml:!!O,isFullscreen:this.props.isFullscreen,onError:this.triggerError,fileExtension:n,usesFrameMessenger:l,sharePermission:this.props.sharePermission,filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sizeClass:this.props.sizeClass})},t.prototype.renderAudioPreview=function(){var e=this.props.file;return E.isHlsAudio()?i.createElement(g.PreviewVideo,{title:c.getFilenameWithoutExtension(e),fileExtension:c.getExtension(e),previewUrl:e.preview_url,videoContainer:e.video_container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,audioUrl:this.props.file.direct_blockserver_link,bytes:this.props.file.bytes}):i.createElement(f.PreviewAudio,{bytes:this.props.file.bytes,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,src:this.props.file.direct_blockserver_link})},t.prototype.renderArchivePreview=function(){return i.createElement(y.PreviewArchiveLoadable,{file:this.props.file,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user})},t.prototype.renderCloudDocPreview=function(){return this.props.file.preview_url?(w.replace_location(this.props.file.preview_url),null):this.renderUnsupportedErrorPreview()},t.prototype.renderUnsupportedErrorPreview=function(){return this.renderErrorPreview(d.ErrorType.SupportError)},t.prototype.renderErrorPreview=function(e){var t=this.state.rivieraStatusCode,n=this.props,o=n.count,r=n.file,a=n.filePreviewSession,s=n.index,l=n.isMobileUserAgent,d=n.maxFilenameEmLength,f=n.onNext,h=n.onPrevious,m=n.sharedLinkInfo,v=n.sharePermission,g=n.shareToken,_=n.user,y=this.props.shouldDisplayToolbar&&u.FlippableHelpers.isFlippableFile(r)&&!c.isArchiveFile(r);return i.createElement(p.PreviewError,{file:r,maxFilenameEmLength:d,filePreviewSession:a,errorType:e,user:_,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:m,shareToken:g,sharePermission:v,shouldDisplayToolbar:y,index:s,isMobileUserAgent:l,count:o,onPrevious:h,onNext:f,message:this.getErrorMessage(e,t,r)})},t.prototype.choosePreview=function(){var e=this.props,t=e.file,n=e.previewTypeWhitelist;if(t.is_dir&&!s.isSupportedBundleFile(t))return this.renderErrorPreview(d.ErrorType.ExtensionError);if(null==t.ns_id&&!c.isArchiveFile(t))return this.renderErrorPreview(d.ErrorType.PendingUploadError);if(c.isSymLink(t))return this.renderErrorPreview(d.ErrorType.SymLinkError);if(s.isEmptyFile(t)&&t.preview_type!==a.PreviewType.CloudDoc)return this.renderErrorPreview(d.ErrorType.EmptyFileError);var o=null==n||n.includes(t.preview_type);if(!s.extensionSupported(t)||!o)return this.renderErrorPreview(d.ErrorType.ExtensionError);if(!s.filesizeSupported(t))return this.renderErrorPreview(d.ErrorType.FileSizeError);switch(t.preview_type){case a.PreviewType.Photo:return this.renderImagePreview();case a.PreviewType.Video:return this.renderVideoPreview();case a.PreviewType.Linkfile:return this.renderLinkfilePreview();case a.PreviewType.Doc:return this.renderPDFPreview();case a.PreviewType.Excel:case a.PreviewType.HTML:case a.PreviewType.Text:return this.renderHTMLPreview();case a.PreviewType.Audio:return this.renderAudioPreview();case a.PreviewType.Archive:return this.renderArchivePreview();case a.PreviewType.CloudDoc:return this.renderCloudDocPreview();default:C.assert(!1,"Preview type "+t.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}return null},t.prototype.render=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,r=e.shareToken,a=e.sharePermission,l=e.sizeClass,u=e.user,d=this.state,p=d.errorType;return d.hasError?this.renderErrorPreview(p):i.createElement("div",{className:o({"flex-preview-container":!0,"no-download":a&&0===a.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},c.isArchiveFile(t)?null:i.createElement(S.FilePreviewPaasLoggerManager,{file:t}),this.choosePreview(),t.preview_type&&s.isLimitedPreview(t)?i.createElement(P,{extension:c.getExtension(t),file:t,sharedLinkInfo:n,shareToken:r,sharePermission:a,shouldShowActionables:this.shouldShowActionables,sizeClass:l,user:u}):null)},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:r.noop,user:null},t})(i.Component);t.FilePreview=I,t.FilePreviewWithLogging=A}),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","external/react","modules/clean/loggers/file_preview_logger","modules/clean/previews/cookie_preview_tracer","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","external/lodash"],function(e,t,n,o,i,r,a,s,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setUpFilePreviewLogger=function(e){t.teardownFilePreviewLogger(),t.filePreviewTimelineLogger=new i.FilePreviewTimelineLogger(e),t.filePreviewTimelineLogger.listenTo(l.filePreviewEventEmitter),t.filePreviewUserActionLogger=new i.FilePreviewUserActionLogger,t.filePreviewUserActionLogger.listenTo(l.filePreviewEventEmitter)},t.teardownFilePreviewLogger=function(){null!=t.filePreviewTimelineLogger&&t.filePreviewTimelineLogger.unlistenTo(l.filePreviewEventEmitter),null!=t.filePreviewUserActionLogger&&t.filePreviewUserActionLogger.unlistenTo(l.filePreviewEventEmitter)},t.logPreviewSessionEnded=function(e){void 0===e&&(e=u.PreviewSessionEndReason.Unknown);var n={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e};t.state.filePreviewSession.recordEvent(s.EventType.FilePreviewSessionEnded,n)},t.startNewFilePreviewSession=function(e){var n=e.file,o=e.isMounted,i=e.sourceAction,r=e.sourceContext,a=new c.FilePreviewSession({file:n,fileViewerSession:c.FileViewerSession.currentSession,isMounted:o,sourceAction:i,sourceContext:r});c.FilePreviewSession.currentSession=a,t.setState({filePreviewSession:a}),t.setUpFilePreviewLogger(a.id),t.teardownFilePreviewCookieTracer(),t.setupCookiePreviewTracer(a.id,l.filePreviewEventEmitter),a.recordEvent(s.EventType.FilePreviewAttemptStarted)},t.setupCookiePreviewTracer=function(e,n){t.filePreviewCookieTracer=new r.CookiePreviewTracer(e,n)},t.teardownFilePreviewCookieTracer=function(){t.filePreviewCookieTracer&&t.filePreviewCookieTracer.teardown()},t.windowCloseHandler=function(){t.logPreviewSessionEnded(u.PreviewSessionEndReason.BeforeUnload)},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.startNewFilePreviewSession(this.props)},t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(u.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),this.teardownFilePreviewCookieTracer(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillReceiveProps=function(e){p.isEqual(e.file,this.props.file)||(this.logPreviewSessionEnded(u.PreviewSessionEndReason.NewFile),this.startNewFilePreviewSession(e))},t.prototype.render=function(){return this.props.render(this.state.filePreviewSession)},t})(o.Component);t.FilePreviewSessionManager=f;var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFrameMessage=function(e){var n=t.props.file,o=e.action,i=e.parameters;"pagerendered"===o&&a.logPageRendered(n,i)},t.startLogger=function(){t.frameMessenger=new d.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.startLogger()},t.prototype.componentWillUnmount=function(){this.stopLogger()},t.prototype.render=function(){return null},t})(o.Component);t.FilePreviewPaasLoggerManager=h}),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","external/classnames","external/keymaster","external/lodash","external/react","external/react-dom","external/react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/react/comments2/util","modules/clean/analytics","modules/clean/history","modules/clean/loggers/file_viewer_logger","modules/clean/previews/constants","modules/clean/react/file_sidebar/file_sidebar","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/title_bar","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/location/with_location","modules/clean/react/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/preview_quality_popup","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/web_timing_logger","modules/constants/file_activity_stream","modules/constants/file_viewer","modules/constants/python","modules/core/browser","modules/core/dom","modules/core/uri","modules/clean/react/file_viewer/data/selectors","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","modules/clean/growth/showcase_upsell/preview_loader","modules/clean/react/file_viewer/open_in_paper","esignature_prototype/utils"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v,g,_,y,b,w,C,S,E,A,T,P,x,k,R,O,I,M,F,D,N,L,U,z,H,B,V,q,j,W,K,G,Y,Z){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var Q="",X="",J=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.previewSourceAction=t.props.initialPreviewSourceAction,t.previewSourceContext=t.props.initialPreviewSourceContext,t.focusInViewer=function(){if(!W.modalIsUp()&&!t.props.shouldFocusCommentInput){var e=s.findDOMNode(t).querySelector(".button-primary");if(e)e.focus();else{var n=H.getTabbableElementsIn(".react-file-viewer");n.length&&n[0].focus()}}},t.flipNext=function(){t.props.onFlipNext&&t.props.onFlipNext()},t.flipPrevious=function(){t.props.onFlipPrevious&&t.props.onFlipPrevious()},t.setupKeymaster=function(){(L.FILE_VIEWER_FLIP_ALL_FILES||W.FlippableHelpers.isFlippableFile(t.props.file))&&(i("left","fileviewer",function(){t.flipPrevious(),g.logUserAction(j.UserAction.FlipPrevious,j.UserActionContext.Keyboard)}),i("right","fileviewer",function(){t.flipNext(),g.logUserAction(j.UserAction.FlipNext,j.UserActionContext.Keyboard)})),i("esc","fileviewer",function(e){H.focus_in_input()||H.is_input(e.target)||document.querySelector(".annotation-bubble")||t.props.isFullscreen||t.fileSubpath||null!=t.props.onCloseViewer&&t.props.onCloseViewer()}),Q=i.getScope(),i.setScope("fileviewer")},t.cleanupKeymaster=function(){i.clearScope("fileviewer"),i.setScope(Q)},t.shouldShowOpenInAppBanner=function(){var e=t.props,n=e.hidePageChrome,o=e.isMobileUserAgent;return!n&&(!(!z.is_tablet()||!W.renderOpenInAppAsBanner())||(o||z.is_mobile_or_tablet()))},t.openInAppBannerOnClick=function(){g.logUserAction(j.UserAction.OpenInApp,j.UserActionContext.OpenInAppBanner)},t.onInterstitialClose=function(){t.props.onAppDownloadInterstitialDismissed()},t.onInterstitialContinue=function(){t.props.onAppDownloadInterstitialDismissed()},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.setUpLogging()},t.prototype.componentDidMount=function(){var e=this.props,t=e.file,n=e.fetchShowOverQuotaUpsell,o=e.onComponentDidMount,i=e.user;null!=o&&o(),this.flipNext=r.throttle(this.flipNext,100),this.flipPrevious=r.throttle(this.flipPrevious,100),this.setupPreviewUrl(t),this.setDocumentTitle(K.getFilename(t),!0),H.scroll_lock_document(),f.start(),this.logView(),n(i)},t.prototype.componentWillUpdate=function(e){var t=e.file;t!==this.props.file&&(this.updatePreviewUrl(t),this.setDocumentTitle(K.getFilename(t)),this.previewSourceAction=O.PreviewSourceAction.Click,this.previewSourceContext=O.PreviewSourceContext.FileViewer),i.setScope("fileviewer")},t.prototype.componentDidUpdate=function(e){K.areFilesEqual(e.file,this.props.file)||this.logView()},t.prototype.componentWillUnmount=function(){this.teardownPreviewUrl(),this.unsetDocumentTitle(),H.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),k.Modal.close()},Object.defineProperty(t.prototype,"fileSubpath",{get:function(){return E.getFileSubpath(this.props.location)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isViewingFileSubpath",{get:function(){return this.props.file.preview_type===h.PreviewType.Archive&&!!this.fileSubpath},enumerable:!0,configurable:!0}),t.prototype.shouldSuppressPassInfo=function(){return null==this.props.file.ns_id},t.prototype.setUpLogging=function(){if(A.FileViewerSession.currentSession=new A.FileViewerSession,this.props.fileViewTarget===U.FileViewTargetType.SHARED_CONTENT_LINK){var e=D.start_time(),t=(new Date).getTime();this.props.user&&d.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER","PREVIEW_PAGE",{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid})}},t.prototype.setupPreviewUrl=function(e){this.props.skipOuterRouting||this.setPreviewUrl(e)},t.prototype.updatePreviewUrl=function(e){this.setPreviewUrl(e,!1)},t.prototype.teardownPreviewUrl=function(){this.props.skipOuterRouting||this.unsetPreviewUrl()},t.prototype.setPreviewUrl=function(e,t){if(void 0===t&&(t=!0),!this.props.disableRouting){var n=K.getFilename(e),o=B.URI.parse(p.get_url()),i=B.URI.encode_parts(o.getPath()),r=o.removeQuery("select").updateQuery({preview:n}).getQuery();t?p.push_state(i,r,{immediatelyRestoreState:!1}):p.replace_state(i,r)}},t.prototype.unsetPreviewUrl=function(){if(!this.props.disableRouting){var e=B.URI.parse(p.get_url()),t=B.URI.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery();p.push_state(t,n,{immediatelyRestoreState:!1})}},t.prototype.isDownloadDisabled=function(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length},t.prototype.shouldShowAppDownloadInterstitial=function(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data},t.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),t&&(X=document.title),document.title=e},t.prototype.unsetDocumentTitle=function(){""!==X&&(document.title=X)},t.prototype.logView=function(){null===this.props.file.ns_id||W.determinePathContext()===j.PathContext.SharedLinkCollection||this.props.hidePageChrome||f.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,this.isDownloadDisabled())},t.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===M.SizeClass.Small||this.props.hidePageChrome)},t.prototype.renderFlippableControls=function(){if(W.FlippableHelpers.isFlippableFile(this.props.file)&&!this.props.isFullscreen&&!this.isImagePreviewAnnotationEnabled()&&null!=this.props.fileIndex)return a.createElement(S.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious})},t.prototype.renderShowcaseUpsell=function(){return a.createElement(G.ShowcaseUpsellPreviewLoader,{user:this.props.user,currentFile:this.props.file,sharedLinkInfo:this.props.sharedLinkInfo,variant:L.UJ_SHOWCASE_UPSELL_PREVIEW_VARIANT,sizeClass:this.props.sizeClass,isFullscreen:this.props.isFullscreen,hidePageChrome:this.props.hidePageChrome})},t.prototype.renderFilePreview=function(){return a.createElement("div",{className:"react-file-viewer__preview react-file-preview"},a.createElement("div",{className:"flex-preview-container"},this.renderPreviewQualityPopup(),this.shouldShowOpenInAppBanner()&&a.createElement(R.OpenInAppBanner,{urls:this.props.file.open_in_app_data,onClick:this.openInAppBannerOnClick}),a.createElement(C.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,file:this.props.file,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:j.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onNext:this.flipNext,onPrevious:this.flipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!this.props.hidePageChrome,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled(),sizeClass:this.props.sizeClass,user:this.props.user}),this.renderFlippableControls()))},t.prototype.renderSidebar=function(){return this.props.sizeClass!==M.SizeClass.Large||this.props.isFullscreen||this.props.hidePageChrome||z.is_mobile_or_tablet()||this.isViewingFileSubpath||null==this.props.file.ns_id?null:a.createElement(m.FileSidebar,{activityContext:this.props.activityContext,currentFile:this.props.file,headerComponent:this.props.sidebarHeaderComponent,commentsDisabledOnFile:!!this.props.hideComments,isVersionHistoryMode:!!this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,shouldInitiallyFocusInput:!!this.props.shouldFocusCommentInput,user:this.props.user})},t.prototype.renderMobileComments=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,o=e.user;return this.props.isFullscreen||this.isViewingFileSubpath?null:a.createElement(c.MobileWebComments,{currentFile:t,sharedLinkInfo:n,user:o})},t.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome&&this.props.file.preview_type!==h.PreviewType.Archive?null:a.createElement("div",{className:"react-file-viewer__title-bar"},a.createElement(T.TitleBar,{canClose:this.props.canClose,canRestoreRevision:this.props.canRestoreRevision,closeUrl:this.props.titleBarCloseUrl,file:this.props.file,fileSubpath:this.fileSubpath,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,hidePageChrome:this.props.hidePageChrome,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isVersionHistoryMode:this.props.isVersionHistoryMode,isViewingFileSubpath:this.isViewingFileSubpath,maxFilenameEmLength:j.SizeClassFilenameLengthMap[this.props.sizeClass],onClose:this.props.onCloseViewer,onMount:this.focusInViewer,onRestoreRevision:this.props.onRestoreRevision,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sizeClass:this.props.sizeClass,user:this.props.user||null}),this.renderUpsellBanner())},t.prototype.shouldAllowFileDonation=function(){return null==this.props.sharedLinkInfo&&(null==this.props.user||this.props.user.home_ns_id===this.props.file.ns_id)},t.prototype.renderPreviewQualityPopup=function(){var e=this.props,t=e.file,n=e.hidePageChrome,o=e.renderStatus,i=e.sizeClass;return W.shouldShowPreviewQualityPopup({sizeClass:i,hidePageChrome:n,renderStatus:o})?a.createElement(I.PreviewQualityPopup,{allowFileDonation:this.shouldAllowFileDonation(),file:t,showProbability:L.PREVIEW_QUALITY_POPUP_PROBABILITY}):null},t.prototype.renderUpsellBanner=function(){return this.props.showOverQuotaUpsell?a.createElement(w.ExpFileViewerUpsellBannerV2,null):null},t.prototype.render=function(){var e=this.props,t=e.className,n=e.file,i=e.hidePageChrome,r=e.isFullscreen,s=e.sharePermission,l=e.sharedLinkInfo,c=e.sizeClass,d=e.transparentBackground,p=e.user,f=K.getFilename(n);return this.shouldShowAppDownloadInterstitial()?a.createElement("div",{"aria-label":f},a.createElement(_.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:l,file:n,fileViewerSession:A.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue})):a.createElement(P.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},a.createElement($,{ns_id:n.ns_id},a.createElement("div",{"aria-label":f,className:o("react-file-viewer",t,{"no-background":d&&!r}),role:"dialog"},this.renderTitleBar(),c!==M.SizeClass.Large||r||i?null:a.createElement(Y.OpenInPaperBanner,{currentFile:n,sharedLinkInfo:l,sharePermission:s,user:p}),a.createElement("div",{className:o("react-file-viewer__content",{"comments2-mobile-web":u.shouldUseComments2MobileWeb({previewType:n.preview_type||void 0,viewer:p})})},this.renderFilePreview(),this.renderSidebar(),this.renderShowcaseUpsell(),this.renderMobileComments()))))},t.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",disableRouting:!1,hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:U.OREF_CONSTANTS.BROWSE_UNKNOWN,shouldFocusCommentInput:!1,sizeClass:M.SizeClass.Large,skipOuterRouting:!1,fileCount:0},t})(a.Component);t._FileViewer=J;var $=function(e){var t=e.children,n=e.ns_id;return N.IS_ON&&null!=n?a.createElement(v.FileSidebarProvider,null,t):a.Children.only(t)},ee=function(e){return null!=e.file?a.createElement(J,n.__assign({},e)):a.createElement("div",null)},te=x.withLocation(ee),ne=F.withSizeClass(te,{isResponsiveEnabled:W.isResponsiveEnabled,responsiveClassName:j.ResponsiveClassName}),oe=l.connect(function(e,t){var n=V.getAppDownloadInterstitial(e);return void 0===n&&t&&(n=t.appDownloadInterstitialDismissed),{appDownloadInterstitialDismissed:n,file:V.getActiveFile(e),isFullscreen:V.getIsFullScreen(e),isSidebarOpen:V.getIsSidebarOpen(e),renderStatus:V.getRenderStatusForCurrentFile(e),showOverQuotaUpsell:V.getShowOverQuotaUpsell(e)}},{onAppDownloadInterstitialDismissed:y.dismissAppDownloadInterstitial,fetchShowOverQuotaUpsell:y.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:y.setRenderStatusSuccessForCurrentFile})(ne),ie=b.getStoreForFileViewer(),re=function(e){return a.createElement(l.Provider,{store:ie},a.createElement(oe,n.__assign({},e)))},ae=["/static/css/preview_flexbox_layout-vflQUUZaq.css","/static/css/react_file_viewer-vflMCL5kf.css","/static/css/react_title_bar-vflFmgAnG.css","/static/css/spectrum/index.web-vflu1RHct.css","/static/js/spectrum_signatures/index.web-vflRg2bK6.css"];Z.esignaturesEnabled()&&ae.push("/static/js/spectrum_signatures/index.web-vflRg2bK6.css");var se=q(re,ae);t.FileViewer=se}),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return n.__extends(t,e),t.prototype.getNavText=function(){return r._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=r._("Flip left",{comment:"Flip to the previous file in a series of files when previewing files on the web"}),t=r._("Flip right",{comment:"Flip to the next file in a series of files when previewing files on the web"});return o.createElement("div",{className:"react-file-viewer__controls"},o.createElement("button",{className:"nav-control",alt:e,onClick:this.handlePreviousClick},o.createElement(i.Sprite,{group:"web",name:"s_flip_left",alt:e})),o.createElement("div",{className:"nav-text"},this.getNavText()),o.createElement("button",{className:"nav-control",alt:t,onClick:this.handleNextClick},o.createElement(i.Sprite,{group:"web",name:"s_flip_right",alt:t})))},t})(o.Component);t.FlippableControls=a}),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,o,i,r){"use strict";function a(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e)}function s(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e)}function l(e){window.addEventListener("popstate",e)}function c(e){window.removeEventListener("popstate",e)}function u(){var e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function d(){var e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}function p(){C.dispatch(o.setFullScreen(!0))}function f(){C.dispatch(o.setFullScreen(!1))}function h(){w()||y(r.UserActionContext.Browser)}function m(){y(r.UserActionContext.Browser)}function v(){a(h),l(m)}function g(){s(h),c(m)}function _(e,t){p(),e&&(u(),v()),t&&i.logUserAction(r.UserAction.ToggleFullscreenOn,t)}function y(e){g(),f(),d(),e&&i.logUserAction(r.UserAction.ToggleFullscreenOff,e)}function b(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen}function w(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}Object.defineProperty(t,"__esModule",{value:!0});var C=n.getStoreForFileViewer();t.enterFullScreen=_,t.exitFullScreen=y,t.browserSupportFullScreen=b,t.isBrowserFullscreen=w}),define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/open_button/open_button_component"],t,n)}).then(function(e){return e.OpenButton})}})}),define("modules/clean/react/file_viewer/open_in_paper",["require","exports","external/react","modules/clean/react/async/loadable","modules/clean/react/file_viewer/utils","modules/constants/file_viewer"],function(e,t,n,o,i,r){"use strict";function a(){return"VARIANT_A"===r.OPEN_IN_PAPER_VARIANT}Object.defineProperty(t,"__esModule",{value:!0});var s=o.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/paper/open_in_paper_banner"],t,n)}).then(function(e){return e.OpenInPaperBanner})}});t.OpenInPaperBanner=function(e){var t=e.currentFile,o=e.sharedLinkInfo,r=e.sharePermission,l=e.user;return a()&&i.canUserUsePaper(l)&&i.canDownloadFile(o,r)?n.createElement(s,{file:t,sharedLink:o.url,source:null!=o?"shared_file_actions":"mounted_file_actions"}):null}}),define("modules/clean/react/file_viewer/title_bar",["require","exports","external/react","modules/clean/react/async/loadable"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TitleBar=o.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/title_bar_component"],t,n)}).then(function(e){return e.TitleBar})},loading:n.createElement("div",{className:"react-title-bar"})})}),define("modules/clean/react/file_viewer/utils",["require","exports","external/lodash","modules/clean/activity/constants","modules/clean/ajax","modules/core/browser","modules/clean/previews/util","modules/clean/open_with","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/constants/file_viewer","modules/core/uri","modules/clean/react/previews/constants","modules/constants/python","modules/clean/react/file_viewer/constants","modules/clean/react/previews/image_helpers","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/file_store/utils","modules/clean/previews/path_context_utils","modules/clean/previews/responsive_utils"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v,g,_,y,b,w){"use strict";function C(e){return W.indexOf(e.preview_type)>-1&&!a.isLimitedPreview(e)}function S(e){return Array.isArray(e)?e.filter(function(e){return C(e)}).map(function(e){return e}):[]}function E(e,t){return u.WOPI_BUTTON_VISIBLE&&e.bytes<=s.MAX_SUPPORTED_FILE_SIZE_B&&null!==s.get_open_handler_for(e,t)}function A(e,t){return s.get_open_handler_for(e,t)}function T(e,t){var n=A(e,t),o=n.uri+"?hpt_click_ts="+Date.now();r.redirect(o)}function P(e,t){i.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})}function x(e,t){for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];for(var i in o)if(o.hasOwnProperty(i)){var r=o[i],a=r.extensions;if(a.indexOf(t)>-1)return{vendor:n,application:i}}}return null}function k(e,t,n){"acrobat_or_reader"===n?i.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:n,extension:e},subject_user:t}):i.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:n,extension:e},subject_user:t})}function R(e,t){if(e===c.SplitButtonActionLocation.Main){
if(t===c.FileViewerPane.TitleBar)return c.UserActionContext.TitleBarMain;if(t===c.FileViewerPane.PreviewContent)return c.UserActionContext.PreviewContentMain}else if(e===c.SplitButtonActionLocation.Split){if(t===c.FileViewerPane.TitleBar)return c.UserActionContext.TitleBarSplitButton;if(t===c.FileViewerPane.PreviewContent)return c.UserActionContext.PreviewContentSplitButton}return c.UserActionContext.Unknown}function O(){for(var e=!1,t=document.getElementsByClassName("db-modal-wrapper"),n=0;!e&&n<t.length;n++){e="none"!==window.getComputedStyle(t[n]).display}return e}function I(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,function(e){e.style.display="none"})}function M(){return new d.URI({path:"/login",query:{cont:r.get_href()}}).toString()}function F(){return"BANNER"===u.OPEN_IN_APP_VARIANT}function D(e,t){if([o.ActivityContext.BROWSE_FILE_VIEWER,o.ActivityContext.SHARED_LINK_VIEW,o.ActivityContext.SHARED_CONTENT_LINK_VIEW].indexOf(e)>=0)switch(t){case l.PreviewType.Photo:return c.FileViewerInterfaceType.Window;case l.PreviewType.Doc:return c.FileViewerInterfaceType.Frame}}function N(e){return!e}function L(e,t){return N(e)||t&&t.canDownloadRoles.length>0}function U(e){return null!=e&&!e.is_paper_disabled}function z(e){switch(e){case f.FileViewTargetType.SHARED_LINK:return o.ActivityContext.SHARED_LINK_VIEW;case f.FileViewTargetType.SHARED_CONTENT_LINK:return o.ActivityContext.SHARED_CONTENT_LINK_VIEW;default:return o.ActivityContext.BROWSE_FILE_VIEWER}}function H(e){switch(e){case h.PathContext.SharedLinkCollection:return p.PreviewSourceContext.SharedLinkCollection;case h.PathContext.VersionHistory:return p.PreviewSourceContext.VersionHistory;default:return p.PreviewSourceContext.Browse}}function B(e){switch(e){case h.PathContext.SharedLinkFile:case h.PathContext.SharedLinkFolder:return p.PreviewSourceAction.Visit;default:return p.PreviewSourceAction.Click}}function V(e,t){if(0!==e.length){var n=[];[0,1,2,3,4,5,6,-1,-2].forEach(function(o){var i=(t+o+e.length)%e.length;n.indexOf(i)===-1&&n.push(i)}),n.forEach(function(t){if(e.length>t&&e[t].preview_type===l.PreviewType.Photo){var n=e[t],o=n.preview_url||n.thumbnail_url_tmpl;o&&m.preloadResponsiveImage(o).then(function(e){var n=v.FileViewerSession.currentSession;null==n||t in n.imagesFetched||(n.imagesFetched[t]=e)})}})}}function q(e){var t=e.renderStatus,n=e.hidePageChrome,o=e.sizeClass;return!(u.PREVIEW_QUALITY_POPUP_PROBABILITY<=0)&&(t===g.PreviewRenderStatus.Succeeded&&(!n&&o!==_.SizeClass.Small))}function j(e){return"sketch"===y.getExtension(e)}Object.defineProperty(t,"__esModule",{value:!0});var W=[l.PreviewType.Photo];t.FlippableHelpers={isFlippableFile:C,filterFlippableFiles:S},t.OpenWithHelpers={canOpenWith:E,getOpenWithHandlerData:A,openWith:T},t.TooltipHelpers={fetchTooltipInfo:P,getVendorAndApplication:x,logImpression:k},t.getSplitButtonUserActionContext=R,t.modalIsUp=O,t.cleanupPrerenderPreview=I,t.getSharedLinkLoginUrl=M,t.sharedLinkLoginUrl=M(),t.renderOpenInAppAsBanner=F,t.determinePathContext=b.determinePathContext,t.isResponsiveEnabled=w.isResponsiveEnabled,t.getFileViewerInterfaceType=D,t.isMountedFile=N,t.canDownloadFile=L,t.canUserUsePaper=U,t.getActivityContext=z,t.getSourceContext=H,t.getSourceAction=B,t.preloadImages=V,t.shouldShowPreviewQualityPopup=q,t.fetchRivieraStatusCode=function(e,t,o){void 0===o&&(o=function(){});var i=new XMLHttpRequest;return i.open("GET",e),i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)try{var e=i.getResponseHeader("x-dropbox-metadata");if(e){var r=JSON.parse(e),a=n.get(r,"rivieraStatusCode");void 0!==a&&t(a)}else o()}catch(e){o()}},i.send(),i},t.shouldFetchRivieraStatusCode=j}),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","external/lodash","modules/clean/keycode"],function(e,t,n,o,i){"use strict";function r(e){return n.__assign({},t.genericKeyboardEventCriteria,{which:e})}function a(e){return n.__assign({},y,{which:e})}function s(e){return{keyboardEventCriteria:n.__assign({},t.genericKeyboardEventCriteria,e.keyboardEventCriteria),callback:null!=e.callback?e.callback:b}}function l(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}}function c(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}}function u(e){return n.__assign({},e,{keyCode:null!=e.keyCode?e.keyCode:e.which})}function d(e,t){return[(n={which:e},n[t]=!0,n),(o={which:e},o[t]=!1,o)];var n,o}function p(e){return function(t){return d(t,e)}}function f(e){return o.flatten(e.map(p("shiftKey")))}function h(e,t){return e.map(function(e){return s({keyboardEventCriteria:e,callback:t})})}function m(e){return h(w,e)}function v(e){return h(C,e)}function g(e){return void 0!==e.preventDefault}function _(e){return function(t){e(),g(t)&&t.preventDefault()}}Object.defineProperty(t,"__esModule",{value:!0}),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};var y={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(y),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=r,t.generateUnmodifiedSimpleKeyboardEvent=a;var b=function(){};t.hydrateKeyboardBinding=s,t.getKeyboardEventCriteria=l,t.getSimpleKeyboardEvent=c,t.addLegacyPropertiesToSimpleKeyboardEvent=u;var w=f([i.KeyCode.EQUALS,i.KeyCode.PLUS_EQUALS_FF,i.KeyCode.PLUS_CHROME,i.KeyCode.PLUS_EQUALS_FF_GERMAN]),C=f([i.KeyCode.MINUS_FF_MAC,i.KeyCode.MINUS_FF,i.KeyCode.MINUS_CHROME]);t.getEqualsKeyBindings=m,t.getMinusKeyBindings=v,t.isKeyboardEvent=g,t.withPreventDefault=_}),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","external/react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(t,n){var o=e.call(this,t,n)||this;if(!n.registerKeyBindings||!n.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},t.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},t.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},t.prototype.render=function(){return null},t.contextTypes=i.KeyboardBindingProviderContextTypes,t})(o.Component);t.KeyboardBindingConnector=r}),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","external/react","external/prop-types","modules/clean/callback_chain/callback_chain","modules/clean/keycode","modules/clean/react/keyboard_binding/keyboard_binding"],function(e,t,n,o,i,r,a,s){"use strict";function l(e){var t=s.getKeyboardEventCriteria(e),n="";return s.KeyboardEventCriteriaKeys.forEach(function(e){n+=e+":"+t[e]+","}),n}function c(e){return e.reduce(function(e,t){return t.reduce(function(e,t){var n=t.keyboardEventCriteria,o=t.callback,i=l(n);return e[i]=e[i]||[],e[i].push(o),e},e)},{})}function u(e){var t=s.addLegacyPropertiesToSimpleKeyboardEvent(e);new r.CallbackChain(p).run(t)}function d(e){var t=e.target||e.srcElement;if(!t)return!0;var n=t.tagName,o=e.which,i="INPUT"===n||"SELECT"===n||"TEXTAREA"===n,r=["submit","button"].indexOf(t.type)!==-1,s=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();return!(i&&!r||s)||(o===a.KeyCode.ESC||o===a.KeyCode.TAB)}Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:i.func,registerKeyBindings:i.func,unregisterKeyBindings:i.func,updateKeyBindings:i.func};var p=[];t.noop=function(e){};var f=(function(e){function i(n){var o=e.call(this,n)||this;return o.registrationIdentifier=0,o.registeredBindings=[],o.keyboardBindingsByCriteria={},o.allKeyHandlers=[],o.registerKeyBindings=function(e){var n=o.registrationIdentifier++;return o.updateKeyBindings(n,e),o.allKeyHandlers[n]||(o.allKeyHandlers[n]=t.noop),n},o.registerAllKeyCallback=function(e,n){o.allKeyHandlers[e]=null!=n?n:t.noop},o.unregisterKeyBindings=function(e){o.updateKeyBindings(e,[]),o.allKeyHandlers[e]=t.noop},o.updateKeyBindings=function(e,t){o.registeredBindings[e]=null!=t?t:[],o.keyboardBindingsByCriteria=c(o.registeredBindings)},o.onKeyDown=function(e){if(d(e)){var t=o.getCallbacksForKey(e);new r.CallbackChain(t).run(e)}},o.allKeyHandlers=[],o.registeredBindings=[],o}return n.__extends(i,e),i.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=p.length,p.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},i.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),p[this.providerIdentifier]=t.noop,this.props.onDestroy&&this.props.onDestroy()},i.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},i.prototype.getCallbacksForKey=function(e){var t=l(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)},i.prototype.render=function(){return o.Children.only(this.props.children)},i.childContextTypes=t.KeyboardBindingProviderContextTypes,i})(o.Component);t.KeyboardBindingProvider=f,t.getIndexForkeyboardBindingsByCriteria=l,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=c,t.simulateKeyEvent=u}),define("modules/clean/react/open_in_app/button",["require","exports","tslib","external/react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){s.logUserAction(l.UserAction.OpenInApp,n.props.userActionContext),r.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){r.cleanUp()},t.prototype.render=function(){return o.createElement(i.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?a._("Install app?"):a._("Open in app"))},t})(o.Component);t.OpenInAppButton=c}),define("modules/clean/react/previews/archive/preview_archive_loadable",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewArchiveLoadable=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/archive/preview_archive"],t,n)}).then(function(e){return e.PreviewArchive})}})}),define("modules/clean/react/previews/audio/preview_audio",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/previews/audio/preview_audio_details","modules/clean/react/previews/audio/preview_audio_play_button","modules/clean/react/previews/audio/preview_audio_visuals","modules/clean/react/previews/audio/preview_audio_volume","modules/clean/react/previews/audio/radio_illustration","modules/clean/react/previews/audio/utils","modules/clean/react/previews/loading_indicator","modules/core/browser","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v,g,_,y,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={time:0,duration:0,bufferedLength:0,isPlaying:!1,isInitialized:!1,isMuted:!1,volumeLevel:1,rawWaveformHeights:[],waveformWidth:0,isContainerSet:!1},t.setAudioRef=function(e){t.audio=e},t.setAudioWrapperRef=function(e){t.audioWrapper=e},t.handleResize=r.debounce(function(){t.setWaveformWidth()},100),t.markReady=r.once(function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),setTimeout(t.setContainer,500),t.props.bytes&&t.props.bytes<7e7&&t.sendWaveFormRequest()}),t.setContainer=function(){t.setState({isContainerSet:!0})},t.handleCanPlay=function(){t.markReady()},t.handleLoadedMetadata=function(){t.setState({isInitialized:!0})},t.handleProgress=function(){var e=t.getBufferProgress();t.setState({bufferedLength:e})},t.handleTimeUpdate=function(){t.setState({time:t.audio.currentTime})},t.handleSeek=function(e){t.audio.currentTime=e,t.setState({time:e})},t.handleDurationChange=function(){var e=t.getBufferProgress();t.setState({duration:t.audio.duration,bufferedLength:e})},t.handleEnded=function(){t.pauseFile()},t.handlePlayButtonClick=function(){t.playOrPause()},t.handleMuteToggle=function(){var e=t.state.isMuted?t.state.volumeLevel||.1:0;t.audio.volume=e;var n={isMuted:!t.state.isMuted};0===t.state.volumeLevel&&(n.volumeLevel=e),t.setState(n)},t.handleVolumeChange=function(e){t.audio.volume=e,t.setState({volumeLevel:e,isMuted:!e})},t.handleError=function(){y.Notify.error(_._("An audio error occurred")),g.reportException({err:new Error("Audio file failed to play"),tags:["audioPreviews"],severity:g.SEVERITY.NONCRITICAL}),t.logFilePreviewEvent(s.EventType.FilePreviewDownloadFailed),t.props.onError()},t.updateWaveformState=function(e){t.isRendered&&t.setState({rawWaveformHeights:e})},t.checkIfRendered=function(){return t.isRendered},t.parseWaveFormBuffer=function(e){return t.setWaveformWidth(),f.buildFromBuffer(e,1e3,100,t.checkIfRendered,t.updateWaveformState)},t.generateWaveform=function(){var e=Math.floor((t.state.waveformWidth-1)/3);return f.returnWaveform(t.state.rawWaveformHeights,e,.85)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.isRendered=!0,this.logFilePreviewEvent(s.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(s.EventType.FilePreviewDownloadAttempted),this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),v.mark_time_to_view(),v.mark_time_to_interactive(),this.setWaveformWidth(),window.addEventListener("resize",this.handleResize)},t.prototype.componentWillUnmount=function(){this.isRendered=!1,window.removeEventListener("resize",this.handleResize),null!=this.audioContext&&null!=this.audioContext.close&&this.audioContext.close()},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.setWaveformWidth=function(){this.isRendered&&this.setState({waveformWidth:this.audioWrapper.offsetWidth})},t.prototype.getSrcUrl=function(){var e=b.URI.parse(this.props.src);e.updateQuery({duc_id:"dropbox_duc_id"});var t=e.toString();return"//"===t.slice(0,2)&&(t="https:"+t),t},t.prototype.getBufferProgress=function(){return this.audio.duration&&this.audio.buffered&&this.audio.buffered.length?this.audio.buffered.end(this.audio.buffered.length-1):0},t.prototype.playOrPause=function(){this.state.isPlaying?this.pauseFile():this.playFile()},t.prototype.playFile=function(){this.audio.play(),this.setState({isPlaying:!0})},t.prototype.pauseFile=function(){this.audio.pause(),this.setState({isPlaying:!1})},t.prototype.sendWaveFormRequest=function(){var e=this;if(this.setAudioContext(),null==this.audioContext)this.logFailedWaveformGeneration();else{if(m.is_mobile_or_tablet())return;var t=new XMLHttpRequest;t.open("GET",this.getSrcUrl()),t.responseType="arraybuffer",t.withCredentials=!0,t.onreadystatechange=function(){4===t.readyState&&e.isRendered&&(200===t.status?e.audioContext.decodeAudioData(t.response,e.parseWaveFormBuffer,e.logFailedWaveformGeneration):e.logFailedWaveformGeneration())},t.send()}},t.prototype.logFailedWaveformGeneration=function(){g.reportException({err:new Error("Audio could not be decoded"),tags:["audioPreviews"],severity:g.SEVERITY.NONCRITICAL})},t.prototype.setAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;e&&(this.audioContext=new e)},t.prototype.renderAudioTag=function(){return i.createElement("audio",{onCanPlay:this.handleCanPlay,onDurationChange:this.handleDurationChange,onEnded:this.handleEnded,onError:this.handleError,onLoadedMetadata:this.handleLoadedMetadata,onProgress:this.handleProgress,onTimeUpdate:this.handleTimeUpdate,preload:"auto",crossOrigin:"use-credentials",ref:this.setAudioRef,src:this.getSrcUrl()})},t.prototype.renderRadio=function(){var e=0!==this.state.rawWaveformHeights.length,t=o({"preview-audio__radio":!0,"preview-audio__radio--hidden":!this.state.isInitialized||e});return i.createElement("div",{className:t},i.createElement(p.RadioIllustration,null))},t.prototype.renderWaveForm=function(){return i.createElement(u.PreviewAudioVisuals,{generateWaveform:this.generateWaveform,time:this.state.time,duration:this.state.duration,bufferedLength:this.state.bufferedLength,barWidth:2,barSpacing:1,waveformWidth:this.state.waveformWidth,isWaveformReady:0!==this.state.rawWaveformHeights.length,isContainerSet:this.state.isContainerSet,key:1,onSeek:this.handleSeek})},t.prototype.renderToolbar=function(){return i.createElement("div",{className:"toolbar",key:2},this.renderPlayButton(),this.renderDetails(),this.renderVolume())},t.prototype.renderPlayButton=function(){return i.createElement(c.PreviewAudioPlayButton,{isPlaying:this.state.isPlaying,onClick:this.handlePlayButtonClick})},t.prototype.renderDetails=function(){return i.createElement(l.PreviewAudioDetails,{time:this.state.time,duration:this.state.duration})},t.prototype.renderVolume=function(){return m.iOS?null:i.createElement(d.PreviewAudioVolume,{isMuted:this.state.isMuted,volumeLevel:this.state.volumeLevel,onVolumeChange:this.handleVolumeChange,onMuteToggle:this.handleMuteToggle})},t.prototype.render=function(){var e=o({"preview-audio__container":!0,"preview-audio__container--loading":!this.state.isInitialized});return i.createElement("div",{className:"flex-preview-container"},i.createElement("div",{className:"preview-audio preview-content preview-content--center"},i.createElement("div",{className:"preview-audio__wrapper",ref:this.setAudioWrapperRef},i.createElement("div",{className:"preview-audio__aspect-container"},i.createElement("div",{className:e},this.renderAudioTag(),this.renderRadio(),this.state.isInitialized?[this.renderWaveForm(),this.renderToolbar()]:i.createElement(h.LoadingIndicator,{className:"preview-audio__load-indicator"}))))))},t})(i.Component);t._PreviewAudio=w;var C=a(w,["/static/css/preview_audio-vfljN6-z1.css"]);t.PreviewAudio=C}),define("modules/clean/react/previews/audio/preview_audio_details",["require","exports","tslib","external/react","modules/clean/datetime","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.formatString=function(e){return r._("%(time)s").format({time:i.formatAudioTime(e)})},t.prototype.getDisplayString=function(){return o.createElement("span",{className:"toolbar-details__time"},this.formatString(this.props.time)+" / "+this.formatString(this.props.duration))},t.prototype.render=function(){return o.createElement("div",{className:"toolbar-details vertical-align"},o.createElement("div",{className:"toolbar-details__string vertical-align__child"},this.getDisplayString()))},t})(o.Component);t.PreviewAudioDetails=a}),define("modules/clean/react/previews/audio/preview_audio_play_button",["require","exports","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i){"use strict";function r(e){var t=e.isPlaying,r=e.onClick,a=t?"pause":"play",s=t?i._("Pause"):i._("Play");return n.createElement("button",{className:"toolbar-controller vertical-align",onClick:r,title:s},n.createElement("div",{className:"toolbar-controller__button vertical-align__child"},n.createElement(o.Sprite,{group:"web",name:a,alt:s})))}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewAudioPlayButton=r}),define("modules/clean/react/previews/audio/preview_audio_visuals",["require","exports","tslib","external/classnames","external/react","external/react-dom"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrubPercentage:0,isMouseDown:!1},t.setWaveformRef=function(e){t.waveform=e},t.scrubTime=function(e){var n=t.getSeekPercentageFromEvent(e);t.updateWaveformScrubToPercentage(n),t.state.isMouseDown&&t.updateTime(e)},t.resetScrub=function(){t.updateWaveformScrubToPercentage(0),t.setMouseUp()},t.updateTime=function(e){var n=t.getSeekPercentageFromEvent(e),o=n*t.props.duration;t.props.onSeek(o)},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t}return n.__extends(t,e),t.prototype.getSeekPercentageFromEvent=function(e){var t=r.findDOMNode(this.waveform).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.getProgress=function(){return this.props.time/(this.props.duration||1)},t.prototype.getBuffered=function(){return this.state.scrubPercentage>0?this.state.scrubPercentage:this.props.isContainerSet?this.props.bufferedLength/(this.props.duration||1):0},t.prototype.getWidthObject=function(e){return{width:e+"%"}},t.prototype.updateWaveformScrubToPercentage=function(e){this.setState({scrubPercentage:e})},t.prototype.getScrubObject=function(e){return{onClick:this.updateTime,onMouseMove:this.scrubTime,onMouseLeave:this.resetScrub,onMouseDown:this.setMouseDown,onMouseUp:this.setMouseUp,className:e}},t.prototype.getWavebarClasses=function(e){return o({wavebar__single:!0,"wavebar__single--scrubbed":e})},t.prototype.renderWaveBar=function(e,t){var n,o=1-e,r={top:100*o+"%",height:100*e+"%"},a=this.props.waveformWidth,s=(t+1)*(this.props.barWidth+this.props.barSpacing)-this.props.barWidth;if(this.state.scrubPercentage>0){var l=this.state.scrubPercentage*a;n=this.getWavebarClasses(s<l)}else{var c=this.getProgress()*a;n=this.getWavebarClasses(s<c)}return[i.createElement("div",{className:"wavebar__single wavebar__space",key:1}),i.createElement("div",{className:n,style:r,key:2})]},t.prototype.renderWaveBars=function(){var e,t=this,r=o({wavebar__container:!0,"wavebar__container--ready":this.props.isWaveformReady});return e=this.props.isWaveformReady?this.getScrubObject(r):{className:r},i.createElement("div",n.__assign({},e),this.props.generateWaveform().map(function(e,n){return t.renderWaveBar(e,n)}))},t.prototype.renderWaveForm=function(){var e;return e=this.props.isWaveformReady?this.getWidthObject(100*this.state.scrubPercentage):this.getWidthObject(0),i.createElement("div",{className:"waveform"},i.createElement("div",{className:"waveform__scrub",style:e}),this.renderWaveBars())},t.prototype.renderProgressBar=function(){var e=100*this.getProgress(),t=100*this.getBuffered(),r=o({"audio-progress-bar__done":!0,"audio-progress-bar__showing":!!e});return i.createElement("div",n.__assign({},this.getScrubObject("audio-progress-bar")),i.createElement("div",{className:"audio-progress-bar__buffered",style:this.getWidthObject(t)}),i.createElement("div",{className:r,style:this.getWidthObject(e)}))},t.prototype.render=function(){return i.createElement("div",{className:"visuals",ref:this.setWaveformRef},this.renderWaveForm(),this.renderProgressBar())},t})(i.Component);t.PreviewAudioVisuals=a}),define("modules/clean/react/previews/audio/preview_audio_volume",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/previews/audio/volume_toggle"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isMouseDown:!1},t.setVolumeBarRef=function(e){t.volumeBar=e},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t.safeChangeVolume=function(e){if(t.state.isMouseDown)return t.changeVolume(e)},t.changeVolume=function(e){var n=t.getVolumePercentageFromEvent(e);t.props.onVolumeChange(n)},t}return n.__extends(t,e),t.prototype.getVolumePercentageFromEvent=function(e){var t=i.findDOMNode(this.volumeBar).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.renderVolumeBar=function(){var e=this.props.isMuted?0:100*this.props.volumeLevel,t={width:e+"%"};return o.createElement("div",{className:"volume-bar vertical-align__child",onMouseUp:this.setMouseUp,onMouseDown:this.setMouseDown,onMouseLeave:this.setMouseUp,onMouseMove:this.safeChangeVolume,onClick:this.changeVolume},o.createElement("div",{className:"volume-bar__container",ref:this.setVolumeBarRef},o.createElement("div",{className:"volume-bar__selected",style:t})))},t.prototype.render=function(){return o.createElement("div",{className:"toolbar-volume vertical-align"},o.createElement(r.PreviewAudioVolumeToggle,{isMuted:this.props.isMuted,onClick:this.props.onMuteToggle}),this.renderVolumeBar())},t})(o.Component);t.PreviewAudioVolume=a}),define("modules/clean/react/previews/audio/radio_illustration",["require","exports","external/react","modules/clean/react/image","modules/clean/static_urls"],function(e,t,n,o,i){"use strict";function r(){return n.createElement(o.Image,{src:i.static_url("/static/images/icons/music_placeholder-vflQRVA8i.png"),srcHiRes:i.static_url("/static/images/icons/music_placeholder@2x-vflHgCx1x.png")})}Object.defineProperty(t,"__esModule",{value:!0}),t.RadioIllustration=r}),define("modules/clean/react/previews/audio/utils",["require","exports","modules/clean/average_counter"],function(e,t,n){"use strict";function o(e,t,o,i,r){function a(e){return function(){if(e>=t)return void r(l);var c=[],u=Math.ceil(e*s.length/t),d=Math.ceil((e+1)*s.length/t),p=d-u;if(p>o)for(var f=0;f<o;f++){var h=Math.floor(Math.random()*p)+u;c.push(Math.abs(s[h]))}else for(var f=u;f<d;f++){var m=Math.floor(Math.abs(s[f]));c.push(m)}var v=new n.AverageCounter;v.addArray(c),l[e]=v.getAverage(),i()&&setTimeout(a(e+1),0)}}var s=e.getChannelData(0),l=new Array(t);setTimeout(a(0),0)}function i(e,t,o){void 0===o&&(o=1);var i=[];if(0===e.length||t<=0)return i;for(var r=[],a=0;a<t;a++)r.push(new n.AverageCounter);for(var s=0,l=0,a=0;a<e.length;a++){var c=e[a],u=Math.floor(a*t/e.length),d=r[u];d.add(c),i[u]=d.getAverage(),u!==l&&(s=Math.max(s,i[l]),l=u)}return s=Math.max(s,i[t-1]),i.map(function(e){return e*o/s})}Object.defineProperty(t,"__esModule",{value:!0}),t.buildFromBuffer=o,t.returnWaveform=i}),define("modules/clean/react/previews/audio/volume_toggle",["require","exports","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i){"use strict";function r(e){var t=e.isMuted,r=e.onClick,a=t?"volumeMuted":"volume",s=t?i._("Unmute"):i._("Mute");return n.createElement("div",{className:"toolbar-volume__button vertical-align__child"},n.createElement("button",{onClick:r,title:s},n.createElement(o.Sprite,{group:"web",name:a,alt:s})))}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewAudioVolumeToggle=r}),define("modules/clean/react/previews/error/image",["require","exports","external/react","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/static_urls"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorImage=function(e){var t,a=e.errorType;switch(a){case i.ErrorType.PendingUploadError:t=n.createElement(o.Image,{src:r.static_url("/static/images/previews/error/file_uploading_1x-vflRuLSg0.png"),srcHiRes:r.static_url("/static/images/previews/error/file_uploading_2x-vflKOdrWj.png")});break;case i.ErrorType.ExtensionError:t=n.createElement(o.Image,{src:r.static_url("/static/images/previews/error/filetype_not_supported_1x-vflmIVODZ.png"),srcHiRes:r.static_url("/static/images/previews/error/filetype_not_supported_2x-vflE8HW8X.png")});break;case i.ErrorType.FileSizeError:t=n.createElement(o.Image,{src:r.static_url("/static/images/previews/error/file_too_large_1x-vflDGNPuo.png"),srcHiRes:r.static_url("/static/images/previews/error/file_too_large_2x-vfl-r0UPt.png")});break;case i.ErrorType.PasswordProtectedError:t=n.createElement(o.Image,{src:r.static_url("/static/images/previews/error/password_protected_1x-vflnFAKjt.png"),srcHiRes:r.static_url("/static/images/previews/error/password_protected_2x-vflnBXZ1k.png")});break;case i.ErrorType.NeedFlashError:case i.ErrorType.SymLinkError:case i.ErrorType.EmptyFileError:case i.ErrorType.LoadError:default:t=n.createElement(o.Image,{src:r.static_url("/static/images/previews/error/unavailable_1x-vflG2AHMd.png"),srcHiRes:r.static_url("/static/images/previews/error/unavailable_2x-vflGPrE5d.png")})}return n.createElement("div",{className:"u-mar-bottom-s preview-error__image"},t)}}),define("modules/clean/react/previews/error/message",["require","exports","external/react","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/clean/react_format","modules/core/i18n"],function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorMessage=function(e){var t;if(e.message)t=e.message;else switch(e.errorType){case i.ErrorType.PendingUploadError:t=a._("File is uploading...");break;case i.ErrorType.EmptyFileError:t=a._("Empty files can’t be previewed");break;case i.ErrorType.ExtensionError:var s=o.getExtension(e.file);if(s){var l=o.isArchiveFile(e.file)&&e.file.preview_type?a._("<span>.%(extension)s</span> files can’t be previewed from an archive file.",{comment:"Like '.exe files can’t be previewed from an archive file'"}):a._("<span>.%(extension)s</span> files can’t be previewed.",{comment:"Like '.exe files can’t be previewed'"});t=r.reactFormat(l,{span:n.createElement("span",{className:"preview-error__message--bold"}),extension:s})}else t=a._("Files without an extension can’t be previewed");break;case i.ErrorType.FileSizeError:t=a._("This file is too big to preview");break;case i.ErrorType.PasswordProtectedError:t=a._("This file is password-protected");break;case i.ErrorType.NeedFlashError:t=r.reactFormat(a._("Install <a>Adobe Flash Player</a> to preview this video."),{a:n.createElement("a",{href:"https://get.adobe.com/flashplayer/"})});break;case i.ErrorType.SymLinkError:case i.ErrorType.LoadError:default:t=a._("This file can’t be previewed")}return n.createElement("div",{className:"preview-error__message"},t)}}),define("modules/clean/react/previews/error/preview_error",["require","exports","tslib","external/classnames","external/react","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/display_format","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/css","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/clean/web_timing_logger","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0})
;var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(v.set_tti_exclusion_flow("failed previews not included"),v.mark_time_to_view(),v.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===f.ErrorType.PendingUploadError&&this.props.shareToken){new l.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()}},Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!0,configurable:!0}),t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==f.ErrorType.LoadError&&this.props.errorType!==f.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(d.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})},t.prototype.render=function(){var e=this.props,t=e.count,n=e.errorType,a=e.file,l=e.index,c=e.maxFilenameEmLength,v=e.message,g=e.onNext,_=e.onPrevious,w=e.sharedLinkInfo,C=e.shareToken,S=e.sharePermission,E=e.shouldDisplayToolbar,A=e.user,T=s.Emstring.em_snippet(p.getFilename(a),c);return i.createElement("div",{className:o({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":E})},i.createElement("div",{className:"preview-error__wrapper"},i.createElement("div",{className:"preview-error__content"},i.createElement(h.PreviewErrorImage,{errorType:n}),i.createElement(m.PreviewErrorMessage,{file:a,errorType:n,message:v}),i.createElement(y,{filename:T,bytes:a.bytes}),this.props.areActionablesEnabled?i.createElement(u.Actionable,{allowOpenInApp:this.allowOpenInApp,file:a,variant:"primary",location:d.FileViewerPane.PreviewContent,sharedLinkInfo:w,shareToken:C,sharePermission:S,user:A,userActionContext:d.UserActionContext.PreviewContentMain}):null,this.props.errorType!==f.ErrorType.ExtensionError||p.isArchiveFile(this.props.file)?null:i.createElement(b,null)),E&&null!=l&&null!=t?i.createElement("div",{className:"preview-toolbar-container"},i.createElement(r.PreviewImageAnnotationsToolbar,{index:l,count:t,onPrevious:_,onNext:g})):null))},t.defaultProps={areActionablesEnabled:!0},t})(i.Component);t._PreviewError=_;var y=function(e){var t=e.bytes,n=e.filename;return i.createElement("div",{className:"preview-error__info"},n,void 0!==t?i.createElement("span",null,i.createElement("span",{className:"bottom-dot"}," · "),a.format_bytes(t)):null)},b=function(){return i.createElement("div",{className:"preview-error__help-link"},i.createElement("a",{href:d.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},g._("Learn more.")))},w=c(_,["/static/css/preview_error-vfl7lAXET.css"]);t.PreviewError=w}),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){var t=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com"],n=t.map(function(e){return"https://"+e});return n.push("null"),e.call(this,n)||this}return n.__extends(t,e),t})(o.FrameMessengerHost);t.PreviewFrameMessengerHost=i}),define("modules/clean/react/previews/image/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IMAGE_LARGE_PADDING_HEIGHT=148,t.IMAGE_LARGE_PADDING_WIDTH=72,t.IMAGE_PADDING_HEIGHT=50,t.IMAGE_PADDING_WIDTH=0}),define("modules/clean/react/previews/image_helpers",["require","exports","modules/constants/python","modules/clean/photos/thumbnail_url_util"],function(e,t,n,o){"use strict";function i(e,t){var i;return i=t?l.filter(function(e){var n=e[0],o=e[1];return n<=t[0]&&o<=t[1]}):l,i.map(function(t){var i=t[0],r=t[1];return o.thumbnailUrlForSize(e,i,r,n.THUMBNAIL_SIZE_MODE.ABSTRACT)+" "+i+"w"}).join(", ")}function r(e){return o.thumbnailUrlForSize(e,800,600,3)}function a(e){return s(r(e),{srcset:i(e),sizes:t.IMG_SIZES_ATTR})}function s(e,t){return new Promise(function(n,o){var i=Date.now(),r=new Image;r.onload=function(){n({started:i,completed:Date.now()})},r.onerror=function(){o({started:i,failed:Date.now()})},t&&(t.srcset&&(r.srcset=t.srcset),t.sizes&&(r.sizes=t.sizes)),r.src=e})}Object.defineProperty(t,"__esModule",{value:!0});var l=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]];t.IMG_SIZES_ATTR="90vw",t.getSrcSet=i,t.getFallbackSrc=r,t.preloadResponsiveImage=a,t.preloadImage=s}),define("modules/clean/react/previews/loading_indicator",["require","exports","external/classnames","external/react"],function(e,t,n,o){"use strict";function i(e){return o.createElement("div",{className:n("c-loader",e.className)})}Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingIndicator=i}),define("modules/clean/react/previews/pdf_viewer/placeholder_image",["require","exports","external/react","modules/clean/react/previews/image_helpers","modules/core/i18n"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaceholderImage=function(e){var t=e.url,r=e.onError,a=e.onLoad;return n.createElement("div",{className:"placeholder-image-wrapper"},n.createElement("div",{className:"placeholder-image-wrapper__border"},n.createElement("img",{className:"placeholder-image disabled-context-menu",alt:i._("Loading"),sizes:o.IMG_SIZES_ATTR,src:o.getFallbackSrc(t),srcSet:o.getSrcSet(t),onError:r,onLoad:a})))}}),define("modules/clean/react/previews/preview_html",["require","exports","tslib","external/react","external/react-dom","modules/clean/previews/constants","modules/clean/react/previews/constants","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=["failed","viewer-ready"],v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){switch(e.action){case"failed":t.logFilePreviewEvent(l.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(l.EventType.FilePreviewRenderFailed);var n=a.RivieraConvertResponseType.Unknown;e.parameters&&(n=e.parameters.rivieraStatusCode),t.props.onError&&t.props.onError(s.mapRivieraStatusToErrorType(n));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(l.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(l.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&t.frameMessenger.postMessageToChildren("disable-download"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height")}},t.handleIframeLoad=function(){t.logFilePreviewEvent(l.EventType.FilePreviewDownloadSucceeded),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(l.EventType.FilePreviewRenderSucceeded))},t.handleIframeError=function(){t.logFilePreviewEvent(l.EventType.FilePreviewDownloadFailed)},t.setRefIframe=function(e){t.iframe=e},t}return n.__extends(t,e),t.prototype.getIframeSrc=function(){var e=h.URI.parse(this.props.src);return this.props.previewType===r.PreviewType.Excel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:l.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return this.props.previewType===r.PreviewType.Excel&&f.is_mobile_or_tablet()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),p.mark_time_to_view(),p.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(l.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(l.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new c.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,m),this.frameMessenger.startListening());var e=i.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},t.prototype.render=function(){var e={};f.iOS&&(e=s.iOSIframeScrollStyles());var t=this.props,i=t.fileExtension,a=t.isFullscreen,c=t.previewType,p=t.sharePermission,h=t.sizeClass,m=c===r.PreviewType.Excel;return o.createElement("div",{className:"preview-content",style:e},o.createElement("iframe",n.__assign({},this.getIframeProps())),o.createElement(u.PreviewToolbarContainer,{elevateToolbar:m,isFullscreen:a,previewToolbarProps:{shouldDisplayRegionCreationButton:!1,docType:m?l.DocType.spreadsheet:l.DocType.html,fileExtension:i,isFullscreen:a,isSidebarOpen:!1,isHidden:h===d.SizeClass.Small,sharePermission:p,sizeClass:h,pagesCount:1},forceDisableRegionAnnotation:!0,shouldUseImageToolbar:!1}))},t.defaultProps={usesFrameMessenger:!0},t})(o.Component);t.PreviewHTML=v}),define("modules/clean/react/previews/preview_image",["require","exports","tslib","external/classnames","external/lodash","external/react","modules/clean/analytics","modules/clean/image_annotations","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/image_helpers","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/css","spectrum/dimensions"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v,g,_,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var b=(function(t){function _(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={width:"",height:"",zoomPercent:0,margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1,imageLoaded:!1,shouldShowLoadingIndicator:!1},e.showLoadingIndicator=i.debounce(function(){e.state.imageLoaded||e.setState({shouldShowLoadingIndicator:!0})},1e3),e.onImageLoad=function(){e.props.filePreviewSession&&e.props.filePreviewSession.markPrimaryEvent(),g.mark_time_to_view(),g.mark_time_to_interactive(),e.logFilePreviewEvent(d.EventType.FilePreviewDownloadSucceeded),e.logFilePreviewEvent(d.EventType.FilePreviewRenderSucceeded),e.setState({shouldLoadFullSizeImage:!!e.props.shouldDisplayToolbar,imageLoaded:!0}),e.hideLoadingIndicator(),e.props.shouldDisplayToolbar&&e.imageAnnotations.onImageLoad(),e.props.setRenderStatusSuccess(),null!=e.props.onLoad&&e.props.onLoad()},e.onFullImageLoad=function(){e.setState({zoomFit:!0,zoomPercent:0})},e.onImageClick=function(){e.shouldDisableZoom()||e.openFullscreen()},e.onImageDoubleClick=function(){e.shouldDisableZoom()&&e.props.sizeClass!==v.SizeClass.Small&&e.openFullscreen()},e.openFullscreen=function(){null!=e.props.isFullscreen?p.enterFullScreen(!1):e.previewImageZoom().open(e.props["preview-url"],e.props["file-extension"],e.props.onContextMenu,e.props.fileName)},e.onImageError=function(){e.logFilePreviewEvent(d.EventType.FilePreviewDownloadFailed),null!=e.props.onError&&e.props.onError()},e.onZoom=function(t,n,o){if(void 0===o&&(o=void 0),t+"px"!==e.state.width){if(void 0===o&&(o=e.calculateZoomPercent(n)),o<=e.minimumZoomPercent)return void e.onZoomFit();if(o>16){if(e.previewImageFullSize){var i=16*e.previewImageFullSize.naturalWidth,r=16*e.previewImageFullSize.naturalHeight;e.onZoom(i,r,16)}}else{var a=e.getImageDOMNode().width,s=t/a,c=l.getPreviewImageWrapper(),u=c.scrollLeft(),d=c.scrollTop(),p=c.width(),f=c.height(),h=p*(s-1)/2+u*s,m=f*(s-1)/2+d*s,v=n>=f?"0":"auto",g=t>=p?"0":"auto",_=v+" "+g;e.setState({shouldDisplayFullSizeImage:!!e.previewImageFullSize,width:t+"px",height:n+"px",margin:_,zoomPercent:o,zoomFit:!1},function(){c.scrollLeft(h),c.scrollTop(m),e.imageAnnotations.onResize(!1)})}}},e.onZoomIn=function(){e.zoomWithMultiplier(1.25)},e.onZoomOut=function(){e.zoomWithMultiplier(.8)},e.onZoomOriginalOrFit=function(){e.state.zoomFit?e.onZoomOriginal():e.onZoomFit()},e.onZoomOriginal=function(){if(e.previewImageFullSize){var t=e.previewImageFullSize.naturalWidth,n=e.previewImageFullSize.naturalHeight;e.onZoom(t,n)}},e.onZoomFit=function(){""!==e.state.width&&e.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){e.imageAnnotations.onResize(!1)})},e.onPrint=function(){u.imagePrint(c.fullSizeUrl(e.props["preview-url"]))},e.setPreviewImageRef=function(t){e.previewImage=t},e.setPreviewImageFullSizeRef=function(t){e.previewImageFullSize=t},e}return n.__extends(_,t),_.prototype.componentWillUnmount=function(){null==this.props.isFullscreen&&this.previewImageZoom().close(),null!=this.imageAnnotations&&this.imageAnnotations.reset(),this.hideLoadingIndicator()},_.prototype.componentWillMount=function(){this.imageAnnotations=new s.ImageAnnotations},_.prototype.componentDidMount=function(){this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted),this.logOpen();var t=this.getImageDOMNode();if(null!=t&&t.complete){var n=this.props,o=n.nsId,i=n.sjId,r=o+"_"+i;null!=o&&null!=i&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[r]?this.onImageError():this.onImageLoad()}this.showLoadingIndicator(),new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)})},_.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed,t),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted,t),this.logOpen(),this.props.shouldDisplayToolbar&&this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1,imageLoaded:!1}),this.showLoadingIndicator()}},Object.defineProperty(_.prototype,"minimumZoomPercent",{get:function(){if(!this.previewImageFullSize)return 0;var e=this.props,t=e.sizeClass,n=e.windowHeight,o=e.windowWidth,i=this.previewImageFullSize,r=i.naturalHeight,a=i.naturalWidth;if(!r||!a)return 0;var s=l.getImagePadding(t);return l.getMinimumZoomPercent({windowDimensions:{height:n,width:o},imagePadding:s,imageDimensions:{height:r,width:a}})},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"zoomPercent",{get:function(){return this.state.zoomFit?this.minimumZoomPercent:this.state.zoomPercent},enumerable:!0,configurable:!0}),_.prototype.hideLoadingIndicator=function(){this.showLoadingIndicator.cancel(),this.setState({shouldShowLoadingIndicator:!1})},_.prototype.previewImageZoom=function(){return e("modules/clean/react/previews/preview_image_zoom").PreviewImageZoom},_.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),null!=t&&t.recordEvent(e)},_.prototype.logOpen=function(){a.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},_.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.shouldDisplayToolbar||t===v.SizeClass.Small},_.prototype.getImageDOMNode=function(){return this.state.shouldDisplayFullSizeImage?this.previewImageFullSize:this.previewImage},_.prototype.zoomWithMultiplier=function(e){if(1!==e&&this.previewImageFullSize){var t=this.previewImageFullSize.width,n=this.previewImageFullSize.height,o=this.calculateZoomPercent(n),i=.05*Math.round(o*e/.05);if(Math.abs(i-o)<.05&&(e>1?i+=.05:i-=.05),!(i<0)){var r=i/o,a=Math.round(t*r),s=Math.round(n*r);this.onZoom(a,s,i)}}},_.prototype.calculateZoomPercent=function(e){if(!this.previewImageFullSize)return 0;var t=this.previewImageFullSize.naturalHeight;return e&&t?e/t:0},_.prototype.renderFullSizeImage=function(e){if(this.state.shouldLoadFullSizeImage){var t={"absolute-center":!0};t[""+l.PREVIEW_IMAGE]=this.state.shouldDisplayFullSizeImage,t=o(t);var i=n.__assign({},e);return this.state.shouldDisplayFullSizeImage||(i=n.__assign({},i,{visibility:"hidden"})),r.createElement("img",{alt:this.props.fileName,ref:this.setPreviewImageFullSizeRef,src:c.fullSizeUrl(this.props["preview-url"]),className:t,style:i,onClick:this.onImageClick,onDoubleClick:this.onImageDoubleClick,onLoad:this.onFullImageLoad})}},_.prototype.renderSmallImage=function(e){if(!this.state.shouldDisplayFullSizeImage){var t=this.props["preview-url"];return r.createElement("img",{ref:this.setPreviewImageRef,sizes:f.IMG_SIZES_ATTR,src:f.getFallbackSrc(t),srcSet:f.getSrcSet(t),className:o(l.PREVIEW_IMAGE,"absolute-center","preview-image-small",{"disabled-context-menu":!!this.props.onContextMenu}),style:e,onLoad:this.onImageLoad,onError:this.onImageError,onClick:this.onImageClick,onContextMenu:this.props.onContextMenu,onDoubleClick:this.onImageDoubleClick,alt:this.props.fileName})}},_.prototype.render=function(){var e=this.props,t=e.count,n=e.index,i=e.onNext,a=e.onPrevious,s=e.shouldDisplayToolbar,c=e.shouldDisableAnnotations,u=e.isFullscreen,d=this.state,p=d.height,f=d.imageLoaded,v=d.margin,g=d.shouldShowLoadingIndicator,_=d.width,y={};return _&&p&&s&&(y={height:p,margin:v,maxHeight:p,maxWidth:_,width:_}),f||(y={display:"none"}),r.createElement("div",{className:o((b={"flex-preview-container":!0,"image-visible":!0,"annotations-visible":!0,"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":s,"zoom-fit":this.state.zoomFit},b[l.PREVIEW_IMAGE_CONTAINER]=!0,b))},r.createElement("div",{className:l.PREVIEW_IMAGE_WRAPPER+" preview-content"},f||!g?null:r.createElement(h.LoadingIndicator,{className:"loading-indicator"}),this.renderFullSizeImage(y),this.renderSmallImage(y)),s?r.createElement(m.PreviewToolbarContainer,{forceDisableRegionAnnotation:c,isFullscreen:u,previewToolbarProps:{index:n,count:t,zoomPercent:this.zoomPercent,minimumZoomPercent:this.minimumZoomPercent,maximumZoomPercent:16,onPrevious:a,onNext:i,onFullscreen:this.openFullscreen,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,onZoomOriginalOrFit:this.onZoomOriginalOrFit,onPrint:this.onPrint},shouldUseImageToolbar:!0}):null);var b},_})(r.Component);t._PreviewImage=b;var w=function(e){return r.createElement(y.Dimensions,{className:"flex-preview-container"},function(t){var o=t.width,i=t.height;return r.createElement(b,n.__assign({},e,{windowHeight:i,windowWidth:o}))})},C=_(w,["/static/css/preview_image-vflhFqPwS.css"]);t.PreviewImage=C}),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","external/classnames","external/react","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css_timing","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadAttempted);var n={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(n.xhrFields={withCredentials:!0},r.SilentBackgroundRequest(n)):r.Request(n)},t.handleLinkDataSuccess=function(e){if(null==e.uri)return void t.handleLinkDataError();t.logFilePreviewEvent(c.EventType.FilePreviewDownloadSucceeded),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(c.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess()},t.handleLinkDataError=function(){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadFailed),t.markWebTiming(),t.state.isMounted&&t.setState({description:f._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){var n=u.get_redirect_uri(t.state.link);window.open(n.toString(),"_blank")}},t}return n.__extends(t,e),t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(c.EventType.FilePreviewSupportConfirmed),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},n={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},r="-",l="";null!=this.props.filename&&(r=s.filename_without_extension(this.props.filename),l=s.file_extension(this.props.filename),""!==l&&(l="."+l));var c=t.MAX_DISPLAYED_FILENAME_CHARS-l.length,u=a.Emstring.em_snippet(r,c),d="-";null!=this.state.description&&(d=this.state.description);var h={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},m=p.static_url("/static/images/icons128/page_white_linkfile-vfloEntlU.png");return i.createElement("div",{className:"flex-preview-container"},i.createElement("div",{className:"preview-content preview-content--center"},i.createElement("div",{className:"preview-linkfile-box"},i.createElement("div",{className:o(e)},i.createElement("div",{className:"preview-linkfile-icon"},i.createElement("img",{src:m,alt:""})),i.createElement("div",{className:"preview-linkfile-title"},i.createElement("span",{className:"preview-linkfile-filebase"},u),i.createElement("span",{className:"preview-linkfile-fileext"},l)),i.createElement("div",{className:"preview-linkfile-info"},i.createElement("div",{className:o(h)},d),i.createElement("button",{className:o(n),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},f._("Open in new tab")))))))},t.SPINNER_FADE_DELAY_MSEC=150,t.MAX_DISPLAYED_FILENAME_CHARS=21,t})(i.Component);t._PreviewLinkfile=h;var m=l.requireCssWithComponent(h,["/static/css/preview_linkfile-vflLAlKbW.css"]);t.PreviewLinkfile=m}),define("modules/clean/react/previews/preview_pdf_loadable",["require","exports","external/react","modules/clean/react/async/loadable","modules/clean/react/css_timing","modules/clean/react/previews/pdf_viewer/placeholder_image"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_pdf"],t,n)}).then(function(e){return e.PreviewPDF})},loading:function(e){var t=e.previewThumbnailUrl;return t?n.createElement("div",{className:"preview-pdf-ssr"},n.createElement("div",{className:"preview-ssr-viewer"},n.createElement(r.PlaceholderImage,{url:t}))):null}}),s=i.requireCssWithComponent(a,["/static/css/preview_pdf-vflazLfGD.css","/static/css/snackbar-vflLtw9Um.css"]);t.PreviewPDFLoadable=s}),define("modules/clean/react/previews/preview_toolbar_container",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarContainer=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_toolbar_container_component"],t,n)}).then(function(e){return e.PreviewToolbarContainer})}})}),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","external/keymaster","external/classnames","external/react","external/lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h="",m="previewzoomcontainer",v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipNext&&t.props.onFlipNext(),l.logUserAction(c.UserAction.FlipNext,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipPrevious&&t.props.onFlipPrevious(),l.logUserAction(c.UserAction.FlipPrevious,e)},t.onClick=function(e){var n="."+t.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close";s(e.target).is(n)||0!==s(e.target).parents(n).length||(e.preventDefault(),t.onCloseFactory({},c.UserActionContext.LightboxFrame))},t.onMouseMove=function(e){0===s(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,n){void 0===e&&(e={}),void 0===n&&(n=c.UserActionContext.LightboxCloseButton),l.logUserAction(c.UserAction.ToggleFullscreenOff,n),t.props.onClose()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),o("esc",m,function(){e.onCloseFactory({},c.UserActionContext.Keyboard)}),null!=this.props.zoomOutCallback&&o("space",m,this.props.zoomOutCallback),o("left",m,function(){e.startControlsTimer(),e.flipPrevious(c.UserActionContext.Keyboard)}),o("right",m,function(){e.startControlsTimer(),e.flipNext(c.UserActionContext.Keyboard)}),h=o.getScope(),o.setScope(m),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){o.setScope(m)},t.prototype.componentWillUnmount=function(){o.clearScope(m),o.setScope(h),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.hideControls()},3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.fileCount?r.createElement(u.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props.renderZoomControls,t=i({"preview-toolbar-container":!0,hidden:this.state.controlsHidden});return r.createElement("div",{className:t,ref:"previewZoomerToolbarContainer"},r.createElement("div",{className:"preview-toolbar-overlay-container"},r.createElement("div",{className:"preview-toolbar-overlay"},r.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),e?r.createElement("div",{className:i({"toolbar-button-entry":!0,"zoom-out":!0,disabled:this.props.zoomOutDisabled}),ref:"zoomControlZoomOut"},r.createElement(d.Sprite,{alt:f._("Zoom out"),group:"web",name:"zoomout"})):null,e?r.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer"},r.createElement(p.TitleBubble,{content:f._("View actual size"),position:p.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},r.createElement("span",{className:"zoom-label",ref:"zoomLabel"}))):null,e?r.createElement("div",{className:i({"toolbar-button-entry":!0,"zoom-in":!0,disabled:this.props.zoomInDisabled}),ref:"zoomControlZoomIn"},r.createElement(d.Sprite,{alt:f._("Zoom in"),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=i({"preview-zoomer-close":!0,hidden:this.state.controlsHidden});return r.createElement("span",null,r.createElement("button",{"aria-label":f._("Close"),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},r.createElement(d.Sprite,{alt:f._("Close"),group:"web",name:"xclose"})))},t.prototype.render=function(){var e=i({"preview-zoomer-container":!0,"zoomer-drag-disabled":this.props.dragDisabled});return r.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t})(r.Component);t.PreviewZoomContainer=v}),define("modules/clean/react/previews/quality_popup/constants",["require","exports"],function(e,t){"use strict";function n(e){return i[e]}Object.defineProperty(t,"__esModule",{value:!0});var o;(function(e){e[e.POPUP=0]="POPUP",e[e.FEEDBACK_MODAL=1]="FEEDBACK_MODAL"})(o=t.QualityPopupStage||(t.QualityPopupStage={}));var i=[];i[o.POPUP]="popup",i[o.FEEDBACK_MODAL]="feedback_modal",t.getPopupStageLoggerKey=n,t.BooleanAnswers={YES:"Y",NO:"N"}}),define("modules/clean/react/previews/quality_popup/preview_quality_popup",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewQualityPopup=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/quality_popup/preview_quality_popup_component"],t,n)}).then(function(e){return e.PreviewQualityPopup})}})}),define("modules/clean/react/previews/quality_popup/questions",["require","exports","modules/core/i18n","modules/constants/file_viewer"],function(e,t,n,o){"use strict";function i(e,t){var n=h[e];return"ALL_EXTENSIONS"===n||n.indexOf(t)>-1}function r(e){var t=o.PREVIEW_QUALITY_POPUP_QUESTION;if(!f.hasOwnProperty(t))return null;var n=f[t];return i(n,e)?n:null}function a(e){return!!m[e]}function s(e,t){return v[e][t]||v[e].ALL_EXTENSIONS}function l(e){return E[e]}Object.defineProperty(t,"__esModule",{value:!0});var c;(function(e){e[e.LOOK_GOOD=0]="LOOK_GOOD",e[e.LOAD_QUICKLY=1]="LOAD_QUICKLY",e[e.FEEDBACK=2]="FEEDBACK",e[e.DONATE=3]="DONATE"})(c=t.Questions||(t.Questions={}));var u=["3gp","3gpp","3gpp2","asf","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpg","mpeg","mts","oggtheora","ogv","rm","ts","vob","webm","wmv"],d=["jpg","jpeg","png","tiff","tif","gif","bmp","webp","wbmp"],p=["flac","oga","m4a","mp3","wma","aac","wav"],f={};f.LOOK_GOOD=c.LOOK_GOOD,f.LOAD_QUICKLY=c.LOAD_QUICKLY;var h={};h[c.LOOK_GOOD]="ALL_EXTENSIONS",h[c.LOAD_QUICKLY]="ALL_EXTENSIONS";var m=[];m[c.LOOK_GOOD]=!0;var v=[];v[c.LOOK_GOOD]={};for(var g=0,_=p;g<_.length;g++){var y=_[g];v[c.LOOK_GOOD][y]=n._("Does this audio preview sound okay?")}for(var b=0,w=u;b<w.length;b++){var y=w[b];v[c.LOOK_GOOD][y]=n._("Does this video preview look okay?")}for(var C=0,S=d;C<S.length;C++){var y=S[C];v[c.LOOK_GOOD][y]=n._("Does this image preview look okay?")}v[c.LOOK_GOOD].ALL_EXTENSIONS=n._("Does this file preview look okay?"),v[c.LOAD_QUICKLY]={},v[c.LOAD_QUICKLY].ALL_EXTENSIONS=n._("Did this preview load quickly?");var E=[]
;E[c.LOOK_GOOD]="look_good",E[c.LOAD_QUICKLY]="load_quickly",E[c.FEEDBACK]="feedback",E[c.DONATE]="donate",t.isQuestionAllowed=i,t.getQuestionToAsk=r,t.shouldShowFeedbackModal=a,t.getQuestionWording=s,t.getQuestionLoggerKey=l}),define("modules/clean/react/previews/video/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.PlayerRendered="player_rendered",e.FirstClickPlay="first_click_play",e.ChangePlaybackRate="change_playback_rate",e.ChangeVideoQuality="change_video_quality",e.EnterFullscreen="enter_fullscreen",e.ClosePreview="close_preview",e.SeekVideo="seek_video",e.VideoStartsPlaying="video_starts_playing",e.VideoStalled="video_stalled",e.VideoSegmentFailure="video_segment_failure",e.ScrubberThumbnailsLoaded="scrubber_thumbnails_loaded",e.ScrubberThumbnailsFailed="scrubber_thumbnails_failed",e.AudioWaveformLoaded="audio_waveform_loaded",e.AudioWaveformFailed="audio_waveform_failed"})(t.VideoPreviewEvent||(t.VideoPreviewEvent={})),t.HdLabels=["1080p","720p"],t.QualityLabelOrder=t.HdLabels.concat(["480p","360p","240p"]).reverse()}),define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","external/react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],function(e,t,n,o,i,r,a){"use strict";function s(e){return e.sourceContext!==a.PreviewSourceContext.EmbeddedSharedLinkFile?o.createElement(r.PreviewVideoComments2,n.__assign({},e)):o.createElement(i.PreviewVideoBasic,n.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideoProps=i.PreviewVideoProps,t.PreviewVideo=s}),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","external/classnames","external/lodash","external/react","jquery","modules/clean/image_size","modules/clean/keycode","modules/clean/loggers/file_preview_logger","modules/clean/loggers/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/video/constants","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/full_screen_helpers"],function(e,t,n,o,i,r,a,s,l,c,u,d,p,f,h,m,v,g,_,y,b,w,C,S,E,A,T){"use strict";function P(){return"v2"===A.cssVersion()?"/static/css/video-js-5-custom-v2-vflFbcj4d.css":"/static/css/video-js-5-custom-v1-vflzWLOoT.css"}function x(e){return E.URI.parse(e).updateQuery({size:s.imageBestFitSize(a(window).width(),a(window).height()),size_mode:"2"}).toString()}Object.defineProperty(t,"__esModule",{value:!0});var k=p.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/video/video_player"],t,n)}).then(function(e){return e.VideoPlayer})}}),R=(function(e){function t(t){var n=e.call(this,t)||this;return n.lastPlaybackRate=1,n.checkRenderSucceeded=function(e){"hls"===n.props.videoContainer&&!e&&i.every(n.successFlags)&&n.markRenderSucceeded()},n.onEmbed=function(){n.logFilePreviewTimelineEvent(h.EventType.FilePreviewSupportConfirmed),n.logFilePreviewTimelineEvent(h.EventType.FilePreviewDownloadAttempted)},n.onLoadedMetadata=function(e){void 0===e&&(e=0),n.videoLogger.populateVideoDuration(e)},n.onCanPlay=function(){n.markRenderSucceeded()},n.onReady=function(e){void 0===e&&(e=!1),n.logFilePreviewTimelineEvent(h.EventType.FilePreviewDownloadSucceeded),n.successFlags.playerReady=!0,n.checkRenderSucceeded(e),n.props.filePreviewSession&&n.props.filePreviewSession.markPrimaryEvent(),C.mark_time_to_view(),C.mark_time_to_interactive(),n.videoLogger.logEvent(w.VideoPreviewEvent.PlayerRendered)},n.onPlay=i.once(function(){n.markRenderSucceeded(),n.videoLogger.logEvent(w.VideoPreviewEvent.FirstClickPlay)}),n.onStartsPlaying=i.once(function(e){n.videoLogger.logEvent(w.VideoPreviewEvent.VideoStartsPlaying,{play_latency:e.toString()})}),n.onUserInactive=function(e){e!==n.lastPlaybackRate&&(n.lastPlaybackRate=e,n.logUserAction(h.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},n.onScrubberThumbnailsLoaded=function(e){e?n.videoLogger.logEvent(w.VideoPreviewEvent.ScrubberThumbnailsLoaded):n.videoLogger.logEvent(w.VideoPreviewEvent.ScrubberThumbnailsFailed)},n.onAudioWaveformLoaded=function(){n.videoLogger.logEvent(w.VideoPreviewEvent.AudioWaveformLoaded)},n.onAudioWaveformFailed=function(){n.videoLogger.logEvent(w.VideoPreviewEvent.AudioWaveformFailed)},n.onError=function(e){if("needflash"===e)return n.logFilePreviewTimelineEvent(h.EventType.FilePreviewSupportDenied),void("function"==typeof n.props.onError&&n.props.onError(y.ErrorType.NeedFlashError));n.logFilePreviewTimelineEvent(h.EventType.FilePreviewDownloadFailed),C.mark_time_to_view(),C.mark_time_to_interactive(),n.props.onError&&n.props.onError(y.ErrorType.LoadError)},n.onPlaybackRateChange=function(e,t){n.videoLogger.logEvent(w.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:t.toString()})},n.onSeek=function(e,t){n.videoLogger.logEvent(w.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),new_video_time:t.toString()})},n.onStalled=function(e,t){n.videoLogger.logEvent(w.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:t.toString()})},n.onTruncated=function(){m.filePreviewEventEmitter.emit(h.EventType.FilePreviewVideoTruncated),n.videoLogger.setVideoTruncated()},n.onThumbLoad=function(e){void 0===e&&(e=!1),n.successFlags.thumbLoaded=!0,n.checkRenderSucceeded(e)},n.onClose=function(e){n.videoLogger.logEvent(w.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},n.onSelectQuality=function(e,t){n.videoLogger.logEvent(w.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:t})},n.handleKeyPress=function(e){return e.keyCode===l.KeyCode.SPACE&&(n.togglePlayback(),e.preventDefault(),!0)},n.keyboardBindings=[{keyboardEventCriteria:g.generateUnmodifiedKeyboardEventCriteria(l.KeyCode.SPACE),callback:n.handleKeyPress}],n.processGutterClick=function(e){var t=n.props.onGutterClick;t&&e.target===e.currentTarget&&t()},n.successFlags={thumbLoaded:!1,playerReady:!1},n}return n.__extends(t,e),t.prototype.setUpLoggers=function(){this.teardownLoggers(),this.userActionLogger=new c.FilePreviewUserActionLogger,this.userActionLogger.listenTo(m.filePreviewEventEmitter),this.videoLogger=new u.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)},t.prototype.teardownLoggers=function(){this.userActionLogger&&(this.userActionLogger.unlistenTo(m.filePreviewEventEmitter),delete this.userActionLogger)},t.prototype.logFilePreviewTimelineEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.logUserAction=function(e,t){m.filePreviewEventEmitter.emit(h.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,h.UserActionContext.VideoPlayer,t)},t.prototype.markRenderSucceeded=function(){this.logFilePreviewTimelineEvent(h.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()},t.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},t.prototype.componentDidMount=function(){this.setUpLoggers()},t.prototype.componentWillUnmount=function(){this.teardownLoggers()},t.prototype.shouldComponentUpdate=function(e){return v.compareStateAndProps(e,{})},t.prototype.componentDidUpdate=function(e){this.props.isFullscreen&&!e.isFullscreen&&this.videoLogger.logEvent(w.VideoPreviewEvent.EnterFullscreen)},t.prototype.togglePlayback=function(){m.filePreviewEventEmitter.emit(h.EventType.FilePreviewVideoToggled)},t.prototype.render=function(){var e=this.props,t=e.title,i=e.isFullscreen,a=e.previewUrl,s=e.sourceContext,l=e.thumbnailUrlTmpl,c=e.videoMetadataUrl,u=e.videoContainer,p=e.vttThumbnailsUrl,f=A.video_type(u),h=s!==y.PreviewSourceContext.EmbeddedSharedLinkFile,m=!1,v=!1,g=0;S.is_mobile_or_tablet()&&(m=!0,v=!0,g=1);var w={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:v,playsinline:g};null!=l&&(w.poster=d.tagCriticalPathContentRequest(x(l),this.props.filePreviewSession));var C={src:a,sourceContentType:f,metadataLink:c,title:t,vttThumbnailsUrl:p},E={onLoadedMetadata:this.onLoadedMetadata,onCanPlay:this.onCanPlay,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onStartsPlaying:this.onStartsPlaying,onThumbLoad:this.onThumbLoad,onUserInactive:this.onUserInactive,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onAudioWaveformLoaded:this.onAudioWaveformLoaded,onAudioWaveformFailed:this.onAudioWaveformFailed,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},P={videoProps:C,playerCallbacks:E,playerOptions:w,seekPosition:this.props.seekPosition,shouldEnableControls:!this.props.hideControls,noDownload:m,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:h,isAudio:this.props.isAudio,audioUrl:this.props.audioUrl,bytes:this.props.bytes,showOnboarding:!!this.props.showOnboarding};return i?r.createElement(b.PreviewZoomContainer,{renderZoomControls:!1,onClose:T.exitFullScreen,containerClass:"video-player"},this.props.disableKeyboardShortcuts?null:r.createElement(_.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.createElement(k,n.__assign({},P))):r.createElement("div",{className:o({"flex-preview-container":!0,"touch-device":S.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:r.createElement(_.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.createElement("div",{className:"preview-content preview-video",onClick:this.processGutterClick},r.createElement("div",{className:"preview-video__wrapper"},r.createElement("div",{className:o({"preview-video__aspect-container":!0,"preview-audio-transcoded":this.props.isAudio})},r.createElement("div",{className:"preview-video__container"},r.createElement(k,n.__assign({},P)))))))},t})(r.Component);t._PreviewVideoBasic=R;var O=f(R,["/static/css/preview_video-vfljF09ZK.css",P()]);t.PreviewVideoBasic=O}),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/selectors","modules/clean/react/previews/video/preview_video_basic"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(){return function(e){e(r.deactivateAllThreads())}}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedPreviewVideoComments2=i.connect(function(e){return{showOnboarding:s.getShowOnboardingOnVideo(e)}},{onTimeUpdate:r.Actions.updatePlayerCurrentTime,onGutterClick:c})(l.PreviewVideoBasic);var u=(function(e){function r(t){var n=e.call(this,t)||this;return n.store=a.getStoreForComments2(),n}return n.__extends(r,e),r.prototype.render=function(){return o.createElement(i.Provider,{store:this.store},o.createElement(t.ConnectedPreviewVideoComments2,n.__assign({},this.props)))},r})(o.PureComponent);t.PreviewVideoComments2=u}),define("modules/clean/react/previews/video/utils",["require","exports","modules/constants/file_viewer","modules/core/browser"],function(e,t,n,o){"use strict";function i(e){return n.VIDEO_PREVIEWS.indexOf(e)!==-1}function r(){return i("REFACTOR")?"v2":"v1"}function a(){return"v2"===r()&&i("SETTINGS")}function s(e){return n.VIDEO_OVERRIDE_NATIVE_HLS||e===d&&o.is_android()}function l(){return n.VIDEO_QUALITY_NATIVE_HLS&&(o.edge||o.safari)}function c(){return"OFF"!==n.HLS_AUDIO}function u(e){return"webm"===e?"video/webm":d}Object.defineProperty(t,"__esModule",{value:!0}),t.checkVariant=i,t.cssVersion=r,t.shouldShowNewSettingsMenu=a,t.shouldAllowThumbnailsOnScrubbing=function(){return i("THUMBNAILS")},t.shouldOverrideNativeHls=s,t.showQualityNativeHls=l,t.isHlsAudio=c;var d="application/vnd.apple.mpegurl";t.video_type=u}),define("modules/clean/react/share_download/button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadSimpleButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(function(e){return e.DownloadSimpleButton})}}),t.ShareDownloadButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(function(e){return e.ShareDownloadButton})}})}),define("modules/clean/shallow_equal",["require","exports"],function(e,t){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function o(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(var a=0;a<o.length;a++)if(!i.call(t,o[a])||!n(e[o[a]],t[o[a]]))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.prototype.hasOwnProperty;t.shallowEqual=o}),define("modules/core/type",["require","exports","external/lodash"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t){if(!n.isString(e)&&!n.isFunction(e))throw new TypeError("First parameter needs to be a string identifying the type");if(!n.isFunction(t))throw new TypeError("Second parameter needs to be a predicate defining the type");n.isFunction(e)?this.getTypeString=e:this.getTypeString=function(){return e},this.predicate=t}return e})();t.Type=o;var i=function(e){if(t.isBasicType(e))return!0;if(e instanceof o)return!0;if(n.isFunction(e))return!0;if(n.isArray(e)){if(1!==e.length)return!1;if(!i(e[0]))return!1}else{if(!(n.isObject(e)&&null==e.prototype&&e.constructor===Object&&Object.keys(e).length>0))return!1;for(var r in e){if(!i(e[r]))return!1}}return!0},r=(function(){var e=new o("undefined",n.isUndefined),t=new o("null",n.isNull),r=new o("Boolean",n.isBoolean),a=new o("Number",n.isNumber),s=new o("String",n.isString),l=new o("Object",function(e){return n.isObject(e)&&!n.isFunction(e)&&!n.isArray(e)}),c=new o("Type",i);return function(n){return void 0===n?e:null===n?t:n===Boolean?r:n===Number?a:n===String?s:n===Object?l:n===o?c:void 0}})();t.isBasicType=function(e){return null!=r(e)},t.firstFailingKeypath=function(e,i,a){if(null==a&&(a=[]),t.isBasicType(e)){if(!r(e).predicate(i))return a}else if(e instanceof o){if(!e.predicate(i))return a}else if(n.isFunction(e)){if(!(i instanceof e))return a}else if(n.isArray(e)){if(t.firstFailingKeypath(Array,i,a))return a;for(var s=0;s<i.length;s++){var l=i[s];if(a.push(s),t.firstFailingKeypath(e[0],l,a))return a;a.pop()}}else{if(t.firstFailingKeypath(Object,i,a))return a;for(var c=Object.keys(e),u=Object.keys(i),d=0,p=Array.from(n.difference(c,u));d<p.length;d++){var f=p[d];if(t.firstFailingKeypath(e[f],void 0,a))return a}for(var h=0,m=Array.from(n.intersection(u,c));h<m.length;h++){var f=m[h];if(a.push(f),t.firstFailingKeypath(e[f],i[f],a))return a;a.pop()}}},t.checkType=function(e,n){return null==t.firstFailingKeypath(e,n)},t.getTypeString=function(e){if(t.isBasicType(e))return r(e).getTypeString();if(e instanceof o)return e.getTypeString();if(n.isFunction(e))return e.name;if(n.isArray(e))return"["+t.getTypeString(e[0])+"]";var i=[];for(var a in e){var s=e[a];i.push(a+": "+t.getTypeString(s))}return"{"+i.join(", ")+"}"}}),define("modules/core/types",["require","exports","tslib","external/lodash","modules/core/type"],function(e,t,n,o,i){"use strict";function r(e,t){var n=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var r=t.apply(this,n),a=i.firstFailingKeypath(e,r);if(null!=a){var s=c(0,a,e,r);throw new TypeError(s)}return r};return t.isTypeChecked&&(n.isTypeChecked=!0),n}var a=(function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}})(),s=(function(e){function t(t){return e.call(this,i.getTypeString.bind(null,t),i.checkType.bind(null,t))||this}return n.__extends(t,e),t})(i.Type),l=function(e,t){if(i.isBasicType(e));else if(e instanceof i.Type)null!=e.parameter_types&&o.isFunction(t)&&!t.isTypeChecked&&(t=u.apply(void 0,Array.from(e.parameter_types).concat([t])));else if(o.isFunction(e));else if(o.isArray(e))for(var n=0;n<t.length;n++){var r=t[n],a=l(e[0],r);a!==r&&(t=t.slice(),t[n]=a)}else for(var s in e){var c=e[s],d=l(c,t[s]);d!==t[s]&&(t=o.clone(t),t[s]=d)}return t},c=function(e,t,n,r){for(var a,s=0,l=Array.from(t);s<l.length;s++){var c=l[s];r=r[c],n=o.isArray(n)?n[0]:n[c]}return t.length>0&&(a=", key "+t.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(r,null,"  ")+" doesn't match type "+i.getTypeString(n)},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1),r=e.slice(0,n-1),a=e[n-1],u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r,u=o.find(r,function(e){return e instanceof s});if(null!=u){var d=n.indexOf(u),p=Math.max(e.length-n.length+1,0),f=[d,1];o.times(p,function(){return f.push(u)}),n=n.slice(),n.splice.apply(n,Array.from(f||[]))}for(var h=0;h<n.length;h++){var m=n[h],v=i.firstFailingKeypath(m,e[h]);if(null!=v){var g=c(h,v,m,e[h]);throw new TypeError(g)}e[h]=l(m,e[h])}return a.apply(this,e)};return u.isTypeChecked=!0,u},d=function(e){if(e instanceof i.Type&&e.isOptional||e instanceof s)return e;var t=function(){return"?"+i.getTypeString(e)},n=function(t){return null==t||i.checkType(e,t)},o=new i.Type(t,n);return e instanceof i.Type&&null!=e.parameter_types&&(o.parameter_types=e.parameter_types),o.isOptional=!0,o},p=function(e){return new s(e)},f={takes:r(Function,u(p(i.Type),Function,u)),returns:r(Function,u(i.Type,Function,r)),Maybe:r(i.Type,u(i.Type,d)),Any:new i.Type("Any",function(e){return!0})};return a||(f.takes=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]},f.returns=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]}),f}),define("spectrum_signatures/field_placer",["require","exports","tslib","react","react-rnd"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i.Rnd,a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={x:0,y:0,width:0,height:0},t.handleDrag=function(e,n){t.updateState(n.x,n.y)},t.handleDragStop=function(e,n){t.props.onDrag&&t.props.onDrag(n.x,n.y)},t.handleResize=function(e,n,o,i,r){t.updateState(r.x,r.y,parseInt(o.style.width,10),parseInt(o.style.height,10))},t.handleResizeStop=function(e,n,o,i,r){t.props.onResize&&t.props.onResize(parseInt(o.style.width,10),parseInt(o.style.height,10),r.x,r.y)},t}return n.__extends(t,e),t.prototype.updateState=function(e,t,n,o){this.setState({x:e||this.props.x,y:t||this.props.y,width:n||this.props.width,height:o||this.props.height})},t.prototype.componentDidMount=function(){this.updateState()},t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.x,o=t.y,i=t.width,r=t.height;n===e.x&&o===e.y&&i===e.width&&r===e.height||this.updateState()},t.prototype.render=function(){var e=this.props.children;return o.createElement(r,{className:"esignature-field",style:{backgroundColor:this.props.color},size:{width:this.state.width,height:this.state.height},position:{x:this.state.x,y:this.state.y},onDrag:this.handleDrag,onDragStop:this.handleDragStop,onResize:this.handleResize,onResizeStop:this.handleResizeStop},o.createElement("div",{className:"esignature-field-body"},e))},t})(o.PureComponent);t.FieldPlacer=a}),define("spectrum_signatures/field_selector",["require","exports","tslib","classnames","react","spectrum/button","spectrum/icon_chooser","spectrum/popover"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleSelection=function(e){n.setState({selected:e.value}),n.props.onSelect(e)},n.state={selected:t.options.length>0?t.options[0].value:""},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=(this.props.options,this.props.options.map(function(t){var n=t.value,r=t.color,l=n===e.state.selected;return i.createElement(s.PopoverContentItem,{className:"esignature-field-selector-button",key:n,value:t},i.createElement("div",{className:o({"esignature-field-selector-option":!0,"esignature-field-selector-option__selected":l})},i.createElement("div",{className:"esignature-field-selector-option-color",style:{backgroundColor:r}}),n),l?i.createElement(a.IconChooser,{className:"esignature-selected-icon",name:"selected-check"}):null)}));return i.createElement(s.Popover,{onSelection:this.handleSelection},i.createElement(s.PopoverTrigger,{className:"esignature-field-selector-popover-trigger"},i.createElement(r.Button,{className:"esignature-field-selector-popover-button",variant:"styleless"},this.state.selected+" ▾")),i.createElement(s.PopoverContent,{className:"esignature-field-selector-popover-content",position:"above"},i.createElement("div",{className:"esignature-field-selector"},i.createElement(s.PopoverContentTitle,{className:"esignature-field-selector-header"},"ADD FIELDS FOR"),t)))},t})(i.Component);t.FieldSelector=l}),define("re-resizable",["require","exports","module","react"],function(e,t,n){"use strict";var o=e("react"),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=(function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}})(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c={base:{position:"absolute",userSelect:"none",MsUserSelect:"none"},top:{width:"100%",height:"10px",top:"-5px",left:"0px",cursor:"row-resize"},right:{width:"10px",height:"100%",top:"0px",right:"-5px",cursor:"col-resize"},bottom:{width:"100%",height:"10px",bottom:"-5px",left:"0px",cursor:"row-resize"},left:{width:"10px",height:"100%",top:"0px",left:"-5px",cursor:"col-resize"},topRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",top:"-10px",cursor:"ne-resize"},bottomRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",bottom:"-10px",cursor:"se-resize"},bottomLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",bottom:"-10px",cursor:"sw-resize"},topLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",top:"-10px",cursor:"nw-resize"}},u=function(e){return o.createElement("div",{className:e.className,style:a({},c.base,c[e.direction],e.replaceStyles||{}),onMouseDown:function(t){e.onResizeStart(t,e.direction)},onTouchStart:function(t){e.onResizeStart(t,e.direction)}},e.children)},d={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},p={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"},f=function(e,t,n){return Math.max(Math.min(e,n),t)},h=function(e,t){return Math.round(e/t)*t},m=function(e,t){return e.substr(e.length-t.length,t.length)===t},v=function(e){return m(e.toString(),"px")?e.toString():m(e.toString(),"%")?e.toString():e+"px"},g=["style","className","grid","bounds","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent"],_=(function(e){function t(e){i(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isResizing:!1,resizeCursor:"auto",width:void 0===(n.propsSize&&n.propsSize.width)?"auto":n.propsSize&&n.propsSize.width,height:void 0===(n.propsSize&&n.propsSize.height)?"auto":n.propsSize&&n.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0}},n.updateExtendsProps(e),n.onResizeStart=n.onResizeStart.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),"undefined"!=typeof window&&(window.addEventListener("mouseup",n.onMouseUp),window.addEventListener("mousemove",n.onMouseMove),window.addEventListener("mouseleave",n.onMouseUp),window.addEventListener("touchmove",n.onMouseMove),window.addEventListener("touchend",n.onMouseUp)),n}return s(t,e),r(t,[{key:"updateExtendsProps",value:function(e){this.extendsProps=Object.keys(e).reduce(function(t,n){return g.indexOf(n)!==-1?t:(t[n]=e[n],t)},{})}},{key:"getParentSize",value:function(){var e=this.base;if(!e)return{width:window.innerWidth,height:window.innerHeight};var t=!1,n=this.parentNode.style.flexWrap,o=e.style.minWidth;"wrap"!==n&&(t=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%";var i={width:e.offsetWidth,height:e.offsetHeight};return e.style.position="absolute",t&&(this.parentNode.style.flexWrap=n),e.style.minWidth=o,i}},{key:"componentDidMount",value:function(){var e=this.size;this.setState({width:this.state.width||e.width,height:this.state.height||e.height});var t=this.parentNode;if(t instanceof HTMLElement&&!this.base){var n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.position="absolute",n.style.transform="scale(0, 0)",n.style.left="-2147483647px",n.style.flex="0",n.classList?n.classList.add("__resizable_base__"):n.className+="__resizable_base__",t.appendChild(n)}}},{key:"componentWillReceiveProps",value:function(e){this.updateExtendsProps(e)}},{key:"componentWillUnmount",value:function(){if("undefined"!=typeof window){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseleave",this.onMouseUp),window.removeEventListener("touchmove",this.onMouseMove),window.removeEventListener("touchend",this.onMouseUp);var e=this.parentNode,t=this.base;if(!t||!e)return;if(!(e instanceof HTMLElement&&t instanceof Node))return;e.removeChild(t)}}},{key:"calculateNewSize",value:function(e,t){var n=this.propsSize&&this.propsSize[t];return"auto"!==this.state[t]||this.state.original[t]!==e||void 0!==n&&"auto"!==n?e:"auto"}},{key:"onResizeStart",value:function(e,t){var n=0,o=0;if(e.nativeEvent instanceof MouseEvent){if(n=e.nativeEvent.clientX,o=e.nativeEvent.clientY,3===e.nativeEvent.which)return}else e.nativeEvent instanceof TouchEvent&&(n=e.nativeEvent.touches[0].clientX,o=e.nativeEvent.touches[0].clientY);this.props.onResizeStart&&this.props.onResizeStart(e,t,this.resizable),this.props.size&&(void 0!==this.props.size.height&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),void 0!==this.props.size.width&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.setState({original:{x:n,y:o,width:this.size.width,height:this.size.height},isResizing:!0,resizeCursor:window.getComputedStyle(e.target).cursor,direction:t})}},{key:"onMouseMove",value:function(e){if(this.state.isResizing){var t=e instanceof MouseEvent?e.clientX:e.touches[0].clientX,n=e instanceof MouseEvent?e.clientY:e.touches[0].clientY,o=this.state,i=o.direction,r=o.original,a=o.width,s=o.height,l=this.props,c=l.lockAspectRatio,u=l.lockAspectRatioExtraHeight,d=l.lockAspectRatioExtraWidth,p=this.props,v=p.maxWidth,g=p.maxHeight,_=p.minWidth,y=p.minHeight,b=this.getParentSize();if(v&&"string"==typeof v&&m(v,"%")){var w=Number(v.replace("%",""))/100;v=b.width*w}if(g&&"string"==typeof g&&m(g,"%")){var C=Number(g.replace("%",""))/100;g=b.height*C}if(_&&"string"==typeof _&&m(_,"%")){var S=Number(_.replace("%",""))/100;_=b.width*S}if(y&&"string"==typeof y&&m(y,"%")){var E=Number(y.replace("%",""))/100;y=b.height*E}v=void 0===v?void 0:Number(v),g=void 0===g?void 0:Number(g),_=void 0===_?void 0:Number(_),y=void 0===y?void 0:Number(y);var A="number"==typeof c?c:r.width/r.height,T=r.width,P=r.height;if(/right/i.test(i)&&(T=r.width+(t-r.x),c&&(P=(T-d)/A+u)),/left/i.test(i)&&(T=r.width-(t-r.x),c&&(P=(T-d)/A+u)),/bottom/i.test(i)&&(P=r.height+(n-r.y),c&&(T=(P-u)*A+d)),/top/i.test(i)&&(P=r.height-(n-r.y),c&&(T=(P-u)*A+d)),"parent"===this.props.bounds){var x=this.parentNode;if(x instanceof HTMLElement){var k=x.getBoundingClientRect(),R=k.left,O=k.top,I=this.resizable.getBoundingClientRect(),M=I.left,F=I.top,D=x.offsetWidth+(R-M),N=x.offsetHeight+(O-F);v=v&&v<D?v:D,g=g&&g<N?g:N}}else if("window"===this.props.bounds){if("undefined"!=typeof window){var L=this.resizable.getBoundingClientRect(),U=L.left,z=L.top,H=window.innerWidth-U,B=window.innerHeight-z;v=v&&v<H?v:H,g=g&&g<B?g:B}}else if(this.props.bounds instanceof HTMLElement){var V=this.props.bounds.getBoundingClientRect(),q=V.left,j=V.top,W=this.resizable.getBoundingClientRect(),K=W.left,G=W.top;if(!(this.props.bounds instanceof HTMLElement))return;var Y=this.props.bounds.offsetWidth+(q-K),Z=this.props.bounds.offsetHeight+(j-G);v=v&&v<Y?v:Y,g=g&&g<Z?g:Z}var Q=void 0===_?10:_,X=void 0===v||v<0?T:v,J=void 0===y?10:y,$=void 0===g||g<0?P:g;if(c){var ee=(J-u)*A+d,te=($-u)*A+d,ne=(Q-d)/A+u,oe=(X-d)/A+u,ie=Math.max(Q,ee),re=Math.min(X,te),ae=Math.max(J,ne),se=Math.min($,oe);T=f(T,ie,re),P=f(P,ae,se)}else T=f(T,Q,X),P=f(P,J,$);this.props.grid&&(T=h(T,this.props.grid[0])),this.props.grid&&(P=h(P,this.props.grid[1]));var le={width:T-r.width,height:P-r.height};if(a&&"string"==typeof a&&m(a,"%")){T=T/b.width*100+"%"}if(s&&"string"==typeof s&&m(s,"%")){P=P/b.height*100+"%"}this.setState({width:this.calculateNewSize(T,"width"),height:this.calculateNewSize(P,"height")}),this.props.onResize&&this.props.onResize(e,i,this.resizable,le)}}},{key:"onMouseUp",value:function(e){var t=this.state,n=t.isResizing,o=t.direction,i=t.original;if(n){var r={width:this.size.width-i.width,height:this.size.height-i.height};this.props.onResizeStop&&this.props.onResizeStop(e,o,this.resizable,r),this.props.size&&this.setState(this.props.size),this.setState({isResizing:!1,resizeCursor:"auto"})}}},{key:"updateSize",value:function(e){this.setState({width:e.width,height:e.height})}},{key:"renderResizer",value:function(){var e=this,t=this.props,n=t.enable,i=t.handleStyles,r=t.handleClasses,a=t.handleWrapperStyle,s=t.handleWrapperClass,l=t.handleComponent;if(!n)return null;var c=Object.keys(n).map(function(t){return n[t]!==!1?o.createElement(u,{key:t,direction:t,onResizeStart:e.onResizeStart,replaceStyles:i&&i[t],className:r&&r[t]},l&&l[t]?o.createElement(l[t]):null):null});return o.createElement("span",{className:s,style:a},c)}},{key:"render",value:function(){var e=this,t=this.state.isResizing?d:p;return o.createElement("div",a({ref:function(t){t&&(e.resizable=t)},style:a({position:"relative"},t,this.props.style,this.sizeStyle,{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box"}),
className:this.props.className},this.extendsProps),this.state.isResizing&&o.createElement("div",{style:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:""+(this.state.resizeCursor||"auto"),opacity:"0",position:"fixed",zIndex:"9999",top:"0",left:"0",bottom:"0",right:"0"}}),this.props.children,this.renderResizer())}},{key:"parentNode",get:function(){return this.resizable.parentNode}},{key:"propsSize",get:function(){return this.props.size||this.props.defaultSize}},{key:"base",get:function(){var e=this.parentNode;if(e)for(var t=[].slice.call(e.children),n=0;n<t.length;n+=1){var o=t[n];if(o instanceof HTMLElement&&o.classList.contains("__resizable_base__"))return o}}},{key:"size",get:function(){var e=0,t=0;if("undefined"!=typeof window){var n=this.resizable.offsetWidth,o=this.resizable.offsetHeight,i=this.resizable.style.position;"relative"!==i&&(this.resizable.style.position="relative"),e="auto"!==this.resizable.style.width?this.resizable.offsetWidth:n,t="auto"!==this.resizable.style.height?this.resizable.offsetHeight:o,this.resizable.style.position=i}return{width:e,height:t}}},{key:"sizeStyle",get:function(){var e=this,t=this.props.size,n=function(t){if(void 0===e.state[t]||"auto"===e.state[t])return"auto";if(e.propsSize&&e.propsSize[t]&&m(e.propsSize[t].toString(),"%")){if(m(e.state[t].toString(),"%"))return e.state[t].toString();var n=e.getParentSize();return Number(e.state[t].toString().replace("px",""))/n[t]*100+"%"}return v(e.state[t])};return{width:t&&void 0!==t.width&&!this.state.isResizing?v(t.width):n("width"),height:t&&void 0!==t.height&&!this.state.isResizing?v(t.height):n("height")}}}]),t})(o.Component);_.defaultProps={onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0},n.exports=_}.bind(Object.create(null))),(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react-dom"),require("react")):"function"==typeof define&&define.amd?define("react-draggable",["react-dom","react"],t):"object"==typeof exports?exports.ReactDraggable=t(require("react-dom"),require("react")):e.ReactDraggable=t(e.ReactDOM,e.React)})(this,function(e,t){return(function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)})([function(e,t,n){"use strict";function o(e,t){for(var n=0,o=e.length;n<o;n++)if(t.apply(t,[e[n],n,e]))return e[n]}function i(e){return"function"==typeof e||"[object Function]"===Object.prototype.toString.call(e)}function r(e){return"number"==typeof e&&!isNaN(e)}function a(e){return parseInt(e,10)}function s(e,t,n){if(e[t])return new Error("Invalid prop "+t+" passed to "+n+" - do not set this, set it on the child.")}Object.defineProperty(t,"__esModule",{value:!0}),t.findInArray=o,t.isFunction=i,t.isNum=r,t.int=a,t.dontSetMe=s},function(e,t,n){"use strict";function o(e){return function(){return e}}var i=function(){};i.thatReturns=o,i.thatReturnsFalse=o(!1),i.thatReturnsTrue=o(!0),i.thatReturnsNull=o(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e},e.exports=i},function(e,t,n){"use strict";function o(e,t,n,o,r,a,s,l){if(i(t),!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,o,r,a,s,l],d=0;c=new Error(t.replace(/%s/g,function(){return u[d++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}}var i=function(e){};"production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&(i=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),e.exports=o},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,n){t.exports=e},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return P||(P=(0,E.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(t){return(0,E.isFunction)(e[t])})),!!(0,E.isFunction)(e[P])&&e[P](t)}function a(e,t,n){var o=e;do{if(r(o,t))return!0;if(o===n)return!1;o=o.parentNode}while(o);return!1}function s(e,t,n){e&&(e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener?e.addEventListener(t,n,!0):e["on"+t]=n)}function l(e,t,n){e&&(e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener?e.removeEventListener(t,n,!0):e["on"+t]=null)}function c(e){var t=e.clientHeight,n=e.ownerDocument.defaultView.getComputedStyle(e);return t+=(0,E.int)(n.borderTopWidth),t+=(0,E.int)(n.borderBottomWidth)}function u(e){var t=e.clientWidth,n=e.ownerDocument.defaultView.getComputedStyle(e);return t+=(0,E.int)(n.borderLeftWidth),t+=(0,E.int)(n.borderRightWidth)}function d(e){var t=e.clientHeight,n=e.ownerDocument.defaultView.getComputedStyle(e);return t-=(0,E.int)(n.paddingTop),t-=(0,E.int)(n.paddingBottom)}function p(e){var t=e.clientWidth,n=e.ownerDocument.defaultView.getComputedStyle(e);return t-=(0,E.int)(n.paddingLeft),t-=(0,E.int)(n.paddingRight)}function f(e,t){var n=t===t.ownerDocument.body,o=n?{left:0,top:0}:t.getBoundingClientRect();return{x:e.clientX+t.scrollLeft-o.left,y:e.clientY+t.scrollTop-o.top}}function h(e){var t=e.x,n=e.y;return i({},(0,A.browserPrefixToKey)("transform",T.default),"translate("+t+"px,"+n+"px)")}function m(e){return"translate("+e.x+","+e.y+")"}function v(e,t){return e.targetTouches&&(0,E.findInArray)(e.targetTouches,function(e){return t===e.identifier})||e.changedTouches&&(0,E.findInArray)(e.changedTouches,function(e){return t===e.identifier})}function g(e){return e.targetTouches&&e.targetTouches[0]?e.targetTouches[0].identifier:e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].identifier:void 0}function _(e){if(e){var t=e.getElementById("react-draggable-style-el");t||(t=e.createElement("style"),t.type="text/css",t.id="react-draggable-style-el",t.innerHTML=".react-draggable-transparent-selection *::-moz-selection {background: transparent;}\n",t.innerHTML+=".react-draggable-transparent-selection *::selection {background: transparent;}\n",e.getElementsByTagName("head")[0].appendChild(t)),e.body&&w(e.body,"react-draggable-transparent-selection")}}function y(e){try{e&&e.body&&C(e.body,"react-draggable-transparent-selection"),window.getSelection().removeAllRanges()}catch(e){}}function b(){return S({touchAction:"none"},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function w(e,t){e.classList?e.classList.add(t):e.className.match(new RegExp("(?:^|\\s)"+t+"(?!\\S)"))||(e.className+=" "+t)}function C(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(?:^|\\s)"+t+"(?!\\S)","g"),"")}Object.defineProperty(t,"__esModule",{value:!0});var S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};t.matchesSelector=r,t.matchesSelectorAndParentsTo=a,t.addEvent=s,t.removeEvent=l,t.outerHeight=c,t.outerWidth=u,t.innerHeight=d,t.innerWidth=p,t.offsetXYFromParent=f,t.createCSSTransform=h,t.createSVGTransform=m,t.getTouch=v,t.getTouchIdentifier=g,t.addUserSelectStyles=_,t.removeUserSelectStyles=y,t.styleHacks=b,t.addClassName=w,t.removeClassName=C;var E=n(0),A=n(19),T=o(A),P=""},function(e,n){e.exports=t},function(e,t,n){if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV){var o="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,i=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o};e.exports=n(14)(i,!0)}else e.exports=n(17)()},function(e,t,n){"use strict";var o=n(1),i=o;if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV){var r=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=0,r="Warning: "+e.replace(/%s/g,function(){return n[i++]});"undefined"!=typeof console&&console.error(r);try{throw new Error(r)}catch(e){}};i=function(e,t){if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){for(var n=arguments.length,o=Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];r.apply(void 0,[t].concat(o))}}}e.exports=i},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){if(!e.props.bounds)return[t,n];var o=e.props.bounds;o="string"==typeof o?o:d(o);var i=p(e);if("string"==typeof o){var r=i.ownerDocument,a=r.defaultView,s=void 0;if(s="parent"===o?i.parentNode:r.querySelector(o),!(s instanceof HTMLElement))throw new Error('Bounds selector "'+o+'" could not find an element.');var l=a.getComputedStyle(i),c=a.getComputedStyle(s);o={left:-i.offsetLeft+(0,f.int)(c.paddingLeft)+(0,f.int)(l.marginLeft),top:-i.offsetTop+(0,f.int)(c.paddingTop)+(0,f.int)(l.marginTop),right:(0,v.innerWidth)(s)-(0,v.outerWidth)(i)-i.offsetLeft+(0,f.int)(c.paddingRight)-(0,f.int)(l.marginRight),bottom:(0,v.innerHeight)(s)-(0,v.outerHeight)(i)-i.offsetTop+(0,f.int)(c.paddingBottom)-(0,f.int)(l.marginBottom)}}return(0,f.isNum)(o.right)&&(t=Math.min(t,o.right)),(0,f.isNum)(o.bottom)&&(n=Math.min(n,o.bottom)),(0,f.isNum)(o.left)&&(t=Math.max(t,o.left)),(0,f.isNum)(o.top)&&(n=Math.max(n,o.top)),[t,n]}function r(e,t,n){return[Math.round(t/e[0])*e[0],Math.round(n/e[1])*e[1]]}function a(e){return"both"===e.props.axis||"x"===e.props.axis}function s(e){return"both"===e.props.axis||"y"===e.props.axis}function l(e,t,n){var o="number"==typeof t?(0,v.getTouch)(e,t):null;if("number"==typeof t&&!o)return null;var i=p(n),r=n.props.offsetParent||i.offsetParent||i.ownerDocument.body;return(0,v.offsetXYFromParent)(o||e,r)}function c(e,t,n){var o=e.state,i=!(0,f.isNum)(o.lastX),r=p(e);return i?{node:r,deltaX:0,deltaY:0,lastX:t,lastY:n,x:t,y:n}:{node:r,deltaX:t-o.lastX,deltaY:n-o.lastY,lastX:o.lastX,lastY:o.lastY,x:t,y:n}}function u(e,t){return{node:t.node,x:e.state.x+t.deltaX,y:e.state.y+t.deltaY,deltaX:t.deltaX,deltaY:t.deltaY,lastX:e.state.x,lastY:e.state.y}}function d(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom}}function p(e){var t=m.default.findDOMNode(e);if(!t)throw new Error("<DraggableCore>: Unmounted during event!");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundPosition=i,t.snapToGrid=r,t.canDragX=a,t.canDragY=s,t.getControlPosition=l,t.createCoreData=c,t.createDraggableData=u;var f=n(0),h=n(4),m=o(h),v=n(5)},function(e,t,n){"use strict";(function(e){function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),l=(function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}})(),c=n(6),u=o(c),d=n(7),p=o(d),f=n(4),h=o(f),m=n(5),v=n(9),g=n(0),_=n(11),y=o(_),b={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}},w=b.mouse,C=(function(e){function t(){var e,n,o,a;i(this,t);for(var l=arguments.length,c=Array(l),u=0;u<l;u++)c[u]=arguments[u];return n=o=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),o.state={dragging:!1,lastX:NaN,lastY:NaN,touchIdentifier:null},o.handleDragStart=function(e){if(o.props.onMouseDown(e),!o.props.allowAnyClick&&"number"==typeof e.button&&0!==e.button)return!1;var t=h.default.findDOMNode(o);if(!t||!t.ownerDocument||!t.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");var n=t.ownerDocument;if(!(o.props.disabled||!(e.target instanceof n.defaultView.Node)||o.props.handle&&!(0,m.matchesSelectorAndParentsTo)(e.target,o.props.handle,t)||o.props.cancel&&(0,m.matchesSelectorAndParentsTo)(e.target,o.props.cancel,t))){var i=(0,m.getTouchIdentifier)(e);o.setState({touchIdentifier:i});var r=(0,v.getControlPosition)(e,i,o);if(null!=r){var a=r.x,s=r.y,l=(0,v.createCoreData)(o,a,s);(0,y.default)("DraggableCore: handleDragStart: %j",l),(0,y.default)("calling",o.props.onStart);o.props.onStart(e,l)!==!1&&(o.props.enableUserSelectHack&&(0,m.addUserSelectStyles)(n),o.setState({dragging:!0,lastX:a,lastY:s}),(0,m.addEvent)(n,w.move,o.handleDrag),(0,m.addEvent)(n,w.stop,o.handleDragStop))}}},o.handleDrag=function(e){"touchmove"===e.type&&e.preventDefault();var t=(0,v.getControlPosition)(e,o.state.touchIdentifier,o);if(null!=t){var n=t.x,i=t.y;if(Array.isArray(o.props.grid)){var r=n-o.state.lastX,a=i-o.state.lastY,l=(0,v.snapToGrid)(o.props.grid,r,a),c=s(l,2);if(r=c[0],a=c[1],!r&&!a)return;n=o.state.lastX+r,i=o.state.lastY+a}var u=(0,v.createCoreData)(o,n,i);(0,y.default)("DraggableCore: handleDrag: %j",u);if(o.props.onDrag(e,u)!==!1)o.setState({lastX:n,lastY:i});else try{o.handleDragStop(new MouseEvent("mouseup"))}catch(e){var d=document.createEvent("MouseEvents");d.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.handleDragStop(d)}}},o.handleDragStop=function(e){if(o.state.dragging){var t=(0,v.getControlPosition)(e,o.state.touchIdentifier,o);if(null!=t){var n=t.x,i=t.y,r=(0,v.createCoreData)(o,n,i),a=h.default.findDOMNode(o);a&&o.props.enableUserSelectHack&&(0,m.removeUserSelectStyles)(a.ownerDocument),(0,y.default)("DraggableCore: handleDragStop: %j",r),o.setState({dragging:!1,lastX:NaN,lastY:NaN}),o.props.onStop(e,r),a&&((0,y.default)("DraggableCore: Removing handlers"),(0,m.removeEvent)(a.ownerDocument,w.move,o.handleDrag),(0,m.removeEvent)(a.ownerDocument,w.stop,o.handleDragStop))}}},o.onMouseDown=function(e){return w=b.mouse,o.handleDragStart(e)},o.onMouseUp=function(e){return w=b.mouse,o.handleDragStop(e)},o.onTouchStart=function(e){return w=b.touch,o.handleDragStart(e)},o.onTouchEnd=function(e){return w=b.touch,o.handleDragStop(e)},a=n,r(o,a)}return a(t,e),l(t,[{key:"componentWillUnmount",value:function(){var e=h.default.findDOMNode(this);if(e){var t=e.ownerDocument;(0,m.removeEvent)(t,b.mouse.move,this.handleDrag),(0,m.removeEvent)(t,b.touch.move,this.handleDrag),(0,m.removeEvent)(t,b.mouse.stop,this.handleDragStop),(0,m.removeEvent)(t,b.touch.stop,this.handleDragStop),this.props.enableUserSelectHack&&(0,m.removeUserSelectStyles)(t)}}},{key:"render",value:function(){return u.default.cloneElement(u.default.Children.only(this.props.children),{style:(0,m.styleHacks)(this.props.children.props.style),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}}]),t})(u.default.Component);C.displayName="DraggableCore",C.propTypes={allowAnyClick:p.default.bool,disabled:p.default.bool,enableUserSelectHack:p.default.bool,offsetParent:function(t,n){if(e.browser===!0&&t[n]&&1!==t[n].nodeType)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:p.default.arrayOf(p.default.number),handle:p.default.string,cancel:p.default.string,onStart:p.default.func,onDrag:p.default.func,onStop:p.default.func,onMouseDown:p.default.func,className:g.dontSetMe,style:g.dontSetMe,transform:g.dontSetMe},C.defaultProps={allowAnyClick:!1,cancel:null,disabled:!1,enableUserSelectHack:!0,offsetParent:null,handle:null,grid:null,transform:null,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){}},t.default=C}).call(t,n(20))},function(e,t,n){"use strict";function o(){}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var o=n(13).default;e.exports=o,e.exports.default=o,e.exports.DraggableCore=n(10).default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},c=(function(){function e(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),u=(function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}})(),d=n(6),p=o(d),f=n(7),h=o(f),m=n(4),v=o(m),g=n(18),_=o(g),y=n(5),b=n(9),w=n(0),C=n(10),S=o(C),E=n(11),A=o(E),T=(function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onDragStart=function(e,t){if((0,A.default)("Draggable: onDragStart: %j",t),n.props.onStart(e,(0,b.createDraggableData)(n,t))===!1)return!1;n.setState({dragging:!0,dragged:!0})},n.onDrag=function(e,t){if(!n.state.dragging)return!1;(0,A.default)("Draggable: onDrag: %j",t);var o=(0,b.createDraggableData)(n,t),i={x:o.x,y:o.y};if(n.props.bounds){var r=i.x,a=i.y;i.x+=n.state.slackX,i.y+=n.state.slackY;var s=(0,b.getBoundPosition)(n,i.x,i.y),l=c(s,2),u=l[0],d=l[1];i.x=u,i.y=d,i.slackX=n.state.slackX+(r-i.x),i.slackY=n.state.slackY+(a-i.y),o.x=i.x,o.y=i.y,o.deltaX=i.x-n.state.x,o.deltaY=i.y-n.state.y}if(n.props.onDrag(e,o)===!1)return!1;n.setState(i)},n.onDragStop=function(e,t){if(!n.state.dragging)return!1;if(n.props.onStop(e,(0,b.createDraggableData)(n,t))===!1)return!1;(0,A.default)("Draggable: onDragStop: %j",t);var o={dragging:!1,slackX:0,slackY:0};if(Boolean(n.props.position)){var i=n.props.position,r=i.x,a=i.y;o.x=r,o.y=a}n.setState(o)},n.state={dragging:!1,dragged:!1,x:e.position?e.position.x:e.defaultPosition.x,y:e.position?e.position.y:e.defaultPosition.y,slackX:0,slackY:0,isElementSVG:!1},n}return s(t,e),u(t,[{key:"componentWillMount",value:function(){!this.props.position||this.props.onDrag||this.props.onStop||console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}},{key:"componentDidMount",value:function(){void 0!==window.SVGElement&&v.default.findDOMNode(this)instanceof window.SVGElement&&this.setState({isElementSVG:!0})}},{key:"componentWillReceiveProps",value:function(e){!e.position||this.props.position&&e.position.x===this.props.position.x&&e.position.y===this.props.position.y||this.setState({x:e.position.x,y:e.position.y})}},{key:"componentWillUnmount",value:function(){this.setState({dragging:!1})}},{key:"render",value:function(){var e,t={},n=null,o=Boolean(this.props.position),r=!o||this.state.dragging,a=this.props.position||this.props.defaultPosition,s={x:(0,b.canDragX)(this)&&r?this.state.x:a.x,y:(0,b.canDragY)(this)&&r?this.state.y:a.y};this.state.isElementSVG?n=(0,y.createSVGTransform)(s):t=(0,y.createCSSTransform)(s);var c=this.props,u=c.defaultClassName,d=c.defaultClassNameDragging,f=c.defaultClassNameDragged,h=p.default.Children.only(this.props.children),m=(0,_.default)(h.props.className||"",u,(e={},i(e,d,this.state.dragging),i(e,f,this.state.dragged),e));return p.default.createElement(S.default,l({},this.props,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),p.default.cloneElement(h,{className:m,style:l({},h.props.style,t),transform:n}))}}]),t})(p.default.Component);T.displayName="Draggable",T.propTypes=l({},S.default.propTypes,{axis:h.default.oneOf(["both","x","y","none"]),bounds:h.default.oneOfType([h.default.shape({left:h.default.number,right:h.default.number,top:h.default.number,bottom:h.default.number}),h.default.string,h.default.oneOf([!1])]),defaultClassName:h.default.string,defaultClassNameDragging:h.default.string,defaultClassNameDragged:h.default.string,defaultPosition:h.default.shape({x:h.default.number,y:h.default.number}),position:h.default.shape({x:h.default.number,y:h.default.number}),className:w.dontSetMe,style:w.dontSetMe,transform:w.dontSetMe}),T.defaultProps=l({},S.default.defaultProps,{axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},position:null}),t.default=T},function(e,t,n){"use strict";var o=n(1),i=n(2),r=n(8),a=n(15),s=n(3),l=n(16);e.exports=function(e,t){function n(e){var t=e&&(k&&e[k]||e["@@iterator"]);if("function"==typeof t)return t}function c(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function u(e){this.message=e,this.stack=""}function d(e){function n(n,l,c,d,p,f,h){if(d=d||"<<anonymous>>",f=f||c,h!==s)if(t)i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&"undefined"!=typeof console){var m=d+":"+c;!o[m]&&a<3&&(r(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",f,d),o[m]=!0,a++)}return null==l[c]?n?new u(null===l[c]?"The "+p+" `"+f+"` is marked as required in `"+d+"`, but its value is `null`.":"The "+p+" `"+f+"` is marked as required in `"+d+"`, but its value is `undefined`."):null:e(l,c,d,p,f)}if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV)var o={},a=0;var l=n.bind(null,!1);return l.isRequired=n.bind(null,!0),l}function p(e){function t(t,n,o,i,r,a){var s=t[n];if(A(s)!==e)return new u("Invalid "+i+" `"+r+"` of type `"+T(s)+"` supplied to `"+o+"`, expected `"+e+"`.");return null}return d(t)}function f(){return d(o.thatReturnsNull)}function h(e){function t(t,n,o,i,r){if("function"!=typeof e)return new u("Property `"+r+"` of component `"+o+"` has invalid PropType notation inside arrayOf.");var a=t[n];if(!Array.isArray(a)){return new u("Invalid "+i+" `"+r+"` of type `"+A(a)+"` supplied to `"+o+"`, expected an array.")}for(var l=0;l<a.length;l++){var c=e(a,l,o,i,r+"["+l+"]",s);if(c instanceof Error)return c}return null}return d(t)}function m(){function t(t,n,o,i,r){var a=t[n];if(!e(a)){return new u("Invalid "+i+" `"+r+"` of type `"+A(a)+"` supplied to `"+o+"`, expected a single ReactElement.")}return null}return d(t)}function v(e){function t(t,n,o,i,r){if(!(t[n]instanceof e)){var a=e.name||"<<anonymous>>";return new u("Invalid "+i+" `"+r+"` of type `"+x(t[n])+"` supplied to `"+o+"`, expected instance of `"+a+"`.")}return null}return d(t)}function g(e){function t(t,n,o,i,r){for(var a=t[n],s=0;s<e.length;s++)if(c(a,e[s]))return null;return new u("Invalid "+i+" `"+r+"` of value `"+a+"` supplied to `"+o+"`, expected one of "+JSON.stringify(e)+".")}return Array.isArray(e)?d(t):("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&r(!1,"Invalid argument supplied to oneOf, expected an instance of array."),o.thatReturnsNull)}function _(e){function t(t,n,o,i,r){if("function"!=typeof e)return new u("Property `"+r+"` of component `"+o+"` has invalid PropType notation inside objectOf.");var a=t[n],l=A(a);if("object"!==l)return new u("Invalid "+i+" `"+r+"` of type `"+l+"` supplied to `"+o+"`, expected an object.");for(var c in a)if(a.hasOwnProperty(c)){var d=e(a,c,o,i,r+"."+c,s);if(d instanceof Error)return d}return null}return d(t)}function y(e){function t(t,n,o,i,r){for(var a=0;a<e.length;a++){if(null==(0,e[a])(t,n,o,i,r,s))return null}return new u("Invalid "+i+" `"+r+"` supplied to `"+o+"`.")}if(!Array.isArray(e))return"production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV&&r(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),o.thatReturnsNull;for(var n=0;n<e.length;n++){var i=e[n];if("function"!=typeof i)return r(!1,"Invalid argument supplied to oneOfType. Expected an array of check functions, but received %s at index %s.",P(i),n),o.thatReturnsNull}return d(t)}function b(){function e(e,t,n,o,i){return S(e[t])?null:new u("Invalid "+o+" `"+i+"` supplied to `"+n+"`, expected a ReactNode.")}return d(e)}function w(e){function t(t,n,o,i,r){var a=t[n],l=A(a);if("object"!==l)return new u("Invalid "+i+" `"+r+"` of type `"+l+"` supplied to `"+o+"`, expected `object`.");for(var c in e){var d=e[c];if(d){var p=d(a,c,o,i,r+"."+c,s);if(p)return p}}return null}return d(t)}function C(e){function t(t,n,o,i,r){var l=t[n],c=A(l);if("object"!==c)return new u("Invalid "+i+" `"+r+"` of type `"+c+"` supplied to `"+o+"`, expected `object`.");var d=a({},t[n],e);for(var p in d){var f=e[p];if(!f)return new u("Invalid "+i+" `"+r+"` key `"+p+"` supplied to `"+o+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var h=f(l,p,o,i,r+"."+p,s);if(h)return h}return null}return d(t)}function S(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(S);if(null===t||e(t))return!0;var o=n(t);if(!o)return!1;var i,r=o.call(t);if(o!==t.entries){for(;!(i=r.next()).done;)if(!S(i.value))return!1}else for(;!(i=r.next()).done;){var a=i.value;if(a&&!S(a[1]))return!1}return!0;default:return!1}}function E(e,t){return"symbol"===e||("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}function A(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":E(t,e)?"symbol":t}function T(e){if(void 0===e||null===e)return""+e;var t=A(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function P(e){var t=T(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}function x(e){return e.constructor&&e.constructor.name?e.constructor.name:"<<anonymous>>"}var k="function"==typeof Symbol&&Symbol.iterator,R={array:p("array"),bool:p("boolean"),func:p("function"),number:p("number"),object:p("object"),string:p("string"),symbol:p("symbol"),any:f(),arrayOf:h,element:m(),instanceOf:v,node:b(),objectOf:_,oneOf:g,oneOfType:y,shape:w,exact:C};return u.prototype=Error.prototype,R.checkPropTypes=l,R.PropTypes=R,R}},function(e,t,n){"use strict";function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function i(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(e){o[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;e.exports=i()?Object.assign:function(e,t){for(var n,i,l=o(e),c=1;c<arguments.length;c++){n=Object(arguments[c]);for(var u in n)a.call(n,u)&&(l[u]=n[u]);if(r){i=r(n);for(var d=0;d<i.length;d++)s.call(n,i[d])&&(l[i[d]]=n[i[d]])}}return l}},function(e,t,n){"use strict";function o(e,t,n,o,l){if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV)for(var c in e)if(e.hasOwnProperty(c)){var u;try{i("function"==typeof e[c],"%s: %s type `%s` is invalid; it must be a function, usually from the `prop-types` package, but received `%s`.",o||"React class",n,c,typeof e[c]),u=e[c](t,c,o,n,null,a)}catch(e){u=e}if(r(!u||u instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",o||"React class",n,c,typeof u),u instanceof Error&&!(u.message in s)){s[u.message]=!0;var d=l?l():"";r(!1,"Failed %s type: %s%s",n,u.message,null!=d?d:"")}}}if("production"!==Object({DRAGGABLE_DEBUG:void 0}).NODE_ENV)var i=n(2),r=n(8),a=n(3),s={};e.exports=o},function(e,t,n){"use strict";var o=n(1),i=n(2),r=n(3);e.exports=function(){function e(e,t,n,o,a,s){s!==r&&i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=o,n.PropTypes=n,n}},function(e,t,n){var o,i;(function(){"use strict";function n(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];if(o){var i=typeof o;if("string"===i||"number"===i)e.push(o);else if(Array.isArray(o))e.push(n.apply(null,o));else if("object"===i)for(var a in o)r.call(o,a)&&o[a]&&e.push(a)}}return e.join(" ")}var r={}.hasOwnProperty;void 0!==e&&e.exports?e.exports=n:(o=[],i=function(){return n}.apply(t,o),void 0!==i&&(e.exports=i))})()},function(e,t,n){"use strict";function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"transform";if("undefined"==typeof window||void 0===window.document)return"";var t=window.document.documentElement.style;if(e in t)return"";for(var n=0;n<s.length;n++)if(i(e,s[n])in t)return s[n];return""}function i(e,t){return t?""+t+a(e):e}function r(e,t){return t?"-"+t.toLowerCase()+"-"+e:e}function a(e){for(var t="",n=!0,o=0;o<e.length;o++)n?(t+=e[o].toUpperCase(),n=!1):"-"===e[o]?n=!0:t+=e[o];return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getPrefix=o,
t.browserPrefixToKey=i,t.browserPrefixToStyle=r;var s=["Moz","Webkit","O","ms"];t.default=o()},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function r(e){if(d===clearTimeout)return clearTimeout(e);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){m&&f&&(m=!1,f.length?h=f.concat(h):v=-1,h.length&&s())}function s(){if(!m){var e=i(a);m=!0;for(var t=h.length;t;){for(f=h,h=[];++v<t;)f&&f[v].run();v=-1,t=h.length}f=null,m=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var u,d,p=e.exports={};(function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(e){d=o}})();var f,h=[],m=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new l(e,t)),1!==h.length||m||i(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}}])}),define("react-rnd",["require","exports","module","react","react-draggable","re-resizable"],function(e,t,n){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(e,t){function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function r(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&(n[o[i]]=e[o[i]]);return n}Object.defineProperty(t,"__esModule",{value:!0});var a=e("react"),s=o(e("react-draggable")),l=o(e("re-resizable")),c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},u=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},d={width:"auto",height:"auto",display:"inline-block",position:"absolute",top:0,left:0},p=(function(e){function t(t){var n=e.call(this,t)||this;return n.isResizing=!1,n.state={original:{x:0,y:0},bounds:{top:0,right:0,bottom:0,left:0},maxWidth:t.maxWidth,maxHeight:t.maxHeight},n.onResizeStart=n.onResizeStart.bind(n),n.onResize=n.onResize.bind(n),n.onResizeStop=n.onResizeStop.bind(n),n.onDragStart=n.onDragStart.bind(n),n.onDrag=n.onDrag.bind(n),n.onDragStop=n.onDragStop.bind(n),n.getMaxSizesFromProps=n.getMaxSizesFromProps.bind(n),n}return i(t,e),t.prototype.componentDidMount=function(){var e=this.getOffsetFromParent(),t=e.left,n=e.top,o=this.getDraggablePosition(),i=o.x,r=o.y;this.draggable.setState({x:i-t,y:r-n}),this.forceUpdate()},t.prototype.getDraggablePosition=function(){var e=this.draggable.state;return{x:e.x,y:e.y}},t.prototype.getParent=function(){return this.resizable&&this.resizable.parentNode},t.prototype.getParentSize=function(){return this.resizable.getParentSize()},t.prototype.getMaxSizesFromProps=function(){return{maxWidth:void 0===this.props.maxWidth?Number.MAX_SAFE_INTEGER:this.props.maxWidth,maxHeight:void 0===this.props.maxHeight?Number.MAX_SAFE_INTEGER:this.props.maxHeight}},t.prototype.getSelfElement=function(){return this.resizable&&this.resizable.resizable},t.prototype.onDragStart=function(e,t){if(this.props.onDragStart&&this.props.onDragStart(e,t),this.props.bounds){var n,o=this.getParent();if("parent"===this.props.bounds)n=o;else if("body"===this.props.bounds)n=document.body;else{if("window"===this.props.bounds){if(!this.resizable)return;return this.setState({bounds:{top:0,right:window.innerWidth-this.resizable.size.width,bottom:window.innerHeight-this.resizable.size.height,left:0}})}n=document.querySelector(this.props.bounds)}if(n instanceof HTMLElement&&o instanceof HTMLElement){var i=n.getBoundingClientRect(),r=i.left,a=i.top,s=o.getBoundingClientRect(),l=s.left,c=s.top,u=r-l,d=a-c;if(this.resizable){var p=this.getOffsetFromParent();this.setState({bounds:{top:d-p.top,right:u+(n.offsetWidth-this.resizable.size.width)-p.left,bottom:d+(n.offsetHeight-this.resizable.size.height)-p.top,left:u-p.left}})}}}},t.prototype.onDrag=function(e,t){if(this.props.onDrag){var n=this.getOffsetFromParent();this.props.onDrag(e,u({},t,{x:t.x-n.left,y:t.y-n.top}))}},t.prototype.onDragStop=function(e,t){if(this.props.onDragStop){var n=this.getOffsetFromParent(),o=n.left,i=n.top;this.props.onDragStop(e,u({},t,{x:t.x+o,y:t.y+i}))}},t.prototype.onResizeStart=function(e,t,n){if(e.stopPropagation(),this.isResizing=!0,this.setState({original:this.getDraggablePosition()}),this.props.bounds){var o=this.getParent(),i=void 0;i="parent"===this.props.bounds?o:"body"===this.props.bounds?document.body:"window"===this.props.bounds?window:document.querySelector(this.props.bounds);var r=this.getSelfElement();if(r instanceof Element&&(i instanceof HTMLElement||i===window)&&o instanceof HTMLElement){var a=this.getMaxSizesFromProps(),s=a.maxWidth,l=a.maxHeight,c=this.getParentSize();if(s&&"string"==typeof s)if(s.endsWith("%")){var u=Number(s.replace("%",""))/100;s=c.width*u}else s.endsWith("px")&&(s=Number(s.replace("px","")));if(l&&"string"==typeof l)if(l.endsWith("%")){var u=Number(l.replace("%",""))/100;l=c.width*u}else l.endsWith("px")&&(l=Number(l.replace("px","")));var d=r.getBoundingClientRect(),p=d.left,f=d.top,h="window"===this.props.bounds?{left:0,top:0}:i.getBoundingClientRect(),m=h.left,v=h.top,g="window"===this.props.bounds?window.innerWidth:i.offsetWidth,_="window"===this.props.bounds?window.innerHeight:i.offsetHeight,y=t.toLowerCase().endsWith("left"),b=t.toLowerCase().endsWith("right"),w=t.startsWith("top"),C=t.startsWith("bottom");if(y&&this.resizable){var S=p-m+this.resizable.size.width;this.setState({maxWidth:S>Number(s)?s:S})}if(b||this.props.lockAspectRatio&&!y){var S=g+(m-p);this.setState({maxWidth:S>Number(s)?s:S})}if(w&&this.resizable){var S=f-v+this.resizable.size.height;this.setState({maxHeight:S>Number(l)?l:S})}if(C||this.props.lockAspectRatio&&!w){var S=_+(v-f);this.setState({maxHeight:S>Number(l)?l:S})}}}else this.setState({maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight});this.props.onResizeStart&&this.props.onResizeStart(e,t,n)},t.prototype.onResize=function(e,t,n,o){var i,r,a=this.getOffsetFromParent();/left/i.test(t)&&(i=this.state.original.x-o.width,this.props.position||this.draggable.setState({x:i}),i+=a.left),/top/i.test(t)&&(r=this.state.original.y-o.height,this.props.position||this.draggable.setState({y:r}),r+=a.top),this.props.onResize&&(void 0===i&&(i=this.getDraggablePosition().x+a.left),void 0===r&&(r=this.getDraggablePosition().y+a.top),this.props.onResize(e,t,n,o,{x:i,y:r}))},t.prototype.onResizeStop=function(e,t,n,o){this.isResizing=!1;var i=this.getMaxSizesFromProps(),r=i.maxWidth,a=i.maxHeight;if(this.setState({maxWidth:r,maxHeight:a}),this.props.onResizeStop){var s=this.getDraggablePosition();this.props.onResizeStop(e,t,n,o,s)}},t.prototype.updateSize=function(e){this.resizable&&this.resizable.updateSize({width:e.width,height:e.height})},t.prototype.updatePosition=function(e){this.draggable.setState(e)},t.prototype.getOffsetFromParent=function(){var e=this.getParent();if(!e)return{top:0,left:0};var t=e.getBoundingClientRect(),n=t.left,o=t.top,i=this.getSelfElement().getBoundingClientRect(),r=this.getDraggablePosition();return{left:i.left-n-r.x,top:i.top-o-r.y}},t.prototype.render=function(){var e=this,t=this.props,n=t.disableDragging,o=t.style,i=t.dragHandleClassName,c=t.position,p=t.onMouseDown,f=t.dragAxis,h=t.dragGrid,m=t.bounds,v=t.enableUserSelectHack,g=t.cancel,_=t.children,y=(t.onResizeStart,t.onResize,t.onResizeStop,t.onDragStart,t.onDrag,t.onDragStop,t.resizeHandleStyles),b=t.resizeHandleClasses,w=t.enableResizing,C=t.resizeGrid,S=r(t,["disableDragging","style","dragHandleClassName","position","onMouseDown","dragAxis","dragGrid","bounds","enableUserSelectHack","cancel","children","onResizeStart","onResize","onResizeStop","onDragStart","onDrag","onDragStop","resizeHandleStyles","resizeHandleClasses","enableResizing","resizeGrid"]),E=this.props.default?u({},this.props.default):void 0;delete S.default;var A,T=n||i?{cursor:"normal"}:{cursor:"move"},P=u({},d,T,o),x=this.getOffsetFromParent(),k=x.left,R=x.top;return c&&(A={x:c.x-k,y:c.y-R}),a.createElement(s,{ref:function(t){t&&(e.draggable=t)},handle:i?"."+i:void 0,defaultPosition:E,onMouseDown:p,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,axis:f,disabled:n,grid:h,bounds:m?this.state.bounds:void 0,position:A,enableUserSelectHack:v,cancel:g},a.createElement(l,u({},S,{ref:function(t){t&&(e.resizable=t)},defaultSize:E,size:this.props.size,enable:w,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,style:P,minWidth:this.props.minWidth,minHeight:this.props.minHeight,maxWidth:this.isResizing?this.state.maxWidth:this.props.maxWidth,maxHeight:this.isResizing?this.state.maxHeight:this.props.maxHeight,grid:C,handleWrapperClass:this.props.resizeHandleWrapperClass,handleWrapperStyle:this.props.resizeHandleWrapperStyle,lockAspectRatio:this.props.lockAspectRatio,lockAspectRatioExtraWidth:this.props.lockAspectRatioExtraWidth,lockAspectRatioExtraHeight:this.props.lockAspectRatioExtraHeight,handleStyles:y,handleClasses:b}),_))},t.defaultProps={maxWidth:Number.MAX_SAFE_INTEGER,maxHeight:Number.MAX_SAFE_INTEGER,onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},onDragStart:function(){},onDrag:function(){},onDragStop:function(){}},t})(a.Component);t.Rnd=p}.bind(Object.create(null))),define("spectrum_signatures/signature_creation_modal",["require","exports","tslib","react","spectrum/modal"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={signature:""},t.handleChange=function(e){t.setState({signature:e.currentTarget.value})},t.handleSubmit=function(){""!==t.state.signature&&t.props.onSubmit(t.state.signature)},t}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(i.UtilityModal,{className:"esignature-signature-creation-modal",overlayClassName:"signature-creation-modal-overlay",title:"Add your signature",ariaLabel:"Add your signature",open:this.props.open,displayCloseButton:!0,primaryAction:"Done",onPrimaryAction:this.handleSubmit,secondaryAction:"Close",onSecondaryAction:this.props.onClose,onRequestClose:this.props.onClose},o.createElement("input",{className:"signature-input",type:"text",placeholder:"Type to sign",value:this.state.signature,onChange:this.handleChange}))},t})(o.Component);t.SignatureCreationModal=r});
//# sourceMappingURL=pkg-file_viewer.min.js-vflrpWl4o.map