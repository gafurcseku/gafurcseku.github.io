define("modules/clean/upsell/top_notification",["require","exports","jquery","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/top_notif","modules/clean/upsell/exception","modules/clean/upsell/top_notification_common","modules/clean/upsell/upsell_controller","modules/clean/viewer","modules/core/notify"],function(t,i,o,e,n,r,s,a,p,c,_){"use strict";return(function(){function t(t,i){this.options=i;try{this._constructor(t)}catch(t){s.reportJsControllerException({err:t,js_controller_options:this.options})}}return t.prototype._constructor=function(t){var i=this;o("#notify-wrapper").addClass("with-top-notification"),a.setTopNotificationClassOnBodyElement(),this.$top_notification_bar=o(t),this.$top_notification_bar.children().hasClass("over-quota-prompt-space")&&(this._resize_space_notification_bar(),o(window).on("resize",this._resize_space_notification_bar));var s=this.$top_notification_bar.find("a:not(.dismiss-button)");this.options.confirmInNewTab&&s.attr("target","_blank");var u=new p(s,this.$top_notification_bar.find(".dismiss-button"),this.options);return u.log_impression(),p.register_custom_controller({on_confirm:this._on_acknowledge,on_dismiss:this._on_acknowledge}),this.$top_notification_bar.find("a").on("click",function(t){if(o(t.currentTarget).hasClass("top-notification-bar-dismiss")&&t.preventDefault(),!i.options.notDismissable)return r.TopNotificationBar.hide()}),this.$top_notification_bar.find(".prompt-banner-email-verify-resend-link").on("click",function(t){t.preventDefault(),u.log_event("send-email-link-clicked");var r=Array.from(c.Viewer.get_viewer().get_users()).filter(function(t){return!t.is_email_verified})[0];if(null!=r){var s=e.EmailVerification.get_for_user(r);return s.send_email(n.PROMPT_CAMPAIGN,function(){return u.log_event("verification-email-sent"),_.Notify.success("Verification email sent!",5)}),s.ensure_polling(function(){return i.$top_notification_bar.hide(),o("body").removeClass("top-notification-bar"),u.log_event("email-verified"),_.Notify.success("Your email address was verified!")})}}),this.$top_notification_bar.find(".over-quota-prompt-icon").on("mouseover",function(t){var i=o("#over-quota-prompt-hover"),e=i.find(".over-quota-prompt-icon").position(),n=e.top+25,r=e.left-50;return i.find("#tooltip-selector").css("padding","20px"),i.find(".tooltip-inner").css({width:"275px","text-align":"left"}),i.find(".tooltip-bubble").css({top:n,left:r,display:"block","font-size":"12px"}),i.find("#tooltip-selector").on("mouseleave",function(t){return o(".tooltip-bubble").css("display","none")})})},t.prototype._resize_space_notification_bar=function(){var t=o(window).width(),i=.1*t;return o("#top-notification-bar-container").css({"border-left":i+"px solid #F2768B"}),o("#prompt-top-notification-bar").css({"margin-left":i*-2+30+"px"})},t.prototype.unregister_custom_controller=function(){return p.unregister_custom_controller({on_confirm:this._on_acknowledge,on_dismiss:this._on_acknowledge})},t.prototype._on_acknowledge=function(t,i){},t})()}),define("modules/clean/upsell/upsell_controller",["require","exports","jquery","modules/clean/ajax","modules/clean/upsell/exception","modules/clean/upsell/legacy_prompt_event_logging","modules/core/dom","modules/core/uri"],function(t,i,o,e,n,r,s,a){"use strict";var p=(function(){function t(i,e,n){var r=this;this._keydown=this._keydown.bind(this),this.dismiss=this.dismiss.bind(this),this.confirm=this.confirm.bind(this),this.post_dismiss=this.post_dismiss.bind(this),this.post_confirm=this.post_confirm.bind(this),this.options=n,i.length>0&&i.one("click",function(t){return r.confirm(t)}),e.length>0&&e.one("click",function(t){var i=o(t.target).hasClass("remind-me-later");return r.dismiss(t,i)}),this.options.dismissWithKeys&&o(document).on("keydown",this._keydown),t.add_tk_params(i,{addTkParams:this.options.addTkParams,campaignId:this.options.campaignId,versionId:this.options.versionId,campaignLocationTkId:this.options.campaignLocationTkId}),i.add(e).addClass("enabled")}return t.initClass=function(){this.CONFIRM="confirm",this.DISMISS="dismiss",this.LOG_IMPRESSION="log_impression"},t.prototype._keydown=function(t){if(27===t.keyCode||8===t.keyCode&&!s.focus_in_input())return t.preventDefault(),o(document).off("keydown",this._keydown),this.dismiss(t)},t.prototype._campaignUrl=function(i,o){var e=(function(){return i===t.CONFIRM?"/prompt/confirm":i===t.DISMISS?"/prompt/dismiss":i===t.LOG_IMPRESSION?"/prompt/log_impression":void 0})();if(this.options&&this.options.campaignId){var n=new a.URI({path:e}).updateQuery({campaign_id:this.options.campaignId});return this.options.versionId&&n.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),i===t.DISMISS&&o&&n.updateQuery({remind_me_later:!0}),n.toString()}},t.prototype._confirmOrDismiss=function(t,i,n,r){var s=this;return"keydown"===t.type||n||(t.stopImmediatePropagation(),t.preventDefault()),e.SilentBackgroundRequest({type:"POST",url:i,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}}).done(function(i){return"keydown"===t.type||n||t.target.click(),o(document).trigger(r,s.options)})},t.prototype.dismiss=function(i,e){var n=this._campaignUrl(t.DISMISS,e);return n&&this._confirmOrDismiss(i,n,!1,"db:prompt:dismiss"),o(document).trigger("db:prompt:pre-dismiss",this.options)},t.prototype.confirmUrl=function(t){var i=o(t.currentTarget);return(function(){return i.is("button, input")&&"submit"===i.attr("type")?o(t.currentTarget).closest("form").attr("action"):i.is("a")?o(t.currentTarget).attr("href"):void 0})()||this.options.confirmUrl},t.prototype.confirmInNewTab=function(t){var i=o(t.currentTarget),e=(function(){return i.is("button, input")&&"submit"===i.attr("type")?o(t.currentTarget).closest("form").attr("target"):i.is("a")?o(t.currentTarget).attr("target"):void 0})();return e?"_blank"===e:this.options.confirmInNewTab},t.prototype.confirm=function(i){var e=this._campaignUrl(t.CONFIRM);return e&&this._confirmOrDismiss(i,e,this.confirmInNewTab(i),"db:prompt:confirm"),o(document).trigger(r.LEGACY_EVENT_PRE_CONFIRM,this.options)},t.prototype.get_time_since_request_start=function(){if(window.performance&&window.performance.timing&&window.performance.timing.navigationStart)return(new Date).getTime()-window.performance.timing.navigationStart},t.prototype.log_impression=function(){var i=this._campaignUrl(t.LOG_IMPRESSION);if(i)return e.SilentBackgroundRequest({type:"POST",url:i,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},t.prototype.log_event=function(t){if(this.options&&this.options.campaignId){var i=new a.URI({path:"/prompt/log_event"}).updateQuery({event_name:t,campaign_id:this.options.campaignId});return this.options.versionId&&i.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),e.SilentBackgroundRequest({type:"POST",url:i.toString(),subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})}},t.prototype.post_dismiss=function(){var t=this._dismissUrl();if(t)return e.SilentBackgroundRequest({type:"POST",url:t,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},t.prototype.post_confirm=function(){var t=this._confirmUrl();if(t)return e.SilentBackgroundRequest({type:"POST",url:t,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},t.add_tk_params=function(t,i){if(i.addTkParams){if(!i.campaignId||!i.campaignLocationTkId){var e=new Error("Missing campaignId or campaignLocationTkId.");return void n.reportJsControllerException({err:e,js_controller_options:i,severity:n.SEVERITY.NONCRITICAL})}return t.each(function(t,e){var n,r=o(e);r.is("a")?n="href":(r=r.closest("form"),n="action");var s=r.attr(n);if(r.length>0&&s){var p=a.URI.parse(s);return p.updateQuery({_tk:i.campaignLocationTkId,_camp:i.versionId||i.campaignId}),r.attr(n,p.toString())}})}},t.register_custom_controller=function(t){var i=t.on_show,e=t.on_confirm,n=t.on_dismiss,s=t.pre_confirm,a=t.pre_dismiss;if(i&&o(document).on(r.LEGACY_EVENT_SHOW,i),e&&o(document).on(r.LEGACY_EVENT_CONFIRM,e),n&&o(document).on(r.LEGACY_EVENT_DISMISS,n),s&&o(document).on(r.LEGACY_EVENT_PRE_CONFIRM,s),a)return o(document).on(r.LEGACY_EVENT_PRE_DISMISS,a)},t.unregister_custom_controller=function(t){var i=t.on_show,e=t.on_confirm,n=t.on_dismiss,s=t.pre_confirm,a=t.pre_dismiss;if(i&&o(document).off(r.LEGACY_EVENT_SHOW,i),e&&o(document).off(r.LEGACY_EVENT_CONFIRM,e),n&&o(document).off(r.LEGACY_EVENT_DISMISS,n),s&&o(document).off(r.LEGACY_EVENT_PRE_CONFIRM,s),a)return o(document).off(r.LEGACY_EVENT_PRE_DISMISS,a)},t})();return p.initClass(),p});
//# sourceMappingURL=pkg-prompt-legacy.min.js-vflGDen8f.map